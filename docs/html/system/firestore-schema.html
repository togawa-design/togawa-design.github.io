<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firestore DB構成図 - L-SET ドキュメント</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background: #fafafa;
    }
    .nav { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
    .nav a { color: #0066cc; text-decoration: none; }
    .nav a:hover { text-decoration: underline; }
    h1 { color: #1a1a1a; border-bottom: 2px solid #0066cc; padding-bottom: 10px; }
    h2 { color: #333; margin-top: 2em; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
    h3 { color: #444; margin-top: 1.5em; }
    code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace; }
    pre { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace; line-height: 1.4; }
    pre code { background: none; color: inherit; padding: 0; white-space: pre; }
    table { border-collapse: collapse; width: 100%; margin: 1em 0; }
    th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
    th { background: #f5f5f5; font-weight: 600; }
    tr:nth-child(even) { background: #fafafa; }
    a { color: #0066cc; }
    ul, ol { padding-left: 1.5em; }
    li { margin: 0.3em 0; }
    blockquote { border-left: 4px solid #0066cc; margin: 1em 0; padding-left: 1em; color: #666; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.9em; }
    .mermaid { background: white; padding: 20px; border-radius: 8px; margin: 1em 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
    });
  </script>
</head>
<body>
  <nav class="nav">
    <a href="../index.html">← 目次に戻る</a>
  </nav>
  <h1>Firestore DB構成図</h1><h2>概要</h2>
リクエコで使用するCloud Firestoreのデータベース構成を記述します。</p><p>---</p><h2>コレクション構成図</h2><pre><code class="language-">firestore/
│
├── companies/                    # 会社情報
│   └── {companyDomain}/          # ドキュメントID = 会社ドメイン
│       ├── jobs/                 # サブコレクション: 求人
│       │   └── {jobId}/
│       ├── lpSettings/           # サブコレクション: LP設定
│       │   └── {jobId}/
│       └── recruitSettings/      # サブコレクション: 採用ページ設定
│           └── main/
│
├── admin_users/                  # 管理者ユーザー
│   └── {uid}/
│
├── company_users/                # 会社ユーザー
│   └── {username}/
│
├── applications/                 # 応募データ
│   └── {applicationId}/
│
├── users/                        # 一般ユーザー
│   └── {uid}/
│
├── settings/                     # 設定（担当者リスト等）
│   └── {companyDomain}/
│
├── messages/                     # メッセージ（応募者↔会社）
│   └── {messageId}/
│
├── notifications/                # 通知（会社ユーザー向け）
│   └── {notificationId}/
│
├── announcements/                # お知らせ（管理者配信）
│   └── {announcementId}/
│
├── interviews/                   # 面談スケジュール
│   └── {interviewId}/
│
├── favorites/                    # お気に入り求人
│   └── {favoriteId}/
│
└── page_analytics_events/        # アナリティクスイベント
    └── {docId}/
</code></pre><p>---</p><h2>コレクション詳細</h2><h3>companies（会社情報）</h3><pre><code class="language-typescript">// /companies/{companyDomain}
{
  company: string,           // 会社名
  companyAddress: string,    // 住所
  description: string,       // 会社説明（HTML可）
  imageUrl: string,          // 会社ロゴURL
  logoUrl: string,           // 会社ロゴURL（別名）
  designPattern: string,     // デザインパターン
  order: number,             // 表示順
  showCompany: boolean,      // 公開フラグ
  createdAt: Timestamp,
  updatedAt: Timestamp
}
</code></pre><h3>companies/{companyDomain}/jobs（求人情報）</h3><pre><code class="language-typescript">// /companies/{companyDomain}/jobs/{jobId}
{
  id: string,                 // 求人ID
  title: string,              // 募集タイトル
  location: string,           // 勤務地
  companyAddress: string,     // 会社住所
  access: string,             // アクセス情報</p><p>  // 給与情報
  salaryType: string,         // 給与形態（時給/日給/月給）
  monthlySalary: string,      // 月給
  monthlySalaryExample: string, // 月収例
  dailySalaryExample: string,   // 日収例
  yearlySalaryExample: string,  // 年収例
  totalBonus: string,         // 特典総額</p><p>  // 求人詳細
  jobType: string,            // 職種
  jobDescription: string,     // 仕事内容
  requirements: string,       // 応募資格
  benefits: string,           // 福利厚生
  workingHours: string,       // 勤務時間
  holidays: string,           // 休日
  employmentType: string,     // 雇用形態</p><p>  // 表示設定
  features: string,           // 特徴タグ（カンマ区切り）
  displayedFeatures: string,  // 表示用特徴タグ
  visible: boolean,           // 公開フラグ
  order: number,              // 表示順
  memo: string,               // 管理用メモ</p><p>  // 掲載期間
  publishStartDate: Timestamp,
  publishEndDate: Timestamp,</p><p>  // メディア
  jobLogo: string,            // 求人ロゴURL
  showVideoButton: boolean,   // 動画ボタン表示
  videoUrl: string,           // 動画URL</p><p>  createdAt: Timestamp,
  updatedAt: Timestamp
}
</code></pre><h3>companies/{companyDomain}/lpSettings（LP設定）</h3><pre><code class="language-typescript">// /companies/{companyDomain}/lpSettings/{jobId}
{
  sections: [                 // セクション配列
    {
      type: string,           // セクションタイプ
      visible: boolean,       // 表示フラグ
      order: number,          // 表示順
      settings: {             // セクション固有設定
        title: string,
        subtitle: string,
        // ... セクションタイプに応じた設定
      }
    }
  ],
  designPattern: string,      // デザインパターン
  themeColor: string,         // テーマカラー
  updatedAt: Timestamp
}
</code></pre><h3>companies/{companyDomain}/recruitSettings（採用ページ設定）</h3><pre><code class="language-typescript">// /companies/{companyDomain}/recruitSettings/main
{
  sections: [                 // セクション配列
    {
      type: string,
      visible: boolean,
      order: number,
      settings: { ... }
    }
  ],
  headerSettings: {
    logoUrl: string,
    heroImageUrl: string,
    title: string,
    subtitle: string
  },
  footerSettings: {
    companyName: string,
    address: string,
    phone: string,
    email: string
  },
  designPattern: string,
  updatedAt: Timestamp
}
</code></pre><h3>admin_users（管理者ユーザー）</h3><pre><code class="language-typescript">// /admin_users/{uid}
{
  uid: string,
  email: string,
  displayName: string,
  photoURL: string,
  role: string,               // 'admin' | 'super_admin'
  createdAt: Timestamp,
  lastLoginAt: Timestamp
}
</code></pre><h3>company_users（会社ユーザー）</h3><pre><code class="language-typescript">// /company_users/{username}
{
  username: string,
  password: string,           // ハッシュ化推奨
  companyDomain: string,      // 紐付け会社
  displayName: string,
  email: string,
  role: string,               // 'company_admin' | 'company_user'
  isActive: boolean,          // アクティブフラグ
  createdAt: Timestamp,
  lastLoginAt: Timestamp
}
</code></pre><h3>applications（応募データ）</h3><pre><code class="language-typescript">// /applications/{applicationId}
{
  // 応募者情報
  applicant: {
    name: string,
    email: string,
    phone: string,
    age: number,
    currentJob: string,
    experience: string,
    message: string
  },</p><p>  // 求人情報
  companyDomain: string,
  companyName: string,        // 会社名（表示用）
  jobId: string,
  jobTitle: string,</p><p>  // ステータス
  status: string,             // 'new' <table><tr><td>'reviewing'</td><td>'interview'</td><td>'hired'</td></tr></table> 'rejected'</p><p>  // 面談情報
  interviewId: string,        // 面談スケジュールへの参照
  interviewDate: Timestamp,
  interviewNotes: string,</p><p>  // 担当者
  assignee: string,           // 担当者名</p><p>  createdAt: Timestamp,
  updatedAt: Timestamp
}
</code></pre><h3>users（一般ユーザー）</h3><pre><code class="language-typescript">// /users/{uid}
{
  uid: string,
  email: string,
  displayName: string,
  photoURL: string,</p><p>  // プロフィール
  profile: {
    name: string,
    phone: string,
    age: number,
    currentJob: string,
    desiredJob: string,
    experience: string
  },</p><p>  createdAt: Timestamp,
  updatedAt: Timestamp
}
</code></pre><h3>settings（設定）</h3><pre><code class="language-typescript">// /settings/{companyDomain}
{
  assignees: string[],        // 担当者リスト
  updatedAt: Timestamp
}
</code></pre><h3>messages（メッセージ）</h3><pre><code class="language-typescript">// /messages/{messageId}
{
  applicationId: string,      // 紐付け応募ID
  companyDomain: string,
  from: string,               // 'company' | 'applicant'
  content: string,            // メッセージ内容
  read: boolean,              // 既読フラグ
  createdAt: Timestamp
}
</code></pre><h3>notifications（通知）</h3><pre><code class="language-typescript">// /notifications/{notificationId}
{
  type: string,               // 'application' <table><tr><td>'message'</td></tr></table> 'system'
  companyDomain: string,
  applicationId: string,
  jobId: string,
  jobTitle: string,
  applicantName: string,
  applicantEmail: string,
  isRead: boolean,
  createdAt: Timestamp
}
</code></pre><h3>announcements（お知らせ）</h3><pre><code class="language-typescript">// /announcements/{announcementId}
{
  title: string,
  content: string,
  targetAudience: string,     // 'job_seekers' <table><tr><td>'company_users'</td></tr></table> 'all'
  publishStartDate: Timestamp,
  publishEndDate: Timestamp,
  status: string,             // 'draft' | 'published'
  priority: number,
  createdBy: string,
  createdAt: Timestamp,
  updatedAt: Timestamp
}
</code></pre><h3>interviews（面談スケジュール）</h3><pre><code class="language-typescript">// /interviews/{interviewId}
{
  applicationId: string,      // 紐付け応募ID
  companyDomain: string,
  scheduledAt: Timestamp,     // 面談日時
  staffName: string,          // 担当スタッフ
  meetingType: string,        // 'in_person' <table><tr><td>'online'</td></tr></table> 'phone'
  location: string,           // 面談場所（対面の場合）
  meetingUrl: string,         // 会議URL（オンラインの場合）
  notes: string,              // メモ
  createdAt: Timestamp,
  updatedAt: Timestamp
}
</code></pre><h3>favorites（お気に入り）</h3><pre><code class="language-typescript">// /favorites/{favoriteId}
{
  userId: string,             // ユーザーID
  jobId: string,              // 求人ID
  jobTitle: string,
  companyDomain: string,
  companyName: string,
  location: string,
  monthlySalary: string,
  createdAt: Timestamp
}
</code></pre><h3>page_analytics_events（アナリティクスイベント）</h3><pre><code class="language-typescript">// /page_analytics_events/{docId}
{
  pageType: string,           // 'lp' <table><tr><td>'recruit'</td></tr></table> 'job'
  companyDomain: string,
  jobId: string,
  eventType: string,          // 'pageview' <table><tr><td>'apply_click'</td></tr></table> 'scroll'
  userAgent: string,
  referrer: string,
  createdAt: Timestamp
}
</code></pre><p>---</p><h2>インデックス設定</h2><h3>jobs コレクション</h3><pre><code class="language-json">{
  "collectionGroup": "jobs",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "visible", "order": "ASCENDING" },
    { "fieldPath": "order", "order": "ASCENDING" }
  ]
}
</code></pre><pre><code class="language-json">{
  "collectionGroup": "jobs",
  "queryScope": "COLLECTION_GROUP",
  "fields": [
    { "fieldPath": "visible", "order": "ASCENDING" },
    { "fieldPath": "publishEndDate", "order": "DESCENDING" }
  ]
}
</code></pre><h3>applications コレクション</h3><pre><code class="language-json">{
  "collectionGroup": "applications",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "companyDomain", "order": "ASCENDING" },
    { "fieldPath": "createdAt", "order": "DESCENDING" }
  ]
}
</code></pre><h3>messages コレクション</h3><pre><code class="language-json">{
  "collectionGroup": "messages",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "applicationId", "order": "ASCENDING" },
    { "fieldPath": "createdAt", "order": "ASCENDING" }
  ]
}
</code></pre><h3>notifications コレクション</h3><pre><code class="language-json">{
  "collectionGroup": "notifications",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "companyDomain", "order": "ASCENDING" },
    { "fieldPath": "isRead", "order": "ASCENDING" },
    { "fieldPath": "createdAt", "order": "DESCENDING" }
  ]
}
</code></pre><h3>favorites コレクション</h3><pre><code class="language-json">{
  "collectionGroup": "favorites",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "userId", "order": "ASCENDING" },
    { "fieldPath": "createdAt", "order": "DESCENDING" }
  ]
}
</code></pre><h3>company_users コレクション</h3><pre><code class="language-json">{
  "collectionGroup": "company_users",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "companyDomain", "order": "ASCENDING" },
    { "fieldPath": "isActive", "order": "ASCENDING" }
  ]
}
</code></pre><p>---</p><h2>セキュリティルール概要</h2><table><tr><td>コレクション</td><td>読み取り</td><td>書き込み</td></tr>
</table>
<table><tr><td>companies</td><td>全員</td><td>認証ユーザー</td></tr>
<tr><td>jobs</td><td>全員（visible=true）</td><td>認証ユーザー</td></tr>
<tr><td>lpSettings</td><td>全員</td><td>認証ユーザー</td></tr>
<tr><td>recruitSettings</td><td>全員</td><td>認証ユーザー</td></tr>
<tr><td>admin_users</td><td>認証ユーザー</td><td>管理者</td></tr>
<tr><td>company_users</td><td>全員</td><td>管理者</td></tr>
<tr><td>applications</td><td>自社のみ</td><td>認証ユーザー</td></tr>
<tr><td>users</td><td>本人のみ</td><td>本人のみ</td></tr>
<tr><td>settings</td><td>自社のみ</td><td>認証ユーザー</td></tr>
<tr><td>messages</td><td>当事者のみ</td><td>当事者のみ</td></tr>
<tr><td>notifications</td><td>自社のみ</td><td>システム</td></tr>
<tr><td>announcements</td><td>全員</td><td>管理者</td></tr>
<tr><td>interviews</td><td>自社のみ</td><td>認証ユーザー</td></tr>
<tr><td>favorites</td><td>本人のみ</td><td>本人のみ</td></tr>
<tr><td>page_analytics_events</td><td>認証ユーザー</td><td>全員</td></tr>
</table>
---</p><h2>ER図</h2><div class="mermaid">
erDiagram
    companies ||--o{ jobs : "1:N サブコレクション"
    companies ||--o{ lpSettings : "1:N サブコレクション"
    companies ||--|| recruitSettings : "1:1 サブコレクション"
    companies ||--o{ company_users : "1:N 参照"
    companies ||--o{ settings : "1:1 参照"
    jobs ||--|| lpSettings : "1:1 jobIdで紐付け"
    jobs ||--o{ applications : "1:N 参照"
    jobs ||--o{ favorites : "1:N 参照"
    applications ||--o{ messages : "1:N 参照"
    applications ||--o| interviews : "1:0..1 参照"
    users ||--o{ favorites : "1:N 参照"
    companies ||--o{ notifications : "1:N 参照"

    companies {
        string companyDomain PK
        string company
        boolean showCompany
    }

    jobs {
        string jobId PK
        string companyDomain FK
        string title
        boolean visible
        string memo
    }

    lpSettings {
        string jobId PK
        array sections
        string designPattern
    }

    recruitSettings {
        string main PK
        array sections
        string designPattern
    }

    company_users {
        string username PK
        string companyDomain FK
        string password
        string role
        boolean isActive
    }

    admin_users {
        string uid PK
        string email
        string role
    }

    applications {
        string applicationId PK
        string companyDomain FK
        string jobId FK
        object applicant
        string status
        string interviewId FK
    }

    users {
        string uid PK
        string email
        object profile
    }

    settings {
        string companyDomain PK
        array assignees
    }

    messages {
        string messageId PK
        string applicationId FK
        string from
        string content
        boolean read
    }

    notifications {
        string notificationId PK
        string companyDomain FK
        string type
        boolean isRead
    }

    interviews {
        string interviewId PK
        string applicationId FK
        timestamp scheduledAt
        string meetingType
    }

    favorites {
        string favoriteId PK
        string userId FK
        string jobId FK
    }

    announcements {
        string announcementId PK
        string title
        string status
        string targetAudience
    }
</div><p>---</p><h2>データ移行メモ</h2><h3>GAS → Firestore 移行</h3><table><tr><td>GAS（スプレッドシート）</td><td>Firestore</td></tr>
</table>
<table><tr><td>会社一覧シート</td><td>/companies</td></tr>
<tr><td>各社管理シート</td><td>/companies/{domain}/jobs</td></tr>
<tr><td>LP設定シート</td><td>/companies/{domain}/lpSettings</td></tr>
<tr><td>採用ページ設定シート</td><td>/companies/{domain}/recruitSettings</td></tr>
</table>
---</p><h2>関連ドキュメント</h2>
<ul><li><a href="../development/setup.html">環境構築手順</a></li>
<li><a href="../ui/screen-flow.html">画面遷移図</a></li>
<li><a href="./detailed-design.html">詳細設計書</a></li>
</ul>
  <div class="footer">
    <p>Generated from Markdown - L-SET Documentation</p>
  </div>
</body>
</html>