<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>インフラ構成図 - L-SET ドキュメント</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background: #fafafa;
    }
    .nav { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
    .nav a { color: #0066cc; text-decoration: none; }
    .nav a:hover { text-decoration: underline; }
    h1 { color: #1a1a1a; border-bottom: 2px solid #0066cc; padding-bottom: 10px; }
    h2 { color: #333; margin-top: 2em; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
    h3 { color: #444; margin-top: 1.5em; }
    code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace; }
    pre { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace; line-height: 1.4; }
    pre code { background: none; color: inherit; padding: 0; white-space: pre; }
    table { border-collapse: collapse; width: 100%; margin: 1em 0; }
    th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
    th { background: #f5f5f5; font-weight: 600; }
    tr:nth-child(even) { background: #fafafa; }
    a { color: #0066cc; }
    ul, ol { padding-left: 1.5em; }
    li { margin: 0.3em 0; }
    blockquote { border-left: 4px solid #0066cc; margin: 1em 0; padding-left: 1em; color: #666; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.9em; }
    .mermaid { background: white; padding: 20px; border-radius: 8px; margin: 1em 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
    });
  </script>
</head>
<body>
  <nav class="nav">
    <a href="../index.html">← 目次に戻る</a>
  </nav>
  <h1>インフラ構成図</h1><h2>概要</h2><p>本システムはGoogle Cloud Platform（GCP）とFirebaseを基盤とし、GitHub Pagesでフロントエンドをホスティング。</p><p>---</p><h2>全体構成図</h2><pre><code class="language-">┌─────────────────────────────────────────────────────────────────────────┐
│                              インターネット                               │
└─────────────────────────────────────────────────────────────────────────┘
                │                    │                    │
                ▼                    ▼                    ▼
┌───────────────────┐  ┌───────────────────┐  ┌───────────────────────────┐
│   GitHub Pages    │  │   Cloud Functions │  │     外部サービス           │
│  (フロントエンド)   │  │    (バックエンド)   │  │                           │
│                   │  │                   │  │  ・Google Analytics 4     │
│  ・admin.html     │  │  ・getAnalyticsData│  │  ・SendGrid              │
│  ・company-recruit│  │  ・legacyLogin     │  │  ・Cloudinary            │
│  ・lp.html        │  │  ・sendEmail       │  │  ・Google Calendar API   │
│                   │  │  ・etc...          │  │  ・e-Stat API            │
└───────────────────┘  └───────────────────┘  └───────────────────────────┘
                │                    │
                │                    ▼
                │         ┌───────────────────┐
                │         │     Firebase      │
                │         │                   │
                └────────▶│  ・Authentication │
                          │  ・Firestore      │
                          │  ・Storage        │
                          └───────────────────┘
</code></pre><p>---</p><h2>環境構成</h2><h3>本番環境</h3><table><tr><td>サービス</td><td>プロジェクトID / URL</td></tr>
</table>
<table><tr><td>GCP Project</td><td><code>generated-area-484613-e3</code></td></tr>
<tr><td>Firebase Project</td><td><code>generated-area-484613-e3-90bd4</code></td></tr>
<tr><td>Cloud Functions</td><td><code>asia-northeast1-generated-area-484613-e3.cloudfunctions.net</code></td></tr>
<tr><td>GitHub Pages</td><td><code>https://togawa-design.github.io</code></td></tr>
<tr><td>カスタムドメイン</td><td><code>https://rikueco.jp</code></td></tr>
<tr><td>GA4 Property</td><td><code>520379160</code></td></tr>
</table>
<h3>開発環境</h3><table><tr><td>サービス</td><td>プロジェクトID / URL</td></tr>
</table>
<table><tr><td>GCP Project</td><td><code>lset-dev</code></td></tr>
<tr><td>Firebase Project</td><td><code>lset-dev</code></td></tr>
<tr><td>Cloud Functions</td><td><code>asia-northeast1-lset-dev.cloudfunctions.net</code></td></tr>
<tr><td>GA4 Property</td><td><code>524526933</code></td></tr>
</table>
---</p><h2>GCPリソース詳細</h2><h3>Cloud Functions</h3><table><tr><td>関数名</td><td>Gen</td><td>ランタイム</td><td>メモリ</td><td>タイムアウト</td></tr>
</table>
<table><tr><td>getAnalyticsData</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>trackPageAnalytics</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>getPageAnalytics</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>sendEmail</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>inboundParse</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>getEmails</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>createCompanyUser</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>createCompanyStaff</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>deleteCompanyUser</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>legacyLogin</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>resetLegacyPassword</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>initiateCalendarAuth</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>calendarOAuthCallback</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>getCalendarAvailability</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>createCalendarEvent</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>getCalendarIntegration</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>revokeCalendarAuth</td><td>Gen1</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>syncSalaryData</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
<tr><td>getSalaryData</td><td>Gen2</td><td>Node.js 22</td><td>256MB</td><td>60s</td></tr>
</table>
<h3>Firebase</h3><p>#### Authentication
<ul><li>メール/パスワード認証: 有効</li>
<li>Google認証: 有効</li>
</ul>
#### Firestore
<ul><li>リージョン: <code>asia-northeast1</code></li>
<li>モード: Native</li>
</ul>
<strong>主要コレクション:</strong>
<ul><li><code>companies</code> - 会社情報</li>
<li><code>company_users</code> - 会社ユーザー</li>
<li><code>admins</code> - システム管理者</li>
<li><code>jobs</code> - 求人情報</li>
<li><code>applications</code> - 応募情報</li>
<li><code>emails</code> - メール履歴</li>
<li><code>calendar_tokens</code> - カレンダー連携トークン</li>
<li><code>page_analytics</code> - ページアナリティクス</li>
</ul>
#### Storage
<ul><li>バケット: <code>generated-area-484613-e3-90bd4.appspot.com</code></li>
<li>用途: 画像アップロード（Cloudinaryへ移行済み）</li>
</ul>
---</p><h2>ネットワーク構成</h2><pre><code class="language-">┌──────────────────────────────────────────────────────────────┐
│                         ユーザー                              │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│                      CDN / DNS                               │
│  ・GitHub Pages (togawa-design.github.io)                   │
│  ・カスタムドメイン (rikueco.jp)                              │
└──────────────────────────────────────────────────────────────┘
                              │
            ┌─────────────────┼─────────────────┐
            ▼                 ▼                 ▼
┌───────────────────┐ ┌───────────────┐ ┌───────────────────┐
│   静的コンテンツ    │ │  API リクエスト │ │  Firebase SDK    │
│  (HTML/CSS/JS)    │ │  (HTTPS)      │ │  (WebSocket)     │
└───────────────────┘ └───────────────┘ └───────────────────┘
            │                 │                 │
            ▼                 ▼                 ▼
┌───────────────────┐ ┌───────────────┐ ┌───────────────────┐
│   GitHub Pages    │ │Cloud Functions│ │    Firebase       │
│                   │ │   (Gen1/2)    │ │  Auth/Firestore   │
└───────────────────┘ └───────────────┘ └───────────────────┘
</code></pre><p>---</p><h2>セキュリティ</h2><h3>アクセス制御</h3><table><tr><td>レイヤー</td><td>制御方法</td></tr>
</table>
<table><tr><td>Cloud Functions</td><td>CORS設定、Firebase ID Token検証</td></tr>
<tr><td>Firestore</td><td>セキュリティルール</td></tr>
<tr><td>Firebase Auth</td><td>メール確認、パスワードポリシー</td></tr>
</table>
<h3>暗号化</h3><table><tr><td>データ</td><td>暗号化方式</td></tr>
</table>
<table><tr><td>通信</td><td>HTTPS/TLS 1.3</td></tr>
<tr><td>Firestore</td><td>保存時暗号化（デフォルト）</td></tr>
<tr><td>パスワード</td><td>bcrypt（ソルト付きハッシュ）</td></tr>
</table>
---</p><h2>監視・ログ</h2><table><tr><td>項目</td><td>サービス</td></tr>
</table>
<table><tr><td>アプリケーションログ</td><td>Cloud Logging</td></tr>
<tr><td>エラー監視</td><td>Cloud Error Reporting</td></tr>
<tr><td>パフォーマンス</td><td>Cloud Monitoring</td></tr>
<tr><td>アナリティクス</td><td>Google Analytics 4</td></tr>
</table>
---</p><h2>コスト構造</h2><h3>無料枠内で運用可能な項目</h3><ul><li>GitHub Pages: 無料</li>
<li>Firebase Auth: 10,000 MAU まで無料</li>
<li>Firestore: 1GB ストレージ、50,000 読み取り/日 まで無料</li>
<li>Cloud Functions: 200万呼び出し/月 まで無料</li>
</ul>
<h3>有料サービス</h3><table><tr><td>サービス</td><td>料金体系</td></tr>
</table>
<table><tr><td>SendGrid</td><td>従量課金 or プラン</td></tr>
<tr><td>Cloudinary</td><td>従量課金 or プラン</td></tr>
<tr><td>GA4</td><td>無料</td></tr>
</table>
  <div class="footer">
    <p>Generated from Markdown - L-SET Documentation</p>
  </div>
</body>
</html>