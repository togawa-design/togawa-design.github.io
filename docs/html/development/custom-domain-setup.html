<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Pages カスタムドメイン設定手順 - L-SET ドキュメント</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background: #fafafa;
    }
    .nav { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
    .nav a { color: #0066cc; text-decoration: none; }
    .nav a:hover { text-decoration: underline; }
    h1 { color: #1a1a1a; border-bottom: 2px solid #0066cc; padding-bottom: 10px; }
    h2 { color: #333; margin-top: 2em; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
    h3 { color: #444; margin-top: 1.5em; }
    code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace; }
    pre { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace; line-height: 1.4; }
    pre code { background: none; color: inherit; padding: 0; white-space: pre; }
    table { border-collapse: collapse; width: 100%; margin: 1em 0; }
    th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
    th { background: #f5f5f5; font-weight: 600; }
    tr:nth-child(even) { background: #fafafa; }
    a { color: #0066cc; }
    ul, ol { padding-left: 1.5em; }
    li { margin: 0.3em 0; }
    blockquote { border-left: 4px solid #0066cc; margin: 1em 0; padding-left: 1em; color: #666; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.9em; }
    .mermaid { background: white; padding: 20px; border-radius: 8px; margin: 1em 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
    });
  </script>
</head>
<body>
  <nav class="nav">
    <a href="../index.html">← 目次に戻る</a>
  </nav>
  <h1>GitHub Pages カスタムドメイン設定手順</h1><h2>概要</h2><p>GitHub Pages（togawa-design.github.io）をカスタムドメインに移行するための手順書。</p><p>---</p><h2>1. お名前.com DNS設定</h2><h3>Apexドメイン（example.com）を使う場合</h3><p>DNS設定画面で以下のAレコードを追加:</p><table><tr><td>ホスト名</td><td>TYPE</td><td>TTL</td><td>VALUE</td></tr>
</table>
<table><tr><td>(空白)</td><td>A</td><td>3600</td><td>185.199.108.153</td></tr>
<tr><td>(空白)</td><td>A</td><td>3600</td><td>185.199.109.153</td></tr>
<tr><td>(空白)</td><td>A</td><td>3600</td><td>185.199.110.153</td></tr>
<tr><td>(空白)</td><td>A</td><td>3600</td><td>185.199.111.153</td></tr>
</table>
<h3>サブドメイン（www.example.com）を使う場合</h3><table><tr><td>ホスト名</td><td>TYPE</td><td>TTL</td><td>VALUE</td></tr>
</table>
<table><tr><td>www</td><td>CNAME</td><td>3600</td><td>togawa-design.github.io</td></tr>
</table>
<h3>両方使う場合（推奨）</h3><p>上記のAレコード4つ + CNAMEレコード1つを全て追加。</p><p>---</p><h2>2. GitHub リポジトリ設定</h2><p><li>リポジトリの <strong>Settings</strong> → <strong>Pages</strong> を開く</li>
<li><strong>Custom domain</strong> 欄にドメインを入力（例: <code>example.com</code>）</li>
<li><strong>Save</strong> をクリック</li>
<li>DNS確認が完了するまで待つ（数分〜最大48時間）</li>
<li><strong>Enforce HTTPS</strong> にチェックを入れる（DNS確認後に有効化可能）</li></p><p>---</p><h2>3. CNAMEファイルの追加</h2><h3>方法A: GitHub Actions で自動追加（推奨）</h3><p><code>.github/workflows/deploy.yml</code> を編集:</p><pre><code class="language-yaml"><h1>107行目付近の「# .nojekyll ファイルを作成」の後に追加</h1>
          # CNAME ファイルを作成（カスタムドメイン用）
          echo "YOUR-DOMAIN.com" > CNAME
</code></pre><h3>方法B: 手動で追加</h3><p>gh-pages ブランチのルートに <code>CNAME</code> ファイルを作成:</p><pre><code class="language-">YOUR-DOMAIN.com
</code></pre><p>---</p><h2>4. Firebase Authentication 承認済みドメイン追加</h2><h3>設定場所</h3><p>Firebase Console:
https://console.firebase.google.com/project/generated-area-484613-e3-90bd4/authentication/settings</p><h3>手順</h3><p><li><strong>Authentication</strong> → <strong>Settings</strong> → <strong>承認済みドメイン</strong> を開く</li>
<li><strong>ドメインを追加</strong> をクリック</li>
<li>カスタムドメインを入力（例: <code>example.com</code>）</li>
<li>保存</li></p><p>---</p><h2>5. Cloud Functions CORS設定更新</h2><h3>修正ファイル</h3><p><code>functions/index.js</code></p><h3>修正箇所1: corsHandler（21行目付近）</h3><pre><code class="language-javascript">const corsHandler = cors({
  origin: [
    'http://localhost:3000',
    'http://localhost:3001',
    'http://localhost:3002',
    'http://localhost:3003',
    'http://localhost:3004',
    'http://localhost:3005',
    'http://localhost:5500',
    'http://localhost:5502',
    'http://127.0.0.1:3000',
    'http://127.0.0.1:3001',
    'http://127.0.0.1:3002',
    'http://127.0.0.1:3003',
    'http://127.0.0.1:3004',
    'http://127.0.0.1:3005',
    'http://127.0.0.1:5500',
    'http://127.0.0.1:5502',
    'https://togawa-design.github.io',
    'https://YOUR-DOMAIN.com',      // ← 追加
    'https://www.YOUR-DOMAIN.com'   // ← 追加
  ],
  methods: ['GET', 'POST', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization'],
  credentials: true
});
</code></pre><h3>修正箇所2: legacyLogin の allowedOrigins（3608行目付近）</h3><pre><code class="language-javascript">const allowedOrigins = [
  'http://localhost:3000',
  'http://localhost:3001',
  'http://localhost:3002',
  'http://localhost:3003',
  'http://localhost:3004',
  'http://localhost:3005',
  'http://127.0.0.1:3000',
  'https://togawa-design.github.io',
  'https://YOUR-DOMAIN.com',      // ← 追加
  'https://www.YOUR-DOMAIN.com'   // ← 追加
];
</code></pre><h3>デプロイ</h3><pre><code class="language-bash">cd functions</p><h1>全関数をデプロイ（時間がかかる）</h1>
npm run deploy
npm run deploy:auth
npm run deploy:sendEmail
npm run deploy:calendar</p><h1>または個別にデプロイ</h1>
gcloud functions deploy <関数名> --gen2 --runtime nodejs20 --trigger-http --allow-unauthenticated --region asia-northeast1 --project generated-area-484613-e3
</code></pre><p>---</p><h2>6. OAuth コールバックURL更新</h2><h3>修正ファイル</h3><p><code>functions/index.js</code></p><h3>修正箇所（2600行目、2731行目付近）</h3><pre><code class="language-javascript">// 変更前
const frontendRedirectUri = process.env.FRONTEND_CALLBACK_URL || 'https://togawa-design.github.io/oauth-callback.html';</p><p>// 変更後
const frontendRedirectUri = process.env.FRONTEND_CALLBACK_URL || 'https://YOUR-DOMAIN.com/oauth-callback.html';
</code></pre><h3>または環境変数で設定</h3><p>デプロイ時に環境変数を設定:</p><pre><code class="language-bash">gcloud functions deploy initiateCalendarAuth \
  --set-env-vars FRONTEND_CALLBACK_URL=https://YOUR-DOMAIN.com/oauth-callback.html \
  ...
</code></pre><p>---</p><h2>7. Google Cloud Console OAuth設定</h2><h3>設定場所</h3><p>Google Cloud Console:
https://console.cloud.google.com/apis/credentials?project=generated-area-484613-e3</p><h3>手順</h3><p><li><strong>APIとサービス</strong> → <strong>認証情報</strong> を開く</li>
<li>OAuth 2.0 クライアントID をクリック</li>
<li><strong>承認済みの JavaScript 生成元</strong> に追加:</li>
   - <code>https://YOUR-DOMAIN.com</code>
   - <code>https://www.YOUR-DOMAIN.com</code>
<li><strong>承認済みのリダイレクト URI</strong> に追加:</li>
   - <code>https://YOUR-DOMAIN.com/oauth-callback.html</code>
<li>保存</li></p><p>---</p><h2>作業順序チェックリスト</h2><table><tr><td>#</td><td>作業</td><td>状態</td><td>備考</td></tr>
</table>
<table><tr><td>1</td><td>お名前.com DNS設定</td><td>[ ]</td><td>Aレコード4つ + CNAME</td></tr>
<tr><td>2</td><td>GitHub Pages カスタムドメイン設定</td><td>[ ]</td><td>Settings → Pages</td></tr>
<tr><td>3</td><td>CNAME ファイル追加</td><td>[ ]</td><td>deploy.yml または手動</td></tr>
<tr><td>4</td><td>Firebase 承認済みドメイン追加</td><td>[ ]</td><td>Authentication設定</td></tr>
<tr><td>5</td><td>Cloud Functions CORS更新</td><td>[ ]</td><td>index.js 2箇所</td></tr>
<tr><td>6</td><td>Cloud Functions デプロイ</td><td>[ ]</td><td>npm run deploy:*</td></tr>
<tr><td>7</td><td>OAuth コールバックURL更新</td><td>[ ]</td><td>index.js 2箇所</td></tr>
<tr><td>8</td><td>Google Cloud OAuth設定</td><td>[ ]</td><td>認証情報</td></tr>
<tr><td>9</td><td>DNS浸透確認</td><td>[ ]</td><td>dig コマンド</td></tr>
<tr><td>10</td><td>HTTPS有効化確認</td><td>[ ]</td><td>GitHub Pages設定</td></tr>
<tr><td>11</td><td>動作確認</td><td>[ ]</td><td>ログイン、API呼び出し</td></tr>
</table>
---</p><h2>確認コマンド</h2><h3>DNS浸透確認</h3><pre><code class="language-bash"><h1>Aレコード確認</h1>
dig YOUR-DOMAIN.com +short</p><h1>期待する出力</h1>
185.199.108.153
185.199.109.153
185.199.110.153
185.199.111.153</p><h1>CNAME確認</h1>
dig www.YOUR-DOMAIN.com +short
</code></pre><h3>HTTPSアクセス確認</h3><pre><code class="language-bash">curl -I https://YOUR-DOMAIN.com
</code></pre><p>---</p><h2>トラブルシューティング</h2><h3>DNS浸透に時間がかかる</h3><ul><li>最大48時間かかることがある</li>
<li>急ぐ場合はTTLを短く設定（300秒など）</li>
</ul>
<h3>HTTPS証明書エラー</h3><ul><li>DNS確認完了後、GitHub側で証明書が自動発行される</li>
<li>数分〜数十分かかる場合がある</li>
</ul>
<h3>CORSエラー</h3><ul><li>Cloud Functionsのデプロイ忘れがないか確認</li>
<li>ブラウザのキャッシュをクリア</li>
</ul>
<h3>Googleログインできない</h3><ul><li>Firebase Authentication の承認済みドメインを確認</li>
<li>Google Cloud Console の OAuth設定を確認</li>
</ul>
---</p><h2>置換リスト</h2><p>ドメイン決定後、以下を一括置換:</p><table><tr><td>検索文字列</td><td>置換後</td></tr>
</table>
<table><tr><td><code>YOUR-DOMAIN.com</code></td><td>実際のドメイン</td></tr>
<tr><td><code>togawa-design.github.io</code></td><td>実際のドメイン（必要に応じて残す）</td></tr>
</table>
---</p><h2>関連ドキュメント</h2><ul><li><a href="https://docs.github.com/ja/pages/configuring-a-custom-domain-for-your-github-pages-site">GitHub Pages カスタムドメイン設定</a></li>
<li><a href="https://firebase.google.com/docs/auth/web/google-signin">Firebase Authentication 承認済みドメイン</a></li>
</ul>
  <div class="footer">
    <p>Generated from Markdown - L-SET Documentation</p>
  </div>
</body>
</html>