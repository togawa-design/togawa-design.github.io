import{escapeHtml as e}from"./utils-BB91om2o.js";import{s as t}from"./modal-gG-182nw.js";const n="https://asia-northeast1-generated-area-484613-e3-90bd4.cloudfunctions.net";async function a(){const e=await async function(){try{const e=firebase.auth().currentUser;if(e)return await e.getIdToken()}catch(e){console.warn("Failed to get ID token:",e)}return null}(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}async function i(e,t,i){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)throw new Error("ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚æœ¬ç•ªç’°å¢ƒã§ãŠè©¦ã—ãã ã•ã„ã€‚");const s=await a(),l=await fetch(`${n}/initiateCalendarAuth`,{method:"POST",headers:s,body:JSON.stringify({companyDomain:e,companyUserId:t,staffName:i})});if(!l.ok){const e=await l.json();throw new Error(e.error||"èªè¨¼URLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}return l.json()}async function s(e,t){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)return console.log("[Calendar] ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã¯åˆ©ç”¨ã§ãã¾ã›ã‚“"),{success:!0,integration:null};const i=await a(),s=new URLSearchParams({companyDomain:e,companyUserId:t}),l=await fetch(`${n}/getCalendarIntegration?${s}`,{headers:i});if(!l.ok){const e=await l.json();throw new Error(e.error||"é€£æºæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}return l.json()}async function l(e,t){const i=await a(),s=await fetch(`${n}/revokeCalendarAuth`,{method:"POST",headers:i,body:JSON.stringify({companyDomain:e,companyUserId:t})});if(!s.ok){const e=await s.json();throw new Error(e.error||"é€£æºè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}return s.json()}async function o(e,t,i,s){const l=await a(),o=new URLSearchParams({companyDomain:e,companyUserId:t,startDate:i,endDate:s}),r=await fetch(`${n}/getCalendarAvailability?${o}`,{headers:l});if(!r.ok){const e=await r.json();throw new Error(e.error||"ç©ºãæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}return r.json()}async function r(e){const t=await a(),i=await fetch(`${n}/createCalendarEvent`,{method:"POST",headers:t,body:JSON.stringify(e)});if(!i.ok){const e=await i.json();throw new Error(e.error||"ã‚¤ãƒ™ãƒ³ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}return i.json()}function c(e){const t=new Date(e),n=t.getDay(),a=t.getDate()-n+(0===n?-6:1);return t.setDate(a),t.setHours(0,0,0,0),t}function d(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function u(e){return["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][e.getDay()]}const p={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"};let v=null,m=null,f=[],g=[],y=1;let h=null,w=[],b={},$=[],L={},D=null,E=null,k="";function A(e){return document.getElementById(k+e)}const x={new:"æ–°è¦",contacted:"é€£çµ¡æ¸ˆã¿",interviewing:"é¢æ¥èª¿æ•´ä¸­",interviewed:"é¢æ¥æ¸ˆã¿",hired:"æ¡ç”¨",joined:"å…¥ç¤¾",pending:"ä¿ç•™",ng:"NG",rejected:"ä¸æ¡ç”¨",withdrawn:"è¾é€€"},S={apply:"å¿œå‹Ÿ",line:"LINEç›¸è«‡",consult:"ãŠå•ã„åˆã‚ã›"},T={immediate:"ã™ãã«ã§ã‚‚","within-week":"1é€±é–“ä»¥å†…","within-month":"1ãƒ¶æœˆä»¥å†…","within-2months":"2ãƒ¶æœˆä»¥å†…",undecided:"æœªå®šãƒ»ç›¸è«‡ã—ãŸã„"},j={first_contact:{subject:"åˆå›é€£çµ¡",body:"{applicantName}æ§˜\n\nã“ã®åº¦ã¯ã€Œ{jobTitle}ã€ã«ã”å¿œå‹Ÿã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚\n\nã”å¿œå‹Ÿå†…å®¹ã‚’ç¢ºèªã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚\nã¤ãã¾ã—ã¦ã¯ã€ä¸€åº¦ãŠé›»è©±ã«ã¦ãŠè©±ã‚’ã•ã›ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚\n\nã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã‚’ã„ãã¤ã‹ãŠçŸ¥ã‚‰ã›ã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚\nï¼ˆå¹³æ—¥10:00ã€œ18:00ã®é–“ã§ãŠé¡˜ã„ã§ãã¾ã™ã¨å¹¸ã„ã§ã™ï¼‰\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\nä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"},schedule_interview:{subject:"é¢æ¥æ—¥ç¨‹èª¿æ•´",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\né¢æ¥ã®æ—¥ç¨‹èª¿æ•´ã«ã¤ã„ã¦ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚\n\nä¸‹è¨˜ã®æ—¥ç¨‹ã§ã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã¯ã”ã–ã„ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚\n\nã€å€™è£œæ—¥ã€‘\nãƒ»â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\nãƒ»â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\nãƒ»â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\n\nä¸Šè¨˜ä»¥å¤–ã§ã‚‚ã”èª¿æ•´å¯èƒ½ã§ã™ã®ã§ã€ã”å¸Œæœ›ã®æ—¥æ™‚ãŒã”ã–ã„ã¾ã—ãŸã‚‰ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚\n\nä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"},interview_reminder:{subject:"é¢æ¥ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\né¢æ¥æ—¥ç¨‹ã®ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’ãŠé€ã‚Šã„ãŸã—ã¾ã™ã€‚\n\nã€é¢æ¥æ—¥æ™‚ã€‘â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\nã€å ´æ‰€ã€‘ã€’â—¯â—¯â—¯-â—¯â—¯â—¯â—¯ â—¯â—¯çœŒâ—¯â—¯å¸‚â—¯â—¯\nã€æŒã¡ç‰©ã€‘å±¥æ­´æ›¸ã€ç­†è¨˜ç”¨å…·\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\nå½“æ—¥ãŠä¼šã„ã§ãã‚‹ã“ã¨ã‚’æ¥½ã—ã¿ã«ã—ã¦ãŠã‚Šã¾ã™ã€‚"},document_request:{subject:"æ›¸é¡æå‡ºä¾é ¼",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\né¸è€ƒã‚’é€²ã‚ã‚‹ã«ã‚ãŸã‚Šã€ä¸‹è¨˜ã®æ›¸é¡ã‚’ã”æå‡ºã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚\n\nã€æå‡ºæ›¸é¡ã€‘\nãƒ»å±¥æ­´æ›¸ï¼ˆå†™çœŸè²¼ä»˜ï¼‰\nãƒ»è·å‹™çµŒæ­´æ›¸\n\nã€æå‡ºæ–¹æ³•ã€‘\nãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã«ã¦ã”é€ä»˜ãã ã•ã„ã€‚\n\nã€æå‡ºæœŸé™ã€‘\nâ—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰ã¾ã§\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\nä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"},result_pending:{subject:"é¸è€ƒçµæœå¾…ã¡",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\nå…ˆæ—¥ã¯é¢æ¥ã«ãŠè¶Šã—ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\nç¾åœ¨ã€ç¤¾å†…ã«ã¦é¸è€ƒã‚’é€²ã‚ã¦ãŠã‚Šã¾ã™ã€‚\nçµæœã«ã¤ãã¾ã—ã¦ã¯ã€â—¯æœˆâ—¯æ—¥é ƒã¾ã§ã«ã”é€£çµ¡ã•ã›ã¦ã„ãŸã ãäºˆå®šã§ã™ã€‚\n\nä»Šã—ã°ã‚‰ããŠå¾…ã¡ã„ãŸã ã‘ã¾ã™ã‚ˆã†ãŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚"},offer:{subject:"å†…å®šé€šçŸ¥",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\nã“ã®åº¦ã¯ã€Œ{jobTitle}ã€ã®é¸è€ƒã«ã”å‚åŠ ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\næ…é‡ã«æ¤œè¨ã•ã›ã¦ã„ãŸã ã„ãŸçµæœã€{applicantName}æ§˜ã‚’æ¡ç”¨ã•ã›ã¦ã„ãŸã ãã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚\n\nã¤ãã¾ã—ã¦ã¯ã€å…¥ç¤¾ã«é–¢ã™ã‚‹è©³ç´°ã«ã¤ã„ã¦ã”èª¬æ˜ã•ã›ã¦ã„ãŸã ããŸãã€\nãŠé›»è©±ã«ã¦ã”é€£çµ¡ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n{applicantName}æ§˜ã¨ä¸€ç·’ã«åƒã‘ã‚‹ã“ã¨ã‚’æ¥½ã—ã¿ã«ã—ã¦ãŠã‚Šã¾ã™ã€‚"},rejection:{subject:"ä¸æ¡ç”¨é€šçŸ¥",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\nã“ã®åº¦ã¯ã€Œ{jobTitle}ã€ã«ã”å¿œå‹Ÿã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\næ…é‡ã«æ¤œè¨ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸãŒã€èª ã«æ®‹å¿µãªãŒã‚‰ä»Šå›ã¯ã”æœŸå¾…ã«æ²¿ãˆãªã„çµæœã¨ãªã‚Šã¾ã—ãŸã€‚\n\nã”å¿œå‹Ÿã„ãŸã ã„ãŸã“ã¨ã«å¿ƒã‚ˆã‚Šæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã¨ã¨ã‚‚ã«ã€\n{applicantName}æ§˜ã®ä»Šå¾Œã®ã”æ´»èºã‚’ãŠç¥ˆã‚Šç”³ã—ä¸Šã’ã¾ã™ã€‚"}};function C(){return firebase.apps.length||firebase.initializeApp(p),firebase.firestore()}async function M(){try{const e=C(),t=await e.collection("company_users").where("companyDomain","==",v).where("isActive","==",!0).get();return $=[],t.forEach(e=>{$.push({id:e.id,...e.data()})}),await async function(){L={};for(const t of $)try{const e=await s(v,t.id);e.integration&&(L[t.id]=e.integration)}catch(e){console.log(`No calendar integration for user ${t.id}`)}}(),$}catch(e){return console.error("Failed to load company users:",e),[]}}function I(e){const t=document.querySelector(".applicants-content"),n=A("settings-section"),a=A("page-title"),i=document.querySelector(".header-actions");if("settings"===e){t&&(t.style.display="none"),n&&(n.style.display="block"),a&&(a.textContent="è¨­å®š"),i&&(i.style.display="none"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("nav-settings");e&&e.closest("li").classList.add("active"),N()}else{t&&(t.style.display="flex"),n&&(n.style.display="none"),a&&(a.textContent="å¿œå‹Ÿè€…ä¸€è¦§"),i&&(i.style.display="flex"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const e=document.querySelector('[data-section="applicants"]');e&&e.closest("li").classList.add("active")}}function N(){const n=A("calendar-integrations-list");n&&(0!==$.length?(n.innerHTML=$.map(t=>{const n=L[t.id],a=n&&n.isActive;return`\n      <div class="calendar-integration-item" data-user-id="${e(t.id)}">\n        <div class="calendar-integration-info">\n          <div class="calendar-integration-icon">ğŸ‘¤</div>\n          <div class="calendar-integration-details">\n            <h4>${e(t.name||t.username)}</h4>\n            <p>${a?e(n.googleEmail):"æœªé€£æº"}</p>\n          </div>\n        </div>\n        <div class="calendar-integration-actions">\n          ${a?`<span class="calendar-status connected">é€£æºä¸­</span>\n               <button class="btn-disconnect-calendar" data-user-id="${e(t.id)}">è§£é™¤</button>`:`<button class="btn-connect-calendar" data-user-id="${e(t.id)}" data-user-name="${e(t.name||t.username)}">\n                 <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>\n                 Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«é€£æº\n               </button>`}\n        </div>\n      </div>\n    `}).join(""),n.querySelectorAll(".btn-connect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e,t){try{const n=await i(v,e,t);window.open(n.authUrl,"calendar-auth","width=600,height=700");let a=0;const l=10,o=setInterval(async()=>{a++;try{const t=await s(v,e);t.integration&&t.integration.isActive&&(clearInterval(o),L[e]=t.integration,N(),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºãŒå®Œäº†ã—ã¾ã—ãŸ"))}catch(t){}a>=l&&clearInterval(o)},3e3)}catch(n){console.error("Failed to initiate calendar auth:",n),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}}(e.dataset.userId,e.dataset.userName)})}),n.querySelectorAll(".btn-disconnect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e){if(!(await t({title:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã®è§£é™¤",message:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ",confirmText:"è§£é™¤ã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",danger:!0})))return;try{await l(v,e),delete L[e],N(),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’è§£é™¤ã—ã¾ã—ãŸ")}catch(n){console.error("Failed to revoke calendar auth:",n),alert("é€£æºè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}}(e.dataset.userId)})})):n.innerHTML='<p class="no-data">æ‹…å½“è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>ç®¡ç†ç”»é¢ã‹ã‚‰æ‹…å½“è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>')}async function H(){if(!h)return;const t=A("interview-modal");if(!t)return;const n=A("interview-staff");n&&(n.innerHTML='<option value="">æ‹…å½“è€…ã‚’é¸æŠ...</option>'+$.map(t=>{const n=L[t.id],a=(null==n?void 0:n.isActive)?" (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºæ¸ˆ)":"";return`<option value="${e(t.id)}" data-has-calendar="${(null==n?void 0:n.isActive)?"true":"false"}">${e(t.name||t.username)}${a}</option>`}).join("")),E=null,D=c(new Date),A("availability-section").style.display="none",A("selected-slot-section").style.display="none",A("manual-datetime-section").style.display="block",A("calendar-status-hint").textContent="",t.style.display="flex"}function F(){const e=A("interview-modal");e&&(e.style.display="none")}async function q(){var e;const t=A("interview-staff"),n=t.options[t.selectedIndex],a="true"===(null==(e=null==n?void 0:n.dataset)?void 0:e.hasCalendar),i=t.value,s=A("availability-section"),l=A("manual-datetime-section"),o=A("calendar-status-hint");if(!i)return s.style.display="none",l.style.display="block",void(o.textContent="");a?(s.style.display="block",l.style.display="none",o.textContent="æ‹…å½“è€…ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ç©ºãæ™‚é–“ã‚’å–å¾—ã—ã¾ã™",o.style.color="#10b981",await U(i)):(s.style.display="none",l.style.display="block",o.textContent="ã“ã®æ‹…å½“è€…ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœªé€£æºã§ã™ã€‚æ‰‹å‹•ã§æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",o.style.color="#f59e0b")}async function U(t){const n=A("availability-grid");if(n){n.innerHTML='<div class="loading-message">ç©ºãæ™‚é–“ã‚’å–å¾—ä¸­...</div>';try{const n=new Date(D);n.setDate(n.getDate()+6);const a=d(D),i=d(n);!function(t){const n=A("availability-grid");if(!n)return;const a={},i=[];for(let e=0;e<5;e++){const t=new Date(D);t.setDate(t.getDate()+e);const n=d(t);i.push({date:t,dateStr:n}),a[n]=[]}t.forEach(e=>{const t=e.start.split("T")[0];a[t]&&a[t].push(e)});const s=i.map(({date:t,dateStr:n})=>{const i=a[n]||[],s=u(t);return`\n      <div class="availability-day">\n        <div class="day-header">${`${t.getMonth()+1}/${t.getDate()}`} (${s})</div>\n        <div class="day-slots">\n          ${i.length>0?i.map(t=>{const n=new Date(t.start),a=`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`,i=t.start;return`<button class="slot-btn ${E===i?"selected":""}" data-slot="${e(i)}">${a}</button>`}).join(""):'<span class="no-slots">-</span>'}\n        </div>\n      </div>\n    `}).join("");n.innerHTML=`<div class="availability-week">${s}</div>`,n.querySelectorAll(".slot-btn").forEach(e=>{e.addEventListener("click",()=>{!function(e){E=e,document.querySelectorAll(".slot-btn").forEach(t=>{t.classList.toggle("selected",t.dataset.slot===e)});const t=A("selected-slot-section"),n=A("selected-slot");if(t&&n){const a=new Date(e),i=u(a),s=`${a.getFullYear()}å¹´${a.getMonth()+1}æœˆ${a.getDate()}æ—¥(${i})`,l=`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`;n.textContent=`${s} ${l}`,t.style.display="block"}}(e.dataset.slot)})})}((await o(v,t,a,i)).availableSlots||[]),function(){const e=A("week-label");if(!e||!D)return;const t=new Date(D);t.setDate(t.getDate()+6);const n=`${D.getMonth()+1}/${D.getDate()}`,a=`${t.getMonth()+1}/${t.getDate()}`;e.textContent=`${D.getFullYear()}å¹´ ${n} - ${a}`}()}catch(a){console.error("Failed to load availability:",a),n.innerHTML='<div class="empty-message">ç©ºãæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}}function B(){D.setDate(D.getDate()-7);const e=A("interview-staff");(null==e?void 0:e.value)&&U(e.value)}function R(){D.setDate(D.getDate()+7);const e=A("interview-staff");(null==e?void 0:e.value)&&U(e.value)}async function O(){var e,t,n,a,i,s,l,o;const c=A("interview-staff"),d=null==c?void 0:c.value;if(!d)return void alert("æ‹…å½“è€…ã‚’é¸æŠã—ã¦ãã ã•ã„");const u=c.options[c.selectedIndex];let p;if("true"===(null==(e=null==u?void 0:u.dataset)?void 0:e.hasCalendar)&&E)p=new Date(E);else{const e=A("interview-datetime");if(!(null==e?void 0:e.value))return void alert("é¢è«‡æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„");p=new Date(e.value)}const m=parseInt((null==(t=A("interview-duration"))?void 0:t.value)||"60"),g=(null==(n=document.querySelector('input[name="meeting-type"]:checked'))?void 0:n.value)||"in_person",y=(null==(a=A("interview-location"))?void 0:a.value)||"",w=[];(null==(i=A("send-reminder-1day"))?void 0:i.checked)&&w.push({offsetMinutes:1440,sendTime:"10:00"}),(null==(s=A("send-reminder-1hour"))?void 0:s.checked)&&w.push({offsetMinutes:60});const b=f.find(e=>e.id===h);if(!b)return;const L=$.find(e=>e.id===d),D=A("interview-modal-save");D&&(D.disabled=!0,D.textContent="ç™»éŒ²ä¸­...");try{const e=await r({companyDomain:v,companyUserId:d,applicationId:h,applicantName:b.applicantName||(null==(l=b.applicant)?void 0:l.name)||"å¿œå‹Ÿè€…",applicantEmail:b.applicantEmail||(null==(o=b.applicant)?void 0:o.email)||"",staffName:(null==L?void 0:L.name)||(null==L?void 0:L.username)||"æ‹…å½“è€…",scheduledAt:p.toISOString(),durationMinutes:m,meetingType:g,location:y,reminders:w}),t=C();await t.collection("applications").doc(h).update({status:"interviewing",interviewId:e.interviewId,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const n=f.findIndex(e=>e.id===h);-1!==n&&(f[n].status="interviewing",f[n].interviewId=e.interviewId),F(),W(h),J(),X(),alert("é¢è«‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚æ‹…å½“è€…ã®Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚")}catch(k){console.error("Failed to save interview:",k),alert("é¢è«‡ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: "+k.message)}finally{D&&(D.disabled=!1,D.textContent="é¢è«‡ã‚’ç™»éŒ²")}}async function P(){try{const e=C().collection("settings").doc(v||"global"),t=await e.get();w=t.exists&&t.data().assignees?t.data().assignees:[],Y()}catch(e){console.error("Failed to load assignees:",e),w=[]}}function Y(){const t=A("detail-assignee");if(t){const n=t.value;t.innerHTML='<option value="">æœªå‰²å½“</option>'+w.map(t=>`<option value="${e(t)}">${e(t)}</option>`).join(""),t.value=n}}async function _(){var e;const t=A("new-assignee-name"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)if(w.includes(n))alert("ã“ã®æ‹…å½“è€…ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™");else try{const e=C().collection("settings").doc(v||"global");w.push(n),await e.set({assignees:w,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),Y(),G();const t=A("detail-assignee");t&&(t.value=n)}catch(a){console.error("Failed to add assignee:",a),alert("æ‹…å½“è€…ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}else alert("æ‹…å½“è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")}function V(){const e=A("assignee-modal"),t=A("new-assignee-name");e&&(e.style.display="flex"),t&&(t.value="",t.focus())}function G(){const e=A("assignee-modal");e&&(e.style.display="none")}async function K(){const t=A("applicants-list");t&&(t.innerHTML='<div class="loading-message">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>');try{let t=C().collection("applications");v&&(t=t.where("companyDomain","==",v)),t=t.orderBy("createdAt","desc");const n=await t.get();f=[],n.forEach(e=>{f.push({id:e.id,...e.data()})}),b={},f.forEach(e=>{var t,n;const a=e.applicantPhone||(null==(t=e.applicant)?void 0:t.phone),i=e.applicantEmail||(null==(n=e.applicant)?void 0:n.email);if(a){const t=a.replace(/[-\s]/g,"");b[t]||(b[t]=[]),b[t].push(e)}if(i){const t=i.toLowerCase().trim();b[t]||(b[t]=[]),b[t].push(e)}}),function(){const t=A("filter-job");if(!t)return;const n=[...new Set(f.map(e=>e.jobTitle).filter(Boolean))];n.sort();const a=t.value;t.innerHTML='<option value="">å…¨æ±‚äºº</option>'+n.map(t=>`<option value="${e(t)}">${e(t)}</option>`).join(""),t.value=a}(),J(),X()}catch(n){console.error("Failed to load applicants:",n),t&&(t.innerHTML='<div class="empty-message">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>')}}function z(e){var t,n;if(e.applicantAge)return e.applicantAge;if(null==(t=e.applicant)?void 0:t.age)return e.applicant.age;if(e.age)return e.age;const a=e.applicantBirthdate||(null==(n=e.applicant)?void 0:n.birthdate)||e.birthdate;return a?function(e){if(!e)return null;const t=new Date,n=new Date(e);if(isNaN(n.getTime()))return null;let a=t.getFullYear()-n.getFullYear();const i=t.getMonth()-n.getMonth();return(i<0||0===i&&t.getDate()<n.getDate())&&a--,a}(a):null}function J(){var e,t,n,a,i,s,l;const o=(null==(e=A("filter-status"))?void 0:e.value)||"",r=(null==(t=A("filter-job"))?void 0:t.value)||"",c=(null==(n=A("filter-age"))?void 0:n.value)||"",d=(null==(a=A("filter-date"))?void 0:a.value)||"",u=(null==(s=null==(i=A("filter-search"))?void 0:i.value)?void 0:s.toLowerCase())||"",p=(null==(l=A("filter-exclude-complete"))?void 0:l.checked)??!0;["filter-status","filter-job","filter-age","filter-date"].forEach(e=>{const t=A(e);t&&(t.value?t.classList.add("filter-active"):t.classList.remove("filter-active"))});const v=new Date;g=f.filter(e=>{var t,n;const a=e.status||"new";if(p&&function(e){return["hired","joined","ng","rejected","withdrawn"].includes(e)}(a))return!1;if(o&&a!==o)return!1;if(r&&(e.jobTitle||"")!==r)return!1;if(c){const t=function(e){if(!e||"-"===e)return null;const t=parseInt(e);return isNaN(t)?null:t<20?"10":t<30?"20":t<40?"30":t<50?"40":t<60?"50":"60"}(z(e));if(t!==c)return!1}if(d){const n=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),a=(v-n)/864e5;if("today"===d&&a>1)return!1;if("week"===d&&a>7)return!1;if("month"===d&&a>30)return!1;if("3months"===d&&a>90)return!1}if(u){const t=(e.jobTitle||"").toLowerCase(),a=(e.applicantName||(null==(n=e.applicant)?void 0:n.name)||"").toLowerCase();if(!t.includes(u)&&!a.includes(u))return!1}return!0}),y=1,Z(),Q()}function X(){const e=f.length,t=f.filter(e=>!e.status||"new"===e.status).length,n=f.filter(e=>["contacted","interviewing","interviewed","pending"].includes(e.status)).length,a=f.filter(e=>["hired","joined","ng","rejected","withdrawn"].includes(e.status)).length,i=A("stat-total"),s=A("stat-new"),l=A("stat-progress"),o=A("stat-complete");i&&(i.textContent=e),s&&(s.textContent=t),l&&(l.textContent=n),o&&(o.textContent=a)}function Z(){const t=A("applicants-list");if(!t)return;if(0===g.length)return void(t.innerHTML='<div class="empty-message">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=20*(y-1),a=n+20,i=g.slice(n,a);t.innerHTML=i.map(t=>{var n,a;const i=oe((null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.timestamp||t.createdAt)),s=t.status||"new",l=S[t.type]||t.type||"-",o=x[s]||s,r=t.applicantName||(null==(a=t.applicant)?void 0:a.name)||"-",c=h===t.id;let d="type-apply";"line"===t.type&&(d="type-line"),"consult"===t.type&&(d="type-consult");const u=function(e){var t,n,a;const i=e.applicantPhone||(null==(t=e.applicant)?void 0:t.phone),s=e.applicantEmail||(null==(n=e.applicant)?void 0:n.email);let l=[];if(i){const e=i.replace(/[-\s]/g,""),t=b[e]||[];l=l.concat(t)}if(s){const e=s.toLowerCase().trim(),t=b[e]||[];l=l.concat(t)}const o=[...new Map(l.map(e=>[e.id,e])).values()].filter(t=>t.id!==e.id),r=(null==(a=e.createdAt)?void 0:a.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),c=o.filter(e=>{var t;return((null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt))<r});return{isReapply:c.length>0,hasNgHistory:c.some(e=>"ng"===e.status||"rejected"===e.status),previousApps:c}}(t);let p="";return u.hasNgHistory?p+='<span class="duplicate-badge badge-ng-history">NGå±¥æ­´</span>':u.isReapply&&(p+='<span class="duplicate-badge badge-reapply">å†å¿œå‹Ÿ</span>'),`\n      <div class="applicant-card ${c?"selected":""}" data-id="${e(t.id)}">\n        <div class="applicant-card-main">\n          <div class="applicant-card-header">\n            <span class="applicant-card-name">${e(r)}</span>\n            <span class="applicant-card-type ${d}">${e(l)}</span>\n            ${p}\n          </div>\n          <div class="applicant-card-job">${e(t.jobTitle||"-")}</div>\n          <div class="applicant-card-meta">\n            <span>${e(i)}</span>\n            ${t.assignee?`<span>æ‹…å½“: ${e(t.assignee)}</span>`:""}\n          </div>\n        </div>\n        <div class="applicant-card-status">\n          <span class="status-badge status-${e(s)}">${e(o)}</span>\n        </div>\n      </div>\n    `}).join(""),t.querySelectorAll(".applicant-card").forEach(e=>{e.addEventListener("click",()=>{W(e.dataset.id)})})}function Q(){const e=A("pagination");if(!e)return;const t=Math.ceil(g.length/20);if(t<=1)return void(e.innerHTML="");let n="";n+=`<button class="page-btn" ${1===y?"disabled":""} data-page="${y-1}">å‰ã¸</button>`;for(let a=1;a<=t;a++)1===a||a===t||a>=y-2&&a<=y+2?n+=`<button class="page-btn ${a===y?"active":""}" data-page="${a}">${a}</button>`:a!==y-3&&a!==y+3||(n+='<span class="page-ellipsis">...</span>');n+=`<button class="page-btn" ${y===t?"disabled":""} data-page="${y+1}">æ¬¡ã¸</button>`,e.innerHTML=n,e.querySelectorAll(".page-btn").forEach(e=>{e.addEventListener("click",()=>{e.disabled||(y=parseInt(e.dataset.page),Z(),Q())})})}function W(t){var n,a,i,s,l,o;const r=f.find(e=>e.id===t);if(!r)return;h=t,document.querySelectorAll(".applicant-card").forEach(e=>{e.classList.toggle("selected",e.dataset.id===t)});const c=A("detail-empty"),d=A("detail-content");c&&(c.style.display="none"),d&&(d.style.display="flex");const p=r.applicantName||(null==(n=r.applicant)?void 0:n.name)||"-",v=r.applicantPhone||(null==(a=r.applicant)?void 0:a.phone)||"-",m=r.applicantEmail||(null==(i=r.applicant)?void 0:i.email)||"-",g=r.applicantAddress||(null==(s=r.applicant)?void 0:s.address)||"-",y=(null==(l=r.applicant)?void 0:l.startDate)||"-",w=z(r),b=null!==w?`${w}æ­³`:"-";A("detail-name").textContent=p,A("detail-job-title").textContent=r.jobTitle||"-",A("detail-phone").textContent=v,A("detail-email").textContent=m,A("detail-age").textContent=b,A("detail-address").textContent=g,A("detail-start-date").textContent=T[y]||y;const $=(null==(o=r.createdAt)?void 0:o.toDate)?r.createdAt.toDate():new Date(r.timestamp||r.createdAt);A("detail-datetime").textContent=oe($,!0),A("detail-type").textContent=S[r.type]||r.type||"-",A("detail-source").textContent=re(r.source);const L=r.status||"new";document.querySelectorAll(".status-btn").forEach(e=>{e.classList.toggle("active",e.dataset.status===L)});const D=A("detail-assignee");D&&(D.value=r.assignee||"");const E=A("detail-notes");E&&(E.value=r.notes||""),ae(r.history||[]),te(t),async function(t){var n;const a=A("interview-info");if(!a)return;const i=f.find(e=>e.id===t);if(null==i?void 0:i.interviewId)try{const t=C(),s=await t.collection("interviews").doc(i.interviewId).get();if(!s.exists)return void(a.innerHTML='<p class="no-data">é¢è«‡ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>');const l=s.data(),o=(null==(n=l.scheduledAt)?void 0:n.toDate)?l.scheduledAt.toDate():new Date(l.scheduledAt),r=u(o),c={in_person:"å¯¾é¢",online:"ã‚ªãƒ³ãƒ©ã‚¤ãƒ³",phone:"é›»è©±"};a.innerHTML=`\n      <div class="interview-scheduled">\n        <h4>é¢è«‡äºˆå®š</h4>\n        <p><strong>æ—¥æ™‚:</strong> ${o.getFullYear()}å¹´${o.getMonth()+1}æœˆ${o.getDate()}æ—¥(${r}) ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}</p>\n        <p><strong>æ‹…å½“è€…:</strong> ${e(l.staffName||"-")}</p>\n        <p><strong>å½¢å¼:</strong> ${c[l.meetingType]||l.meetingType}</p>\n        ${l.location?`<p><strong>å ´æ‰€:</strong> ${e(l.location)}</p>`:""}\n      </div>\n    `}catch(s){console.error("Failed to load interview info:",s),a.innerHTML='<p class="no-data">é¢è«‡æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}else a.innerHTML='<p class="no-data">é¢è«‡ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>'}(t)}function ee(){h=null,document.querySelectorAll(".applicant-card").forEach(e=>{e.classList.remove("selected")});const e=A("detail-empty"),t=A("detail-content");e&&(e.style.display="flex"),t&&(t.style.display="none")}async function te(t){const n=A("messages-container");if(n){n.innerHTML='<p class="no-data">èª­ã¿è¾¼ã¿ä¸­...</p>';try{const n=C(),a=await n.collection("messages").where("applicationId","==",t).orderBy("createdAt","asc").get(),i=[];a.forEach(e=>{i.push({id:e.id,...e.data()})}),function(t){const n=A("messages-container");if(!n)return;if(!t||0===t.length)return void(n.innerHTML='<p class="no-data">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“</p>');n.innerHTML=t.map(t=>{var n;const a=(null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.createdAt),i="company"===t.from;return`\n      <div class="message-item ${i?"message-company":"message-applicant"}">\n        <div class="message-header">\n          <span class="message-sender">${e(i?"ä¼šç¤¾":"å¿œå‹Ÿè€…")}</span>\n          <span class="message-date">${oe(a,!0)}</span>\n        </div>\n        <div class="message-content">${e(t.content).replace(/\n/g,"<br>")}</div>\n      </div>\n    `}).join(""),n.scrollTop=n.scrollHeight}(i)}catch(a){console.error("Failed to load messages:",a),n.innerHTML='<p class="no-data">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}}}async function ne(){var e;if(!h)return;const t=A("new-message-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(!n)return void alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const a=A("btn-send-message");a&&(a.disabled=!0,a.textContent="é€ä¿¡ä¸­...");try{const e=C(),a=f.find(e=>e.id===h);await e.collection("messages").add({applicationId:h,companyDomain:(null==a?void 0:a.companyDomain)||v,from:"company",content:n,read:!1,createdAt:firebase.firestore.FieldValue.serverTimestamp()}),t.value="",await te(h)}catch(i){console.error("Failed to send message:",i),alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: "+i.message)}finally{a&&(a.disabled=!1,a.textContent="é€ä¿¡")}}function ae(t){const n=A("detail-history");n&&(t&&0!==t.length?n.innerHTML=t.map(t=>{var n;return`\n      <div class="history-item">\n        <div class="history-date">${oe((null==(n=t.date)?void 0:n.toDate)?t.date.toDate():new Date(t.date),!0)}</div>\n        <div class="history-text">${e(t.text)}</div>\n      </div>\n    `}).join(""):n.innerHTML='<p class="no-data">å¯¾å¿œå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>')}async function ie(){var e,t;if(!h)return;const n=(null==(e=A("detail-notes"))?void 0:e.value)||"",a=(null==(t=A("detail-assignee"))?void 0:t.value)||"",i=A("btn-save-notes");i&&(i.disabled=!0,i.textContent="ä¿å­˜ä¸­...");try{const e=C();await e.collection("applications").doc(h).update({notes:n,assignee:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const t=f.findIndex(e=>e.id===h);-1!==t&&(f[t].notes=n,f[t].assignee=a),Z()}catch(s){console.error("Failed to save notes:",s),alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{i&&(i.disabled=!1,i.textContent="ä¿å­˜")}}async function se(){var e;if(!h)return;const t=A("new-history-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)try{const e=C(),a=f.find(e=>e.id===h),i=(null==a?void 0:a.history)||[];i.push({date:new Date,text:n}),await e.collection("applications").doc(h).update({history:i,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const s=f.findIndex(e=>e.id===h);-1!==s&&(f[s].history=i),ae(i),t.value=""}catch(a){console.error("Failed to add history:",a),alert("å±¥æ­´ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}else alert("å¯¾å¿œå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")}function le(){if(0===g.length)return void alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");const e=g.map(e=>{var t,n,a,i,s,l;const o=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),r=e.applicantName||(null==(n=e.applicant)?void 0:n.name)||"",c=e.applicantPhone||(null==(a=e.applicant)?void 0:a.phone)||"",d=e.applicantEmail||(null==(i=e.applicant)?void 0:i.email)||"",u=z(e),p=null!==u?`${u}æ­³`:"",v=e.applicantAddress||(null==(s=e.applicant)?void 0:s.address)||"",m=(null==(l=e.applicant)?void 0:l.startDate)||"";return[oe(o,!0),S[e.type]||e.type||"",r,c,d,p,v,T[m]||m,e.jobTitle||"",re(e.source),x[e.status||"new"],e.assignee||"",(e.notes||"").replace(/"/g,'""')]}),t=[["æ—¥æ™‚","ç¨®åˆ¥","å¿œå‹Ÿè€…å","é›»è©±ç•ªå·","ãƒ¡ãƒ¼ãƒ«","å¹´é½¢","ç¾ä½æ‰€","å¸Œæœ›å‹¤å‹™é–‹å§‹æ—¥","æ±‚äººã‚¿ã‚¤ãƒˆãƒ«","æµå…¥å…ƒ","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","æ‹…å½“è€…","ãƒ¡ãƒ¢"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),n=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download=`applicants-${v||"all"}-${function(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}${n}${a}`}(new Date)}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}function oe(e,t=!1){if(!e||isNaN(e.getTime()))return"-";const n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");if(!t)return`${n}/${a}/${i}`;return`${n}/${a}/${i} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function re(e){if(!e||"direct"===e)return"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹";try{const t=new URL(e).hostname;return t.includes("google")?"Googleæ¤œç´¢":t.includes("yahoo")?"Yahoo!æ¤œç´¢":t.includes("tiktok")?"TikTokåºƒå‘Š":t.includes("instagram")||t.includes("fb")||t.includes("facebook")?"Metaåºƒå‘Š":t.includes("twitter")||t.includes("x.com")?"X(Twitter)":t.includes("line")?"LINE":t}catch{return e||"ä¸æ˜"}}function ce(){var e,t,n,a,i,s,l,o,r,c,d,u,p,v,m,g,y,w,b,$,L,D,E,x,S,T,M,N,U,P,Y,z,Z,Q;let W;null==(e=A("btn-refresh"))||e.addEventListener("click",K),null==(t=A("btn-refresh-applicants"))||t.addEventListener("click",K),null==(n=A("btn-export-csv"))||n.addEventListener("click",le),null==(a=A("filter-status"))||a.addEventListener("change",J),null==(i=A("filter-type"))||i.addEventListener("change",J),null==(s=A("filter-job"))||s.addEventListener("change",J),null==(l=A("filter-age"))||l.addEventListener("change",J),null==(o=A("filter-date"))||o.addEventListener("change",J),null==(r=A("filter-exclude-complete"))||r.addEventListener("change",J),null==(c=A("filter-search"))||c.addEventListener("input",()=>{clearTimeout(W),W=setTimeout(J,300)}),null==(d=A("btn-close-detail"))||d.addEventListener("click",ee),document.querySelectorAll(".status-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.status;t&&async function(e){if(h)try{const t=C();await t.collection("applications").doc(h).update({status:e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const n=f.findIndex(e=>e.id===h);-1!==n&&(f[n].status=e),document.querySelectorAll(".status-btn").forEach(t=>{t.classList.toggle("active",t.dataset.status===e)}),J(),X()}catch(t){console.error("Failed to update status:",t),alert("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}}(t)})}),null==(u=A("btn-save-notes"))||u.addEventListener("click",ie),null==(p=A("btn-add-history"))||p.addEventListener("click",se),null==(v=A("new-history-text"))||v.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),se())}),null==(m=A("btn-send-message"))||m.addEventListener("click",ne),null==(g=A("new-message-text"))||g.addEventListener("keydown",e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),ne())}),null==(y=A("message-template-select"))||y.addEventListener("change",e=>{!function(e){var t;if(!e)return;const n=j[e];if(!n)return;const a=f.find(e=>e.id===h);if(!a)return;const i=a.applicantName||(null==(t=a.applicant)?void 0:t.name)||"ãŠå®¢æ§˜",s=a.jobTitle||"æ±‚äºº";let l=n.body.replace(/{applicantName}/g,i).replace(/{jobTitle}/g,s);const o=A("new-message-text");o&&(o.value=l,o.focus());const r=A("message-template-select");r&&(r.value="")}(e.target.value)}),null==(w=A("btn-add-assignee"))||w.addEventListener("click",V),null==(b=A("assignee-modal-close"))||b.addEventListener("click",G),null==($=A("assignee-modal-cancel"))||$.addEventListener("click",G),null==(L=A("assignee-modal-save"))||L.addEventListener("click",_),null==(D=A("assignee-modal"))||D.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&G()}),null==(E=A("new-assignee-name"))||E.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),_())}),null==(x=document.getElementById("nav-settings"))||x.addEventListener("click",e=>{e.preventDefault(),I("settings")}),null==(S=A("btn-back-to-applicants"))||S.addEventListener("click",()=>{I("applicants")}),k||(null==(T=A("btn-schedule-interview"))||T.addEventListener("click",H),null==(M=A("interview-modal-close"))||M.addEventListener("click",F),null==(N=A("interview-modal-cancel"))||N.addEventListener("click",F),null==(U=A("interview-modal-save"))||U.addEventListener("click",O),null==(P=A("interview-modal"))||P.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&F()}),null==(Y=A("interview-staff"))||Y.addEventListener("change",q),null==(z=A("btn-prev-week"))||z.addEventListener("click",B),null==(Z=A("btn-next-week"))||Z.addEventListener("click",R)),null==(Q=A("btn-save-reminder-settings"))||Q.addEventListener("click",de);const te=document.getElementById("mobile-menu-btn"),ae=document.querySelector(".admin-sidebar");te&&ae&&(te.addEventListener("click",()=>{ae.classList.toggle("open"),te.classList.toggle("active")}),document.addEventListener("click",e=>{!ae.classList.contains("open")||ae.contains(e.target)||te.contains(e.target)||(ae.classList.remove("open"),te.classList.remove("active"))}))}async function de(){var e,t,n;try{const a=C(),i={reminder1Day:(null==(e=A("reminder-1day"))?void 0:e.checked)||!1,reminder1DayTime:(null==(t=A("reminder-1day-time"))?void 0:t.value)||"10:00",reminder1Hour:(null==(n=A("reminder-1hour"))?void 0:n.checked)||!1,updatedAt:firebase.firestore.FieldValue.serverTimestamp()};await a.collection("settings").doc(v||"global").set({reminderSettings:i},{merge:!0}),alert("ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(a){console.error("Failed to save reminder settings:",a),alert("è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}}async function ue(){const e=new URLSearchParams(window.location.search);v=e.get("domain"),m=e.get("company")?decodeURIComponent(e.get("company")):null;const t=A("company-name");t&&(t.textContent=m||v||"å…¨ä¼šç¤¾"),ce(),await P(),await M(),await K(),"undefined"!=typeof window&&(window.ApplicantsManager={loadApplicantsData:K,applyFilters:J,exportCsv:le,showSection:I})}async function pe(e,t,n=""){v=e,m=t,k=n,ce(),await P(),await M(),await K()}function ve(){return h&&f.find(e=>e.id===h)||null}export{s as a,u as b,r as c,o as d,i as e,d as f,c as g,ve as h,pe as i,ue as j,l as r};
