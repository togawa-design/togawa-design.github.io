import"./modulepreload-polyfill-YP0FEG5d.js";import{i as e,ab as t,ac as n,h as o,ad as s,ae as a,l,af as c,k as i,ag as d,ah as r,ai as u,aj as m,j as p,ak as g,al as y,am as b,b as v,u as f,v as h,t as E,q as I,o as w,an as j,ao as L,ap as B,aq as x,ar as $,as as S,r as k,at as T,au as C,av as D,aw as M,z as A,Y as H,Z as P,_ as q,F as _,D as U,C as O,ax as J,B as X,ay as R,az as V,aA as F,aB as G,aC as z,aD as N,aE as Y,E as Z,aF as Q,aG as K,O as W,aH as ee,aI as te,aJ as ne,aK as oe,e as se,aL as ae,aM as le,d as ce,aN as ie,aO as de,s as re,m as ue,n as me,aP as pe,aQ as ge}from"./auth-BX5ABlML.js";import{e as ye}from"./utils-DCR9QUau.js";import{p as be}from"./jobs-loader-vTfia0vR.js";import"./LPEditor-DhYOL23n.js";import"./api-B1sZYcOA.js";import"./image-uploader-gAKnoYUY.js";import"./core-BE8AvM4l.js";function ve(e){return e.filter(e=>{if(p.search){const t=p.search.toLowerCase(),n=(e.title||"").toLowerCase(),o=(e.location||"").toLowerCase();if(!n.includes(t)&&!o.includes(t))return!1}if(p.status){const t=function(e){const t=v(e);return"active"===t?"published":t}(e);if(t!==p.status)return!1}if(p.area){if(!(e.location||"").includes(p.area))return!1}return!0})}function fe(){const e=document.getElementById("jobs-list"),t=document.getElementById("jobs-count"),n=document.getElementById("jobs-filtered-count");if(document.getElementById("jobs-tbody")&&!e)return void function(){const e=document.getElementById("jobs-tbody");if(!e)return;const t=l||[];if(0===t.length)return void(e.innerHTML='<tr><td colspan="6" class="loading-cell">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');e.innerHTML=t.map(e=>{const t=e.monthlySalary?`Â¥${Number(e.monthlySalary).toLocaleString()}`:"-",n="true"===e.visible||"TRUE"===e.visible||!0===e.visible;return`\n      <tr data-row="${e._rowIndex}">\n        <td>${ye(e.id||"-")}</td>\n        <td>${ye(e.title||"-")}</td>\n        <td>${ye(e.location||"-")}</td>\n        <td>${t}</td>\n        <td>${n?'<span class="badge success">å…¬é–‹</span>':'<span class="badge">éå…¬é–‹</span>'}</td>\n        <td>\n          <div class="action-buttons">\n            <button class="btn-small btn-edit" data-row="${e._rowIndex}">ç·¨é›†</button>\n          </div>\n        </td>\n      </tr>\n    `}).join(""),e.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",()=>{je(parseInt(e.dataset.row,10))})})}();if(!e)return;const o=l||[],c=ve(o);if(t&&(t.textContent=o.length),n&&(c.length!==o.length?n.textContent=`ï¼ˆ${c.length}ä»¶è¡¨ç¤ºä¸­ï¼‰`:n.textContent=""),function(){const e=document.getElementById("job-filter-area");if(!e)return;const t=new Set;(l||[]).forEach(e=>{if(e.location){const n=e.location.match(/^(.+?[éƒ½é“åºœçœŒ])/);n?t.add(n[1]):t.add(e.location.split(/[å¸‚åŒºç”ºæ‘]/)[0])}});const n=e.value;e.innerHTML='<option value="">å…¨ã‚¨ãƒªã‚¢</option>',Array.from(t).sort().forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}),e.value=n}(),0===c.length){const t=p.search||p.status||p.area;return void(e.innerHTML=`<div class="job-cards-loading">${t?"æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“":"æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}</div>`)}e.innerHTML=c.map(e=>{var t;const n="true"===e.visible||"TRUE"===e.visible||!0===e.visible,o=(null==(t=e.imageUrl)?void 0:t.trim())||"",s=(e.badges?e.badges.split(",").map(e=>e.trim()).filter(e=>e):[]).map(e=>`<span class="job-card-tag${"æ€¥å‹Ÿ"===e?" urgent":""}">${ye(e)}</span>`).join("");let a="-",l="";if(e.publishEndDate){const t=new Date(e.publishEndDate),n=new Date;n.setHours(0,0,0,0);const o=Math.ceil((t-n)/864e5);a=`${String(t.getFullYear()).slice(2)}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`,o<0?l=" expired":o<=7&&(l=" soon")}let c="";c=n?" expired"===l?'<span class="badge expired">æ²è¼‰çµ‚äº†</span>':'<span class="badge published">å…¬é–‹ä¸­</span>':'<span class="badge draft">éå…¬é–‹</span>';const i=g[e.id]||{},d=i.applications||0,r=i.pv||0;return`\n      <div class="job-card-row" data-row="${e._rowIndex}">\n        <div class="job-card-image">\n          ${o?`<img src="${ye(o)}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'job-card-image-placeholder\\'>ğŸ“‹</div>'">`:'<div class="job-card-image-placeholder">ğŸ“‹</div>'}\n        </div>\n        <div class="job-card-info">\n          <div class="job-card-title">${ye(e.title||"-")}</div>\n          <div class="job-card-tags">${s}</div>\n        </div>\n        <div class="job-card-type">${ye(e.jobType||"-")}</div>\n        <div class="job-card-area">${ye(e.location||"-")}</div>\n        <div class="job-card-deadline${l}">${a}</div>\n        <div class="job-card-stats">${d}</div>\n        <div class="job-card-stats">${r}</div>\n        <div class="job-card-status">${c}</div>\n        <div class="job-card-actions">\n          <button class="btn-icon btn-edit" data-row="${e._rowIndex}" title="ç·¨é›†">\n            <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n          </button>\n          <button class="btn-icon btn-duplicate" data-row="${e._rowIndex}" title="è¤‡è£½">\n            <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n          </button>\n        </div>\n      </div>\n    `}).join(""),e.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",()=>{je(parseInt(e.dataset.row,10))})}),e.querySelectorAll(".btn-duplicate").forEach(e=>{e.addEventListener("click",()=>{!function(e){var t;const n=null==(t=l)?void 0:t.find(t=>t._rowIndex===e);if(!n)return void alert("æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");s(null),a(!0);Ie({...n,title:`${n.title||""} (ã‚³ãƒ”ãƒ¼)`});const o=document.getElementById("edit-job-start-date-section"),c=document.getElementById("edit-job-end-date-section");o&&(o.value="");c&&(c.value="");const i=document.getElementById("edit-job-visible-section");i&&(i.checked=!1);const d=document.getElementById("job-edit-title"),r=document.getElementById("job-edit-badge");d&&(d.textContent="æ±‚äººã®è¤‡è£½");r&&(r.textContent="è¤‡è£½",r.classList.remove("edit"));const u=document.getElementById("job-edit-delete-btn");u&&(u.style.display="none");we()}(parseInt(e.dataset.row,10))})})}async function he(){const t=document.getElementById("jobs-list"),n=document.getElementById("jobs-tbody");if(!t&&!n)return;t&&(t.innerHTML='<div class="job-cards-loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>'),n&&(n.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>');const s=o.gasApiUrl,a=c();try{const o=`${s}?action=getJobs&domain=${encodeURIComponent(e)}`,c=await fetch(o,{signal:a.signal});if(!c.ok)throw new Error("ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");const m=await c.json();if(!m.success)throw new Error(m.error||"æ±‚äººãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");if(i(m.jobs||[]),m.sheetUrl&&!d&&r(m.sheetUrl),m.manageSheetUrl&&!d&&r(m.manageSheetUrl),0===l.length){t&&(t.innerHTML='<div class="job-cards-loading">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'),n&&(n.innerHTML='<tr><td colspan="6" class="loading-cell">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');const e=document.getElementById("jobs-count");return void(e&&(e.textContent="0"))}fe(),async function(){if(!e)return;try{const n=firebase.firestore(),o=await n.collection("applications").where("companyDomain","==",e).get(),s={};o.docs.forEach(e=>{const t=e.data(),n=t.jobId||t.job_id||"";n&&(s[n]=(s[n]||0)+1)});let a={};try{const t=await y(e,30);(null==t?void 0:t.jobs)?t.jobs.forEach(e=>{const t=(e.pagePath||"").match(/job=([^&]+)/);if(t){const n=decodeURIComponent(t[1]);a[n]=(a[n]||0)+(e.views||0)}e.jobId&&(a[e.jobId]=(a[e.jobId]||0)+(e.views||0))}):(null==t?void 0:t.jobStats)?t.jobStats.forEach(e=>{const t=e.jobId||e.id||"";t&&(a[t]=e.pageViews||e.views||0)}):(null==t?void 0:t.pages)&&t.pages.forEach(e=>{var t;const n=null==(t=e.pagePath)?void 0:t.match(/job=([^&]+)/);if(n){const t=decodeURIComponent(n[1]);a[t]=(a[t]||0)+(e.views||e.pageViews||0)}})}catch(t){console.warn("Analytics APIã‹ã‚‰ã®PVå–å¾—ã«å¤±æ•—:",t)}const l={};new Set([...Object.keys(s),...Object.keys(a)]).forEach(e=>{l[e]={applications:s[e]||0,pv:a[e]||0}}),b(l),fe()}catch(n){console.error("æ±‚äººçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚¨ãƒ©ãƒ¼:",n)}}(),u()}catch(m){if("AbortError"===m.name)return void console.log("[JobManage] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");console.error("æ±‚äººãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",m);const e=`ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${ye(m.message)}`;t&&(t.innerHTML=`<div class="job-cards-loading">${e}</div>`),n&&(n.innerHTML=`<tr><td colspan="6" class="loading-cell">${e}</td></tr>`)}}function Ee(){s(null),a(!0),function(){["title","location","salary","bonus","order","type","features","badges","description","requirements","benefits","hours","holidays","start-date","end-date"].forEach(e=>{const t=document.getElementById(`edit-job-${e}-section`);t&&(t.value="")});const e=document.getElementById("edit-job-visible-section");e&&(e.checked=!0)}();const e=document.getElementById("job-edit-title"),t=document.getElementById("job-edit-badge");e&&(e.textContent="æ–°è¦æ±‚äººä½œæˆ"),t&&(t.textContent="æ–°è¦",t.classList.remove("edit"));const n=document.getElementById("job-edit-delete-btn");n&&(n.style.display="none"),we()}function Ie(e){const t=(e,t)=>{const n=document.getElementById(`edit-job-${e}-section`);n&&(n.value=t||"")};t("title",e.title),t("location",e.location),t("salary",e.monthlySalary),t("bonus",e.totalBonus),t("order",e.order),t("type",e.jobType),t("features",e.features),t("badges",e.badges),t("description",e.jobDescription),t("requirements",e.requirements),t("benefits",e.benefits),t("hours",e.workingHours),t("holidays",e.holidays),t("start-date",m(e.publishStartDate)),t("end-date",m(e.publishEndDate));const n=document.getElementById("edit-job-visible-section");n&&(n.checked="true"===e.visible||"TRUE"===e.visible||!0===e.visible)}function we(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-job-edit");e&&e.classList.add("active");const t=document.getElementById("page-title"),n=document.querySelector(".header-actions");t&&(t.textContent="æ±‚äººç·¨é›†"),n&&(n.style.display="none")}function je(e){var t;const n=null==(t=l)?void 0:t.find(t=>t._rowIndex===e);if(!n)return void alert("æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");s(n),a(!1),Ie(n);const o=document.getElementById("job-edit-title"),c=document.getElementById("job-edit-badge");o&&(o.textContent=n.title||"æ±‚äººç·¨é›†"),c&&(c.textContent="ç·¨é›†",c.classList.add("edit"));const i=document.getElementById("job-edit-delete-btn");i&&(i.style.display=""),we()}function Le(){if(s(null),a(!1),window.switchToJobsSection)window.switchToJobsSection();else{document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-jobs");e&&e.classList.add("active");const t=document.getElementById("page-title"),n=document.querySelector(".header-actions");t&&(t.textContent="æ±‚äººä¸€è¦§"),n&&(n.style.display="flex")}}async function Be(){var s,a;if(!e)return void alert("ä¼šç¤¾ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“");const l=e=>{var t,n;return(null==(n=null==(t=document.getElementById(`edit-job-${e}-section`))?void 0:t.value)?void 0:n.trim())||""},c={id:t?"":(null==(s=n)?void 0:s.id)||"",title:l("title"),location:l("location"),monthlySalary:l("salary"),totalBonus:l("bonus"),order:l("order"),jobType:l("type"),features:l("features"),badges:l("badges"),jobDescription:l("description"),requirements:l("requirements"),benefits:l("benefits"),workingHours:l("hours"),holidays:l("holidays"),publishStartDate:l("start-date"),publishEndDate:l("end-date"),visible:(null==(a=document.getElementById("edit-job-visible-section"))?void 0:a.checked)?"true":"false"};if(!c.title||!c.location)return void alert("å‹Ÿé›†ã‚¿ã‚¤ãƒˆãƒ«ã¨å‹¤å‹™åœ°ã¯å¿…é ˆã§ã™");const i=o.gasApiUrl,d=document.getElementById("job-edit-save-btn");try{d&&(d.disabled=!0,d.textContent="ä¿å­˜ä¸­...");const o=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveJob",companyDomain:e,job:c,rowIndex:t?null:n._rowIndex})))),s=`${i}?action=post&data=${encodeURIComponent(o)}`,a=await fetch(s,{method:"GET",redirect:"follow"}),l=await a.text();let u;try{u=JSON.parse(l)}catch(r){throw console.error("JSON parse error:",r),new Error(`GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™: ${l.substring(0,200)}`)}if(!u.success)return void alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(u.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));Le(),await he(),alert(t?"æ±‚äººã‚’ä½œæˆã—ã¾ã—ãŸ":"æ±‚äººæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ")}catch(u){console.error("æ±‚äººä¿å­˜ã‚¨ãƒ©ãƒ¼:",u),alert("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+u.message)}finally{d&&(d.disabled=!1,d.textContent="ä¿å­˜")}}async function xe(){if(!n||!e)return void alert("å‰Šé™¤å¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“");if(!confirm("ã“ã®æ±‚äººã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))return;const t=o.gasApiUrl,s=document.getElementById("job-edit-delete-btn");try{s&&(s.disabled=!0,s.textContent="å‰Šé™¤ä¸­...");const o=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteJob",companyDomain:e,rowIndex:n._rowIndex})))),l=`${t}?action=post&data=${encodeURIComponent(o)}`,c=await fetch(l,{method:"GET",redirect:"follow"}),i=await c.text();let d;try{d=JSON.parse(i)}catch(a){throw console.error("JSON parse error:",a),new Error("GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™")}if(!d.success)return void alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(d.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));Le(),await he(),alert("æ±‚äººã‚’å‰Šé™¤ã—ã¾ã—ãŸ")}catch(l){console.error("æ±‚äººå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",l),alert("å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+l.message)}finally{s&&(s.disabled=!1,s.textContent="å‰Šé™¤")}}function $e(){return l.filter(e=>("true"===e.visible||"TRUE"===e.visible||!0===e.visible)&&e.title).map(t=>({...t,company:j,companyDomain:e,companyAddress:t.location||""}))}function Se(){const e=document.getElementById("feed-status");e&&(e.style.display="flex")}function ke(){const e=document.getElementById("feed-status");e&&(e.style.display="none")}async function Te(){const t=$e();if(0!==t.length)try{Se();const n=f(t);h(n,`indeed-${e}.xml`,"application/xml")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{ke()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function Ce(){const t=$e();if(0!==t.length)try{Se();const n=E(t);h(n,`google-jobs-${e}.json`,"application/json")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{ke()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function De(){const t=$e();if(0!==t.length)try{Se();const n=I(t);h(n,`jobbox-${e}.xml`,"application/xml")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{ke()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function Me(){const t=$e();if(0!==t.length)try{Se();const n=w(t);h(n,`jobs-${e}.csv`,"text/csv;charset=utf-8")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{ke()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function Ae(){const t=document.getElementById("analytics-period");let n=7;switch((null==t?void 0:t.value)||"7days"){case"7days":n=7;break;case"30days":case"last-month":n=30;break;case"month":n=(new Date).getDate();break}const o=document.getElementById("job-analytics-tbody"),s=document.getElementById("source-analytics-tbody"),a=document.getElementById("device-analytics-tbody");o&&(o.innerHTML='<tr><td colspan="5" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>'),s&&(s.innerHTML='<tr><td colspan="3" class="loading-cell">èª­ã¿è¾¼ã¿ä¸­...</td></tr>'),a&&(a.innerHTML='<tr><td colspan="3" class="loading-cell">èª­ã¿è¾¼ã¿ä¸­...</td></tr>');try{const[t,o]=await Promise.all([L(n),B(n)]);let s=null;e&&(s=await y(e,n));const a={overview:t,traffic:o,companyDetail:s};x(a),function(t){const{overview:n,traffic:o,companyDetail:s}=t;if(e&&s){const e=s.summary||{};document.getElementById("analytics-pv").textContent=(e.totalViews||0).toLocaleString(),document.getElementById("analytics-users").textContent=(e.totalUsers||0).toLocaleString(),document.getElementById("analytics-pages-per-session").textContent=e.avgJobsViewed||"-",document.getElementById("analytics-avg-time").textContent=$(e.avgSessionDuration||0)}else{document.getElementById("analytics-pv").textContent=((null==n?void 0:n.pageViews)||0).toLocaleString(),document.getElementById("analytics-users").textContent=((null==n?void 0:n.users)||0).toLocaleString();const e=(null==n?void 0:n.sessions)||0,t=(null==n?void 0:n.pageViews)||0,o=e>0?(t/e).toFixed(1):"-";document.getElementById("analytics-pages-per-session").textContent=o,document.getElementById("analytics-avg-time").textContent="-"}const a=document.getElementById("job-analytics-tbody");a&&((null==s?void 0:s.jobs)&&s.jobs.length>0?a.innerHTML=s.jobs.map(e=>`\n        <tr>\n          <td>${ye(e.jobTitle||e.pagePath||"ä¸æ˜")}</td>\n          <td>${e.views||0}</td>\n          <td>${e.users||"-"}</td>\n          <td>-</td>\n          <td>-</td>\n        </tr>\n      `).join(""):a.innerHTML='\n        <tr>\n          <td colspan="5" class="loading-cell">\n            ã“ã®ä¼šç¤¾ã®æ±‚äººåˆ¥ãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚<br>\n            <small>â€» GA4ã§ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆview_job_detailï¼‰ã®è¨­å®šãŒå¿…è¦ã§ã™</small>\n          </td>\n        </tr>\n      ');const l=document.getElementById("source-analytics-tbody");if(l)if(e&&(null==s?void 0:s.traffic)&&s.traffic.length>0){const e=s.traffic,t=e.reduce((e,t)=>e+(t.count||0),0);l.innerHTML=e.slice(0,10).map(e=>{const n=t>0?Math.round(e.count/t*100):0;return`\n          <tr>\n            <td>${ye(e.channel||"ä¸æ˜")}</td>\n            <td>${e.count||0}</td>\n            <td>${n}%</td>\n          </tr>\n        `}).join("")}else{const e=(null==o?void 0:o.sources)||[];if(e.length>0){const t=e.reduce((e,t)=>e+(t.sessions||0),0);l.innerHTML=e.slice(0,10).map(e=>{const n=t>0?Math.round(e.sessions/t*100):0;return`\n            <tr>\n              <td>${ye(e.source||"(direct)")}</td>\n              <td>${e.sessions||0}</td>\n              <td>${n}%</td>\n            </tr>\n          `}).join("")}else if((null==o?void 0:o.channels)&&o.channels.length>0){const e=o.channels.reduce((e,t)=>e+(t.sessions||0),0);l.innerHTML=o.channels.map(t=>{const n=e>0?Math.round(t.sessions/e*100):0;return`\n            <tr>\n              <td>${ye(t.channel||"ä¸æ˜")}</td>\n              <td>${t.sessions||0}</td>\n              <td>${n}%</td>\n            </tr>\n          `}).join("")}else l.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}const c=document.getElementById("device-analytics-tbody");if(c){const t=e&&(null==s?void 0:s.devices)?s.devices:(null==o?void 0:o.devices)||[];if(t.length>0){const e=t.reduce((e,t)=>e+(t.sessions||0),0);c.innerHTML=t.map(t=>{const n=e>0?Math.round(t.sessions/e*100):0;return`\n          <tr>\n            <td>${ye(S(t.device))}</td>\n            <td>${t.sessions||0}</td>\n            <td>${n}%</td>\n          </tr>\n        `}).join("")}else c.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}const i=document.getElementById("analytics-demographics");i&&(e&&s?(i.style.display="block",k(s.gender,s.age,{maleBarId:"gender-bar-male",femaleBarId:"gender-bar-female",malePercentId:"gender-male-percent",femalePercentId:"gender-female-percent",ageContainerId:"age-bars"})):i.style.display="none")}(a)}catch(l){console.error("ã‚¢ã‚¯ã‚»ã‚¹è§£æãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",l),function(){document.getElementById("analytics-pv").textContent="- (æœªé€£æº)",document.getElementById("analytics-users").textContent="-",document.getElementById("analytics-pages-per-session").textContent="-",document.getElementById("analytics-avg-time").textContent="-";const e=document.getElementById("job-analytics-tbody");e&&(e.innerHTML='\n      <tr>\n        <td colspan="5" class="loading-cell">\n          ã‚¢ã‚¯ã‚»ã‚¹è§£æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>\n          Google Analyticsã¨ã®é€£æºã‚’è¨­å®šã™ã‚‹ã¨ã€è©³ç´°ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚\n        </td>\n      </tr>\n    ');const t=document.getElementById("source-analytics-tbody");t&&(t.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>');const n=document.getElementById("device-analytics-tbody");n&&(n.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>')}()}}async function He(t,n){if(!e)return[];try{const o=firebase.firestore();return(await o.collection("applications").where("companyDomain","==",e).where("createdAt",">=",t).where("createdAt","<=",n).orderBy("createdAt","desc").get()).docs.map(e=>{var t,n;return{id:e.id,...e.data(),createdAt:(null==(n=null==(t=e.data().createdAt)?void 0:t.toDate)?void 0:n.call(t))||new Date(e.data().createdAt)}})}catch(o){return console.error("å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",o),[]}}async function Pe(e,t){const n=t.getTime()-e.getTime(),o=new Date(e.getTime()-1),s=new Date(o.getTime()-n);return await He(s,o)}function qe(e){const t={new:"æ–°è¦",contacted:"é€£çµ¡æ¸ˆ",interviewing:"é¢æ¥ä¸­",hired:"æ¡ç”¨",rejected:"ä¸æ¡ç”¨",withdrawn:"è¾é€€"},n={};Object.values(t).forEach(e=>{n[e]=0}),e.forEach(e=>{const o=e.status||"new",s=t[o]||"æ–°è¦";n[s]=(n[s]||0)+1});const o=e.length;return Object.entries(n).map(([e,t])=>({status:e,count:t,percentage:o>0?Math.round(t/o*100):0}))}function _e(e){const t={google:"Googleæ¤œç´¢",indeed:"Indeed",jobbox:"æ±‚äººãƒœãƒƒã‚¯ã‚¹",direct:"ç›´æ¥æµå…¥",line:"LINE",other:"ãã®ä»–"},n={};e.forEach(e=>{let o=e.source||e.utmSource||"other";o=o.includes("google")?"google":o.includes("indeed")?"indeed":o.includes("jobbox")||o.includes("stanby")?"jobbox":o.includes("line")?"line":"direct"===o||"(direct)"===o?"direct":"other";const s=t[o]||"ãã®ä»–";n[s]=(n[s]||0)+1});const o=e.length;return Object.entries(n).map(([e,t])=>({source:e,count:t,percentage:o>0?Math.round(t/o*100):0})).sort((e,t)=>t.count-e.count)}function Ue(e){const t={};return e.forEach(e=>{const n=e.assignee||"æœªå‰²å½“";t[n]||(t[n]={assignee:n,handled:0,pending:0});"new"===(e.status||"new")?t[n].pending++:t[n].handled++}),Object.values(t).sort((e,t)=>t.handled-e.handled)}function Oe(e){const{applications:t,comparison:n,period:o}=e,s=t.length,a=n.length,c=a>0?Math.round((s-a)/a*100):0,i=c>=0?`+${c}%`:`${c}%`,d=t.filter(e=>"hired"===e.status).length,r=t.filter(e=>"new"===e.status||"contacted"===e.status).length;document.getElementById("summary-total").textContent=s,document.getElementById("summary-change").textContent=i,document.getElementById("summary-change").className="summary-value "+(c>=0?"positive":"negative"),document.getElementById("summary-hired").textContent=d,document.getElementById("summary-pending").textContent=r;const u=qe(t);document.getElementById("status-breakdown").innerHTML=u.map(e=>`\n    <tr>\n      <td>${ye(e.status)}</td>\n      <td>${e.count}</td>\n      <td>${e.percentage}%</td>\n    </tr>\n  `).join("");const m=function(e){const t={};return e.forEach(e=>{const n=e.jobId||"unknown",o=e.jobTitle||"ä¸æ˜ãªæ±‚äºº";t[n]||(t[n]={jobId:n,jobTitle:o,count:0}),t[n].count++}),Object.values(t).sort((e,t)=>t.count-e.count).slice(0,5)}(t),p=document.getElementById("job-performance");0===m.length?p.innerHTML='<tr><td colspan="4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>':p.innerHTML=m.map(e=>{const t=l.find(t=>t.id===e.jobId),n=(null==t?void 0:t.pageViews)||"-",o="-"!==n&&n>0?(e.count/n*100).toFixed(1)+"%":"-";return`\n        <tr>\n          <td>${ye(e.jobTitle)}</td>\n          <td>${e.count}</td>\n          <td>${n}</td>\n          <td>${o}</td>\n        </tr>\n      `}).join("");const g=_e(t),y=document.getElementById("source-breakdown");0===g.length?y.innerHTML='<tr><td colspan="3">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>':y.innerHTML=g.map(e=>`\n      <tr>\n        <td>${ye(e.source)}</td>\n        <td>${e.count}</td>\n        <td>${e.percentage}%</td>\n      </tr>\n    `).join("");const b=Ue(t),v=document.getElementById("assignee-breakdown");0===b.length?v.innerHTML='<tr><td colspan="3">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>':v.innerHTML=b.map(e=>`\n      <tr>\n        <td>${ye(e.assignee)}</td>\n        <td>${e.handled}</td>\n        <td>${e.pending}</td>\n      </tr>\n    `).join(""),document.getElementById("report-empty").style.display="none",document.getElementById("report-content").style.display="block",document.getElementById("report-actions").style.display="flex"}async function Je(){const e=document.getElementById("report-period").value;let t,n;if("custom"===e){const e=document.getElementById("report-from"),o=document.getElementById("report-to");if(!e.value||!o.value)return void alert("é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’æŒ‡å®šã—ã¦ãã ã•ã„");t=new Date(e.value),t.setHours(0,0,0,0),n=new Date(o.value),n.setHours(23,59,59,999)}else{const o=function(e){const t=new Date;let n,o;switch(e){case"week":{const e=t.getDay();n=new Date(t),n.setDate(t.getDate()-e),n.setHours(0,0,0,0),o=new Date(t),o.setHours(23,59,59,999);break}case"last-week":{const e=t.getDay();o=new Date(t),o.setDate(t.getDate()-e-1),o.setHours(23,59,59,999),n=new Date(o),n.setDate(o.getDate()-6),n.setHours(0,0,0,0);break}case"month":n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t),o.setHours(23,59,59,999);break;case"last-month":n=new Date(t.getFullYear(),t.getMonth()-1,1),o=new Date(t.getFullYear(),t.getMonth(),0,23,59,59,999);break;default:n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t)}return{start:n,end:o}}(e);t=o.start,n=o.end}document.getElementById("report-loading").style.display="flex",document.getElementById("report-empty").style.display="none",document.getElementById("report-content").style.display="none",document.getElementById("report-actions").style.display="none";try{const[e,o]=await Promise.all([He(t,n),Pe(t,n)]);T(e),C({applications:e,comparison:o,period:{start:t,end:n}}),Oe(D)}catch(o){console.error("ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:",o),alert("ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+o.message)}finally{document.getElementById("report-loading").style.display="none"}}function Xe(){if(!D||!D.applications.length)return void alert("ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");const{applications:t,period:n}=D,o=[["å¿œå‹Ÿæ—¥æ™‚","æ±‚äººã‚¿ã‚¤ãƒˆãƒ«","æ°å","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","æµå…¥å…ƒ","æ‹…å½“è€…"],...t.map(e=>[e.createdAt?new Date(e.createdAt).toLocaleString("ja-JP"):"",e.jobTitle||"",e.name||"",e.status||"new",e.source||e.utmSource||"",e.assignee||""])].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),s=new Blob(["\ufeff"+o],{type:"text/csv;charset=utf-8"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a;const c=n.start.toISOString().split("T")[0],i=n.end.toISOString().split("T")[0];l.download=`report-${e}-${c}-${i}.csv`,l.click(),URL.revokeObjectURL(a)}function Re(){if(!D||!D.applications.length)return void alert("ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");if("undefined"==typeof XLSX)return void alert("Excelãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“");const{applications:t,period:n}=D,o=XLSX.utils.book_new(),s=[["ãƒ¬ãƒãƒ¼ãƒˆæœŸé–“",`${n.start.toLocaleDateString("ja-JP")} ã€œ ${n.end.toLocaleDateString("ja-JP")}`],["ä¼šç¤¾",j],[""],["ç·å¿œå‹Ÿæ•°",t.length],["æ¡ç”¨æ•°",t.filter(e=>"hired"===e.status).length],["å¯¾å¿œä¸­",t.filter(e=>"new"===e.status||"contacted"===e.status).length]],a=XLSX.utils.aoa_to_sheet(s);XLSX.utils.book_append_sheet(o,a,"ã‚µãƒãƒªãƒ¼");const l=t.map(e=>[e.createdAt?new Date(e.createdAt).toLocaleString("ja-JP"):"",e.jobTitle||"",e.name||"",e.phone||"",e.email||"",e.status||"new",e.source||e.utmSource||"",e.assignee||""]),c=XLSX.utils.aoa_to_sheet([["å¿œå‹Ÿæ—¥æ™‚","æ±‚äººã‚¿ã‚¤ãƒˆãƒ«","æ°å","é›»è©±ç•ªå·","ãƒ¡ãƒ¼ãƒ«","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","æµå…¥å…ƒ","æ‹…å½“è€…"],...l]);XLSX.utils.book_append_sheet(o,c,"å¿œå‹Ÿä¸€è¦§");const i=qe(t).map(e=>[e.status,e.count,`${e.percentage}%`]),d=XLSX.utils.aoa_to_sheet([["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","ä»¶æ•°","å‰²åˆ"],...i]);XLSX.utils.book_append_sheet(o,d,"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥");const r=_e(t).map(e=>[e.source,e.count,`${e.percentage}%`]),u=XLSX.utils.aoa_to_sheet([["æµå…¥å…ƒ","ä»¶æ•°","å‰²åˆ"],...r]);XLSX.utils.book_append_sheet(o,u,"æµå…¥å…ƒåˆ¥");const m=Ue(t).map(e=>[e.assignee,e.handled,e.pending]),p=XLSX.utils.aoa_to_sheet([["æ‹…å½“è€…","å¯¾å¿œæ¸ˆ","æœªå¯¾å¿œ"],...m]);XLSX.utils.book_append_sheet(o,p,"æ‹…å½“è€…åˆ¥");const g=n.start.toISOString().split("T")[0],y=n.end.toISOString().split("T")[0];XLSX.writeFile(o,`report-${e}-${g}-${y}.xlsx`)}function Ve(){console.log("[LPè¨­å®š] initCompanyLPSettings é–‹å§‹"),M(A,{getCompanyDomain:()=>e}),H(),P(),q();const t=document.getElementById("btn-save-lp-settings");t&&t.addEventListener("click",()=>{_()});const n=document.getElementById("btn-reset-lp-settings");n&&n.addEventListener("click",()=>{confirm("LPè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")&&Ye()});const o=document.getElementById("btn-toggle-preview");o&&o.addEventListener("click",U);const s=document.getElementById("btn-close-preview");s&&s.addEventListener("click",O);const a=document.getElementById("lp-back-to-jobs");a&&a.addEventListener("click",()=>{const e=document.getElementById("lp-job-select-group"),t=document.getElementById("lp-editor");e&&(e.style.display="block"),t&&(t.style.display="none"),Fe("job")}),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".preview-device-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active");const t=e.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");n&&n.setAttribute("data-device",t)})}),["lp-hero-title","lp-hero-subtitle","lp-hero-image","lp-cta-text","lp-faq","lp-tiktok-pixel","lp-google-ads-id","lp-google-ads-label","lp-ogp-title","lp-ogp-description","lp-ogp-image","lp-video-url"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",()=>X())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>X())}),document.querySelectorAll(".collapsible-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t),o=e.querySelector(".collapse-icon");if(n){const e="none"!==n.style.display;n.style.display=e?"none":"block",o&&(o.textContent=e?"â–¶":"â–¼")}})}),J(),ee(!0)}function Fe(e){const t=document.querySelectorAll(".lp-step"),n=["job","edit"],o=n.indexOf(e);t.forEach(e=>{const t=e.dataset.step,s=n.indexOf(t);e.classList.remove("active","completed"),s<o?e.classList.add("completed"):s===o&&e.classList.add("active")})}async function Ge(){G||Ve(),console.log("[LPè¨­å®š] loadCompanyLPSettings é–‹å§‹, companyDomain:",e),await async function(){const t=document.getElementById("lp-job-grid"),n=document.getElementById("lp-job-select");t&&(t.innerHTML='<div class="lp-loading-placeholder">æ±‚äººã‚’èª­ã¿è¾¼ã¿ä¸­...</div>');try{if(l.length>0){const t=l.map(t=>({id:`${e}_${t.jobId||t.id}`,jobId:t.jobId||t.id,title:t.title||t.å‹Ÿé›†ã‚¿ã‚¤ãƒˆãƒ«||"(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)",company:j,companyDomain:e,sheetUrl:d,rawData:t}));if(z(t),function(t){const n=document.getElementById("lp-job-grid");if(!n)return;if(0===t.length)return void(n.innerHTML='<div class="lp-no-results"><p>æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“</p></div>');n.innerHTML=t.map(e=>`\n    <div class="lp-job-card" data-job-id="${ye(e.id)}">\n      <div class="lp-job-title">${ye(e.title)}</div>\n      <div class="lp-job-id">ID: ${ye(e.jobId)}</div>\n      <div class="lp-job-actions">\n        <button type="button" class="lp-job-action-btn primary lp-select-job-btn">LPè¨­å®šã‚’ç·¨é›†</button>\n        <a href="lp.html?j=${encodeURIComponent(e.id)}" target="_blank" class="lp-job-action-btn secondary">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</a>\n      </div>\n    </div>\n  `).join(""),n.querySelectorAll(".lp-select-job-btn").forEach(t=>{t.addEventListener("click",async o=>{o.stopPropagation();const s=t.closest(".lp-job-card"),a=s.dataset.jobId;n.querySelectorAll(".lp-job-card").forEach(e=>e.classList.remove("selected")),s.classList.add("selected");const l=document.getElementById("lp-job-select");l&&(l.value=a),N(Y.find(e=>e.id===a)),await async function(t){console.log("[LPè¨­å®š] loadLPSettingsForJob:",t);const n=document.getElementById("lp-preview-btn"),s=document.getElementById("lp-edit-mode-btn");if(!t)return;ze(!0),n&&(n.href=`lp.html?j=${encodeURIComponent(t)}`);s&&(s.href=`lp.html?j=${encodeURIComponent(t)}&edit`);Z();const a=document.querySelector('input[name="design-pattern"][value="standard"]');a&&(a.checked=!0);try{if(await async function(){if(d)return d;try{let t=K();t&&0!==t.length||(await W(),t=K());const n=t.find(t=>t.companyDomain===e);if(n){const e=n.manageSheetUrl||n.jobsSheet||null;r(e),console.log("[LPè¨­å®š] company-managerã‹ã‚‰å–å¾—ã—ãŸsheetUrl:",e)}else console.warn("[LPè¨­å®š] ä¼šç¤¾ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:",e)}catch(o){console.warn("[LPè¨­å®š] ä¼šç¤¾æƒ…å ±ã®å–å¾—ã«å¤±æ•—:",o)}return d}(),!d)return console.log("[LPè¨­å®š] ç®¡ç†ã‚·ãƒ¼ãƒˆURLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),void Ye();let n=null;const s=d.match(/\/d\/([a-zA-Z0-9_-]+)/);if(s?n=s[1]:/^[a-zA-Z0-9_-]+$/.test(d)&&(n=d),!n)return console.log("[LPè¨­å®š] ç®¡ç†ã‚·ãƒ¼ãƒˆIDã‚’æŠ½å‡ºã§ãã¾ã›ã‚“"),void Ye();const a=Date.now(),l=`https://docs.google.com/spreadsheets/d/${n}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent("LPè¨­å®š")}&_t=${a}`,c=await fetch(l,{cache:"no-store"});if(c.ok){const e=function(e,t){const n=function(e){const t=[];let n="",o=!1;for(let s=0;s<e.length;s++){const a=e[s];if('"'===a)'"'===e[s+1]?(n+='""',s++):(o=!o,n+=a);else if("\n"!==a||o){if("\r"===a)continue;n+=a}else n.trim()&&t.push(n),n=""}n.trim()&&t.push(n);return t}(e),o=be(n[0]||"");for(let s=1;s<n.length;s++){if(!n[s].trim())continue;const e=be(n[s]),a={};o.forEach((t,n)=>{const o=t.replace(/"/g,"").trim();a[o]=e[n]||""});if((a.jobId||a["æ±‚äººID"]||"")===t){const e={heroTitle:a.heroTitle||a["ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«"]||"",heroSubtitle:a.heroSubtitle||a["ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«"]||"",heroImage:a.heroImage||a["ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ"]||"",ctaText:a.ctaText||a["CTAãƒ†ã‚­ã‚¹ãƒˆ"]||"",faq:a.faq||a.FAQ||"",designPattern:a.designPattern||a["ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³"]||"",layoutStyle:a.layoutStyle||a["ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¹ã‚¿ã‚¤ãƒ«"]||"default",sectionOrder:a.sectionOrder||a["ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åº"]||"",sectionVisibility:a.sectionVisibility||a["ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º"]||"",tiktokPixelId:a.tiktokPixelId||a["TikTok Pixel ID"]||"",googleAdsId:a.googleAdsId||a["Google Ads ID"]||"",googleAdsLabel:a.googleAdsLabel||a["Google Ads ãƒ©ãƒ™ãƒ«"]||"",ogpTitle:a.ogpTitle||a["OGPã‚¿ã‚¤ãƒˆãƒ«"]||"",ogpDescription:a.ogpDescription||a["OGPèª¬æ˜æ–‡"]||"",ogpImage:a.ogpImage||a["OGPç”»åƒ"]||"",showVideoButton:a.showVideoButton||a["å‹•ç”»ãƒœã‚¿ãƒ³è¡¨ç¤º"]||"",videoUrl:a.videoUrl||a["å‹•ç”»URL"]||"",lpContent:a.lpContent||a["LPæ§‹æˆ"]||"",customPrimary:a.customPrimary||a["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰"]||"",customAccent:a.customAccent||a["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼‰"]||"",customBg:a.customBg||a["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆèƒŒæ™¯ï¼‰"]||"",customText:a.customText||a["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰"]||""};for(let t=1;t<=6;t++)e[`pointTitle${t}`]=a[`pointTitle${t}`]||a[`ãƒã‚¤ãƒ³ãƒˆ${t}ã‚¿ã‚¤ãƒˆãƒ«`]||"",e[`pointDesc${t}`]=a[`pointDesc${t}`]||a[`ãƒã‚¤ãƒ³ãƒˆ${t}èª¬æ˜`]||"";return e}}return null}(await c.text(),t);if(e){Ne("lp-hero-title",e.heroTitle),Ne("lp-hero-subtitle",e.heroSubtitle),Ne("lp-hero-image",e.heroImage),Ne("lp-cta-text",e.ctaText||"ä»Šã™ãå¿œå‹Ÿã™ã‚‹"),Ne("lp-faq",e.faq),Ne("lp-tiktok-pixel",e.tiktokPixelId),Ne("lp-google-ads-id",e.googleAdsId),Ne("lp-google-ads-label",e.googleAdsLabel),Ne("lp-ogp-title",e.ogpTitle),Ne("lp-ogp-description",e.ogpDescription),Ne("lp-ogp-image",e.ogpImage);const t=document.getElementById("lp-show-video-button"),n=document.getElementById("video-url-group");if(t&&(t.checked="true"===String(e.showVideoButton).toLowerCase()||!0===e.showVideoButton,n&&(n.style.display=t.checked?"block":"none")),Ne("lp-video-url",e.videoUrl),e.designPattern){const t=document.querySelector(`input[name="design-pattern"][value="${e.designPattern}"]`);t&&(t.checked=!0)}return Q({primary:e.customPrimary||"",accent:e.customAccent||"",bg:e.customBg||"",text:e.customText||""}),V(e.heroImage||""),F(e),void X()}}}catch(o){console.log("[LPè¨­å®š] LPè¨­å®šã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:",o)}finally{ze(!1)}Ye(),X()}(a);const c=document.getElementById("lp-job-select-group"),i=document.getElementById("lp-editor");c&&(c.style.display="none"),i&&(i.style.display="block"),Fe("edit")})})}(t),n){let e='<option value="">-- æ±‚äººã‚’é¸æŠ --</option>';for(const n of t)e+=`<option value="${ye(n.id)}">${ye(n.title)}</option>`;n.innerHTML=e}}else t&&(t.innerHTML='<div class="lp-no-results"><p>æ±‚äººãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã¾ãšæ±‚äººã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p></div>')}catch(o){console.error("[LPè¨­å®š] æ±‚äººèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",o),t&&(t.innerHTML='<div class="lp-no-results"><p>æ±‚äººãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p></div>')}}()}function ze(e){const t=document.getElementById("lp-editor");if(!t)return;t.querySelectorAll("input, select, textarea, button").forEach(t=>{t.disabled=e});const n=document.getElementById("btn-save-lp-settings"),o=document.getElementById("btn-reset-lp-settings");n&&(n.disabled=e),o&&(o.disabled=e);const s=t.querySelector(".lp-loading-overlay");if(e){if(!s){const e=document.createElement("div");e.className="lp-loading-overlay",e.innerHTML='<div class="loading-spinner"></div><p>èª­ã¿è¾¼ã¿ä¸­...</p>',t.style.position="relative",t.appendChild(e)}}else null==s||s.remove()}function Ne(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}function Ye(){["lp-hero-title","lp-hero-subtitle","lp-hero-image","lp-faq","lp-tiktok-pixel","lp-google-ads-id","lp-google-ads-label","lp-ogp-title","lp-ogp-description","lp-ogp-image","lp-video-url"].forEach(e=>Ne(e,"")),Ne("lp-cta-text","ä»Šã™ãå¿œå‹Ÿã™ã‚‹");const e=document.getElementById("lp-show-video-button"),t=document.getElementById("video-url-group");e&&(e.checked=!1),t&&(t.style.display="none");const n=document.querySelector('input[name="design-pattern"][value="standard"]');n&&(n.checked=!0),R(),V(""),F({})}function Ze(){const t=document.getElementById("password-change-form");t&&t.addEventListener("submit",async n=>{n.preventDefault();const o=document.getElementById("current-password").value,s=document.getElementById("new-password").value,a=document.getElementById("confirm-password").value,l=document.getElementById("password-change-error"),c=document.getElementById("password-change-success");if(l.style.display="none",c.style.display="none",s!==a)return l.textContent="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“",void(l.style.display="block");if(s.length<8)return l.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„",void(l.style.display="block");try{const n=await async function(t,n){if("undefined"==typeof firebase||!firebase.firestore)return{success:!1,error:"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“"};const o=firebase.firestore(),s=sessionStorage.getItem("company_user_id");if(!s)try{const s=await o.collection("company_users").where("companyDomain","==",e).limit(1).get();if(s.empty)return{success:!1,error:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"};const a=s.docs[0];return a.data().password!==t?{success:!1,error:"ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"}:(await o.collection("company_users").doc(a.id).update({password:n,passwordChangedAt:firebase.firestore.FieldValue.serverTimestamp()}),{success:!0})}catch(a){return console.error("Password change error:",a),{success:!1,error:a.message}}try{const e=await o.collection("company_users").where("username","==",s).limit(1).get();if(e.empty)return{success:!1,error:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"};const a=e.docs[0];return a.data().password!==t?{success:!1,error:"ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"}:(await o.collection("company_users").doc(a.id).update({password:n,passwordChangedAt:firebase.firestore.FieldValue.serverTimestamp()}),{success:!0})}catch(a){return console.error("Password change error:",a),{success:!1,error:a.message}}}(o,s);n.success?(c.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ",c.style.display="block",t.reset()):(l.textContent=n.error,l.style.display="block")}catch(i){console.error("Password change error:",i),l.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ",l.style.display="block"}})}function Qe(t){if(ie())return void console.log("[JobManage] ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆä¸­ã®ãŸã‚ç„¡è¦–:",t);pe(),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`section-${t}`);n&&n.classList.add("active"),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.dataset.section===t&&e.closest("li").classList.add("active")});const o=document.getElementById("page-title"),s=document.querySelector(".header-actions");"jobs"===t?(o&&(o.textContent=`${j} ã®æ±‚äººä¸€è¦§`),s&&(s.style.display="flex")):"analytics"===t?(o&&(o.textContent="ã‚¢ã‚¯ã‚»ã‚¹è§£æ"),s&&(s.style.display="none")):"reports"===t?(o&&(o.textContent="å¿œå‹Ÿãƒ¬ãƒãƒ¼ãƒˆ"),s&&(s.style.display="none")):"applicants"===t?(o&&(o.textContent="å¿œå‹Ÿè€…ç®¡ç†"),s&&(s.style.display="none"),de||(re(!0),ue(e))):"lp-settings"===t?(o&&(o.textContent="LPè¨­å®š"),s&&(s.style.display="none"),Ge()):"recruit-settings"===t?(o&&(o.textContent="æ¡ç”¨ãƒšãƒ¼ã‚¸è¨­å®š"),s&&(s.style.display="none"),me(e)):"settings"===t?(o&&(o.textContent="ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š"),s&&(s.style.display="none")):"job-edit"===t&&(o&&(o.textContent="æ±‚äººç·¨é›†"),s&&(s.style.display="none")),requestAnimationFrame(()=>{ge()})}async function Ke(){if(ne(),!oe())return void(window.location.href="admin.html");const t=new URLSearchParams(window.location.search),n=t.get("domain"),o=t.get("company")||n,s=t.get("sheetUrl");se(n,o,s);const a=t.get("section");if(a&&["analytics","reports","applicants"].includes(a)&&Qe(a),!e)return alert("ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"),void(window.location.href="admin.html");if(!ae(e))return alert("ã“ã®ä¼šç¤¾ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"),void(window.location.href="admin.html");le()?function(){const e=document.getElementById("company-sidebar"),t=document.getElementById("admin-sidebar");e&&(e.style.display="none"),t&&(t.style.display="");const n=document.getElementById("btn-logout-admin");n&&n.addEventListener("click",()=>{te(),window.location.href="admin.html"}),null==t||t.querySelectorAll(".sidebar-nav a[data-section]").forEach(e=>{e.addEventListener("click",n=>{var o;const s=e.dataset.section;["jobs","analytics","reports","applicants","recruit-settings"].includes(s)&&(n.preventDefault(),Qe(s),t.querySelectorAll(".sidebar-nav li").forEach(e=>e.classList.remove("active")),null==(o=e.closest("li"))||o.classList.add("active"))})})}():function(){const e=document.querySelector(".feed-section");e&&(e.style.display="none");const t=document.querySelector('.sidebar-nav a[data-section="back"]');t&&(t.style.display="none");const n=document.getElementById("btn-back-admin");n&&(n.style.display="none");const o=document.getElementById("btn-logout");o&&(o.style.display="block",o.addEventListener("click",()=>{te(),window.location.href="admin.html"}));const s=document.getElementById("nav-settings-item");s&&(s.style.display="block");const a=document.getElementById("nav-lp-settings-item");a&&(a.style.display="block"),Ve(),Ze();const l=document.getElementById("company-name");l&&(l.innerHTML=`${ye(j)} <span class="badge info">ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>`)}();const l=document.getElementById("page-title");l&&!a&&(l.textContent=`${j} ã®æ±‚äººä¸€è¦§`);const c=document.getElementById("company-name");c&&(c.textContent=j);const i=document.getElementById("btn-open-sheet");d&&i?(i.href=d,i.style.display=""):i&&(i.style.display="none"),function(){var e,t,n,o,s,a,l,c,i,d,r,u,m,g,y;null==(e=document.getElementById("btn-add-job"))||e.addEventListener("click",Ee),null==(t=document.getElementById("btn-refresh"))||t.addEventListener("click",he),null==(n=document.getElementById("job-edit-back-btn"))||n.addEventListener("click",Le),null==(o=document.getElementById("job-edit-cancel-btn"))||o.addEventListener("click",Le),null==(s=document.getElementById("job-edit-delete-btn"))||s.addEventListener("click",xe),null==(a=document.getElementById("job-edit-form-section"))||a.addEventListener("submit",e=>{e.preventDefault(),Be()}),null==(l=document.getElementById("btn-download-indeed"))||l.addEventListener("click",Te),null==(c=document.getElementById("btn-download-google"))||c.addEventListener("click",Ce),null==(i=document.getElementById("btn-download-jobbox"))||i.addEventListener("click",De),null==(d=document.getElementById("btn-download-csv"))||d.addEventListener("click",Me);const b=document.getElementById("job-search"),v=document.getElementById("job-filter-status"),f=document.getElementById("job-filter-area"),h=document.getElementById("btn-clear-filters");if(b){let e;b.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{p.search=b.value.trim(),fe()},300)})}v&&v.addEventListener("change",()=>{p.status=v.value,fe()}),f&&f.addEventListener("change",()=>{p.area=f.value,fe()}),h&&h.addEventListener("click",()=>{ce(),b&&(b.value=""),v&&(v.value=""),f&&(f.value=""),fe()}),document.querySelectorAll(".sidebar-nav a[data-section]").forEach(e=>{e.addEventListener("click",t=>{const n=e.dataset.section;n&&"back"!==n&&(t.preventDefault(),Qe(n))})}),null==(r=document.getElementById("report-period"))||r.addEventListener("change",e=>{const t=document.getElementById("report-custom-dates");t&&(t.style.display="custom"===e.target.value?"flex":"none")}),null==(u=document.getElementById("btn-generate-report"))||u.addEventListener("click",Je),null==(m=document.getElementById("btn-report-csv"))||m.addEventListener("click",Xe),null==(g=document.getElementById("btn-report-excel"))||g.addEventListener("click",Re),null==(y=document.getElementById("btn-load-analytics"))||y.addEventListener("click",Ae)}(),await he()}window.switchToJobsSection=()=>Qe("jobs"),"undefined"!=typeof window&&(window.JobManager={init:Ke,loadJobsData:he,showJobModal:Ee,editJob:je,closeJobModal:Le,saveJobData:Be,deleteJob:xe}),document.addEventListener("DOMContentLoaded",()=>{Ke()});
