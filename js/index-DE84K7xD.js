import{escapeHtml as e}from"./utils-BB91om2o.js";import{s as t}from"./modal-gG-182nw.js";const n="https://asia-northeast1-generated-area-484613-e3-90bd4.cloudfunctions.net";async function a(){const e=await async function(){try{const e=firebase.auth().currentUser;if(e)return await e.getIdToken()}catch(e){console.warn("Failed to get ID token:",e)}return null}(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}async function i(e,t,i){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)throw new Error("ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚æœ¬ç•ªç’°å¢ƒã§ãŠè©¦ã—ãã ã•ã„ã€‚");const s=await a(),l=await fetch(`${n}/initiateCalendarAuth`,{method:"POST",headers:s,body:JSON.stringify({companyDomain:e,companyUserId:t,staffName:i})});if(!l.ok){const e=await l.json();throw new Error(e.error||"èªè¨¼URLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}return l.json()}async function s(e,t){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)return console.log("[Calendar] ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã¯åˆ©ç”¨ã§ãã¾ã›ã‚“"),{success:!0,integration:null};const i=await a(),s=new URLSearchParams({companyDomain:e,companyUserId:t}),l=await fetch(`${n}/getCalendarIntegration?${s}`,{headers:i});if(!l.ok){const e=await l.json();throw new Error(e.error||"é€£æºæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}return l.json()}async function l(e,t){const i=await a(),s=await fetch(`${n}/revokeCalendarAuth`,{method:"POST",headers:i,body:JSON.stringify({companyDomain:e,companyUserId:t})});if(!s.ok){const e=await s.json();throw new Error(e.error||"é€£æºè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}return s.json()}async function o(e,t,i,s){const l=await a(),o=new URLSearchParams({companyDomain:e,companyUserId:t,startDate:i,endDate:s}),c=await fetch(`${n}/getCalendarAvailability?${o}`,{headers:l});if(!c.ok){const e=await c.json();throw new Error(e.error||"ç©ºãæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}return c.json()}async function c(e){const t=await a(),i=await fetch(`${n}/createCalendarEvent`,{method:"POST",headers:t,body:JSON.stringify(e)});if(!i.ok){const e=await i.json();throw new Error(e.error||"ã‚¤ãƒ™ãƒ³ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}return i.json()}function r(e){const t=new Date(e),n=t.getDay(),a=t.getDate()-n+(0===n?-6:1);return t.setDate(a),t.setHours(0,0,0,0),t}function d(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function u(e){return["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][e.getDay()]}const p={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"};let v=null,m=null,g=[],f=[],y=1;let h=null,w=[],b={},$=[],L={},E=null,D=null,k="";function S(e){return document.getElementById(k+e)}const x={new:"æ–°è¦",contacted:"é€£çµ¡æ¸ˆã¿",interviewing:"é¢æ¥èª¿æ•´ä¸­",interviewed:"é¢æ¥æ¸ˆã¿",hired:"æ¡ç”¨",joined:"å…¥ç¤¾",pending:"ä¿ç•™",ng:"NG",rejected:"ä¸æ¡ç”¨",withdrawn:"è¾é€€"},A={apply:"å¿œå‹Ÿ",line:"LINEç›¸è«‡",consult:"ãŠå•ã„åˆã‚ã›"},T={immediate:"ã™ãã«ã§ã‚‚","within-week":"1é€±é–“ä»¥å†…","within-month":"1ãƒ¶æœˆä»¥å†…","within-2months":"2ãƒ¶æœˆä»¥å†…",undecided:"æœªå®šãƒ»ç›¸è«‡ã—ãŸã„"},j={first_contact:{subject:"åˆå›é€£çµ¡",body:"{applicantName}æ§˜\n\nã“ã®åº¦ã¯ã€Œ{jobTitle}ã€ã«ã”å¿œå‹Ÿã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚\n\nã”å¿œå‹Ÿå†…å®¹ã‚’ç¢ºèªã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚\nã¤ãã¾ã—ã¦ã¯ã€ä¸€åº¦ãŠé›»è©±ã«ã¦ãŠè©±ã‚’ã•ã›ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚\n\nã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã‚’ã„ãã¤ã‹ãŠçŸ¥ã‚‰ã›ã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚\nï¼ˆå¹³æ—¥10:00ã€œ18:00ã®é–“ã§ãŠé¡˜ã„ã§ãã¾ã™ã¨å¹¸ã„ã§ã™ï¼‰\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\nä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"},schedule_interview:{subject:"é¢æ¥æ—¥ç¨‹èª¿æ•´",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\né¢æ¥ã®æ—¥ç¨‹èª¿æ•´ã«ã¤ã„ã¦ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚\n\nä¸‹è¨˜ã®æ—¥ç¨‹ã§ã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã¯ã”ã–ã„ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚\n\nã€å€™è£œæ—¥ã€‘\nãƒ»â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\nãƒ»â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\nãƒ»â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\n\nä¸Šè¨˜ä»¥å¤–ã§ã‚‚ã”èª¿æ•´å¯èƒ½ã§ã™ã®ã§ã€ã”å¸Œæœ›ã®æ—¥æ™‚ãŒã”ã–ã„ã¾ã—ãŸã‚‰ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚\n\nä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"},interview_reminder:{subject:"é¢æ¥ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\né¢æ¥æ—¥ç¨‹ã®ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’ãŠé€ã‚Šã„ãŸã—ã¾ã™ã€‚\n\nã€é¢æ¥æ—¥æ™‚ã€‘â—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰â—¯â—¯:00ã€œ\nã€å ´æ‰€ã€‘ã€’â—¯â—¯â—¯-â—¯â—¯â—¯â—¯ â—¯â—¯çœŒâ—¯â—¯å¸‚â—¯â—¯\nã€æŒã¡ç‰©ã€‘å±¥æ­´æ›¸ã€ç­†è¨˜ç”¨å…·\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\nå½“æ—¥ãŠä¼šã„ã§ãã‚‹ã“ã¨ã‚’æ¥½ã—ã¿ã«ã—ã¦ãŠã‚Šã¾ã™ã€‚"},document_request:{subject:"æ›¸é¡æå‡ºä¾é ¼",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\né¸è€ƒã‚’é€²ã‚ã‚‹ã«ã‚ãŸã‚Šã€ä¸‹è¨˜ã®æ›¸é¡ã‚’ã”æå‡ºã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚\n\nã€æå‡ºæ›¸é¡ã€‘\nãƒ»å±¥æ­´æ›¸ï¼ˆå†™çœŸè²¼ä»˜ï¼‰\nãƒ»è·å‹™çµŒæ­´æ›¸\n\nã€æå‡ºæ–¹æ³•ã€‘\nãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã«ã¦ã”é€ä»˜ãã ã•ã„ã€‚\n\nã€æå‡ºæœŸé™ã€‘\nâ—¯æœˆâ—¯æ—¥ï¼ˆâ—¯ï¼‰ã¾ã§\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\nä½•å’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"},result_pending:{subject:"é¸è€ƒçµæœå¾…ã¡",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\nå…ˆæ—¥ã¯é¢æ¥ã«ãŠè¶Šã—ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\nç¾åœ¨ã€ç¤¾å†…ã«ã¦é¸è€ƒã‚’é€²ã‚ã¦ãŠã‚Šã¾ã™ã€‚\nçµæœã«ã¤ãã¾ã—ã¦ã¯ã€â—¯æœˆâ—¯æ—¥é ƒã¾ã§ã«ã”é€£çµ¡ã•ã›ã¦ã„ãŸã ãäºˆå®šã§ã™ã€‚\n\nä»Šã—ã°ã‚‰ããŠå¾…ã¡ã„ãŸã ã‘ã¾ã™ã‚ˆã†ãŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚"},offer:{subject:"å†…å®šé€šçŸ¥",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\nã“ã®åº¦ã¯ã€Œ{jobTitle}ã€ã®é¸è€ƒã«ã”å‚åŠ ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\næ…é‡ã«æ¤œè¨ã•ã›ã¦ã„ãŸã ã„ãŸçµæœã€{applicantName}æ§˜ã‚’æ¡ç”¨ã•ã›ã¦ã„ãŸã ãã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚\n\nã¤ãã¾ã—ã¦ã¯ã€å…¥ç¤¾ã«é–¢ã™ã‚‹è©³ç´°ã«ã¤ã„ã¦ã”èª¬æ˜ã•ã›ã¦ã„ãŸã ããŸãã€\nãŠé›»è©±ã«ã¦ã”é€£çµ¡ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚\n\nã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\n{applicantName}æ§˜ã¨ä¸€ç·’ã«åƒã‘ã‚‹ã“ã¨ã‚’æ¥½ã—ã¿ã«ã—ã¦ãŠã‚Šã¾ã™ã€‚"},rejection:{subject:"ä¸æ¡ç”¨é€šçŸ¥",body:"{applicantName}æ§˜\n\nãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚\n\nã“ã®åº¦ã¯ã€Œ{jobTitle}ã€ã«ã”å¿œå‹Ÿã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\n\næ…é‡ã«æ¤œè¨ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸãŒã€èª ã«æ®‹å¿µãªãŒã‚‰ä»Šå›ã¯ã”æœŸå¾…ã«æ²¿ãˆãªã„çµæœã¨ãªã‚Šã¾ã—ãŸã€‚\n\nã”å¿œå‹Ÿã„ãŸã ã„ãŸã“ã¨ã«å¿ƒã‚ˆã‚Šæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã¨ã¨ã‚‚ã«ã€\n{applicantName}æ§˜ã®ä»Šå¾Œã®ã”æ´»èºã‚’ãŠç¥ˆã‚Šç”³ã—ä¸Šã’ã¾ã™ã€‚"}};function C(){return firebase.apps.length||firebase.initializeApp(p),firebase.firestore()}async function M(){try{const e=C(),t=await e.collection("company_users").where("companyDomain","==",v).where("isActive","==",!0).get();return $=[],t.forEach(e=>{$.push({id:e.id,...e.data()})}),await async function(){L={};for(const t of $)try{const e=await s(v,t.id);e.integration&&(L[t.id]=e.integration)}catch(e){console.log(`No calendar integration for user ${t.id}`)}}(),$}catch(e){return console.error("Failed to load company users:",e),[]}}function I(e){const t=document.querySelector(".applicants-content"),n=S("settings-section"),a=S("page-title"),i=document.querySelector(".header-actions");if("settings"===e){t&&(t.style.display="none"),n&&(n.style.display="block"),a&&(a.textContent="è¨­å®š"),i&&(i.style.display="none"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("nav-settings");e&&e.closest("li").classList.add("active"),H()}else{t&&(t.style.display="flex"),n&&(n.style.display="none"),a&&(a.textContent="å¿œå‹Ÿè€…ä¸€è¦§"),i&&(i.style.display="flex"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const e=document.querySelector('[data-section="applicants"]');e&&e.closest("li").classList.add("active")}}function H(){const n=S("calendar-integrations-list");n&&(0!==$.length?(n.innerHTML=$.map(t=>{const n=L[t.id],a=n&&n.isActive;return`\n      <div class="calendar-integration-item" data-user-id="${e(t.id)}">\n        <div class="calendar-integration-info">\n          <div class="calendar-integration-icon">ğŸ‘¤</div>\n          <div class="calendar-integration-details">\n            <h4>${e(t.name||t.username)}</h4>\n            <p>${a?e(n.googleEmail):"æœªé€£æº"}</p>\n          </div>\n        </div>\n        <div class="calendar-integration-actions">\n          ${a?`<span class="calendar-status connected">é€£æºä¸­</span>\n               <button class="btn-disconnect-calendar" data-user-id="${e(t.id)}">è§£é™¤</button>`:`<button class="btn-connect-calendar" data-user-id="${e(t.id)}" data-user-name="${e(t.name||t.username)}">\n                 <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"/></svg>\n                 Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«é€£æº\n               </button>`}\n        </div>\n      </div>\n    `}).join(""),n.querySelectorAll(".btn-connect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e,t){try{const n=await i(v,e,t);window.open(n.authUrl,"calendar-auth","width=600,height=700");let a=0;const l=10,o=setInterval(async()=>{a++;try{const t=await s(v,e);t.integration&&t.integration.isActive&&(clearInterval(o),L[e]=t.integration,H(),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºãŒå®Œäº†ã—ã¾ã—ãŸ"))}catch(t){}a>=l&&clearInterval(o)},3e3)}catch(n){console.error("Failed to initiate calendar auth:",n),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}}(e.dataset.userId,e.dataset.userName)})}),n.querySelectorAll(".btn-disconnect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e){if(!(await t({title:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã®è§£é™¤",message:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ",confirmText:"è§£é™¤ã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",danger:!0})))return;try{await l(v,e),delete L[e],H(),alert("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’è§£é™¤ã—ã¾ã—ãŸ")}catch(n){console.error("Failed to revoke calendar auth:",n),alert("é€£æºè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}}(e.dataset.userId)})})):n.innerHTML='<p class="no-data">æ‹…å½“è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>ç®¡ç†ç”»é¢ã‹ã‚‰æ‹…å½“è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>')}async function N(){if(!h)return;const t=S("interview-modal");if(!t)return;const n=S("interview-staff");n&&(n.innerHTML='<option value="">æ‹…å½“è€…ã‚’é¸æŠ...</option>'+$.map(t=>{const n=L[t.id],a=(null==n?void 0:n.isActive)?" (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºæ¸ˆ)":"";return`<option value="${e(t.id)}" data-has-calendar="${(null==n?void 0:n.isActive)?"true":"false"}">${e(t.name||t.username)}${a}</option>`}).join("")),D=null,E=r(new Date),S("availability-section").style.display="none",S("selected-slot-section").style.display="none",S("manual-datetime-section").style.display="block",S("calendar-status-hint").textContent="",t.style.display="flex"}function F(){const e=S("interview-modal");e&&(e.style.display="none")}async function q(){var e;const t=S("interview-staff"),n=t.options[t.selectedIndex],a="true"===(null==(e=null==n?void 0:n.dataset)?void 0:e.hasCalendar),i=t.value,s=S("availability-section"),l=S("manual-datetime-section"),o=S("calendar-status-hint");if(!i)return s.style.display="none",l.style.display="block",void(o.textContent="");a?(s.style.display="block",l.style.display="none",o.textContent="æ‹…å½“è€…ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ç©ºãæ™‚é–“ã‚’å–å¾—ã—ã¾ã™",o.style.color="#10b981",await U(i)):(s.style.display="none",l.style.display="block",o.textContent="ã“ã®æ‹…å½“è€…ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœªé€£æºã§ã™ã€‚æ‰‹å‹•ã§æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",o.style.color="#f59e0b")}async function U(t){const n=S("availability-grid");if(n){n.innerHTML='<div class="loading-message">ç©ºãæ™‚é–“ã‚’å–å¾—ä¸­...</div>';try{const n=new Date(E);n.setDate(n.getDate()+6);const a=d(E),i=d(n);!function(t){const n=S("availability-grid");if(!n)return;const a={},i=[];for(let e=0;e<5;e++){const t=new Date(E);t.setDate(t.getDate()+e);const n=d(t);i.push({date:t,dateStr:n}),a[n]=[]}t.forEach(e=>{const t=e.start.split("T")[0];a[t]&&a[t].push(e)});const s=i.map(({date:t,dateStr:n})=>{const i=a[n]||[],s=u(t);return`\n      <div class="availability-day">\n        <div class="day-header">${`${t.getMonth()+1}/${t.getDate()}`} (${s})</div>\n        <div class="day-slots">\n          ${i.length>0?i.map(t=>{const n=new Date(t.start),a=`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`,i=t.start;return`<button class="slot-btn ${D===i?"selected":""}" data-slot="${e(i)}">${a}</button>`}).join(""):'<span class="no-slots">-</span>'}\n        </div>\n      </div>\n    `}).join("");n.innerHTML=`<div class="availability-week">${s}</div>`,n.querySelectorAll(".slot-btn").forEach(e=>{e.addEventListener("click",()=>{!function(e){D=e,document.querySelectorAll(".slot-btn").forEach(t=>{t.classList.toggle("selected",t.dataset.slot===e)});const t=S("selected-slot-section"),n=S("selected-slot");if(t&&n){const a=new Date(e),i=u(a),s=`${a.getFullYear()}å¹´${a.getMonth()+1}æœˆ${a.getDate()}æ—¥(${i})`,l=`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`;n.textContent=`${s} ${l}`,t.style.display="block"}}(e.dataset.slot)})})}((await o(v,t,a,i)).availableSlots||[]),function(){const e=S("week-label");if(!e||!E)return;const t=new Date(E);t.setDate(t.getDate()+6);const n=`${E.getMonth()+1}/${E.getDate()}`,a=`${t.getMonth()+1}/${t.getDate()}`;e.textContent=`${E.getFullYear()}å¹´ ${n} - ${a}`}()}catch(a){console.error("Failed to load availability:",a),n.innerHTML='<div class="empty-message">ç©ºãæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}}function R(){E.setDate(E.getDate()-7);const e=S("interview-staff");(null==e?void 0:e.value)&&U(e.value)}function O(){E.setDate(E.getDate()+7);const e=S("interview-staff");(null==e?void 0:e.value)&&U(e.value)}async function P(){var e,t,n,a,i,s,l,o;const r=S("interview-staff"),d=null==r?void 0:r.value;if(!d)return void alert("æ‹…å½“è€…ã‚’é¸æŠã—ã¦ãã ã•ã„");const u=r.options[r.selectedIndex];let p;if("true"===(null==(e=null==u?void 0:u.dataset)?void 0:e.hasCalendar)&&D)p=new Date(D);else{const e=S("interview-datetime");if(!(null==e?void 0:e.value))return void alert("é¢è«‡æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„");p=new Date(e.value)}const m=parseInt((null==(t=S("interview-duration"))?void 0:t.value)||"60"),f=(null==(n=document.querySelector('input[name="meeting-type"]:checked'))?void 0:n.value)||"in_person",y=(null==(a=S("interview-location"))?void 0:a.value)||"",w=[];(null==(i=S("send-reminder-1day"))?void 0:i.checked)&&w.push({offsetMinutes:1440,sendTime:"10:00"}),(null==(s=S("send-reminder-1hour"))?void 0:s.checked)&&w.push({offsetMinutes:60});const b=g.find(e=>e.id===h);if(!b)return;const L=$.find(e=>e.id===d),E=S("interview-modal-save");E&&(E.disabled=!0,E.textContent="ç™»éŒ²ä¸­...");try{const e=await c({companyDomain:v,companyUserId:d,applicationId:h,applicantName:b.applicantName||(null==(l=b.applicant)?void 0:l.name)||"å¿œå‹Ÿè€…",applicantEmail:b.applicantEmail||(null==(o=b.applicant)?void 0:o.email)||"",staffName:(null==L?void 0:L.name)||(null==L?void 0:L.username)||"æ‹…å½“è€…",scheduledAt:p.toISOString(),durationMinutes:m,meetingType:f,location:y,reminders:w}),t=C();await t.collection("applications").doc(h).update({status:"interviewing",interviewId:e.interviewId,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const n=g.findIndex(e=>e.id===h);-1!==n&&(g[n].status="interviewing",g[n].interviewId=e.interviewId),F(),Q(h),z(),J(),alert("é¢è«‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸã€‚æ‹…å½“è€…ã®Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚")}catch(k){console.error("Failed to save interview:",k),alert("é¢è«‡ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: "+k.message)}finally{E&&(E.disabled=!1,E.textContent="é¢è«‡ã‚’ç™»éŒ²")}}async function B(){try{const e=C().collection("settings").doc(v||"global"),t=await e.get();w=t.exists&&t.data().assignees?t.data().assignees:[],_()}catch(e){console.error("Failed to load assignees:",e),w=[]}}function _(){const t=S("detail-assignee");if(t){const n=t.value;t.innerHTML='<option value="">æœªå‰²å½“</option>'+w.map(t=>`<option value="${e(t)}">${e(t)}</option>`).join(""),t.value=n}}async function V(){var e;const t=S("new-assignee-name"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)if(w.includes(n))alert("ã“ã®æ‹…å½“è€…ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™");else try{const e=C().collection("settings").doc(v||"global");w.push(n),await e.set({assignees:w,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),_(),G();const t=S("detail-assignee");t&&(t.value=n)}catch(a){console.error("Failed to add assignee:",a),alert("æ‹…å½“è€…ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}else alert("æ‹…å½“è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")}function Y(){const e=S("assignee-modal"),t=S("new-assignee-name");e&&(e.style.display="flex"),t&&(t.value="",t.focus())}function G(){const e=S("assignee-modal");e&&(e.style.display="none")}async function K(){const e=S("applicants-list");e&&(e.innerHTML='<div class="loading-message">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>');try{let e=C().collection("applications");v&&(e=e.where("companyDomain","==",v)),e=e.orderBy("createdAt","desc");const t=await e.get();g=[],t.forEach(e=>{g.push({id:e.id,...e.data()})}),b={},g.forEach(e=>{var t,n;const a=e.applicantPhone||(null==(t=e.applicant)?void 0:t.phone),i=e.applicantEmail||(null==(n=e.applicant)?void 0:n.email);if(a){const t=a.replace(/[-\s]/g,"");b[t]||(b[t]=[]),b[t].push(e)}if(i){const t=i.toLowerCase().trim();b[t]||(b[t]=[]),b[t].push(e)}}),z(),J()}catch(t){console.error("Failed to load applicants:",t),e&&(e.innerHTML='<div class="empty-message">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>')}}function z(){var e,t,n,a;const i=(null==(e=S("filter-status"))?void 0:e.value)||"",s=(null==(t=S("filter-type"))?void 0:t.value)||"",l=(null==(a=null==(n=S("filter-search"))?void 0:n.value)?void 0:a.toLowerCase())||"";f=g.filter(e=>{var t;if(i&&(e.status||"new")!==i)return!1;if(s&&e.type!==s)return!1;if(l){const n=(e.jobTitle||"").toLowerCase(),a=(e.applicantName||(null==(t=e.applicant)?void 0:t.name)||"").toLowerCase();if(!n.includes(l)&&!a.includes(l))return!1}return!0}),y=1,X(),Z()}function J(){const e=g.length,t=g.filter(e=>!e.status||"new"===e.status).length,n=g.filter(e=>["contacted","interviewing","interviewed","pending"].includes(e.status)).length,a=g.filter(e=>["hired","joined","ng","rejected","withdrawn"].includes(e.status)).length,i=S("stat-total"),s=S("stat-new"),l=S("stat-progress"),o=S("stat-complete");i&&(i.textContent=e),s&&(s.textContent=t),l&&(l.textContent=n),o&&(o.textContent=a)}function X(){const t=S("applicants-list");if(!t)return;if(0===f.length)return void(t.innerHTML='<div class="empty-message">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=20*(y-1),a=n+20,i=f.slice(n,a);t.innerHTML=i.map(t=>{var n,a;const i=le((null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.timestamp||t.createdAt)),s=t.status||"new",l=A[t.type]||t.type||"-",o=x[s]||s,c=t.applicantName||(null==(a=t.applicant)?void 0:a.name)||"-",r=h===t.id;let d="type-apply";"line"===t.type&&(d="type-line"),"consult"===t.type&&(d="type-consult");const u=function(e){var t,n,a;const i=e.applicantPhone||(null==(t=e.applicant)?void 0:t.phone),s=e.applicantEmail||(null==(n=e.applicant)?void 0:n.email);let l=[];if(i){const e=i.replace(/[-\s]/g,""),t=b[e]||[];l=l.concat(t)}if(s){const e=s.toLowerCase().trim(),t=b[e]||[];l=l.concat(t)}const o=[...new Map(l.map(e=>[e.id,e])).values()].filter(t=>t.id!==e.id),c=(null==(a=e.createdAt)?void 0:a.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),r=o.filter(e=>{var t;return((null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt))<c});return{isReapply:r.length>0,hasNgHistory:r.some(e=>"ng"===e.status||"rejected"===e.status),previousApps:r}}(t);let p="";return u.hasNgHistory?p+='<span class="duplicate-badge badge-ng-history">NGå±¥æ­´</span>':u.isReapply&&(p+='<span class="duplicate-badge badge-reapply">å†å¿œå‹Ÿ</span>'),`\n      <div class="applicant-card ${r?"selected":""}" data-id="${e(t.id)}">\n        <div class="applicant-card-main">\n          <div class="applicant-card-header">\n            <span class="applicant-card-name">${e(c)}</span>\n            <span class="applicant-card-type ${d}">${e(l)}</span>\n            ${p}\n          </div>\n          <div class="applicant-card-job">${e(t.jobTitle||"-")}</div>\n          <div class="applicant-card-meta">\n            <span>${e(i)}</span>\n            ${t.assignee?`<span>æ‹…å½“: ${e(t.assignee)}</span>`:""}\n          </div>\n        </div>\n        <div class="applicant-card-status">\n          <span class="status-badge status-${e(s)}">${e(o)}</span>\n        </div>\n      </div>\n    `}).join(""),t.querySelectorAll(".applicant-card").forEach(e=>{e.addEventListener("click",()=>{Q(e.dataset.id)})})}function Z(){const e=S("pagination");if(!e)return;const t=Math.ceil(f.length/20);if(t<=1)return void(e.innerHTML="");let n="";n+=`<button class="page-btn" ${1===y?"disabled":""} data-page="${y-1}">å‰ã¸</button>`;for(let a=1;a<=t;a++)1===a||a===t||a>=y-2&&a<=y+2?n+=`<button class="page-btn ${a===y?"active":""}" data-page="${a}">${a}</button>`:a!==y-3&&a!==y+3||(n+='<span class="page-ellipsis">...</span>');n+=`<button class="page-btn" ${y===t?"disabled":""} data-page="${y+1}">æ¬¡ã¸</button>`,e.innerHTML=n,e.querySelectorAll(".page-btn").forEach(e=>{e.addEventListener("click",()=>{e.disabled||(y=parseInt(e.dataset.page),X(),Z())})})}function Q(t){var n,a,i,s,l,o,c;const r=g.find(e=>e.id===t);if(!r)return;h=t,document.querySelectorAll(".applicant-card").forEach(e=>{e.classList.toggle("selected",e.dataset.id===t)});const d=S("detail-empty"),p=S("detail-content");d&&(d.style.display="none"),p&&(p.style.display="flex");const v=r.applicantName||(null==(n=r.applicant)?void 0:n.name)||"-",m=r.applicantPhone||(null==(a=r.applicant)?void 0:a.phone)||"-",f=r.applicantEmail||(null==(i=r.applicant)?void 0:i.email)||"-",y=(null==(s=r.applicant)?void 0:s.age)||"-",w=(null==(l=r.applicant)?void 0:l.address)||"-",b=(null==(o=r.applicant)?void 0:o.startDate)||"-";S("detail-name").textContent=v,S("detail-job-title").textContent=r.jobTitle||"-",S("detail-phone").textContent=m,S("detail-email").textContent=f,S("detail-age").textContent=y,S("detail-address").textContent=w,S("detail-start-date").textContent=T[b]||b;const $=(null==(c=r.createdAt)?void 0:c.toDate)?r.createdAt.toDate():new Date(r.timestamp||r.createdAt);S("detail-datetime").textContent=le($,!0),S("detail-type").textContent=A[r.type]||r.type||"-",S("detail-source").textContent=oe(r.source);const L=r.status||"new";document.querySelectorAll(".status-btn").forEach(e=>{e.classList.toggle("active",e.dataset.status===L)});const E=S("detail-assignee");E&&(E.value=r.assignee||"");const D=S("detail-notes");D&&(D.value=r.notes||""),ne(r.history||[]),ee(t),async function(t){var n;const a=S("interview-info");if(!a)return;const i=g.find(e=>e.id===t);if(null==i?void 0:i.interviewId)try{const t=C(),s=await t.collection("interviews").doc(i.interviewId).get();if(!s.exists)return void(a.innerHTML='<p class="no-data">é¢è«‡ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>');const l=s.data(),o=(null==(n=l.scheduledAt)?void 0:n.toDate)?l.scheduledAt.toDate():new Date(l.scheduledAt),c=u(o),r={in_person:"å¯¾é¢",online:"ã‚ªãƒ³ãƒ©ã‚¤ãƒ³",phone:"é›»è©±"};a.innerHTML=`\n      <div class="interview-scheduled">\n        <h4>é¢è«‡äºˆå®š</h4>\n        <p><strong>æ—¥æ™‚:</strong> ${o.getFullYear()}å¹´${o.getMonth()+1}æœˆ${o.getDate()}æ—¥(${c}) ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}</p>\n        <p><strong>æ‹…å½“è€…:</strong> ${e(l.staffName||"-")}</p>\n        <p><strong>å½¢å¼:</strong> ${r[l.meetingType]||l.meetingType}</p>\n        ${l.location?`<p><strong>å ´æ‰€:</strong> ${e(l.location)}</p>`:""}\n      </div>\n    `}catch(s){console.error("Failed to load interview info:",s),a.innerHTML='<p class="no-data">é¢è«‡æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}else a.innerHTML='<p class="no-data">é¢è«‡ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>'}(t)}function W(){h=null,document.querySelectorAll(".applicant-card").forEach(e=>{e.classList.remove("selected")});const e=S("detail-empty"),t=S("detail-content");e&&(e.style.display="flex"),t&&(t.style.display="none")}async function ee(t){const n=S("messages-container");if(n){n.innerHTML='<p class="no-data">èª­ã¿è¾¼ã¿ä¸­...</p>';try{const n=C(),a=await n.collection("messages").where("applicationId","==",t).orderBy("createdAt","asc").get(),i=[];a.forEach(e=>{i.push({id:e.id,...e.data()})}),function(t){const n=S("messages-container");if(!n)return;if(!t||0===t.length)return void(n.innerHTML='<p class="no-data">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“</p>');n.innerHTML=t.map(t=>{var n;const a=(null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.createdAt),i="company"===t.from;return`\n      <div class="message-item ${i?"message-company":"message-applicant"}">\n        <div class="message-header">\n          <span class="message-sender">${e(i?"ä¼šç¤¾":"å¿œå‹Ÿè€…")}</span>\n          <span class="message-date">${le(a,!0)}</span>\n        </div>\n        <div class="message-content">${e(t.content).replace(/\n/g,"<br>")}</div>\n      </div>\n    `}).join(""),n.scrollTop=n.scrollHeight}(i)}catch(a){console.error("Failed to load messages:",a),n.innerHTML='<p class="no-data">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}}}async function te(){var e;if(!h)return;const t=S("new-message-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(!n)return void alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const a=S("btn-send-message");a&&(a.disabled=!0,a.textContent="é€ä¿¡ä¸­...");try{const e=C(),a=g.find(e=>e.id===h);await e.collection("messages").add({applicationId:h,companyDomain:(null==a?void 0:a.companyDomain)||v,from:"company",content:n,read:!1,createdAt:firebase.firestore.FieldValue.serverTimestamp()}),t.value="",await ee(h)}catch(i){console.error("Failed to send message:",i),alert("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: "+i.message)}finally{a&&(a.disabled=!1,a.textContent="é€ä¿¡")}}function ne(t){const n=S("detail-history");n&&(t&&0!==t.length?n.innerHTML=t.map(t=>{var n;return`\n      <div class="history-item">\n        <div class="history-date">${le((null==(n=t.date)?void 0:n.toDate)?t.date.toDate():new Date(t.date),!0)}</div>\n        <div class="history-text">${e(t.text)}</div>\n      </div>\n    `}).join(""):n.innerHTML='<p class="no-data">å¯¾å¿œå±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</p>')}async function ae(){var e,t;if(!h)return;const n=(null==(e=S("detail-notes"))?void 0:e.value)||"",a=(null==(t=S("detail-assignee"))?void 0:t.value)||"",i=S("btn-save-notes");i&&(i.disabled=!0,i.textContent="ä¿å­˜ä¸­...");try{const e=C();await e.collection("applications").doc(h).update({notes:n,assignee:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const t=g.findIndex(e=>e.id===h);-1!==t&&(g[t].notes=n,g[t].assignee=a),X()}catch(s){console.error("Failed to save notes:",s),alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{i&&(i.disabled=!1,i.textContent="ä¿å­˜")}}async function ie(){var e;if(!h)return;const t=S("new-history-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)try{const e=C(),a=g.find(e=>e.id===h),i=(null==a?void 0:a.history)||[];i.push({date:new Date,text:n}),await e.collection("applications").doc(h).update({history:i,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const s=g.findIndex(e=>e.id===h);-1!==s&&(g[s].history=i),ne(i),t.value=""}catch(a){console.error("Failed to add history:",a),alert("å±¥æ­´ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}else alert("å¯¾å¿œå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")}function se(){if(0===f.length)return void alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");const e=f.map(e=>{var t,n,a,i,s,l,o;const c=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),r=e.applicantName||(null==(n=e.applicant)?void 0:n.name)||"",d=e.applicantPhone||(null==(a=e.applicant)?void 0:a.phone)||"",u=e.applicantEmail||(null==(i=e.applicant)?void 0:i.email)||"",p=(null==(s=e.applicant)?void 0:s.age)||"",v=(null==(l=e.applicant)?void 0:l.address)||"",m=(null==(o=e.applicant)?void 0:o.startDate)||"";return[le(c,!0),A[e.type]||e.type||"",r,d,u,p,v,T[m]||m,e.jobTitle||"",oe(e.source),x[e.status||"new"],e.assignee||"",(e.notes||"").replace(/"/g,'""')]}),t=[["æ—¥æ™‚","ç¨®åˆ¥","å¿œå‹Ÿè€…å","é›»è©±ç•ªå·","ãƒ¡ãƒ¼ãƒ«","å¹´é½¢","ç¾ä½æ‰€","å¸Œæœ›å‹¤å‹™é–‹å§‹æ—¥","æ±‚äººã‚¿ã‚¤ãƒˆãƒ«","æµå…¥å…ƒ","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","æ‹…å½“è€…","ãƒ¡ãƒ¢"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),n=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download=`applicants-${v||"all"}-${function(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}${n}${a}`}(new Date)}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}function le(e,t=!1){if(!e||isNaN(e.getTime()))return"-";const n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");if(!t)return`${n}/${a}/${i}`;return`${n}/${a}/${i} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function oe(e){if(!e||"direct"===e)return"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹";try{const t=new URL(e).hostname;return t.includes("google")?"Googleæ¤œç´¢":t.includes("yahoo")?"Yahoo!æ¤œç´¢":t.includes("tiktok")?"TikTokåºƒå‘Š":t.includes("instagram")||t.includes("fb")||t.includes("facebook")?"Metaåºƒå‘Š":t.includes("twitter")||t.includes("x.com")?"X(Twitter)":t.includes("line")?"LINE":t}catch{return e||"ä¸æ˜"}}function ce(){var e,t,n,a,i,s,l,o,c,r,d,u,p,v,m,f,y,w,b,$,L,E,D,x,A,T,M,H,U,B;let _;null==(e=S("btn-refresh"))||e.addEventListener("click",K),null==(t=S("btn-refresh-applicants"))||t.addEventListener("click",K),null==(n=S("btn-export-csv"))||n.addEventListener("click",se),null==(a=S("filter-status"))||a.addEventListener("change",z),null==(i=S("filter-type"))||i.addEventListener("change",z),null==(s=S("filter-search"))||s.addEventListener("input",()=>{clearTimeout(_),_=setTimeout(z,300)}),null==(l=S("btn-close-detail"))||l.addEventListener("click",W),document.querySelectorAll(".status-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.status;t&&async function(e){if(h)try{const t=C();await t.collection("applications").doc(h).update({status:e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const n=g.findIndex(e=>e.id===h);-1!==n&&(g[n].status=e),document.querySelectorAll(".status-btn").forEach(t=>{t.classList.toggle("active",t.dataset.status===e)}),z(),J()}catch(t){console.error("Failed to update status:",t),alert("ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}}(t)})}),null==(o=S("btn-save-notes"))||o.addEventListener("click",ae),null==(c=S("btn-add-history"))||c.addEventListener("click",ie),null==(r=S("new-history-text"))||r.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),ie())}),null==(d=S("btn-send-message"))||d.addEventListener("click",te),null==(u=S("new-message-text"))||u.addEventListener("keydown",e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),te())}),null==(p=S("message-template-select"))||p.addEventListener("change",e=>{!function(e){var t;if(!e)return;const n=j[e];if(!n)return;const a=g.find(e=>e.id===h);if(!a)return;const i=a.applicantName||(null==(t=a.applicant)?void 0:t.name)||"ãŠå®¢æ§˜",s=a.jobTitle||"æ±‚äºº";let l=n.body.replace(/{applicantName}/g,i).replace(/{jobTitle}/g,s);const o=S("new-message-text");o&&(o.value=l,o.focus());const c=S("message-template-select");c&&(c.value="")}(e.target.value)}),null==(v=S("btn-add-assignee"))||v.addEventListener("click",Y),null==(m=S("assignee-modal-close"))||m.addEventListener("click",G),null==(f=S("assignee-modal-cancel"))||f.addEventListener("click",G),null==(y=S("assignee-modal-save"))||y.addEventListener("click",V),null==(w=S("assignee-modal"))||w.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&G()}),null==(b=S("new-assignee-name"))||b.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),V())}),null==($=document.getElementById("nav-settings"))||$.addEventListener("click",e=>{e.preventDefault(),I("settings")}),null==(L=S("btn-back-to-applicants"))||L.addEventListener("click",()=>{I("applicants")}),k||(null==(E=S("btn-schedule-interview"))||E.addEventListener("click",N),null==(D=S("interview-modal-close"))||D.addEventListener("click",F),null==(x=S("interview-modal-cancel"))||x.addEventListener("click",F),null==(A=S("interview-modal-save"))||A.addEventListener("click",P),null==(T=S("interview-modal"))||T.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&F()}),null==(M=S("interview-staff"))||M.addEventListener("change",q),null==(H=S("btn-prev-week"))||H.addEventListener("click",R),null==(U=S("btn-next-week"))||U.addEventListener("click",O)),null==(B=S("btn-save-reminder-settings"))||B.addEventListener("click",re);const X=document.getElementById("mobile-menu-btn"),Z=document.querySelector(".admin-sidebar");X&&Z&&(X.addEventListener("click",()=>{Z.classList.toggle("open"),X.classList.toggle("active")}),document.addEventListener("click",e=>{!Z.classList.contains("open")||Z.contains(e.target)||X.contains(e.target)||(Z.classList.remove("open"),X.classList.remove("active"))}))}async function re(){var e,t,n;try{const a=C(),i={reminder1Day:(null==(e=S("reminder-1day"))?void 0:e.checked)||!1,reminder1DayTime:(null==(t=S("reminder-1day-time"))?void 0:t.value)||"10:00",reminder1Hour:(null==(n=S("reminder-1hour"))?void 0:n.checked)||!1,updatedAt:firebase.firestore.FieldValue.serverTimestamp()};await a.collection("settings").doc(v||"global").set({reminderSettings:i},{merge:!0}),alert("ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(a){console.error("Failed to save reminder settings:",a),alert("è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}}async function de(){const e=new URLSearchParams(window.location.search);v=e.get("domain"),m=e.get("company")?decodeURIComponent(e.get("company")):null;const t=S("company-name");t&&(t.textContent=m||v||"å…¨ä¼šç¤¾"),ce(),await B(),await M(),await K(),"undefined"!=typeof window&&(window.ApplicantsManager={loadApplicantsData:K,applyFilters:z,exportCsv:se,showSection:I})}async function ue(e,t,n=""){v=e,m=t,k=n,ce(),await B(),await M(),await K()}function pe(){return h&&g.find(e=>e.id===h)||null}export{s as a,u as b,c,o as d,i as e,d as f,r as g,pe as h,ue as i,de as j,l as r};
