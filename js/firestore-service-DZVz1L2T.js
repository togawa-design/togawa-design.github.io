import{config as e}from"./config-BRsu1Mb6.js";let r=null,t=null,o=null;function s(){return r||("undefined"!=typeof window&&window.firebase?(t=window.firebase,t.apps.length||t.initializeApp(e.firebaseConfig),r=t.firestore(),r):(console.warn("[FirestoreService] Firebase not loaded"),null))}async function i(){return r||(o||(o=(async()=>{try{return t=await function(e=5e3){return new Promise((r,t)=>{if("undefined"!=typeof window&&window.firebase)return void r(window.firebase);const o=Date.now(),s=()=>{"undefined"!=typeof window&&window.firebase?r(window.firebase):Date.now()-o>=e?t(new Error("Firebase SDK load timeout")):setTimeout(s,50)};s()})}(),t.apps.length||t.initializeApp(e.firebaseConfig),r=t.firestore(),console.log("[FirestoreService] Firestore initialized successfully"),r}catch(s){throw console.error("[FirestoreService] Firebase initialization error:",s),o=null,s}})(),o))}function n(){return r||s(),r}async function c(){return r||await i(),r}async function a(){const e=await c();if(!e)throw new Error("Firestore not initialized");try{const r=await e.collection("companies").orderBy("order","asc").get(),t=[];return r.forEach(e=>{t.push({id:e.id,companyDomain:e.id,...e.data()})}),{success:!0,companies:t}}catch(r){return console.error("[FirestoreService] getCompanies error:",r),{success:!1,error:r.message}}}async function l(e){const r=await c();if(!r)throw new Error("Firestore not initialized");try{const t=await r.collection("companies").doc(e).get();return t.exists?{success:!0,company:{id:t.id,companyDomain:t.id,...t.data()}}:{success:!1,error:"会社が見つかりません"}}catch(t){return console.error("[FirestoreService] getCompany error:",t),{success:!1,error:t.message}}}async function d(e,r){const o=await c();if(!o)throw new Error("Firestore not initialized");try{const s=o.collection("companies").doc(e),i=!(await s.get()).exists,n={...r,updatedAt:t.firestore.FieldValue.serverTimestamp()};return i&&(n.createdAt=t.firestore.FieldValue.serverTimestamp()),await s.set(n,{merge:!0}),{success:!0,message:i?"会社を作成しました":"会社情報を更新しました",companyDomain:e}}catch(s){return console.error("[FirestoreService] saveCompany error:",s),{success:!1,error:s.message}}}async function u(e){const r=await c();if(!r)throw new Error("Firestore not initialized");try{const t=r.batch();(await r.collection("companies").doc(e).collection("jobs").get()).forEach(e=>t.delete(e.ref));(await r.collection("companies").doc(e).collection("lpSettings").get()).forEach(e=>t.delete(e.ref));return(await r.collection("companies").doc(e).collection("recruitSettings").get()).forEach(e=>t.delete(e.ref)),t.delete(r.collection("companies").doc(e)),await t.commit(),{success:!0,message:"会社を削除しました"}}catch(t){return console.error("[FirestoreService] deleteCompany error:",t),{success:!1,error:t.message}}}async function g(e){const r=await c();if(!r)throw new Error("Firestore not initialized");try{const t=await r.collection("companies").doc(e).collection("jobs").orderBy("order","asc").get(),o=[];let s=3;return t.forEach(e=>{o.push({...e.data(),_rowIndex:s,_docId:e.id}),s++}),{success:!0,jobs:o}}catch(t){return console.error("[FirestoreService] getJobs error:",t),{success:!1,error:t.message,jobs:[]}}}async function w(e,r){const t=await c();if(!t)throw new Error("Firestore not initialized");try{const o=await t.collection("companies").doc(e).collection("jobs").doc(String(r)).get();return o.exists?{success:!0,job:{...o.data(),_docId:o.id}}:{success:!1,error:"求人が見つかりません"}}catch(o){return console.error("[FirestoreService] getJob error:",o),{success:!1,error:o.message}}}async function m(e,r,o=null){const s=await c();if(!s)throw new Error("Firestore not initialized");try{const i=s.collection("companies").doc(e).collection("jobs");let n,c,a=!1;if(o)n=i.doc(String(o)),c=o;else if(r.id){n=i.doc(String(r.id));a=!(await n.get()).exists,c=r.id}else{const e=await i.orderBy("id","desc").limit(1).get();let r=0;e.forEach(e=>{const t=parseInt(e.data().id)||0;t>r&&(r=t)}),c=r+1,n=i.doc(String(c)),a=!0}const l={...r,id:String(c),updatedAt:t.firestore.FieldValue.serverTimestamp()};return a&&(l.createdAt=t.firestore.FieldValue.serverTimestamp()),delete l._rowIndex,delete l._docId,await n.set(l,{merge:!0}),{success:!0,message:a?"求人を作成しました":"求人情報を更新しました",jobId:c,rowIndex:null}}catch(i){return console.error("[FirestoreService] saveJob error:",i),{success:!1,error:i.message}}}async function f(e,r){const t=await c();if(!t)throw new Error("Firestore not initialized");try{return await t.collection("companies").doc(e).collection("jobs").doc(String(r)).delete(),{success:!0,message:"求人を削除しました"}}catch(o){return console.error("[FirestoreService] deleteJob error:",o),{success:!1,error:o.message}}}async function p(e,r="default"){const t=await c();if(!t)throw new Error("Firestore not initialized");try{const o=await t.collection("companies").doc(e).collection("lpSettings").doc(String(r)).get();return o.exists?{success:!0,settings:o.data()}:{success:!0,settings:{}}}catch(o){return console.error("[FirestoreService] getLPSettings error:",o),{success:!1,error:o.message}}}async function y(e,r,o){const s=await c();if(!s)throw new Error("Firestore not initialized");try{const i=s.collection("companies").doc(e).collection("lpSettings").doc(String(r||"default")),n={...o,companyDomain:e,jobId:String(r||"default"),updatedAt:t.firestore.FieldValue.serverTimestamp()};return await i.set(n,{merge:!0}),{success:!0,message:"LP設定を保存しました"}}catch(i){return console.error("[FirestoreService] saveLPSettings error:",i),{success:!1,error:i.message}}}async function h(e){const r=await c();if(!r)throw new Error("Firestore not initialized");try{const t=await r.collection("companies").doc(e).collection("recruitSettings").doc("main").get();return t.exists?{success:!0,settings:t.data()}:{success:!0,settings:{}}}catch(t){return console.error("[FirestoreService] getRecruitSettings error:",t),{success:!1,error:t.message}}}async function S(e,r){const o=await c();if(!o)throw new Error("Firestore not initialized");try{const s=o.collection("companies").doc(e).collection("recruitSettings").doc("main"),i={...r,companyDomain:e,updatedAt:t.firestore.FieldValue.serverTimestamp()};return await s.set(i,{merge:!0}),{success:!0,message:"採用ページ設定を保存しました"}}catch(s){return console.error("[FirestoreService] saveRecruitSettings error:",s),{success:!1,error:s.message}}}async function F(){const e=await c();if(!e)throw new Error("Firestore not initialized");try{const r=await e.collectionGroup("jobs").where("visible","==",!0).orderBy("order","asc").get(),t=[];return r.forEach(e=>{const r=e.ref.path.split("/")[1];t.push({...e.data(),companyDomain:r,_docId:e.id})}),{success:!0,jobs:t}}catch(r){return console.error("[FirestoreService] getAllVisibleJobs error:",r),{success:!1,error:r.message,jobs:[]}}}async function b(){if(!(await c()))throw new Error("Firestore not initialized");try{const e=await F();if(!e.success)return e;const r=e.jobs;let t=0,o=0;r.forEach(e=>{const r=function(e){if(!e)return 0;const r=String(e).replace(/[,，]/g,""),t=r.match(/(\d+(?:\.\d+)?)\s*万/);if(t)return 1e4*parseFloat(t[1]);const o=r.match(/[\d,]+/);if(o)return parseInt(o[0].replace(/,/g,""))||0;return 0}(e.monthlySalary);r>0&&(t+=r,o++)});const s=o>0?Math.round(t/o):0,i=s>0?Math.round(s/160):0;return{success:!0,stats:{jobCount:r.length,avgMonthlySalary:s,avgHourlyWage:i,updatedAt:(new Date).toISOString()}}}catch(e){return console.error("[FirestoreService] getJobStats error:",e),{success:!1,error:e.message}}}const v={initFirestore:s,initFirestoreAsync:i,getFirestore:n,getFirestoreAsync:c,getCompanies:a,getCompany:l,saveCompany:d,deleteCompany:u,getJobs:g,getJob:w,saveJob:m,deleteJob:f,getLPSettings:p,saveLPSettings:y,getRecruitSettings:h,saveRecruitSettings:S,getAllVisibleJobs:F,getJobStats:b};export{v as default,u as deleteCompany,f as deleteJob,F as getAllVisibleJobs,a as getCompanies,l as getCompany,n as getFirestore,c as getFirestoreAsync,w as getJob,b as getJobStats,g as getJobs,p as getLPSettings,h as getRecruitSettings,s as initFirestore,i as initFirestoreAsync,d as saveCompany,m as saveJob,y as saveLPSettings,S as saveRecruitSettings};
