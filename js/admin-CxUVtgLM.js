import"./modulepreload-polyfill-YP0FEG5d.js";import{c as e,g as n,a as t,u as a,i as s,d as o,b as c,t as i,r as l,s as d,l as r,e as m,o as u,f as p,h as y,j as v,k as g,m as h,n as f,p as b,q as w,v as E,w as $,x as L,y as I,z as B,A as k,B as M,C as A,D as T,E as S,F as j,G as x,H as D,I as H,J as C,K as q,L as P,M as R,N as z,O as F,P as O}from"./job-feed-generator-BBEmU1ix.js";import{f as U,e as N}from"./utils-BE8OECDH.js";import{f as V,i as W}from"./jobs-loader-CIZMoLrM.js";import"./LPEditor-Cg7IJGVU.js";import"./image-uploader-CwR9OqLI.js";let G=[];async function J(){const t=document.getElementById("date-range"),a=(null==t?void 0:t.value)||7,s=e.apiEndpoint;if(s)try{await async function(e,t){try{X(!0),function(e){const n='<div class="section-loading"><div class="loading-spinner"></div><span>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span></div>';document.querySelectorAll(".stat-value").forEach(e=>{e.dataset.originalText=e.textContent,e.innerHTML='<span class="loading-dots">...</span>'});const t=document.getElementById("daily-chart");t&&e&&(t.innerHTML=n);const a=document.querySelector(".data-table tbody");a&&e&&(a.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;">${n}</td></tr>`);const s=document.getElementById("company-cards");s&&e&&(s.innerHTML=n);const o=document.querySelector("#applications-section .data-table tbody");o&&e&&(o.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:2rem;">${n}</td></tr>`)}(!0);const a={},s=n();s&&(a.Authorization=`Bearer ${s}`);const o=await fetch(`${t}?days=${e}`,{headers:a});if(!o.ok)throw new Error(`API Error: ${o.status}`);const c=await o.json();if(!c.success)throw new Error(c.error||"Unknown error");const i=c.data;i.overview&&(K("total-pageviews",U(i.overview.pageViews)),K("total-users",U(i.overview.users)),K("company-views",U(i.overview.companyViews)),K("apply-clicks",U(i.overview.applyClicks)),function(e,n){const t=(null==e?void 0:e.male)||0,a=(null==e?void 0:e.female)||0,s=t+a;if(s>0){const e=Math.round(t/s*100),n=100-e,a=document.getElementById("admin-gender-bar-male"),o=document.getElementById("admin-gender-bar-female");a&&(a.style.width=`${e}%`),o&&(o.style.width=`${n}%`);const c=document.getElementById("admin-gender-male-percent"),i=document.getElementById("admin-gender-female-percent");c&&(c.textContent=`${e}%`),i&&(i.textContent=`${n}%`)}else{const e=document.getElementById("admin-gender-male-percent"),n=document.getElementById("admin-gender-female-percent");e&&(e.textContent="-"),n&&(n.textContent="-")}const o=document.getElementById("admin-age-bars");if(o){const e=Object.entries(n||{});if(e.length>0){const n=Math.max(...e.map(([,e])=>e));o.innerHTML=e.map(([e,t])=>`\n          <div class="age-bar-wrapper">\n            <span class="age-bar-value">${t}</span>\n            <div class="age-bar" style="height: ${n>0?Math.max(10,t/n*80):10}px;"></div>\n            <span class="age-bar-label">${e}</span>\n          </div>\n        `).join("")}else o.innerHTML='<p style="color: #94a3b8; font-size: 13px; text-align: center;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>'}}(i.overview.gender,i.overview.age)),i.daily&&function(e){const n=document.getElementById("daily-chart");if(!n)return;if(!e||0===e.length)return void(n.innerHTML="<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>");const t=Math.max(...e.map(e=>e.views)),a=e.length>30?e.filter((e,n)=>n%3==0):e;n.innerHTML=`\n    <div class="simple-chart">\n      <div class="chart-bars">\n        ${a.map(e=>`\n            <div class="chart-bar-wrapper">\n              <div class="chart-bar" style="height: ${t>0?e.views/t*100:0}%">\n                <span class="bar-value">${e.views}</span>\n              </div>\n              <span class="bar-label">${e.date}</span>\n            </div>\n          `).join("")}\n      </div>\n    </div>\n  `}(i.daily),i.companies&&(G=i.companies.filter(e=>e.domain&&"(not set)"!==e.domain&&e.name&&"(not set)"!==e.name).map(e=>({name:e.name,domain:e.domain,views:e.views,clicks:e.clicks,pattern:"standard"})),_(),Q()),i.applications&&function(e){const n=document.querySelector("#applications-table tbody");if(!n)return;const t={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};if(!e||0===e.length)return void(n.innerHTML='<tr><td colspan="5" class="loading-cell">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${N(e.date)}</td>\n      <td>${N(e.company)}</td>\n      <td><span class="type-badge ${N(e.type)}">${t[e.type]||N(e.type)}</span></td>\n      <td>${N(e.pageType||e.pagePath||"-")}</td>\n      <td>${N(e.source)}</td>\n    </tr>\n  `).join("")}(i.applications),X(!1)}catch(a){console.error("[Admin] API fetch error:",a),X(!1),Y(e)}}(a,s)}catch(o){console.error("[Admin] API fetch failed, loading mock data:",o),Y(a)}else Y(a)}function X(e){const n=document.getElementById("refresh-btn");n&&(n.textContent=e?"èª­ã¿è¾¼ã¿ä¸­...":"æ›´æ–°",n.disabled=e)}function K(e,n){const t=document.getElementById(e);t&&(t.textContent=n)}function Y(e){const n=80*e,t=45*e,a=12*e;K("total-pageviews",U(150*e+Math.floor(500*Math.random()))),K("total-users",U(n+Math.floor(200*Math.random()))),K("company-views",U(t+Math.floor(100*Math.random()))),K("apply-clicks",U(a+Math.floor(30*Math.random()))),function(e){const n=document.getElementById("daily-chart");if(!n)return;const t=[],a=new Date;for(let c=e-1;c>=0;c--){const e=new Date(a);e.setDate(e.getDate()-c),t.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(100+200*Math.random()),clicks:Math.floor(5+20*Math.random())})}const s=Math.max(...t.map(e=>e.views)),o=e>30?t.filter((e,n)=>n%3==0):t;n.innerHTML=`\n    <div class="simple-chart">\n      <div class="chart-bars">\n        ${o.map(e=>`\n            <div class="chart-bar-wrapper">\n              <div class="chart-bar" style="height: ${e.views/s*100}%">\n                <span class="bar-value">${e.views}</span>\n              </div>\n              <span class="bar-label">${e.date}</span>\n            </div>\n          `).join("")}\n      </div>\n    </div>\n  `}(e),G=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",domain:"toyota",views:1250,clicks:89,pattern:"modern"},{name:"æ—¥ç”£è‡ªå‹•è»Š",domain:"nissan",views:980,clicks:67,pattern:"classic"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",domain:"honda",views:856,clicks:54,pattern:"colorful"},{name:"ã‚¹ãƒãƒ«",domain:"subaru",views:654,clicks:43,pattern:"minimal"},{name:"ãƒãƒ„ãƒ€",domain:"mazda",views:523,clicks:32,pattern:"standard"},{name:"ã‚¹ã‚ºã‚­",domain:"suzuki",views:412,clicks:28,pattern:"modern"},{name:"ãƒ€ã‚¤ãƒãƒ„",domain:"daihatsu",views:387,clicks:24,pattern:"classic"},{name:"ä¸‰è±è‡ªå‹•è»Š",domain:"mitsubishi",views:298,clicks:18,pattern:"standard"}],_(),Q(),function(){const e=document.querySelector("#applications-table tbody");if(!e)return;const n=[{date:"2025/01/17 14:32",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/17 13:15",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"line",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/17 11:48",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Yahooæ¤œç´¢"},{date:"2025/01/17 10:22",company:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/16 18:45",company:"ã‚¹ãƒãƒ«",type:"line",source:"Googleæ¤œç´¢"},{date:"2025/01/16 16:30",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"SNS"},{date:"2025/01/16 14:12",company:"ãƒãƒ„ãƒ€",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/16 11:55",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"}],t={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};e.innerHTML=n.map(e=>`\n    <tr>\n      <td>${N(e.date)}</td>\n      <td>${N(e.company)}</td>\n      <td><span class="type-badge ${N(e.type)}">${t[e.type]}</span></td>\n      <td>${N(e.source)}</td>\n    </tr>\n  `).join("")}()}function _(){const e=document.querySelector("#overview-company-table tbody");if(!e)return;const n=[...G].sort((e,n)=>n.views-e.views);e.innerHTML=n.slice(0,5).map((e,n)=>{const t=(e.clicks/e.views*100).toFixed(1);return`\n      <tr>\n        <td>${n+1}</td>\n        <td>${N(e.name)}</td>\n        <td>${U(e.views)}</td>\n        <td>${e.clicks}</td>\n        <td>${t}%</td>\n      </tr>\n    `}).join("")}function Q(){const a=document.getElementById("company-cards");a&&(a.innerHTML=G.map(e=>{const n=(e.clicks/e.views*100).toFixed(1),a=t(e.pattern);return`\n      <div class="company-card" data-domain="${N(e.domain)}" data-name="${N(e.name)}" data-views="${e.views}" data-clicks="${e.clicks}">\n        <div class="company-card-header">\n          <h4>${N(e.name)}</h4>\n          <span class="pattern-badge ${N(e.pattern)}">${a}</span>\n        </div>\n        <div class="company-card-stats">\n          <div class="card-stat">\n            <span class="stat-value">${U(e.views)}</span>\n            <span class="stat-label">ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${e.clicks}</span>\n            <span class="stat-label">å¿œå‹Ÿã‚¯ãƒªãƒƒã‚¯</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${n}%</span>\n            <span class="stat-label">CVR</span>\n          </div>\n        </div>\n        <button class="btn-view-status" data-domain="${N(e.domain)}" data-name="${N(e.name)}">ä¼šç¤¾ã®çŠ¶æ³ã‚’ç¢ºèª</button>\n      </div>\n    `}).join(""),a.querySelectorAll(".btn-view-status").forEach(t=>{t.addEventListener("click",t=>{!async function(t,a){const s=document.getElementById("company-detail-title");s&&(s.textContent=`${a} ã®åˆ†æ`);const o=document.getElementById("detail-view-page-btn");o&&(o.href=`company.html?c=${t}`);document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const c=document.getElementById("section-company-detail");c&&c.classList.add("active");const i=document.getElementById("page-title");i&&(i.textContent="ä¼æ¥­è©³ç´°åˆ†æ");document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")}),function(){const e='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';document.querySelectorAll(".detail-stat-value").forEach(e=>{e.textContent="-"}),document.querySelectorAll(".detail-chart").forEach(n=>{n.innerHTML=e}),document.querySelectorAll(".detail-table-container tbody").forEach(e=>{e.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>'})}();const l=document.getElementById("date-range"),d=(null==l?void 0:l.value)||30;try{await async function(t,a){const s=e.apiEndpoint,o={},c=n();c&&(o.Authorization=`Bearer ${c}`);const i=await fetch(`${s}?type=company-detail&domain=${t}&days=${a}`,{headers:o}),l=await i.json();if(!l.success)throw new Error(l.error||"API Error");!async function(e,n){var t,a;const s=G.find(e=>e.domain===n)||{},o=(null==(t=e.summary)?void 0:t.totalViews)||s.views||0,c=s.clicks||0,i=o>0?(c/o*100).toFixed(1):0,l=(null==(a=e.summary)?void 0:a.avgDailyViews)||0;K("detail-total-views",U(o)),K("detail-total-clicks",U(c)),K("detail-cvr",`${i}%`),K("detail-avg-daily",U(Math.round(l))),ie(e.daily||[]),de(e.traffic||[]);const d=e.gender||{};re({male:d.male||0,female:d.female||0,other:d.unknown||0});const r=e.age||{};me((m=r,{"20s":(m["18-24"]||0)+(m["25-34"]||0),"30s":m["35-44"]||0,"40s":m["45-54"]||0,"50s":(m["55-64"]||0)+(m["65+"]||0)}));var m;const u=e.jobs||[];if(u.length>0){le(u.slice(0,5).map(e=>({title:e.jobTitle||e.pagePath||"ä¸æ˜",applications:e.applications||0})));ue(u.map(e=>({title:e.jobTitle||e.pagePath||"ä¸æ˜",views:e.views||0,applications:e.applications||0,cvr:e.views>0?((e.applications||0)/e.views*100).toFixed(1):"0.0"})))}else le([]),ue([]);await pe(n)}(l.data,t)}(t,d)}catch(r){console.error("[Admin] Company detail error:",r),function(e){const n=G.find(n=>n.domain===e)||{views:1e3,clicks:50},t=n.views,a=n.clicks,s=(a/t*100).toFixed(1);K("detail-total-views",U(t)),K("detail-total-clicks",U(a)),K("detail-cvr",`${s}%`),K("detail-avg-daily",U(Math.round(t/30)));const o=[],c=new Date;for(let l=29;l>=0;l--){const e=new Date(c);e.setDate(e.getDate()-l),o.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(20+60*Math.random())})}ie(o);const i=[{title:"è£½é€ ã‚¹ã‚¿ãƒƒãƒ•",applications:23},{title:"çµ„ç«‹ä½œæ¥­å“¡",applications:18},{title:"æ¤œæŸ»ãƒ»æ¤œå“",applications:12},{title:"æ©Ÿæ¢°ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼",applications:8},{title:"ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒ•ãƒˆ",applications:5}];le(i);de([{channel:"Organic Search",count:Math.floor(.45*t)},{channel:"Direct",count:Math.floor(.28*t)},{channel:"Social",count:Math.floor(.18*t)},{channel:"Referral",count:Math.floor(.09*t)}]);re({male:Math.floor(.72*a),female:Math.floor(.25*a),other:Math.floor(.03*a)});me({"20s":Math.floor(.35*a),"30s":Math.floor(.32*a),"40s":Math.floor(.23*a),"50s":Math.floor(.1*a)}),ue(i.map(e=>({...e,views:Math.floor(t*(e.applications/a)),cvr:(e.applications/(t*(e.applications/a))*100).toFixed(1)}))),pe(e)}(t)}}(t.target.dataset.domain,t.target.dataset.name)})}))}function Z(e){const n=document.querySelectorAll(".company-card"),t=e.toLowerCase();n.forEach(e=>{const n=e.dataset.name.toLowerCase(),a=e.dataset.domain.toLowerCase();n.includes(t)||a.includes(t)?e.style.display="":e.style.display="none"})}function ee(){const e=document.getElementById("sort-by"),n=(null==e?void 0:e.value)||"views",t=document.getElementById("company-cards");if(!t)return;const a=Array.from(t.querySelectorAll(".company-card"));a.sort((e,t)=>{switch(n){case"views":return parseInt(t.dataset.views)-parseInt(e.dataset.views);case"clicks":return parseInt(t.dataset.clicks)-parseInt(e.dataset.clicks);case"cvr":const n=parseInt(e.dataset.clicks)/parseInt(e.dataset.views);return parseInt(t.dataset.clicks)/parseInt(t.dataset.views)-n;case"name":return e.dataset.name.localeCompare(t.dataset.name,"ja");default:return 0}}),a.forEach(e=>t.appendChild(e))}function ne(){const t=document.querySelectorAll(".analytics-tab"),a=document.querySelectorAll(".analytics-tab-content");t.forEach(s=>{s.addEventListener("click",()=>{const o=s.dataset.tab;t.forEach(e=>e.classList.remove("active")),s.classList.add("active"),a.forEach(e=>e.classList.remove("active"));const c=document.getElementById(o);c&&(c.classList.add("active"),async function(t){const a=document.getElementById("date-range"),s=(null==a?void 0:a.value)||30,o=e.apiEndpoint;switch(t){case"engagement-tab":await async function(e,t){try{const a={},s=n();s&&(a.Authorization=`Bearer ${s}`);const o=await fetch(`${t}?type=engagement&days=${e}`,{headers:a}),c=await o.json();c.success&&c.data?function(e){const n=e.overall||{};K("avg-session-duration",`${n.avgSessionDuration||0}ç§’`),K("engagement-rate",`${n.engagementRate||0}%`),K("bounce-rate",`${n.bounceRate||0}%`);const t=document.querySelector("#engagement-company-table tbody");t&&e.byCompany&&e.byCompany.length>0?t.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${N(e.name||e.domain)}</td>\n        <td>${U(e.views)}</td>\n        <td>${Math.round(e.engagementTime)}ç§’</td>\n        <td>${e.avgTimePerView}ç§’</td>\n      </tr>\n    `).join(""):t&&(t.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(c.data):te()}catch(a){console.error("[Admin] Engagement data error:",a),te()}}(s,o);break;case"traffic-tab":await async function(e,t){try{const a={},s=n();s&&(a.Authorization=`Bearer ${s}`);const o=await fetch(`${t}?type=traffic&days=${e}`,{headers:a}),c=await o.json();c.success&&c.data?function(e){const n=document.getElementById("channel-chart");if(n&&e.channels&&e.channels.length>0){const t=Math.max(...e.channels.map(e=>e.sessions));n.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${e.channels.map(e=>{const n=t>0?e.sessions/t*100:0;return`\n            <div class="bar-row">\n              <span class="bar-label">${N(e.channel)}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${U(e.sessions)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const t=document.querySelector("#source-table tbody");t&&e.sources&&e.sources.length>0?t.innerHTML=e.sources.map(e=>`\n      <tr>\n        <td>${N(e.source)}</td>\n        <td>${N(e.medium)}</td>\n        <td>${U(e.sessions)}</td>\n        <td>${U(e.users)}</td>\n      </tr>\n    `).join(""):t&&(t.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(c.data):ae()}catch(a){console.error("[Admin] Traffic data error:",a),ae()}}(s,o);break;case"funnel-tab":await async function(e,t){try{const a={},s=n();s&&(a.Authorization=`Bearer ${s}`);const o=await fetch(`${t}?type=funnel&days=${e}`,{headers:a}),c=await o.json();c.success&&c.data?function(e){const n=document.getElementById("funnel-chart");n&&e.funnel&&e.funnel.length>0&&(n.innerHTML=e.funnel.map(e=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${N(e.stage)}</span>\n        <span class="funnel-stage-count">${U(e.count)}</span>\n        <span class="funnel-stage-rate">${e.rate}%</span>\n      </div>\n    `).join(""));const t=document.getElementById("action-breakdown-chart");if(t&&e.actionBreakdown&&e.actionBreakdown.length>0){const n=Math.max(...e.actionBreakdown.map(e=>e.count));t.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${e.actionBreakdown.map(e=>{const t=n>0?e.count/n*100:0;return`\n            <div class="bar-row">\n              <span class="bar-label">${N(e.label)}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${t}%"></div>\n                <span class="bar-value">${U(e.count)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const a=document.querySelector("#company-funnel-table tbody");a&&e.byCompany&&e.byCompany.length>0?a.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${N(e.domain)}</td>\n        <td>${U(e.views)}</td>\n        <td>${U(e.clicks)}</td>\n        <td>${e.cvr}%</td>\n      </tr>\n    `).join(""):a&&(a.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(c.data):se()}catch(a){console.error("[Admin] Funnel data error:",a),se()}}(s,o);break;case"trends-tab":await async function(e,t){try{const a={},s=n();s&&(a.Authorization=`Bearer ${s}`);const o=await fetch(`${t}?type=trends&days=${e}`,{headers:a}),c=await o.json();c.success&&c.data?function(e){e.insights&&(K("peak-day",e.insights.peakDay||"-"),K("peak-hour",e.insights.peakHour||"-"));const n=document.getElementById("day-of-week-chart");if(n&&e.byDayOfWeek&&e.byDayOfWeek.length>0){const t=Math.max(...e.byDayOfWeek.map(e=>e.sessions));n.innerHTML=`\n      <div class="day-chart">\n        ${e.byDayOfWeek.map(e=>`\n            <div class="day-bar" style="height: ${t>0?e.sessions/t*100:0}%" data-day="${N(e.day)}">\n              <span class="day-value">${U(e.sessions)}</span>\n            </div>\n          `).join("")}\n      </div>\n    `}const t=document.getElementById("hour-chart");if(t&&e.byHour&&e.byHour.length>0){const n=Math.max(...e.byHour.map(e=>e.sessions));t.innerHTML=`\n      <div class="hour-chart">\n        ${e.byHour.map(e=>`\n            <div class="hour-bar" style="height: ${n>0?e.sessions/n*100:0}%" data-hour="${e.hour}"></div>\n          `).join("")}\n      </div>\n    `}}(c.data):oe()}catch(a){console.error("[Admin] Trend data error:",a),oe()}}(s,o)}}(o))})})}function te(){K("avg-session-duration","45.2ç§’"),K("engagement-rate","68.5%"),K("bounce-rate","31.5%");const e=document.querySelector("#engagement-company-table tbody");if(e){const n=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",views:1250,time:4500,avg:"3.6"},{name:"æ—¥ç”£è‡ªå‹•è»Š",views:980,time:3200,avg:"3.3"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",views:856,time:2800,avg:"3.3"}];e.innerHTML=n.map(e=>`\n      <tr>\n        <td>${e.name}</td>\n        <td>${U(e.views)}</td>\n        <td>${e.time}ç§’</td>\n        <td>${e.avg}ç§’</td>\n      </tr>\n    `).join("")}}function ae(){const e=document.getElementById("channel-chart");if(e){const n=[{channel:"Organic Search",sessions:1250},{channel:"Direct",sessions:890},{channel:"Social",sessions:456},{channel:"Referral",sessions:234}],t=1250;e.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.map(e=>{const n=e.sessions/t*100;return`\n            <div class="bar-row">\n              <span class="bar-label">${e.channel}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${U(e.sessions)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const n=document.querySelector("#source-table tbody");if(n){const e=[{source:"google",medium:"organic",sessions:890,users:756},{source:"(direct)",medium:"(none)",sessions:456,users:412},{source:"yahoo",medium:"organic",sessions:234,users:198}];n.innerHTML=e.map(e=>`\n      <tr>\n        <td>${e.source}</td>\n        <td>${e.medium}</td>\n        <td>${U(e.sessions)}</td>\n        <td>${U(e.users)}</td>\n      </tr>\n    `).join("")}}function se(){const e=document.getElementById("funnel-chart");if(e){const n=[{stage:"ã‚µã‚¤ãƒˆè¨ªå•",count:5e3,rate:"100"},{stage:"ä¼æ¥­ãƒšãƒ¼ã‚¸é–²è¦§",count:2500,rate:"50.0"},{stage:"ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«",count:1800,rate:"36.0"},{stage:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",count:150,rate:"6.0"}];e.innerHTML=n.map(e=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${e.stage}</span>\n        <span class="funnel-stage-count">${U(e.count)}</span>\n        <span class="funnel-stage-rate">${e.rate}%</span>\n      </div>\n    `).join("")}const n=document.getElementById("action-breakdown-chart");if(n){const e=[{label:"å¿œå‹Ÿãƒœã‚¿ãƒ³",count:89},{label:"LINEç›¸è«‡",count:45},{label:"ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡",count:16}],t=89;n.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${e.map(e=>{const n=e.count/t*100;return`\n            <div class="bar-row">\n              <span class="bar-label">${e.label}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${e.count}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const t=document.querySelector("#company-funnel-table tbody");if(t){const e=[{domain:"toyota",views:1250,clicks:89,cvr:"7.1"},{domain:"nissan",views:980,clicks:67,cvr:"6.8"},{domain:"honda",views:856,clicks:54,cvr:"6.3"}];t.innerHTML=e.map(e=>`\n      <tr>\n        <td>${e.domain}</td>\n        <td>${U(e.views)}</td>\n        <td>${e.clicks}</td>\n        <td>${e.cvr}%</td>\n      </tr>\n    `).join("")}}function oe(){K("peak-day","æœ¨"),K("peak-hour","14æ™‚");const e=document.getElementById("day-of-week-chart");if(e){const n=[{day:"æ—¥",sessions:120},{day:"æœˆ",sessions:180},{day:"ç«",sessions:220},{day:"æ°´",sessions:250},{day:"æœ¨",sessions:280},{day:"é‡‘",sessions:240},{day:"åœŸ",sessions:150}],t=280;e.innerHTML=`\n      <div class="day-chart">\n        ${n.map(e=>`\n            <div class="day-bar" style="height: ${e.sessions/t*100}%" data-day="${e.day}">\n              <span class="day-value">${e.sessions}</span>\n            </div>\n          `).join("")}\n      </div>\n    `}const n=document.getElementById("hour-chart");if(n){const e=[];for(let n=0;n<24;n++){let t=10;n>=9&&n<=18&&(t=30+Math.floor(50*Math.random())),n>=12&&n<=15&&(t=50+Math.floor(40*Math.random())),e.push({hour:n,sessions:t})}const t=Math.max(...e.map(e=>e.sessions));n.innerHTML=`\n      <div class="hour-chart">\n        ${e.map(e=>`\n            <div class="hour-bar" style="height: ${e.sessions/t*100}%" data-hour="${e.hour}"></div>\n          `).join("")}\n      </div>\n    `}}function ce(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-companies");e&&e.classList.add("active"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const n=document.querySelector('[data-section="companies"]');n&&n.parentElement.classList.add("active");const t=document.getElementById("page-title");t&&(t.textContent="ä¼æ¥­åˆ¥ãƒ‡ãƒ¼ã‚¿")}function ie(e){const n=document.getElementById("detail-daily-chart");if(!n||!e.length)return void(n&&(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'));const t=Math.max(...e.map(e=>e.views));n.innerHTML=`\n    <div class="detail-line-chart">\n      ${e.map((e,n)=>{const a=t>0?e.views/t*100:0;return`\n          <div class="detail-line-bar" style="height: ${Math.max(a,2)}%" data-date="${e.date}">\n            <span class="bar-tooltip">${e.date}: ${e.views}ä»¶</span>\n          </div>\n        `}).join("")}\n    </div>\n  `}function le(e){const n=document.getElementById("detail-job-chart");if(!n)return;if(!e.length)return void(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const t=Math.max(...e.map(e=>e.applications));n.innerHTML=`\n    <div class="detail-bar-chart">\n      ${e.slice(0,5).map((e,n)=>{const a=t>0?e.applications/t*100:0;return`\n          <div class="detail-bar-row">\n            <span class="detail-bar-label" title="${N(e.title)}">${N(e.title)}</span>\n            <div class="detail-bar-track">\n              <div class="detail-bar-fill job-${n+1}" style="width: ${a}%"></div>\n              <span class="detail-bar-value">${e.applications}ä»¶</span>\n            </div>\n          </div>\n        `}).join("")}\n    </div>\n  `}function de(e){const n=document.getElementById("detail-traffic-chart");if(!n)return;if(!e.length)return void(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const t=e.reduce((e,n)=>e+n.count,0),a=["organic","direct","social","referral"];let s=[],o=0;e.forEach((e,n)=>{const c=e.count/t*100,i=a[n%a.length];s.push(`${{organic:"#10b981",direct:"#6366f1",social:"#f59e0b",referral:"#8b5cf6"}[i]} ${o}deg ${o+3.6*c}deg`),o+=3.6*c}),n.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${s.join(", ")});"></div>\n      <div class="pie-legend">\n        ${e.map((e,n)=>{const s=(e.count/t*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${a[n%a.length]}"></span>\n              <span class="pie-label">${N(e.channel)}</span>\n              <span class="pie-value">${s}%</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function re(e){const n=document.getElementById("detail-gender-chart");if(!n)return;const t=e.male+e.female+e.other;if(0===t)return void(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=(e.male/t*100).toFixed(1),s=(e.female/t*100).toFixed(1),o=(e.other/t*100).toFixed(1),c=e.male/t*360,i=e.female/t*360;n.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(#3b82f6 0deg ${c}deg, #ec4899 ${c}deg ${c+i}deg, #94a3b8 ${c+i}deg 360deg);"></div>\n      <div class="pie-legend">\n        <div class="pie-legend-item">\n          <span class="pie-color male"></span>\n          <span class="pie-label">ç”·æ€§</span>\n          <span class="pie-value">${e.male}äºº (${a}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color female"></span>\n          <span class="pie-label">å¥³æ€§</span>\n          <span class="pie-value">${e.female}äºº (${s}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color other"></span>\n          <span class="pie-label">ãã®ä»–</span>\n          <span class="pie-value">${e.other}äºº (${o}%)</span>\n        </div>\n      </div>\n    </div>\n  `}function me(e){const n=document.getElementById("detail-age-chart");if(!n)return;const t=e["20s"]+e["30s"]+e["40s"]+e["50s"];if(0===t)return void(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=[{key:"20s",label:"20ä»£",color:"age-20s",colorCode:"#3b82f6"},{key:"30s",label:"30ä»£",color:"age-30s",colorCode:"#10b981"},{key:"40s",label:"40ä»£",color:"age-40s",colorCode:"#f59e0b"},{key:"50s",label:"50ä»£ä»¥ä¸Š",color:"age-50s",colorCode:"#ef4444"}];let s=[],o=0;a.forEach(n=>{const a=e[n.key]/t*100;s.push(`${n.colorCode} ${o}deg ${o+3.6*a}deg`),o+=3.6*a}),n.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${s.join(", ")});"></div>\n      <div class="pie-legend">\n        ${a.map(n=>{const a=(e[n.key]/t*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${n.color}"></span>\n              <span class="pie-label">${n.label}</span>\n              <span class="pie-value">${e[n.key]}äºº (${a}%)</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function ue(e){const n=document.querySelector("#detail-job-table tbody");n&&(e.length?n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${N(e.title)}</td>\n      <td>${U(e.views)}</td>\n      <td>${e.applications}</td>\n      <td>${e.cvr}%</td>\n    </tr>\n  `).join(""):n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}async function pe(t){const a=e.apiEndpoint,s={},o=n();o&&(s.Authorization=`Bearer ${o}`);try{const e=await fetch(`${a}?type=recent-applications&domain=${t}&limit=10`,{headers:s}),n=await e.json();if(n.success&&n.data&&n.data.applications){ye(n.data.applications.map(e=>({date:e.date,job:e.jobTitle||"-",type:e.type||"apply",source:e.source||"Direct"})))}else ye([])}catch(c){console.error("[Admin] Recent applications error:",c),ye([])}}function ye(e){const n=document.querySelector("#detail-recent-applications tbody");if(!n)return;const t={apply:"å¿œå‹Ÿ",line:"LINE",consult:"ç›¸è«‡"};e.length?n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${N(e.date)}</td>\n      <td>${N(e.job)}</td>\n      <td><span class="type-badge ${e.type}">${t[e.type]||e.type}</span></td>\n      <td>${N(e.source)}</td>\n    </tr>\n  `).join(""):n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}function ve(){const e=document.getElementById("login-screen"),n=document.getElementById("admin-dashboard");e&&(e.style.display="flex"),n&&(n.style.display="none")}function ge(){const e=document.getElementById("login-screen"),n=document.getElementById("admin-dashboard");e&&(e.style.display="none"),n&&(n.style.display="flex"),function(){const e=C(),n=$();if(console.log("[Admin] Applying role-based UI:",e,n),!E()){["overview","companies","applications","company-manage","lp-settings","settings"].forEach(e=>{const n=document.querySelector(`[data-section="${e}"]`);n&&(n.parentElement.style.display="none")});document.querySelectorAll(".nav-section").forEach(e=>{const n=e.querySelectorAll('li[style*="display: none"]'),t=e.querySelectorAll("li");n.length===t.length&&(e.style.display="none")}),fe("applicant-select");const e=document.querySelector(".sidebar-header p");e&&n&&(e.textContent=`${n} ç®¡ç†ç”»é¢`)}}()}function he(){const e=document.getElementById("admin-sidebar"),n=document.getElementById("mobile-overlay"),t=document.getElementById("mobile-menu-btn");e&&e.classList.remove("open"),n&&n.classList.remove("active"),t&&t.classList.remove("active"),document.body.style.overflow=""}function fe(e){he(),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const n=document.querySelector(`[data-section="${e}"]`);n&&n.parentElement.classList.add("active"),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(`section-${e}`);t&&t.classList.add("active");const a={overview:"æ¦‚è¦",companies:"ä¼æ¥­åˆ¥ãƒ‡ãƒ¼ã‚¿","company-manage":"ä¼šç¤¾ç®¡ç†","lp-settings":"LPè¨­å®š",applications:"å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿","applicant-select":"å¿œå‹Ÿè€…ç®¡ç†","company-users":"ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",settings:"è¨­å®š"},s=document.getElementById("page-title");s&&(s.textContent=a[e]||e),"company-manage"===e&&f(),"lp-settings"===e&&(m(),l());const o=document.querySelector(".header-actions");o&&(o.style.display="lp-settings"===e?"none":""),document.body.classList.toggle("lp-settings-active","lp-settings"===e),"applicant-select"===e&&async function(){const e=document.getElementById("applicant-company-grid");if(!e)return;if(e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>',!E()){const e=$();if(e)return void(window.location.href=`job-manage.html?domain=${encodeURIComponent(e)}`)}try{const n=await V();if(!n||0===n.length)return void(e.innerHTML='<div class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');let t=n.filter(e=>W(e));if(!E()){const e=$();t=t.filter(n=>n.companyDomain===e)}if(0===t.length)return void(e.innerHTML='<div class="loading-cell">è¡¨ç¤ºå¯èƒ½ãªä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“</div>');e.innerHTML=t.map(e=>`\n      <a href="job-manage.html?domain=${encodeURIComponent(e.companyDomain)}" class="company-select-card">\n        <div class="company-select-icon">ğŸ¢</div>\n        <div class="company-select-info">\n          <h4>${N(e.company)}</h4>\n          <p>${N(e.companyDomain)}</p>\n        </div>\n        <div class="company-select-arrow">â†’</div>\n      </a>\n    `).join("")}catch(n){console.error("ä¼šç¤¾ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",n),e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}(),"company-users"===e&&Le()}function be(){console.log("[Admin] bindEvents é–‹å§‹");const e=document.getElementById("mobile-menu-btn");e&&e.addEventListener("click",()=>{const e=document.getElementById("admin-sidebar");e&&e.classList.contains("open")?he():function(){const e=document.getElementById("admin-sidebar"),n=document.getElementById("mobile-overlay"),t=document.getElementById("mobile-menu-btn");e&&e.classList.add("open"),n&&n.classList.add("active"),t&&t.classList.add("active"),document.body.style.overflow="hidden"}()});const n=document.getElementById("sidebar-close-btn");n&&n.addEventListener("click",he);const t=document.getElementById("mobile-overlay");t&&t.addEventListener("click",he),document.querySelectorAll(".login-tab").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.tab;document.querySelectorAll(".login-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active");const t=document.getElementById("company-login-form"),a=document.getElementById("login-form");"company"===n?(t&&(t.style.display="block"),a&&(a.style.display="none")):(t&&(t.style.display="none"),a&&(a.style.display="block"))})});const l=document.getElementById("company-login-form");l&&l.addEventListener("submit",async e=>{var n,t;e.preventDefault();const a=(null==(n=document.getElementById("company-username"))?void 0:n.value)||"",s=(null==(t=document.getElementById("company-password"))?void 0:t.value)||"",o=document.getElementById("company-login-error");o&&(o.style.display="none");const c=await I(a,s);c.success?window.location.href=`job-manage.html?domain=${encodeURIComponent(c.companyDomain)}&company=${encodeURIComponent(c.companyName||c.companyDomain)}`:o&&(o.textContent=c.error,o.style.display="block")});const m=document.getElementById("login-form");m&&m.addEventListener("submit",e=>{var n,t;e.preventDefault();const a=(null==(n=document.getElementById("username"))?void 0:n.value)||"",s=(null==(t=document.getElementById("password"))?void 0:t.value)||"",o=document.getElementById("login-error"),c=B(a,s);c.success?(o&&(o.style.display="none"),ge(),J()):o&&(o.textContent=c.error,o.style.display="block")});const u=document.getElementById("logout-btn");u&&u.addEventListener("click",()=>{k(),ve()}),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();fe(e.currentTarget.dataset.section)})});const p=document.getElementById("date-range");p&&p.addEventListener("change",()=>J());const y=document.getElementById("refresh-btn");y&&y.addEventListener("click",()=>J());const v=document.getElementById("company-search");v&&v.addEventListener("input",e=>Z(e.target.value));const h=document.getElementById("sort-by");h&&h.addEventListener("change",()=>ee());const f=document.getElementById("google-login-btn");f&&f.addEventListener("click",async()=>{const e=document.getElementById("login-error"),n=await M();n.success?(e&&(e.style.display="none"),ge(),J()):e&&(e.textContent=n.error,e.style.display="block")});const b=document.getElementById("btn-add-company");b&&b.addEventListener("click",()=>g());const w=document.getElementById("lp-job-select");w&&w.addEventListener("change",e=>r(e.target.value));const E=document.getElementById("btn-save-lp-settings");console.log("[Admin] ä¿å­˜ãƒœã‚¿ãƒ³è¦ç´ :",E),E?(E.addEventListener("click",()=>{console.log("[Admin] ä¿å­˜ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),d()}),console.log("[Admin] ä¿å­˜ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ")):console.warn("[Admin] ä¿å­˜ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: btn-save-lp-settings");const $=document.getElementById("btn-reset-lp-settings");$&&$.addEventListener("click",()=>{var e;const n=null==(e=document.getElementById("lp-job-select"))?void 0:e.value;n&&r(n)});const L=document.getElementById("btn-toggle-preview");L&&L.addEventListener("click",()=>i());const C=document.getElementById("btn-close-preview");C&&C.addEventListener("click",()=>c()),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",e=>{const n=e.target.dataset.device,t=document.querySelector(".lp-preview-frame-wrapper");document.querySelectorAll(".preview-device-btn").forEach(e=>{e.classList.toggle("active",e.dataset.device===n)}),t&&t.setAttribute("data-device",n)})});document.querySelectorAll("#lp-editor input, #lp-editor textarea").forEach(e=>{e.addEventListener("input",()=>o())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>a())}),s(),A(),T(),document.querySelectorAll('#lp-section-order input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>a())}),document.querySelectorAll(".collapsible-header").forEach(e=>{e.addEventListener("click",()=>{const n=e.closest(".collapsible");n&&n.classList.toggle("collapsed")})}),document.querySelectorAll("#ad-tracking-section, #ogp-section").forEach(e=>{e.classList.add("collapsed")});const F=document.getElementById("save-password");F&&F.addEventListener("click",()=>{var e;const n=null==(e=document.getElementById("new-password"))?void 0:e.value;n&&n.length>=4?(localStorage.setItem("admin_password",n),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ")):alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")});const O=document.getElementById("feed-status"),U=()=>{O&&(O.style.display="flex")},N=()=>{O&&(O.style.display="none")},V=document.getElementById("btn-download-indeed");V&&V.addEventListener("click",async()=>{try{U(),await S(),alert("Indeed XMLãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{N()}});const G=document.getElementById("btn-download-google");G&&G.addEventListener("click",async()=>{try{U(),await j(),alert("Google JSON-LDã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{N()}});const X=document.getElementById("btn-download-jobbox");X&&X.addEventListener("click",async()=>{try{U(),await x(),alert("æ±‚äººãƒœãƒƒã‚¯ã‚¹XMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{N()}});const K=document.getElementById("btn-download-csv");K&&K.addEventListener("click",async()=>{try{U(),await D(),alert("CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{N()}});const Y=document.getElementById("btn-add-company-user");Y&&Y.addEventListener("click",()=>{Ie(null,"")});const _=document.getElementById("btn-bulk-generate");_&&_.addEventListener("click",()=>async function(){if(!confirm("æœªç™ºè¡Œã®å…¨ä¼šç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ"))return;const e=we.filter(e=>W(e)),n=[];for(const c of e){if(await P(c.companyDomain))continue;const e=q(c.companyDomain),t=H();(await R(e,t,c.companyDomain,c.company)).success&&n.push({company:c.company,domain:c.companyDomain,username:e,password:t})}if(0===n.length)return void alert("ç™ºè¡Œå¯¾è±¡ã®ä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");let t=`${n.length}ç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\n\n`;n.forEach(e=>{t+=`ã€${e.company}ã€‘\nID: ${e.username}\nPW: ${e.password}\n\n`});const a=new Blob([t],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=`company-users-${(new Date).toISOString().split("T")[0]}.txt`,o.click(),URL.revokeObjectURL(s),alert(`${n.length}ç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\nãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`),await Le()}());const Q=document.getElementById("company-user-modal-close");Q&&Q.addEventListener("click",Be);const ne=document.getElementById("company-user-modal-cancel");ne&&ne.addEventListener("click",Be);const te=document.getElementById("company-user-form");te&&te.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,n,t,a,s;const o=null==(e=document.getElementById("cu-company-select"))?void 0:e.value,c=null==(t=null==(n=document.getElementById("cu-username"))?void 0:n.value)?void 0:t.trim(),i=null==(a=document.getElementById("cu-password"))?void 0:a.value,l=null==(s=document.getElementById("cu-is-active"))?void 0:s.checked;if(!o||!c)return void alert("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const d=document.getElementById("company-user-modal-save");d&&(d.disabled=!0,d.textContent="ä¿å­˜ä¸­...");try{if($e){const e={username:c,isActive:l};i&&(e.password=i);const n=await z($e,e);if(!n.success)throw new Error(n.error);alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),Be()}else{if(!i)return void alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const e=await R(c,i,o);if(!e.success)throw new Error(e.error);document.getElementById("cu-issued-username").textContent=c,document.getElementById("cu-issued-password").textContent=i,document.getElementById("cu-credentials-display").style.display="block",d&&(d.textContent="å®Œäº†",d.onclick=()=>{Be(),Le()}),alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’æ§ãˆã¦ãã ã•ã„ã€‚")}await Le()}catch(r){console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿å­˜ã‚¨ãƒ©ãƒ¼:",r),alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+r.message)}finally{d&&!$e||d&&(d.disabled=!1,d.textContent="ä¿å­˜")}}()});const ae=document.getElementById("company-user-delete");ae&&ae.addEventListener("click",ke);const se=document.getElementById("cu-generate-password");se&&se.addEventListener("click",()=>{const e=document.getElementById("cu-password");e&&(e.value=H())});const oe=document.getElementById("cu-copy-credentials");oe&&oe.addEventListener("click",Me);const ce=document.getElementById("company-user-modal");ce&&ce.addEventListener("click",e=>{e.target===ce&&Be()})}let we=[],Ee=[],$e=null;async function Le(){const e=document.getElementById("company-users-tbody");if(e){e.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>';try{we=await V(),Ee=await L();const n={};Ee.forEach(e=>{n[e.companyDomain]||(n[e.companyDomain]=[]),n[e.companyDomain].push(e)});const t=we.filter(e=>W(e));if(0===t.length)return void(e.innerHTML='<tr><td colspan="6" class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');let a="";t.forEach(e=>{const t=n[e.companyDomain]||[];0===t.length?a+=`\n          <tr data-company-domain="${N(e.companyDomain)}">\n            <td>${N(e.company)}</td>\n            <td><span class="badge warning">æœªç™ºè¡Œ</span></td>\n            <td><span class="badge">-</span></td>\n            <td>-</td>\n            <td>-</td>\n            <td>\n              <button class="btn-small btn-primary btn-issue-user" data-domain="${N(e.companyDomain)}" data-company="${N(e.company)}">\n                IDç™ºè¡Œ\n              </button>\n            </td>\n          </tr>\n        `:t.forEach((n,s)=>{const o=!1!==n.isActive,c=n.createdAt?new Date(n.createdAt).toLocaleDateString("ja-JP"):"-",i=n.lastLogin?new Date(n.lastLogin).toLocaleString("ja-JP"):"æœªãƒ­ã‚°ã‚¤ãƒ³";a+=`\n            <tr data-user-id="${N(n.id)}">\n              ${0===s?`<td rowspan="${t.length}">${N(e.company)}</td>`:""}\n              <td><code>${N(n.username)}</code></td>\n              <td>${o?'<span class="badge success">æœ‰åŠ¹</span>':'<span class="badge">ç„¡åŠ¹</span>'}</td>\n              <td>${c}</td>\n              <td>${i}</td>\n              <td>\n                <div class="action-buttons">\n                  <button class="btn-small btn-secondary btn-reset-password" data-user-id="${N(n.id)}" data-username="${N(n.username)}">\n                    PWå†ç™ºè¡Œ\n                  </button>\n                  <button class="btn-small btn-edit-user" data-user-id="${N(n.id)}">ç·¨é›†</button>\n                </div>\n              </td>\n            </tr>\n          `})}),e.innerHTML=a,document.querySelectorAll(".btn-issue-user").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.domain;e.dataset.company,Ie(null,n)})}),document.querySelectorAll(".btn-edit-user").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.userId,t=Ee.find(e=>e.id===n);if(t){const e=we.find(e=>e.companyDomain===t.companyDomain);Ie(t,t.companyDomain,(null==e?void 0:e.company)||t.companyDomain)}})}),document.querySelectorAll(".btn-reset-password").forEach(e=>{e.addEventListener("click",async()=>{const n=e.dataset.userId,t=e.dataset.username;await async function(e,n){if(!confirm(`${n} ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ`))return;const t=H();try{const a=await O(e,t);if(!a.success)throw new Error(a.error);const s=`æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\n\nãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${n}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${t}\n\nâ€»ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å†è¡¨ç¤ºã§ãã¾ã›ã‚“ã€‚å¿…ãšæ§ãˆã¦ãã ã•ã„ã€‚`;try{await navigator.clipboard.writeText(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${n}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${t}`),alert(s+"\n\nï¼ˆã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼‰")}catch{alert(s)}}catch(a){console.error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†ç™ºè¡Œã‚¨ãƒ©ãƒ¼:",a),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}}(n,t)})})}catch(n){console.error("ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",n),e.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>'}}}function Ie(e,n,t){const a=document.getElementById("company-user-modal"),s=document.getElementById("company-user-modal-title"),o=document.getElementById("cu-company-select"),c=document.getElementById("cu-username"),i=document.getElementById("cu-password"),l=document.getElementById("cu-is-active"),d=document.getElementById("company-user-delete"),r=document.getElementById("cu-credentials-display");if(!a)return;const m=we.filter(e=>W(e));o.innerHTML=m.map(e=>`\n    <option value="${N(e.companyDomain)}" ${e.companyDomain===n?"selected":""}>\n      ${N(e.company)}\n    </option>\n  `).join(""),e?(s.textContent="ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·¨é›†",c.value=e.username||"",i.value="",i.placeholder="å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›",i.required=!1,l.checked=!1!==e.isActive,d.style.display="",$e=e.id):(s.textContent="ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ",c.value=q(n),i.value=H(),i.placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",i.required=!0,l.checked=!0,d.style.display="none",$e=null),r.style.display="none",a.style.display="flex"}function Be(){const e=document.getElementById("company-user-modal");e&&(e.style.display="none"),$e=null}async function ke(){if($e&&confirm("ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))try{const e=await F($e);if(!e.success)throw new Error(e.error);alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),Be(),await Le()}catch(e){console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",e),alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}}function Me(){var e,n;const t=null==(e=document.getElementById("cu-issued-username"))?void 0:e.textContent,a=null==(n=document.getElementById("cu-issued-password"))?void 0:n.textContent;if(t&&a){const e=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${t}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${a}`;navigator.clipboard.writeText(e).then(()=>{alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")}).catch(()=>{alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ")})}}function Ae(){console.log("[Admin] initAdminDashboard é–‹å§‹");const t=localStorage.getItem("admin_password");t&&(e.credentials.password=t),b(),w()?(ge(),document.addEventListener("authReady",()=>{J()},{once:!0}),setTimeout(()=>{n()||(console.log("[Admin] Auth timeout, loading with mock data"),J())},3e3)):ve(),be(),ne(),function(){const e=document.getElementById("btn-back-to-companies");e&&e.addEventListener("click",ce)}()}"undefined"!=typeof window&&(window.AdminDashboard={config:e,spreadsheetConfig:{sheetId:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",companySheetName:"ä¼šç¤¾ä¸€è¦§",lpSettingsSheetName:"LPè¨­å®š",gasApiUrl:"https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec"},init:Ae,switchSection:fe,getIdToken:n},window.AdminAnalytics={loadDashboardData:J,filterCompanies:Z,sortCompanies:ee},window.AdminCompany={loadCompanyManageData:f,editCompany:h,showCompanyModal:g,closeCompanyModal:v,saveCompanyData:y,renderCompanyTable:p,openJobsArea:u,loadCompanyListForLP:m,loadLPSettings:r,saveLPSettings:d,renderHeroImagePresets:l,toggleLPPreview:i,closeLPPreview:c,debouncedUpdatePreview:o,initSectionSortable:s,updateLPPreview:a,getPatternLabel:e=>({standard:"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰",modern:"ãƒ¢ãƒ€ãƒ³",classic:"ã‚¯ãƒ©ã‚·ãƒƒã‚¯",minimal:"ãƒŸãƒ‹ãƒãƒ«",colorful:"ã‚«ãƒ©ãƒ•ãƒ«"}[e]||"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰")}),document.addEventListener("DOMContentLoaded",()=>{Ae()});
