import"./modulepreload-polyfill-YP0FEG5d.js";import{g as e,a as n,b as t,w as a,t as o,e as l}from"./utils-BE8OECDH.js";import{f as i,a as r,i as s}from"./jobs-loader-CErzUEmq.js";import{I as c,P as d,D as p,J as m}from"./index-BCF2U2NH.js";async function u(e,n,t){try{const a=[];for(const t of e)if(s(t)&&t.companyDomain!==n){if(t.jobsSheet&&t.jobsSheet.trim()){const e=await r(t.jobsSheet.trim());e&&e.length>0&&(e.forEach(e=>{e.company=t.company,e.companyDomain=t.companyDomain}),a.push(...e.slice(0,2)))}if(a.length>=6)break}!function(e,n,t){const a=document.getElementById("related-jobs-container");if(!a)return;const o=e.filter(e=>!(e.companyDomain===n&&String(e.id)===String(t))).slice(0,6);0!==o.length?a.innerHTML=o.map(e=>m({job:e})).join(""):a.innerHTML='<p class="no-data">関連する求人がありません。</p>'}(a.slice(0,6),n,t)}catch(a){console.error("関連求人の取得エラー:",a)}}let y=null,f=null;function v(){const e=document.getElementById("apply-modal");e&&(e.style.display="none"),document.body.style.overflow="",y=null}function b(e){["login","register","form","complete"].forEach(n=>{const t=document.getElementById(`apply-step-${n}`);t&&(t.style.display=n===e?"block":"none")})}async function g(e){var n,t;if(!e)return;const a=document.getElementById("apply-name"),o=document.getElementById("apply-email");a&&e.displayName&&(a.value=e.displayName),o&&e.email&&(o.value=e.email);try{const o=await window.firebaseDb.collection("users").doc(e.uid).get();if(o.exists){const e=o.data(),l=document.getElementById("apply-phone");l&&(null==(n=e.profile)?void 0:n.phone)&&(l.value=e.profile.phone),a&&(null==(t=e.profile)?void 0:t.name)&&(a.value=e.profile.name)}}catch(l){console.warn("[Apply] Failed to fetch user profile:",l)}}function h(e,n){const t=document.getElementById(e);t&&(t.textContent=n,t.style.display="block")}function w(e){const n=document.getElementById(e);n&&(n.style.display="none")}function E(){var e,n,t,a,o,l,i,r;!function(){if("undefined"==typeof firebase||!firebase.auth)return console.warn("[Auth] Firebase Auth not loaded"),!1;const e={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"};firebase.apps.length||firebase.initializeApp(e),f=firebase.auth(),window.firebaseDb=firebase.firestore(),f.onAuthStateChanged(e=>{e&&y&&(b("form"),g(e))})}();const s=document.getElementById("apply-modal");s&&(s.querySelectorAll(".modal-close, .modal-close-btn").forEach(e=>{e.addEventListener("click",v)}),null==(e=s.querySelector(".modal-backdrop"))||e.addEventListener("click",v),null==(n=document.getElementById("show-register"))||n.addEventListener("click",e=>{e.preventDefault(),b("register")}),null==(t=document.getElementById("show-login"))||t.addEventListener("click",e=>{e.preventDefault(),b("login")}),null==(a=document.getElementById("btn-google-login"))||a.addEventListener("click",j),null==(o=document.getElementById("btn-google-register"))||o.addEventListener("click",j),null==(l=document.getElementById("login-form"))||l.addEventListener("submit",I),null==(i=document.getElementById("register-form"))||i.addEventListener("submit",$),null==(r=document.getElementById("apply-form"))||r.addEventListener("submit",B))}async function j(){if(f)try{const e=new firebase.auth.GoogleAuthProvider;await f.signInWithPopup(e)}catch(e){console.error("[Auth] Google login error:",e),h("login-error",D(e.code))}}async function I(e){var n,t;if(e.preventDefault(),!f)return;const a=null==(n=document.getElementById("login-email"))?void 0:n.value,o=null==(t=document.getElementById("login-password"))?void 0:t.value;w("login-error");try{await f.signInWithEmailAndPassword(a,o)}catch(l){console.error("[Auth] Email login error:",l),h("login-error",D(l.code))}}async function $(e){var n,t,a;if(e.preventDefault(),!f)return;const o=null==(n=document.getElementById("register-name"))?void 0:n.value,l=null==(t=document.getElementById("register-email"))?void 0:t.value,i=null==(a=document.getElementById("register-password"))?void 0:a.value;w("register-error");try{const e=await f.createUserWithEmailAndPassword(l,i);o&&await e.user.updateProfile({displayName:o}),await window.firebaseDb.collection("users").doc(e.user.uid).set({uid:e.user.uid,email:e.user.email,displayName:o||"",profile:{name:o||"",phone:"",age:"",address:""},authProvider:"email",createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()})}catch(r){console.error("[Auth] Register error:",r),h("register-error",D(r.code))}}async function B(e){var n,t,a,l;e.preventDefault();const i=null==(n=document.getElementById("apply-name"))?void 0:n.value,r=null==(t=document.getElementById("apply-phone"))?void 0:t.value,s=null==(a=document.getElementById("apply-email"))?void 0:a.value,c=null==(l=document.getElementById("apply-message"))?void 0:l.value;if(w("apply-form-error"),i&&r&&s)if(y)try{const e=await async function(e){try{if(!window.firebaseDb)return console.warn("[Application] Firestore not initialized"),null;const n=null==f?void 0:f.currentUser,t={companyDomain:e.company_domain,companyName:e.company_name,jobId:e.job_id,jobTitle:e.job_title,applicantName:e.name,applicantPhone:e.phone,applicantEmail:e.email,applicantMessage:e.message||"",userId:(null==n?void 0:n.uid)||null,status:"new",type:"apply",source:document.referrer||"direct",userAgent:navigator.userAgent,timestamp:new Date,createdAt:firebase.firestore.FieldValue.serverTimestamp()},a=await window.firebaseDb.collection("applications").add(t);return console.log("[Application] Saved to Firestore:",a.id),a.id}catch(n){return console.error("[Application] Failed to save:",n),null}}({...y,name:i,phone:r,email:s,message:c});if(!e)throw new Error("Failed to save application");const n=null==f?void 0:f.currentUser;n&&await window.firebaseDb.collection("users").doc(n.uid).update({"profile.name":i,"profile.phone":r,updatedAt:firebase.firestore.FieldValue.serverTimestamp()}).catch(()=>{}),o("submit_application",y),b("complete")}catch(d){console.error("[Apply] Submit error:",d),h("apply-form-error","応募の送信に失敗しました。もう一度お試しください")}else h("apply-form-error","エラーが発生しました。再度お試しください");else h("apply-form-error","必須項目を入力してください")}function D(e){return{"auth/email-already-in-use":"このメールアドレスは既に登録されています","auth/invalid-email":"メールアドレスの形式が正しくありません","auth/weak-password":"パスワードは6文字以上で設定してください","auth/user-not-found":"アカウントが見つかりません","auth/wrong-password":"パスワードが正しくありません","auth/invalid-credential":"メールアドレスまたはパスワードが正しくありません","auth/too-many-requests":"リクエストが多すぎます。しばらくしてからお試しください","auth/popup-closed-by-user":"ログインがキャンセルされました"}[e]||"エラーが発生しました。もう一度お試しください"}function A(){document.querySelectorAll("[data-apply-btn]").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const t={company_domain:e.dataset.companyDomain,company_name:e.dataset.companyName,job_id:e.dataset.jobId,job_title:e.dataset.jobTitle};o("click_apply",t),function(e){y=e;const n=document.getElementById("apply-modal");if(!n)return;const t=document.getElementById("apply-job-info");t&&(t.textContent=`${e.company_name} - ${e.job_title}`);const a=null==f?void 0:f.currentUser;a?(b("form"),g(a)):b("login"),n.style.display="flex",document.body.style.overflow="hidden"}(t)})})}async function S(){const s=e("company"),m=e("job");if(s&&m){t("job-detail-container","求人情報を読み込んでいます...");try{await a();const e=await i();if(!e)return void n("job-detail-container","データの取得に失敗しました。");const t=e.find(e=>e.companyDomain&&e.companyDomain.trim()===s);if(!t)return void n("job-detail-container","会社が見つかりませんでした。");let y=null;if(t.jobsSheet&&t.jobsSheet.trim()){const e=await r(t.jobsSheet.trim());e&&(y=e.find(e=>String(e.id)===String(m)),y&&(y.company=t.company,y.companyDomain=t.companyDomain))}if(!y)return void n("job-detail-container","求人が見つかりませんでした。");!function(e){const n=document.getElementById("job-detail-container");if(!n)return;const t=Array.isArray(e.features)?e.features:[];n.innerHTML=`\n    <div class="lp-container">\n      \x3c!-- ヒーローセクション --\x3e\n      <section class="lp-hero-section">\n        <div class="lp-hero-bg"></div>\n        <div class="lp-hero-inner">\n          <p class="lp-hero-label">${l(e.company)}</p>\n          <h1 class="lp-hero-title">${l(e.title)}</h1>\n          <div class="lp-hero-meta">\n            <span class="lp-hero-location">\n              ${c.location}\n              ${l(e.location)}\n            </span>\n          </div>\n          <a href="#apply-section" class="lp-hero-cta" data-apply-btn data-job-id="${l(String(e.id))}" data-company-domain="${l(e.companyDomain)}" data-company-name="${l(e.company)}" data-job-title="${l(e.title)}">今すぐ応募する</a>\n        </div>\n      </section>\n\n      \x3c!-- ポイントセクション --\x3e\n      <section class="lp-points-section">\n        <div class="lp-section-inner">\n          <h2 class="lp-section-heading">この求人のポイント</h2>\n          <div class="lp-points-grid">\n            ${e.totalBonus?d({icon:c.money,label:"特典総額",value:e.totalBonus,isHighlight:!0}):""}\n            ${e.monthlySalary?d({icon:c.wallet,label:"月収例",value:e.monthlySalary}):""}\n            ${e.employmentType?d({icon:c.briefcase,label:"雇用形態",value:e.employmentType}):""}\n          </div>\n          ${t.length>0?`\n          <div class="lp-tags">\n            ${t.map(e=>`<span class="lp-tag">${l(e)}</span>`).join("")}\n          </div>\n          `:""}\n        </div>\n      </section>\n\n      \x3c!-- 募集要項セクション --\x3e\n      <section class="lp-details-section">\n        <div class="lp-section-inner">\n          <h2 class="lp-section-heading">募集要項</h2>\n          <div class="lp-details-table">\n            ${p({label:"仕事内容",value:e.jobDescription})}\n            ${p({label:"給与",value:e.salary})}\n            ${p({label:"応募資格",value:e.requirements})}\n            ${p({label:"勤務時間",value:e.workingHours})}\n            ${p({label:"休日・休暇",value:e.holidays})}\n            ${p({label:"待遇・福利厚生",value:e.benefits})}\n            <div class="lp-detail-row">\n              <div class="lp-detail-label">勤務地</div>\n              <div class="lp-detail-value">${l(e.location)}</div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      \x3c!-- 応募セクション --\x3e\n      <section class="lp-apply-section" id="apply-section">\n        <div class="lp-section-inner">\n          <h2 class="lp-apply-heading">まずはお気軽にご応募ください</h2>\n          <p class="lp-apply-text">経験・学歴不問！あなたのご応募をお待ちしています。</p>\n          <div class="lp-apply-buttons">\n            <a href="#" class="lp-apply-btn primary" data-apply-btn data-job-id="${l(String(e.id))}" data-company-domain="${l(e.companyDomain)}" data-company-name="${l(e.company)}" data-job-title="${l(e.title)}">この求人に応募する</a>\n            <a href="company.html?id=${l(e.companyDomain)}" class="lp-apply-btn secondary">${l(e.company)}の企業情報を見る</a>\n          </div>\n        </div>\n      </section>\n    </div>\n  `}(y),function(e){const n=document.getElementById("breadcrumb-company");n&&(n.innerHTML=`<a href="company.html?id=${encodeURIComponent(e.companyDomain)}">${l(e.company)}</a>`);const t=document.getElementById("breadcrumb-current");t&&(t.textContent=e.title)}(y),function(e){document.title=`${e.title} | ${e.company} | リクエコ求人ナビ`;const n=document.querySelector('meta[name="description"]');n&&(n.content=`${e.company}の${e.title}。${e.location}勤務。${e.totalBonus?"特典総額"+e.totalBonus+"。":""}`)}(y),u(e,s,m),o("view_job_detail",{company_domain:y.companyDomain,company_name:y.company,job_id:String(y.id),job_title:y.title,location:y.location}),E(),A()}catch(y){console.error("求人詳細の取得エラー:",y),n("job-detail-container","データの取得に失敗しました。しばらくしてから再度お試しください。")}}else n("job-detail-container","求人が見つかりませんでした。")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>S(),0)}):setTimeout(()=>S(),0);
