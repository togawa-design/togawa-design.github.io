const LocationPage={getPrefectureFromUrl:()=>new URLSearchParams(window.location.search).get("prefecture"),async init(){const e=document.getElementById("location-page-container");if(!e)return;const n=this.getPrefectureFromUrl();n?await this.renderLocationJobs(e,n):await this.renderAllLocations(e),await this.renderOtherLocations(n),this.initMobileMenu()},async renderAllLocations(e){document.title="勤務地から探す | リクエコ求人ナビ";const n=document.getElementById("breadcrumb-current");n&&(n.textContent="勤務地から探す");try{const n=await JobsLoader.getLocationList();if(!n||0===n.length)return void(e.innerHTML='\n          <div class="jobs-error">\n            <p>勤務地データがありません。</p>\n            <a href="/" class="btn-more">トップページに戻る</a>\n          </div>\n        ');const t=this.groupByRegion(n);e.innerHTML=`\n        <div class="location-page-header">\n          <h1 class="location-page-title">勤務地から探す</h1>\n          <p class="location-page-description">働きたいエリアから求人を探せます</p>\n        </div>\n        <div class="location-regions">\n          ${Object.entries(t).map(([e,n])=>`\n            <div class="location-region">\n              <h2 class="location-region-title">${e}</h2>\n              <div class="location-prefecture-grid">\n                ${n.map(e=>`\n                  <a href="location.html?prefecture=${encodeURIComponent(e.prefecture)}" class="location-prefecture-card">\n                    <span class="prefecture-name">${e.prefecture}</span>\n                    <span class="prefecture-count">${e.count}件</span>\n                  </a>\n                `).join("")}\n              </div>\n            </div>\n          `).join("")}\n        </div>\n      `}catch(n){console.error("エリア一覧の取得エラー:",n),e.innerHTML='\n        <div class="jobs-error">\n          <p>データの取得に失敗しました。</p>\n          <button onclick="location.reload()">再読み込み</button>\n        </div>\n      '}},groupByRegion(e){const n={"北海道":"北海道・東北","青森県":"北海道・東北","岩手県":"北海道・東北","宮城県":"北海道・東北","秋田県":"北海道・東北","山形県":"北海道・東北","福島県":"北海道・東北","茨城県":"関東","栃木県":"関東","群馬県":"関東","埼玉県":"関東","千葉県":"関東","東京都":"関東","神奈川県":"関東","新潟県":"北陸・甲信越","富山県":"北陸・甲信越","石川県":"北陸・甲信越","福井県":"北陸・甲信越","山梨県":"北陸・甲信越","長野県":"北陸・甲信越","岐阜県":"東海","静岡県":"東海","愛知県":"東海","三重県":"東海","滋賀県":"関西","京都府":"関西","大阪府":"関西","兵庫県":"関西","奈良県":"関西","和歌山県":"関西","鳥取県":"中国","島根県":"中国","岡山県":"中国","広島県":"中国","山口県":"中国","徳島県":"四国","香川県":"四国","愛媛県":"四国","高知県":"四国","福岡県":"九州・沖縄","佐賀県":"九州・沖縄","長崎県":"九州・沖縄","熊本県":"九州・沖縄","大分県":"九州・沖縄","宮崎県":"九州・沖縄","鹿児島県":"九州・沖縄","沖縄県":"九州・沖縄"},t={};return["北海道・東北","関東","北陸・甲信越","東海","関西","中国","四国","九州・沖縄"].forEach(e=>{t[e]=[]}),e.forEach(e=>{const a=n[e.prefecture]||"その他";t[a]||(t[a]=[]),t[a].push(e)}),Object.keys(t).forEach(e=>{0===t[e].length&&delete t[e]}),t},async renderLocationJobs(e,n){document.title=`${n}の求人一覧 | リクエコ求人ナビ`;const t=document.querySelector('meta[name="description"]');t&&(t.content=`${n}の期間工・期間従業員の求人一覧。工場・製造業の求人を多数掲載。`);const a=document.getElementById("breadcrumb-current");a&&(a.textContent=`${n}の求人`);try{const t=await JobsLoader.getJobsByLocation(n);if(!t||0===t.length)return void(e.innerHTML=`\n          <div class="location-page-header">\n            <h1 class="location-page-title">${this.escapeHtml(n)}の求人</h1>\n            <p class="location-page-description">現在、${this.escapeHtml(n)}の求人はありません</p>\n          </div>\n          <div class="jobs-error">\n            <p>${this.escapeHtml(n)}の求人が見つかりませんでした。</p>\n            <a href="location.html" class="btn-more">他のエリアを探す</a>\n          </div>\n        `);e.innerHTML=`\n        <div class="location-page-header">\n          <h1 class="location-page-title">${this.escapeHtml(n)}の求人</h1>\n          <p class="location-page-description">${t.length}件の求人が見つかりました</p>\n        </div>\n        <div class="jobs-grid location-jobs-grid">\n          ${t.map(e=>this.renderJobCard(e)).join("")}\n        </div>\n      `,this.trackLocationPageView(n,t.length)}catch(n){console.error("求人の取得エラー:",n),e.innerHTML='\n        <div class="jobs-error">\n          <p>データの取得に失敗しました。</p>\n          <button onclick="location.reload()">再読み込み</button>\n        </div>\n      '}},renderJobCard(e){const n=(Array.isArray(e.features)?e.features:[]).slice(0,3).map(e=>`<li>${this.escapeHtml(e)}</li>`).join("");return`\n      <article class="job-card" data-job-id="${this.escapeHtml(e.id||"")}">\n        <div class="job-card-body">\n          <p class="job-company-name">${this.escapeHtml(e.company||"")}</p>\n          <h3 class="job-title">${this.escapeHtml(e.title||"")}</h3>\n          <p class="job-location">${this.escapeHtml(e.location||"")}</p>\n          <div class="job-benefits">\n            <div class="benefit-item highlight">\n              <span class="benefit-label">特典総額</span>\n              <span class="benefit-value">${this.escapeHtml(e.totalBonus||"")}</span>\n            </div>\n            <div class="benefit-item">\n              <span class="benefit-label">月収例</span>\n              <span class="benefit-value">${this.escapeHtml(e.monthlySalary||"")}</span>\n            </div>\n          </div>\n          ${n?`<ul class="job-features">${n}</ul>`:""}\n          <a href="company.html?id=${this.escapeHtml(e.companyDomain||"")}" class="btn-apply">詳細を見る</a>\n        </div>\n      </article>\n    `},async renderOtherLocations(e){const n=document.getElementById("other-locations-container");if(n)try{const t=(await JobsLoader.getLocationList()).filter(n=>n.prefecture!==e).slice(0,6);if(0===t.length)return void(document.getElementById("other-locations").style.display="none");n.innerHTML=`\n        <div class="other-locations-grid">\n          ${t.map(e=>`\n            <a href="location.html?prefecture=${encodeURIComponent(e.prefecture)}" class="other-location-card">\n              <span class="other-location-name">${e.prefecture}</span>\n              <span class="other-location-count">${e.count}件の求人</span>\n            </a>\n          `).join("")}\n        </div>\n        <div class="other-locations-more">\n          <a href="location.html" class="btn-more">すべてのエリアを見る</a>\n        </div>\n      `}catch(e){console.error("他のエリアの取得エラー:",e),n.innerHTML="<p>データの取得に失敗しました</p>"}},escapeHtml(e){if(!e)return"";const n=document.createElement("div");return n.textContent=e,n.innerHTML},trackLocationPageView(e,n){"function"==typeof gtag&&gtag("event","view_location_page",{prefecture:e,job_count:n,page_location:window.location.href,page_title:document.title})},initMobileMenu(){const e=document.querySelector(".mobile-menu-btn");if(!e)return;if(document.querySelector(".mobile-nav"))return;const n=document.createElement("nav");n.className="mobile-nav",n.innerHTML='\n      <ul>\n        <li><a href="/#jobs">お仕事紹介</a></li>\n        <li><a href="/#content">コンテンツ</a></li>\n        <li><a href="/#about">当サイトについて</a></li>\n        <li><a href="/#contact">お問い合わせ</a></li>\n        <li><a href="admin.html">管理者</a></li>\n      </ul>\n    ',document.querySelector(".header").after(n),e.addEventListener("click",function(){this.classList.toggle("active"),n.classList.toggle("active")}),n.querySelectorAll("a").forEach(t=>{t.addEventListener("click",()=>{e.classList.remove("active"),n.classList.remove("active")})})}};document.addEventListener("DOMContentLoaded",()=>{LocationPage.init()});