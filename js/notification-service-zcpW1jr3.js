import{l as t}from"./firestore-service-w4Tpcz9T.js";const a="announcements",e="notifications";async function i(e="all"){const i=await t(),n=new Date;try{const t=await i.collection(a).where("status","==","published").get(),c=[];return t.forEach(t=>{const a=t.data(),i=o(a.publishStartDate),r=o(a.publishEndDate);i&&i<=n&&r&&r>=n&&("all"!==e&&"all"!==a.targetAudience&&a.targetAudience!==e||c.push({id:t.id,...a,publishStartDate:i,publishEndDate:r,createdAt:o(a.createdAt),updatedAt:o(a.updatedAt)}))}),c.sort((t,a)=>(t.priority||0)-(a.priority||0)),c}catch(c){return console.error("[NotificationService] Error:",c),[]}}async function n(){const e=await t();return(await e.collection(a).orderBy("createdAt","desc").get()).docs.map(t=>{var a,e,i,n;const o=t.data();return{id:t.id,...o,publishStartDate:(null==(a=o.publishStartDate)?void 0:a.toDate)?o.publishStartDate.toDate():o.publishStartDate,publishEndDate:(null==(e=o.publishEndDate)?void 0:e.toDate)?o.publishEndDate.toDate():o.publishEndDate,createdAt:(null==(i=o.createdAt)?void 0:i.toDate)?o.createdAt.toDate():o.createdAt,updatedAt:(null==(n=o.updatedAt)?void 0:n.toDate)?o.updatedAt.toDate():o.updatedAt}})}function o(t){return t?t instanceof Date?t:"string"==typeof t?new Date(t):t.toDate?t.toDate():new Date(t):null}async function c(e){const i=await t(),n=new Date,c={title:e.title||"",content:e.content||"",targetAudience:e.targetAudience||"all",publishStartDate:o(e.publishStartDate)||n,publishEndDate:o(e.publishEndDate)||new Date(n.getTime()+2592e6),status:e.status||"draft",priority:e.priority||0,createdAt:n,updatedAt:n,createdBy:e.createdBy||""};return(await i.collection(a).add(c)).id}async function r(e,i){const n=await t(),o={...i,updatedAt:new Date};"string"==typeof o.publishStartDate&&(o.publishStartDate=new Date(o.publishStartDate)),"string"==typeof o.publishEndDate&&(o.publishEndDate=new Date(o.publishEndDate)),await n.collection(a).doc(e).update(o)}async function d(e){const i=await t();await i.collection(a).doc(e).delete()}async function l(a=null){const i=await t();let n=i.collection(e).where("type","==","application").orderBy("createdAt","desc").limit(50);a&&(n=i.collection(e).where("type","==","application").where("companyDomain","==",a).orderBy("createdAt","desc").limit(50));return(await n.get()).docs.map(t=>{var a;const e=t.data();return{id:t.id,...e,createdAt:(null==(a=e.createdAt)?void 0:a.toDate)?e.createdAt.toDate():e.createdAt}})}async function s(a){const i=await t(),n={type:"application",companyDomain:a.companyDomain||"",applicationId:a.applicationId||"",jobId:a.jobId||"",jobTitle:a.jobTitle||"",applicantName:a.applicantName||"",applicantEmail:a.applicantEmail||"",createdAt:new Date,isRead:!1};return(await i.collection(e).add(n)).id}async function p(a){const i=await t();await i.collection(e).doc(a).update({isRead:!0})}async function u(a){const i=await t(),n=i.batch();(await i.collection(e).where("type","==","application").where("companyDomain","==",a).where("isRead","==",!1).get()).docs.forEach(t=>{n.update(t.ref,{isRead:!0})}),await n.commit()}async function D(a,i){const n=await t();let o=n.collection(e).where("type","==","application").orderBy("createdAt","desc").limit(50);a&&(o=n.collection(e).where("type","==","application").where("companyDomain","==",a).orderBy("createdAt","desc").limit(50));return o.onSnapshot(t=>{const a=t.docs.map(t=>{var a;const e=t.data();return{id:t.id,...e,createdAt:(null==(a=e.createdAt)?void 0:a.toDate)?e.createdAt.toDate():e.createdAt}});i(a)},t=>{console.error("[NotificationService] Listener error:",t)})}export{c as a,i as b,s as c,d,l as e,u as f,n as g,p as m,D as s,r as u};
