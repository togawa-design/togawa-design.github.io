const JobDetailPage={async init(){const n=Utils.getUrlParam("company"),i=Utils.getUrlParam("job");if(n&&i){Utils.showLoading("job-detail-container","求人情報を読み込んでいます...");try{await Utils.waitForJobsLoader();const l=await JobsLoader.fetchCompanies();if(!l)return void Utils.showError("job-detail-container","データの取得に失敗しました。");const e=l.find(i=>i.companyDomain&&i.companyDomain.trim()===n);if(!e)return void Utils.showError("job-detail-container","会社が見つかりませんでした。");let t=null;if(e.jobsSheet&&e.jobsSheet.trim()){const n=await JobsLoader.fetchCompanyJobs(e.jobsSheet.trim());n&&(t=n.find(n=>String(n.id)===String(i)),t&&(t.company=e.company,t.companyDomain=e.companyDomain))}if(!t)return void Utils.showError("job-detail-container","求人が見つかりませんでした。");this.renderJobDetail(t),this.updateBreadcrumb(t),this.updateSEO(t),this.renderRelatedJobsAsync(l,n,i),Utils.trackEvent("view_job_detail",{company:t.company,job_title:t.title,location:t.location})}catch(n){console.error("求人詳細の取得エラー:",n),Utils.showError("job-detail-container","データの取得に失敗しました。しばらくしてから再度お試しください。")}}else Utils.showError("job-detail-container","求人が見つかりませんでした。")},async renderRelatedJobsAsync(n,i,l){try{const e=[];for(const l of n)if(JobsLoader.isCompanyVisible(l)&&l.companyDomain!==i){if(l.jobsSheet&&l.jobsSheet.trim()){const n=await JobsLoader.fetchCompanyJobs(l.jobsSheet.trim());n&&n.length>0&&(n.forEach(n=>{n.company=l.company,n.companyDomain=l.companyDomain}),e.push(...n.slice(0,2)))}if(e.length>=6)break}this.renderRelatedJobs(e.slice(0,6),i,l)}catch(n){console.error("関連求人の取得エラー:",n)}},renderJobDetail(n){const i=document.getElementById("job-detail-container");if(!i)return;const l=Array.isArray(n.features)?n.features:[];i.innerHTML=`\n      <div class="lp-container">\n        \x3c!-- ヒーローセクション --\x3e\n        <section class="lp-hero-section">\n          <div class="lp-hero-bg"></div>\n          <div class="lp-hero-inner">\n            <p class="lp-hero-label">${Utils.escapeHtml(n.company)}</p>\n            <h1 class="lp-hero-title">${Utils.escapeHtml(n.title)}</h1>\n            <div class="lp-hero-meta">\n              <span class="lp-hero-location">\n                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>\n                ${Utils.escapeHtml(n.location)}\n              </span>\n            </div>\n            <a href="#apply-section" class="lp-hero-cta">今すぐ応募する</a>\n          </div>\n        </section>\n\n        \x3c!-- ポイントセクション --\x3e\n        <section class="lp-points-section">\n          <div class="lp-section-inner">\n            <h2 class="lp-section-heading">この求人のポイント</h2>\n            <div class="lp-points-grid">\n              ${n.totalBonus?`\n              <div class="lp-point-card accent">\n                <div class="lp-point-icon">\n                  <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>\n                </div>\n                <div class="lp-point-content">\n                  <span class="lp-point-label">特典総額</span>\n                  <span class="lp-point-value">${Utils.escapeHtml(n.totalBonus)}</span>\n                </div>\n              </div>\n              `:""}\n              ${n.monthlySalary?`\n              <div class="lp-point-card">\n                <div class="lp-point-icon">\n                  <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>\n                </div>\n                <div class="lp-point-content">\n                  <span class="lp-point-label">月収例</span>\n                  <span class="lp-point-value">${Utils.escapeHtml(n.monthlySalary)}</span>\n                </div>\n              </div>\n              `:""}\n              ${n.employmentType?`\n              <div class="lp-point-card">\n                <div class="lp-point-icon">\n                  <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg>\n                </div>\n                <div class="lp-point-content">\n                  <span class="lp-point-label">雇用形態</span>\n                  <span class="lp-point-value">${Utils.escapeHtml(n.employmentType)}</span>\n                </div>\n              </div>\n              `:""}\n            </div>\n            ${l.length>0?`\n            <div class="lp-tags">\n              ${l.map(n=>`<span class="lp-tag">${Utils.escapeHtml(n)}</span>`).join("")}\n            </div>\n            `:""}\n          </div>\n        </section>\n\n        \x3c!-- 募集要項セクション --\x3e\n        <section class="lp-details-section">\n          <div class="lp-section-inner">\n            <h2 class="lp-section-heading">募集要項</h2>\n            <div class="lp-details-table">\n              ${n.jobDescription?`\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">仕事内容</div>\n                <div class="lp-detail-value">${Utils.nl2br(n.jobDescription)}</div>\n              </div>\n              `:""}\n              ${n.salary?`\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">給与</div>\n                <div class="lp-detail-value">${Utils.nl2br(n.salary)}</div>\n              </div>\n              `:""}\n              ${n.requirements?`\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">応募資格</div>\n                <div class="lp-detail-value">${Utils.nl2br(n.requirements)}</div>\n              </div>\n              `:""}\n              ${n.workingHours?`\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">勤務時間</div>\n                <div class="lp-detail-value">${Utils.nl2br(n.workingHours)}</div>\n              </div>\n              `:""}\n              ${n.holidays?`\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">休日・休暇</div>\n                <div class="lp-detail-value">${Utils.nl2br(n.holidays)}</div>\n              </div>\n              `:""}\n              ${n.benefits?`\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">待遇・福利厚生</div>\n                <div class="lp-detail-value">${Utils.nl2br(n.benefits)}</div>\n              </div>\n              `:""}\n              <div class="lp-detail-row">\n                <div class="lp-detail-label">勤務地</div>\n                <div class="lp-detail-value">${Utils.escapeHtml(n.location)}</div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        \x3c!-- 応募セクション --\x3e\n        <section class="lp-apply-section" id="apply-section">\n          <div class="lp-section-inner">\n            <h2 class="lp-apply-heading">まずはお気軽にご応募ください</h2>\n            <p class="lp-apply-text">経験・学歴不問！あなたのご応募をお待ちしています。</p>\n            <div class="lp-apply-buttons">\n              <a href="#" class="lp-apply-btn primary">この求人に応募する</a>\n              <a href="company.html?id=${Utils.escapeHtml(n.companyDomain)}" class="lp-apply-btn secondary">${Utils.escapeHtml(n.company)}の企業情報を見る</a>\n            </div>\n          </div>\n        </section>\n      </div>\n    `},updateBreadcrumb(n){const i=document.getElementById("breadcrumb-company");i&&(i.innerHTML=`<a href="company.html?id=${encodeURIComponent(n.companyDomain)}">${Utils.escapeHtml(n.company)}</a>`);const l=document.getElementById("breadcrumb-current");l&&(l.textContent=n.title)},updateSEO(n){document.title=`${n.title} | ${n.company} | リクエコ求人ナビ`;const i=document.querySelector('meta[name="description"]');i&&(i.content=`${n.company}の${n.title}。${n.location}勤務。${n.totalBonus?"特典総額"+n.totalBonus+"。":""}`)},renderRelatedJobs(n,i,l){const e=document.getElementById("related-jobs-container");if(!e)return;const t=n.filter(n=>!(n.companyDomain===i&&String(n.id)===String(l))).slice(0,6);0!==t.length?e.innerHTML=t.map(n=>JobsLoader.renderJobCard(n)).join(""):e.innerHTML='<p class="no-data">関連する求人がありません。</p>'}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>JobDetailPage.init(),0)}):setTimeout(()=>JobDetailPage.init(),0);