const t="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",e="会社一覧",n="Stats",s="images/default-job.svg",o=()=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${e}`,r=()=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${n}`;function a(t){const e=[];let n="",s=!1;for(let o=0;o<t.length;o++){const r=t[o];'"'===r?s&&'"'===t[o+1]?(n+='"',o++):s=!s:","!==r||s?n+=r:(e.push(n.trim()),n="")}return e.push(n.trim()),e}function i(t){const e={id:"id",ID:"id","会社名":"company",company:"company","タイトル":"title",title:"title","勤務地":"location",location:"companyAddress","特典総額":"totalBonus",totalBonus:"totalBonus","月収例":"monthlySalary",monthlySalary:"monthlySalary","特徴":"features",features:"features","バッジ":"badges",badges:"badges","画像URL":"imageUrl",imageUrl:"imageUrl","詳細URL":"detailUrl",detailUrl:"detailUrl","表示":"visible",visible:"visible","表示する":"showCompany","並び順":"order",order:"order","会社ドメイン":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","会社住所":"companyAddress",companyAddress:"companyAddress","説明":"description",description:"description","お仕事内容":"jobContent",jobContent:"jobContent","仕事内容":"jobDescription",jobDescription:"jobDescription","応募資格":"requirements",requirements:"requirements","待遇":"benefits",benefits:"benefits","勤務時間":"workingHours",workingHours:"workingHours","休日":"holidays",holidays:"holidays","デザインパターン":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","パターン":"designPattern",pattern:"designPattern","管理シート":"jobsSheet",jobsSheet:"jobsSheet",jobs_sheet:"jobsSheet","掲載開始日":"publishStartDate",publishStartDate:"publishStartDate",publish_start_date:"publishStartDate","掲載終了日":"publishEndDate",publishEndDate:"publishEndDate",publish_end_date:"publishEndDate","職種名":"jobType",jobType:"jobType",job_type:"jobType","給与":"salary",salary:"salary","雇用形態":"employmentType",employmentType:"employmentType",employment_type:"employmentType","資格・スキル":"skills",skills:"skills","資格":"skills","スキル":"skills","検索タグ":"tags",tags:"tags"},n=t.replace(/"/g,"").trim();if(e[n])return e[n];const s=n.split(/\s+/);return s.length>1&&e[s[0]]?e[s[0]]:s[0]||n}function c(t,e=0,n=1){const s=t.split("\n"),o=a(s[e]||""),r=[];for(let c=n;c<s.length;c++){if(!s[c].trim())continue;const t=a(s[c]),e={};o.forEach((n,s)=>{const o=i(n);e[o]=t[s]||""}),e.features?e.features=e.features.split(",").map(t=>t.trim()).filter(t=>t):e.features=[],e.tags?(e.tags=e.tags.split(",").map(t=>t.trim()).filter(t=>t),e.features=[...new Set([...e.features,...e.tags])]):e.tags=[],r.push(e)}return r}function l(t){const e=t.match(/\/spreadsheets\/d\/([a-zA-Z0-9_-]+)/);return e?e[1]:/^[a-zA-Z0-9_-]+$/.test(t)?t:null}async function u(){try{const t=await fetch(o());if(!t.ok)throw new Error("会社一覧の取得に失敗しました");return c(await t.text())}catch(t){return console.error("会社一覧の取得エラー:",t),null}}async function p(t){if(!t)return null;try{const e=l(t.trim());if(!e)return null;const n=`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv`,s=await fetch(n);if(!s.ok)throw new Error("求人データの取得に失敗しました");return c(await s.text(),0,2)}catch(e){return console.error("求人データの取得エラー:",e),null}}function m(t){return!(!t.jobsSheet||!t.jobsSheet.trim())&&("○"===t.showCompany||"◯"===t.showCompany)}function d(t){if(!t)return null;const e=t.trim().replace(/\//g,"-"),n=new Date(e);return isNaN(n.getTime())?null:(n.setHours(0,0,0,0),n)}function h(t){const e=new Date;if(e.setHours(0,0,0,0),t.publishStartDate&&t.publishStartDate.trim()){const n=d(t.publishStartDate);if(n&&e<n)return!1}if(t.publishEndDate&&t.publishEndDate.trim()){const n=d(t.publishEndDate);if(n&&e>n)return!1}return!0}function f(t){let e=0,n="";return t.forEach(t=>{if(!t.monthlySalary)return;const s=t.monthlySalary;let o=0;const r=s.match(/(\d+(?:\.\d+)?)\s*万/);if(r)o=1e4*parseFloat(r[1]);else{const t=s.match(/(\d{1,3}(?:,\d{3})*)\s*円/);if(t)o=parseInt(t[1].replace(/,/g,""));else{const t=s.match(/[¥￥]\s*(\d{1,3}(?:,\d{3})*|\d+)/);if(t)o=parseInt(t[1].replace(/,/g,""));else{const t=s.match(/(\d{1,3}(?:,\d{3})*|\d+)/);t&&(o=parseInt(t[1].replace(/,/g,"")))}}}o>e&&(e=o,n=s)}),n}async function y(){const t=await u();if(!t)return[];const e=[];for(const n of t){if(!m(n))continue;const t=await p(n.jobsSheet);t&&t.forEach(t=>{t.company=n.company,t.companyDomain=n.companyDomain,e.push(t)})}return e}async function b(){const t=await y(),e={};return t.forEach(t=>{const n=t.companyAddress||t.location;if(!n)return;const s=n.match(/^(.+?[都道府県])/),o=s?s[1]:n;e[o]||(e[o]={prefecture:o,jobs:[],count:0}),e[o].jobs.push(t),e[o].count++}),Object.values(e).sort((t,e)=>e.count-t.count)}async function g(t){return(await y()).filter(e=>{const n=e.companyAddress||e.location;return n&&n.includes(t)})}async function D(){try{const t=await fetch(r());if(!t.ok)throw new Error("実績データの取得に失敗しました");return function(t){const e=t.split("\n"),n={};for(let s=1;s<e.length;s++){if(!e[s].trim())continue;const t=a(e[s]),o=t[0]?t[0].replace(/"/g,"").trim():"",r=t[1]?t[1].replace(/"/g,"").trim():"",i=t[2]?t[2].replace(/"/g,"").trim():"";o&&(n[o]={value:r,label:i})}return n}(await t.text())}catch(t){return console.error("実績データの取得エラー:",t),null}}function S(t){const e=t?t.toLowerCase().trim():"";return["modern","classic","minimal","colorful"].includes(e)?`pattern-${e}`:""}const w={SHEET_ID:t,SHEET_NAME:e,STATS_SHEET_NAME:n,DEFAULT_IMAGE:s,get csvUrl(){return o()},get statsUrl(){return r()},getSheetUrl:e=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(e)}`,parseCSVLine:a,normalizeHeader:i,parseCSV:c,extractSpreadsheetId:l,fetchCompanies:u,fetchCompanyJobs:p,fetchJobs:u,isCompanyVisible:m,parseDate:d,isJobInPublishPeriod:h,getDetailUrl:function(t){return t.companyDomain&&t.companyDomain.trim()?`company.html?id=${encodeURIComponent(t.companyDomain.trim())}`:t.detailUrl||"#"},getMaxMonthlySalary:f,fetchAllJobs:y,getLocationList:b,getJobsByLocation:g,fetchStats:D,getDesignPatternClass:S,escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeHtml(t){if(!t||"<br>"===t||"<div><br></div>"===t)return"";const e=["b","strong","i","em","u","ul","ol","li","br","div","p"],n=document.createElement("div");n.innerHTML=t;return n.querySelectorAll("*").forEach(t=>{if(e.includes(t.tagName.toLowerCase()))for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);else t.replaceWith(...t.childNodes)}),n.innerHTML}};"undefined"!=typeof window&&(window.JobsLoader=w);export{s as D,w as J,p as a,h as b,b as c,S as d,g as e,u as f,f as g,D as h,m as i};
