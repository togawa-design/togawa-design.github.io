const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/firestore-service-qEqRY9xZ.js","js/env-config-Bna8zKOp.js"])))=>i.map(i=>d[i]);
const t={},e=function(e,n,o){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),o=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(n.map(e=>{if((e=function(t){return"/"+t}(e))in t)return;t[e]=!0;const n=e.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=n?"stylesheet":"modulepreload",n||(a.as="script"),a.crossOrigin="",a.href=e,o&&a.setAttribute("nonce",o),document.head.appendChild(a),n?new Promise((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};let n=null,o=null;async function r(){return o||(o=(async()=>{try{n=await e(()=>import("./firestore-service-qEqRY9xZ.js").then(t=>t.p),__vite__mapDeps([0,1])),n.initFirestore()}catch(t){console.warn("[JobsLoader] Firestore初期化スキップ:",t.message)}})(),o)}async function a(){o&&await o}const s="images/default-job.svg",i=3e5,c={companies:{data:null,timestamp:0},jobs:new Map};function u(t){const e=[];let n="",o=!1;for(let r=0;r<t.length;r++){const a=t[r];'"'===a?o&&'"'===t[r+1]?(n+='"',r++):o=!o:","!==a||o?n+=a:(e.push(n.trim()),n="")}return e.push(n.trim()),e}async function l(){await a();const t=Date.now();if(c.companies.data&&t-c.companies.timestamp<i)return c.companies.data;try{if(!n)throw new Error("Firestoreが初期化されていません");const e=await n.getCompanies();if(!e.success)throw new Error(e.error||"Firestoreから会社一覧の取得に失敗");const o=e.companies.map(t=>({id:t.companyDomain,company:t.company,description:t.description||"",jobDescription:t.jobDescription||"",workingHours:t.workingHours||"",companyAddress:t.companyAddress||"",workLocation:t.workLocation||"",designPattern:t.designPattern||"",imageUrl:t.imageUrl||t.logoUrl||"",order:t.order||0,showCompany:t.showCompany?"○":"",companyDomain:t.companyDomain,jobsSheet:t.companyDomain}));return c.companies.data=o,c.companies.timestamp=t,o}catch(e){return console.error("会社一覧の取得エラー:",e),c.companies.data||null}}async function m(t){if(!t)return null;await a();const e=Date.now(),o=t.trim(),r=c.jobs.get(o);if(r&&e-r.timestamp<i)return r.data;try{if(!n)throw new Error("Firestoreが初期化されていません");const t=await n.getJobs(o);if(!t.success)throw new Error(t.error||"Firestoreから求人の取得に失敗");const r=t.jobs;return c.jobs.set(o,{data:r,timestamp:e}),r}catch(s){return console.error("求人データの取得エラー:",s),(null==r?void 0:r.data)||null}}function p(t){return!(!t.jobsSheet||!t.jobsSheet.trim())&&("○"===t.showCompany||"◯"===t.showCompany)}function d(t){if(!t)return null;const e=t.trim().replace(/\//g,"-"),n=new Date(e);return isNaN(n.getTime())?null:(n.setHours(0,0,0,0),n)}function f(t){const e=new Date;if(e.setHours(0,0,0,0),t.publishStartDate&&t.publishStartDate.trim()){const n=d(t.publishStartDate);if(n&&e<n)return!1}if(t.publishEndDate&&t.publishEndDate.trim()){const n=d(t.publishEndDate);if(n&&e>n)return!1}return!0}function y(t){let e=0,n="";return t.forEach(t=>{if(!t.monthlySalary)return;const o=String(t.monthlySalary);let r=0;const a=o.match(/(\d+(?:\.\d+)?)\s*万/);if(a)r=1e4*parseFloat(a[1]);else{const t=o.match(/(\d{1,3}(?:,\d{3})*)\s*円/);if(t)r=parseInt(t[1].replace(/,/g,""));else{const t=o.match(/[¥￥]\s*(\d{1,3}(?:,\d{3})*|\d+)/);if(t)r=parseInt(t[1].replace(/,/g,""));else{const t=o.match(/(\d{1,3}(?:,\d{3})*|\d+)/);t&&(r=parseInt(t[1].replace(/,/g,"")))}}}r>e&&(e=r,n=o)}),n}async function h(){const t=await l();if(!t)return[];const e=[];for(const n of t){if(!p(n))continue;const t=n.companyDomain;if(!t)continue;const o=await m(t);o&&o.forEach(t=>{t.company=n.company,t.companyDomain=n.companyDomain,e.push(t)})}return e}async function w(){const t=await h(),e={};return t.forEach(t=>{const n=t.companyAddress||t.location;if(!n)return;const o=n.match(/^(.+?[都道府県])/),r=o?o[1]:n;e[r]||(e[r]={prefecture:r,jobs:[],count:0}),e[r].jobs.push(t),e[r].count++}),Object.values(e).sort((t,e)=>e.count-t.count)}async function b(t){return(await h()).filter(e=>{const n=e.companyAddress||e.location;return n&&n.includes(t)})}async function g(){const t=await h(),e={};return t.forEach(t=>{var n;const o=null==(n=t.jobType)?void 0:n.trim();o&&(e[o]||(e[o]={jobType:o,count:0}),e[o].count++)}),Object.values(e).sort((t,e)=>e.count-t.count)}async function D(t){const e=await h(),n=t.toLowerCase();return e.filter(t=>[t.title,t.company,t.jobContent,t.jobDescription,t.description,t.benefits,t.requirements,t.companyAddress,t.location,t.jobType,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(n)))}async function E(t){const e=await h(),n=t.toLowerCase();return e.filter(t=>[t.title,t.jobType,t.jobContent,t.jobDescription,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(n)))}async function j(){const t="jobStats";try{const e=localStorage.getItem(t);if(e){const{data:t,timestamp:n}=JSON.parse(e);if(Date.now()-n<18e5)return t}if(!n)throw new Error("Firestoreが初期化されていません");const o=await n.getJobStats();if(!o.success)throw new Error(o.error||"Firestoreから統計取得に失敗");const r=o.stats;return localStorage.setItem(t,JSON.stringify({data:r,timestamp:Date.now()})),r}catch(e){return console.error("求人統計の取得エラー:",e),null}}function v(t){const e=t?t.toLowerCase().trim():"";return["modern","classic","minimal","colorful"].includes(e)?`pattern-${e}`:""}const S={DEFAULT_IMAGE:s,fetchCompanies:l,fetchCompanyJobs:m,fetchJobs:l,isCompanyVisible:p,parseDate:d,isJobInPublishPeriod:f,getDetailUrl:function(t){return t.companyDomain&&t.companyDomain.trim()?`company.html?id=${encodeURIComponent(t.companyDomain.trim())}`:t.detailUrl||"#"},getMaxMonthlySalary:y,fetchAllJobs:h,getLocationList:w,getJobTypeList:g,getJobsByLocation:b,getJobsByKeyword:D,getJobsByOccupation:E,fetchJobStats:j,getDesignPatternClass:v,initFirestoreLoader:r,escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeHtml(t){if(!t||"<br>"===t||"<div><br></div>"===t)return"";const e=["b","strong","i","em","u","ul","ol","li","br","div","p"],n=document.createElement("div");n.innerHTML=t;return n.querySelectorAll("*").forEach(t=>{if(e.includes(t.tagName.toLowerCase()))for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);else t.replaceWith(...t.childNodes)}),n.innerHTML}};"undefined"!=typeof window&&(window.JobsLoader=S);export{s as D,S as J,e as _,h as a,p as b,E as c,f as d,m as e,l as f,D as g,y as h,r as i,w as j,v as k,b as l,j as m,g as n,u as p};
