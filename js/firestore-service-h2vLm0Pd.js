import{f as e,a as t,c as r,g as o}from"./env-config-Cl-TLAgM.js";const s={ADMIN:"admin",COMPANY:"company"},i={credentials:{username:"admin",password:"receco2025"},sessionKey:"rikueco_admin_session",userRoleKey:"rikueco_user_role",userCompanyKey:"rikueco_user_company",gaPropertyId:o.propertyId,gaApiKey:o.apiKey,apiEndpoint:t.analytics,cloudFunctionsBaseUrl:r,legacyLoginUrl:t.legacyLogin,firebaseConfig:e};function n(e){return{standard:"スタンダード",modern:"モダン",classic:"クラシック",minimal:"ミニマル",colorful:"カラフル"}[e]||"スタンダード"}const a=[{id:"teamwork-1",name:"チームミーティング",url:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=400&q=60"},{id:"teamwork-2",name:"オフィスワーク",url:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400&q=60"},{id:"teamwork-3",name:"コラボレーション",url:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=400&q=60"},{id:"teamwork-4",name:"ビジネス握手",url:"https://images.unsplash.com/photo-1521791136064-7986c2920216?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521791136064-7986c2920216?w=400&q=60"},{id:"teamwork-5",name:"ワークショップ",url:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=400&q=60"},{id:"work-1",name:"作業風景",url:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&q=60"},{id:"work-2",name:"倉庫作業",url:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=400&q=60"},{id:"work-3",name:"建設現場",url:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=400&q=60"},{id:"work-4",name:"技術職",url:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=400&q=60"},{id:"work-5",name:"チームワーク",url:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=400&q=60"}];let c=null,l=null,u=null;function d(){return c||("undefined"!=typeof window&&window.firebase?(l=window.firebase,l.apps.length||l.initializeApp(i.firebaseConfig),c=l.firestore(),c):(console.warn("[FirestoreService] Firebase not loaded"),null))}async function m(){return c||(u||(u=(async()=>{try{return l=await function(e=5e3){return new Promise((t,r)=>{if("undefined"!=typeof window&&window.firebase)return void t(window.firebase);const o=Date.now(),s=()=>{"undefined"!=typeof window&&window.firebase?t(window.firebase):Date.now()-o>=e?r(new Error("Firebase SDK load timeout")):setTimeout(s,50)};s()})}(),l.apps.length||l.initializeApp(i.firebaseConfig),c=l.firestore(),console.log("[FirestoreService] Firestore initialized successfully"),c}catch(e){throw console.error("[FirestoreService] Firebase initialization error:",e),u=null,e}})(),u))}function p(){return c||d(),c}async function g(){return c||await m(),c}async function h(){const e=await g();if(!e)throw new Error("Firestore not initialized");try{const t=await e.collection("companies").orderBy("order","asc").get(),r=[];return t.forEach(e=>{r.push({id:e.id,companyDomain:e.id,...e.data()})}),{success:!0,companies:r}}catch(t){return console.error("[FirestoreService] getCompanies error:",t),{success:!1,error:t.message}}}async function w(e){const t=await g();if(!t)throw new Error("Firestore not initialized");try{const r=await t.collection("companies").doc(e).get();return r.exists?{success:!0,company:{id:r.id,companyDomain:r.id,...r.data()}}:{success:!1,error:"会社が見つかりません"}}catch(r){return console.error("[FirestoreService] getCompany error:",r),{success:!1,error:r.message}}}async function f(e,t){const r=await g();if(!r)throw new Error("Firestore not initialized");try{const o=r.collection("companies").doc(e),s=!(await o.get()).exists,i={...t,updatedAt:l.firestore.FieldValue.serverTimestamp()};return s&&(i.createdAt=l.firestore.FieldValue.serverTimestamp()),await o.set(i,{merge:!0}),{success:!0,message:s?"会社を作成しました":"会社情報を更新しました",companyDomain:e}}catch(o){return console.error("[FirestoreService] saveCompany error:",o),{success:!1,error:o.message}}}async function y(e){const t=await g();if(!t)throw new Error("Firestore not initialized");try{const r=t.batch();(await t.collection("companies").doc(e).collection("jobs").get()).forEach(e=>r.delete(e.ref));(await t.collection("companies").doc(e).collection("lpSettings").get()).forEach(e=>r.delete(e.ref));return(await t.collection("companies").doc(e).collection("recruitSettings").get()).forEach(e=>r.delete(e.ref)),r.delete(t.collection("companies").doc(e)),await r.commit(),{success:!0,message:"会社を削除しました"}}catch(r){return console.error("[FirestoreService] deleteCompany error:",r),{success:!1,error:r.message}}}async function b(e){const t=await g();if(!t)throw new Error("Firestore not initialized");try{const r=await t.collection("companies").doc(e).collection("jobs").orderBy("order","asc").get(),o=[];let s=3;return r.forEach(e=>{o.push({...e.data(),_rowIndex:s,_docId:e.id}),s++}),{success:!0,jobs:o}}catch(r){return console.error("[FirestoreService] getJobs error:",r),{success:!1,error:r.message,jobs:[]}}}async function S(e,t){const r=await g();if(!r)throw new Error("Firestore not initialized");try{const o=await r.collection("companies").doc(e).collection("jobs").doc(String(t)).get();return o.exists?{success:!0,job:{...o.data(),_docId:o.id}}:{success:!1,error:"求人が見つかりません"}}catch(o){return console.error("[FirestoreService] getJob error:",o),{success:!1,error:o.message}}}async function F(e,t,r=null){const o=await g();if(!o)throw new Error("Firestore not initialized");try{const s=o.collection("companies").doc(e).collection("jobs");let i,n,a=!1;if(r)i=s.doc(String(r)),n=r;else if(t.id){i=s.doc(String(t.id));a=!(await i.get()).exists,n=t.id}else{const e=await s.orderBy("id","desc").limit(1).get();let t=0;e.forEach(e=>{const r=parseInt(e.data().id)||0;r>t&&(t=r)}),n=t+1,i=s.doc(String(n)),a=!0}const c={...t,id:String(n),updatedAt:l.firestore.FieldValue.serverTimestamp()};return a&&(c.createdAt=l.firestore.FieldValue.serverTimestamp()),delete c._rowIndex,delete c._docId,await i.set(c,{merge:!0}),{success:!0,message:a?"求人を作成しました":"求人情報を更新しました",jobId:n,rowIndex:null}}catch(s){return console.error("[FirestoreService] saveJob error:",s),{success:!1,error:s.message}}}async function v(e,t){const r=await g();if(!r)throw new Error("Firestore not initialized");try{return await r.collection("companies").doc(e).collection("jobs").doc(String(t)).delete(),{success:!0,message:"求人を削除しました"}}catch(o){return console.error("[FirestoreService] deleteJob error:",o),{success:!1,error:o.message}}}async function E(e,t="default"){const r=await g();if(!r)throw new Error("Firestore not initialized");try{const o=await r.collection("companies").doc(e).collection("lpSettings").doc(String(t)).get();return o.exists?{success:!0,settings:o.data()}:{success:!0,settings:{}}}catch(o){return console.error("[FirestoreService] getLPSettings error:",o),{success:!1,error:o.message}}}async function q(e,t,r){const o=await g();if(!o)throw new Error("Firestore not initialized");try{const s=o.collection("companies").doc(e).collection("lpSettings").doc(String(t||"default")),i={...r,companyDomain:e,jobId:String(t||"default"),updatedAt:l.firestore.FieldValue.serverTimestamp()};return await s.set(i,{merge:!0}),{success:!0,message:"LP設定を保存しました"}}catch(s){return console.error("[FirestoreService] saveLPSettings error:",s),{success:!1,error:s.message}}}async function j(e){const t=await g();if(!t)throw new Error("Firestore not initialized");try{const r=await t.collection("companies").doc(e).collection("recruitSettings").doc("main").get();return r.exists?{success:!0,settings:r.data()}:{success:!0,settings:{}}}catch(r){return console.error("[FirestoreService] getRecruitSettings error:",r),{success:!1,error:r.message}}}async function z(e,t){const r=await g();if(!r)throw new Error("Firestore not initialized");try{const o=r.collection("companies").doc(e).collection("recruitSettings").doc("main"),s={...t,companyDomain:e,updatedAt:l.firestore.FieldValue.serverTimestamp()};return await o.set(s,{merge:!0}),{success:!0,message:"採用ページ設定を保存しました"}}catch(o){return console.error("[FirestoreService] saveRecruitSettings error:",o),{success:!1,error:o.message}}}async function A(){const e=await g();if(!e)throw new Error("Firestore not initialized");try{const t=await e.collectionGroup("jobs").where("visible","==",!0).orderBy("order","asc").get(),r=[];return t.forEach(e=>{const t=e.ref.path.split("/")[1];r.push({...e.data(),companyDomain:t,_docId:e.id})}),{success:!0,jobs:r}}catch(t){return console.error("[FirestoreService] getAllVisibleJobs error:",t),{success:!1,error:t.message,jobs:[]}}}async function C(){if(!(await g()))throw new Error("Firestore not initialized");try{const e=await A();if(!e.success)return e;const t=e.jobs;let r=0,o=0;t.forEach(e=>{const t=function(e){if(!e)return 0;const t=String(e).replace(/[,，]/g,""),r=t.match(/(\d+(?:\.\d+)?)\s*万/);if(r)return 1e4*parseFloat(r[1]);const o=t.match(/[\d,]+/);if(o)return parseInt(o[0].replace(/,/g,""))||0;return 0}(e.monthlySalary);t>0&&(r+=t,o++)});const s=o>0?Math.round(r/o):0,i=s>0?Math.round(s/160):0;return{success:!0,stats:{jobCount:t.length,avgMonthlySalary:s,avgHourlyWage:i,updatedAt:(new Date).toISOString()}}}catch(e){return console.error("[FirestoreService] getJobStats error:",e),{success:!1,error:e.message}}}const J={initFirestore:d,initFirestoreAsync:m,getFirestore:p,getFirestoreAsync:g,getCompanies:h,getCompany:w,saveCompany:f,deleteCompany:y,getJobs:b,getJob:S,saveJob:F,deleteJob:v,getLPSettings:E,saveLPSettings:q,getRecruitSettings:j,saveRecruitSettings:z,getAllVisibleJobs:A,getJobStats:C},_=Object.freeze(Object.defineProperty({__proto__:null,default:J,deleteCompany:y,deleteJob:v,getAllVisibleJobs:A,getCompanies:h,getCompany:w,getFirestore:p,getFirestoreAsync:g,getJob:S,getJobStats:C,getJobs:b,getLPSettings:E,getRecruitSettings:j,initFirestore:d,initFirestoreAsync:m,saveCompany:f,saveJob:F,saveLPSettings:q,saveRecruitSettings:z},Symbol.toStringTag,{value:"Module"}));export{s as U,b as a,n as b,i as c,v as d,q as e,w as f,E as g,f as h,d as i,y as j,z as k,h as l,a as m,j as n,_ as o,F as s};
