const JobsLoader={SHEET_ID:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",SHEET_NAME:"Sheet1",STATS_SHEET_NAME:"Stats",DEFAULT_IMAGE:"images/default-job.svg",get csvUrl(){return`https://docs.google.com/spreadsheets/d/${this.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${this.SHEET_NAME}`},get statsUrl(){return`https://docs.google.com/spreadsheets/d/${this.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${this.STATS_SHEET_NAME}`},async fetchJobs(){try{const n=await fetch(this.csvUrl);if(!n.ok)throw new Error("データの取得に失敗しました");const e=await n.text();return this.parseCSV(e)}catch(n){return console.error("求人データの取得エラー:",n),null}},parseCSV(n){const e=n.split("\n"),t=this.parseCSVLine(e[0]),a=[];for(let n=1;n<e.length;n++){if(!e[n].trim())continue;const s=this.parseCSVLine(e[n]),i={};t.forEach((n,e)=>{const t=this.normalizeHeader(n);i[t]=s[e]||""}),i.features&&(i.features=i.features.split(",").map(n=>n.trim()).filter(n=>n)),a.push(i)}return a},parseCSVLine(n){const e=[];let t="",a=!1;for(let s=0;s<n.length;s++){const i=n[s];'"'===i?a&&'"'===n[s+1]?(t+='"',s++):a=!a:","!==i||a?t+=i:(e.push(t.trim()),t="")}return e.push(t.trim()),e},normalizeHeader:n=>({id:"id",ID:"id","会社名":"company",company:"company","タイトル":"title",title:"title","勤務地":"location",location:"location","特典総額":"totalBonus",totalBonus:"totalBonus","月収例":"monthlySalary",monthlySalary:"monthlySalary","特徴":"features",features:"features","バッジ":"badges",badges:"badges","画像URL":"imageUrl",imageUrl:"imageUrl","詳細URL":"detailUrl",detailUrl:"detailUrl","表示":"visible",visible:"visible","並び順":"order",order:"order","会社ドメイン":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","説明":"description",description:"description","仕事内容":"jobDescription",jobDescription:"jobDescription","応募資格":"requirements",requirements:"requirements","待遇":"benefits",benefits:"benefits","勤務時間":"workingHours",workingHours:"workingHours","休日":"holidays",holidays:"holidays","デザインパターン":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","パターン":"designPattern",pattern:"designPattern"}[n.replace(/"/g,"").trim()]||n.replace(/"/g,"").trim()),renderJobCard(n){const e=n.badges?n.badges.split(",").map(n=>n.trim()):[],t=Array.isArray(n.features)?n.features:[];let a="";(e.includes("NEW")||e.includes("new"))&&(a+='<span class="job-badge new">NEW</span>'),(e.includes("人気")||e.includes("hot"))&&(a+='<span class="job-badge hot">人気</span>');const s=t.map(n=>`<li>${this.escapeHtml(n)}</li>`).join(""),i=n.imageUrl&&n.imageUrl.trim()?n.imageUrl:this.DEFAULT_IMAGE,o=`<img src="${this.escapeHtml(i)}" alt="${this.escapeHtml(n.company)}" onerror="this.parentElement.innerHTML='<div class=\\'job-image-placeholder\\'>${this.escapeHtml(n.company)}</div>'">`;return`\n      <article class="job-card" data-job-id="${this.escapeHtml(n.id||"")}">\n        ${a?`<div class="job-card-header">${a}</div>`:""}\n        <div class="job-card-image">\n          ${o}\n        </div>\n        <div class="job-card-body">\n          <h3 class="job-title">${this.escapeHtml(n.title)}</h3>\n          <p class="job-location">${this.escapeHtml(n.location)}</p>\n          <div class="job-benefits">\n            <div class="benefit-item highlight">\n              <span class="benefit-label">特典総額</span>\n              <span class="benefit-value">${this.escapeHtml(n.totalBonus)}</span>\n            </div>\n            <div class="benefit-item">\n              <span class="benefit-label">月収例</span>\n              <span class="benefit-value">${this.escapeHtml(n.monthlySalary)}</span>\n            </div>\n          </div>\n          ${s?`<ul class="job-features">${s}</ul>`:""}\n          <a href="${this.getDetailUrl(n)}" class="btn-apply">詳細を見る</a>\n        </div>\n      </article>\n    `},escapeHtml(n){if(!n)return"";const e=document.createElement("div");return e.textContent=n,e.innerHTML},getDetailUrl(n){return n.companyDomain&&n.companyDomain.trim()?`company.html?id=${encodeURIComponent(n.companyDomain.trim())}`:this.escapeHtml(n.detailUrl||"#")},getCompanyDomainFromUrl:()=>new URLSearchParams(window.location.search).get("id"),async renderJobDetail(){const n=document.getElementById("job-detail-container");if(!n)return;const e=this.getCompanyDomainFromUrl();if(!e)return void(n.innerHTML='\n        <div class="jobs-error">\n          <p>求人が見つかりませんでした。</p>\n          <a href="/" class="btn-more">トップページに戻る</a>\n        </div>\n      ');const t=await this.fetchJobs();if(!t)return void(n.innerHTML='\n        <div class="jobs-error">\n          <p>求人情報を取得できませんでした。</p>\n          <button onclick="JobsLoader.renderJobDetail()">再読み込み</button>\n        </div>\n      ');const a=t.filter(n=>n.companyDomain&&n.companyDomain.trim()===e&&"false"!==n.visible&&"FALSE"!==n.visible).sort((n,e)=>(parseInt(n.order)||999)-(parseInt(e.order)||999));if(0===a.length)return void(n.innerHTML='\n        <div class="jobs-error">\n          <p>求人が見つかりませんでした。</p>\n          <a href="/" class="btn-more">トップページに戻る</a>\n        </div>\n      ');const s=a[0];document.title=`${s.company}の求人一覧 | リクエコ求人ナビ`;const i=document.querySelector('meta[name="description"]');i&&(i.content=`${s.company}の期間工・期間従業員求人一覧。${a.length}件の求人を掲載中。`);const o=document.getElementById("breadcrumb-current");o&&(o.textContent=s.company),n.innerHTML=this.renderCompanyPageContent(s,a),this.trackCompanyPageView(s),this.setupApplyTracking(),this.renderRelatedJobs(t,e)},getDesignPatternClass(n){const e=n?n.toLowerCase().trim():"";return["modern","classic","minimal","colorful"].includes(e)?`pattern-${e}`:""},renderCompanyPageContent(n,e){const t=n.imageUrl&&n.imageUrl.trim()?n.imageUrl:this.DEFAULT_IMAGE;return`\n      <div class="company-page ${this.getDesignPatternClass(n.designPattern)}">\n        <div class="company-header">\n          <div class="company-header-image">\n            <img src="${this.escapeHtml(t)}" alt="${this.escapeHtml(n.company)}" onerror="this.style.display='none'">\n          </div>\n          <div class="company-header-info">\n            <h1 class="company-name">${this.escapeHtml(n.company)}</h1>\n            <p class="company-job-count">${e.length}件の求人を掲載中</p>\n          </div>\n        </div>\n\n        ${n.description?`\n        <div class="company-description">\n          <h2>会社について</h2>\n          <p>${this.escapeHtml(n.description).replace(/\n/g,"<br>")}</p>\n        </div>\n        `:""}\n\n        <div class="company-jobs">\n          <h2>募集中の求人</h2>\n          <div class="company-jobs-list">\n            ${e.map(n=>this.renderCompanyJobCard(n)).join("")}\n          </div>\n        </div>\n\n        <div class="company-cta">\n          <p>お仕事選びでお困りですか？</p>\n          <div class="company-cta-buttons">\n            <a href="#" class="btn-apply-large">無料で相談する</a>\n            <a href="#" class="btn-line-large">LINEで相談する</a>\n          </div>\n        </div>\n      </div>\n    `},renderCompanyJobCard(n){const e=n.badges?n.badges.split(",").map(n=>n.trim()):[],t=Array.isArray(n.features)?n.features:[];let a="";return(e.includes("NEW")||e.includes("new"))&&(a+='<span class="job-badge new">NEW</span>'),(e.includes("人気")||e.includes("hot"))&&(a+='<span class="job-badge hot">人気</span>'),`\n      <div class="company-job-card">\n        <div class="company-job-card-header">\n          ${a}\n          <h3 class="company-job-title">${this.escapeHtml(n.title)}</h3>\n          <p class="company-job-location">${this.escapeHtml(n.location)}</p>\n        </div>\n        <div class="company-job-card-body">\n          <div class="company-job-benefits">\n            <div class="company-job-benefit highlight">\n              <span class="label">特典総額</span>\n              <span class="value">${this.escapeHtml(n.totalBonus)}</span>\n            </div>\n            <div class="company-job-benefit">\n              <span class="label">月収例</span>\n              <span class="value">${this.escapeHtml(n.monthlySalary)}</span>\n            </div>\n          </div>\n          ${t.length>0?`\n          <ul class="company-job-features">\n            ${t.map(n=>`<li>${this.escapeHtml(n)}</li>`).join("")}\n          </ul>\n          `:""}\n\n          ${n.jobDescription?`\n          <div class="company-job-description">\n            <h4>仕事内容</h4>\n            <p>${this.escapeHtml(n.jobDescription).replace(/\n/g,"<br>")}</p>\n          </div>\n          `:""}\n\n          ${n.requirements?`\n          <div class="company-job-description">\n            <h4>応募資格</h4>\n            <p>${this.escapeHtml(n.requirements).replace(/\n/g,"<br>")}</p>\n          </div>\n          `:""}\n\n          ${n.benefits?`\n          <div class="company-job-description">\n            <h4>待遇・福利厚生</h4>\n            <p>${this.escapeHtml(n.benefits).replace(/\n/g,"<br>")}</p>\n          </div>\n          `:""}\n\n          ${n.workingHours?`\n          <div class="company-job-description">\n            <h4>勤務時間</h4>\n            <p>${this.escapeHtml(n.workingHours).replace(/\n/g,"<br>")}</p>\n          </div>\n          `:""}\n\n          ${n.holidays?`\n          <div class="company-job-description">\n            <h4>休日・休暇</h4>\n            <p>${this.escapeHtml(n.holidays).replace(/\n/g,"<br>")}</p>\n          </div>\n          `:""}\n\n          <a href="#" class="btn-apply-job">この求人に応募する</a>\n        </div>\n      </div>\n    `},async renderRelatedJobs(n,e){const t=document.getElementById("related-jobs-container");if(!t)return;const a=n.filter(n=>n.companyDomain!==e&&"false"!==n.visible&&"FALSE"!==n.visible).sort((n,e)=>(parseInt(n.order)||999)-(parseInt(e.order)||999)).slice(0,3);0!==a.length?t.innerHTML=a.map(n=>this.renderJobCard(n)).join(""):t.innerHTML="<p>他の求人がありません。</p>"},async renderJobs(n="jobs-container"){const e=document.getElementById(n);if(!e)return void console.error(`Container #${n} not found`);e.innerHTML='\n      <div class="jobs-loading">\n        <div class="loading-spinner"></div>\n        <p>求人情報を読み込んでいます...</p>\n      </div>\n    ';const t=await this.fetchJobs();if(!t||0===t.length)return void(e.innerHTML=`\n        <div class="jobs-error">\n          <p>求人情報を取得できませんでした。</p>\n          <button onclick="JobsLoader.renderJobs('${n}')">再読み込み</button>\n        </div>\n      `);const a=t.filter(n=>"false"!==n.visible&&"FALSE"!==n.visible).sort((n,e)=>(parseInt(n.order)||999)-(parseInt(e.order)||999));e.innerHTML=a.map(n=>this.renderJobCard(n)).join("")},async fetchStats(){try{const n=await fetch(this.statsUrl);if(!n.ok)throw new Error("実績データの取得に失敗しました");const e=await n.text();return this.parseStatsCSV(e)}catch(n){return console.error("実績データの取得エラー:",n),null}},parseStatsCSV(n){const e=n.split("\n"),t={};for(let n=1;n<e.length;n++){if(!e[n].trim())continue;const a=this.parseCSVLine(e[n]),s=a[0]?a[0].replace(/"/g,"").trim():"",i=a[1]?a[1].replace(/"/g,"").trim():"",o=a[2]?a[2].replace(/"/g,"").trim():"";s&&(t[s]={value:i,label:o})}return t},async renderStats(){const n=await this.fetchStats();if(!n)return;const e=document.querySelector(".hero-stats");if(!e)return;const t=Object.keys(n).map(e=>{const t=n[e];return`\n        <div class="stat-item">\n          <span class="stat-number">${this.escapeHtml(t.value)}</span>\n          <span class="stat-label">${this.escapeHtml(t.label)}</span>\n        </div>\n      `}).join("");e.innerHTML=t},trackEvent(n,e={}){"function"==typeof gtag&&gtag("event",n,e),"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||console.log("[Analytics]",n,e)},trackCompanyPageView(n){this.trackEvent("view_company_page",{company_domain:n.companyDomain||"",company_name:n.company||"",design_pattern:n.designPattern||"standard",page_location:window.location.href,page_title:document.title})},trackJobView(n){this.trackEvent("view_job",{job_id:n.id||"",job_title:n.title||"",company_domain:n.companyDomain||"",company_name:n.company||"",location:n.location||""})},trackApplyClick(n,e="apply"){this.trackEvent("click_apply",{job_id:n.id||"",job_title:n.title||"",company_domain:n.companyDomain||"",company_name:n.company||"",button_type:e,location:n.location||""})},trackJobCardClick(n){this.trackEvent("click_job_card",{job_id:n.id||"",job_title:n.title||"",company_domain:n.companyDomain||"",company_name:n.company||"",source_page:window.location.pathname})},setupApplyTracking(){document.querySelectorAll(".btn-apply-job, .btn-apply-large").forEach(n=>{n.addEventListener("click",n=>{const e=this.getCompanyDomainFromUrl();this.trackApplyClick({companyDomain:e},"apply")})}),document.querySelectorAll(".btn-line-large").forEach(n=>{n.addEventListener("click",n=>{const e=this.getCompanyDomainFromUrl();this.trackApplyClick({companyDomain:e},"line")})})}};document.addEventListener("DOMContentLoaded",()=>{document.getElementById("job-detail-container")&&JobsLoader.renderJobDetail(),document.getElementById("jobs-container")&&JobsLoader.renderJobs(),document.querySelector(".hero-stats")&&JobsLoader.renderStats()});