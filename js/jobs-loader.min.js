const JobsLoader={SHEET_ID:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",SHEET_NAME:"Sheet1",STATS_SHEET_NAME:"Stats",DEFAULT_IMAGE:"images/default-job.svg",get csvUrl(){return`https://docs.google.com/spreadsheets/d/${this.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${this.SHEET_NAME}`},get statsUrl(){return`https://docs.google.com/spreadsheets/d/${this.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${this.STATS_SHEET_NAME}`},async fetchJobs(){try{const e=await fetch(this.csvUrl);if(!e.ok)throw new Error("データの取得に失敗しました");const t=await e.text();return this.parseCSV(t)}catch(e){return console.error("求人データの取得エラー:",e),null}},parseCSV(e){const t=e.split("\n"),s=this.parseCSVLine(t[0]),n=[];for(let e=1;e<t.length;e++){if(!t[e].trim())continue;const a=this.parseCSVLine(t[e]),r={};s.forEach((e,t)=>{const s=this.normalizeHeader(e);r[s]=a[t]||""}),r.features&&(r.features=r.features.split(",").map(e=>e.trim()).filter(e=>e)),n.push(r)}return n},parseCSVLine(e){const t=[];let s="",n=!1;for(let a=0;a<e.length;a++){const r=e[a];'"'===r?n&&'"'===e[a+1]?(s+='"',a++):n=!n:","!==r||n?s+=r:(t.push(s.trim()),s="")}return t.push(s.trim()),t},normalizeHeader:e=>({id:"id",ID:"id","会社名":"company",company:"company","タイトル":"title",title:"title","勤務地":"location",location:"location","特典総額":"totalBonus",totalBonus:"totalBonus","月収例":"monthlySalary",monthlySalary:"monthlySalary","特徴":"features",features:"features","バッジ":"badges",badges:"badges","画像URL":"imageUrl",imageUrl:"imageUrl","詳細URL":"detailUrl",detailUrl:"detailUrl","表示":"visible",visible:"visible","並び順":"order",order:"order"}[e.replace(/"/g,"").trim()]||e.replace(/"/g,"").trim()),renderJobCard(e){const t=e.badges?e.badges.split(",").map(e=>e.trim()):[],s=Array.isArray(e.features)?e.features:[];let n="";(t.includes("NEW")||t.includes("new"))&&(n+='<span class="job-badge new">NEW</span>'),(t.includes("人気")||t.includes("hot"))&&(n+='<span class="job-badge hot">人気</span>');const a=s.map(e=>`<li>${this.escapeHtml(e)}</li>`).join(""),r=e.imageUrl&&e.imageUrl.trim()?e.imageUrl:this.DEFAULT_IMAGE,i=`<img src="${this.escapeHtml(r)}" alt="${this.escapeHtml(e.company)}" onerror="this.parentElement.innerHTML='<div class=\\'job-image-placeholder\\'>${this.escapeHtml(e.company)}</div>'">`;return`\n      <article class="job-card" data-job-id="${this.escapeHtml(e.id||"")}">\n        ${n?`<div class="job-card-header">${n}</div>`:""}\n        <div class="job-card-image">\n          ${i}\n        </div>\n        <div class="job-card-body">\n          <h3 class="job-title">${this.escapeHtml(e.title)}</h3>\n          <p class="job-location">${this.escapeHtml(e.location)}</p>\n          <div class="job-benefits">\n            <div class="benefit-item highlight">\n              <span class="benefit-label">特典総額</span>\n              <span class="benefit-value">${this.escapeHtml(e.totalBonus)}</span>\n            </div>\n            <div class="benefit-item">\n              <span class="benefit-label">月収例</span>\n              <span class="benefit-value">${this.escapeHtml(e.monthlySalary)}</span>\n            </div>\n          </div>\n          ${a?`<ul class="job-features">${a}</ul>`:""}\n          <a href="${this.escapeHtml(e.detailUrl||"#")}" class="btn-apply">詳細を見る</a>\n        </div>\n      </article>\n    `},escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML},async renderJobs(e="jobs-container"){const t=document.getElementById(e);if(!t)return void console.error(`Container #${e} not found`);t.innerHTML='\n      <div class="jobs-loading">\n        <div class="loading-spinner"></div>\n        <p>求人情報を読み込んでいます...</p>\n      </div>\n    ';const s=await this.fetchJobs();if(!s||0===s.length)return void(t.innerHTML=`\n        <div class="jobs-error">\n          <p>求人情報を取得できませんでした。</p>\n          <button onclick="JobsLoader.renderJobs('${e}')">再読み込み</button>\n        </div>\n      `);const n=s.filter(e=>"false"!==e.visible&&"FALSE"!==e.visible).sort((e,t)=>(parseInt(e.order)||999)-(parseInt(t.order)||999));t.innerHTML=n.map(e=>this.renderJobCard(e)).join("")},async fetchStats(){try{const e=await fetch(this.statsUrl);if(!e.ok)throw new Error("実績データの取得に失敗しました");const t=await e.text();return this.parseStatsCSV(t)}catch(e){return console.error("実績データの取得エラー:",e),null}},parseStatsCSV(e){const t=e.split("\n"),s={};for(let e=1;e<t.length;e++){if(!t[e].trim())continue;const n=this.parseCSVLine(t[e]),a=n[0]?n[0].replace(/"/g,"").trim():"",r=n[1]?n[1].replace(/"/g,"").trim():"",i=n[2]?n[2].replace(/"/g,"").trim():"";a&&(s[a]={value:r,label:i})}return s},async renderStats(){const e=await this.fetchStats();if(!e)return;const t=document.querySelector(".hero-stats");if(!t)return;const s=Object.keys(e).map(t=>{const s=e[t];return`\n        <div class="stat-item">\n          <span class="stat-number">${this.escapeHtml(s.value)}</span>\n          <span class="stat-label">${this.escapeHtml(s.label)}</span>\n        </div>\n      `}).join("");t.innerHTML=s}};document.addEventListener("DOMContentLoaded",()=>{document.getElementById("jobs-container")&&JobsLoader.renderJobs(),document.querySelector(".hero-stats")&&JobsLoader.renderStats()});