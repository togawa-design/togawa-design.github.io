const JobsPage={async init(){const e=document.getElementById("jobs-page-container");e&&(await this.renderAllJobs(e),await this.renderLocationsList(),this.initMobileMenu())},async renderAllJobs(e){try{const n=await JobsLoader.fetchCompanies();if(!n||0===n.length)return void(e.innerHTML='\n          <div class="jobs-page-header">\n            <h1 class="jobs-page-title">求人している会社一覧</h1>\n            <p class="jobs-page-description">現在、掲載中の求人はありません</p>\n          </div>\n          <div class="jobs-error">\n            <p>求人情報が見つかりませんでした。</p>\n            <a href="/" class="btn-more">トップページに戻る</a>\n          </div>\n        ');const a=n.filter(e=>JobsLoader.isCompanyVisible(e)).sort((e,n)=>(parseInt(e.order)||999)-(parseInt(n.order)||999));if(0===a.length)return void(e.innerHTML='\n          <div class="jobs-page-header">\n            <h1 class="jobs-page-title">求人している会社一覧</h1>\n            <p class="jobs-page-description">現在、掲載中の求人はありません</p>\n          </div>\n          <div class="jobs-error">\n            <p>求人情報が見つかりませんでした。</p>\n            <a href="/" class="btn-more">トップページに戻る</a>\n          </div>\n        ');const t=await Promise.all(a.map(async e=>{if(e._displayTotalBonus="",e._displayMonthlySalary=e.monthlySalary||"",e.jobsSheet&&e.jobsSheet.trim()){const n=await JobsLoader.fetchCompanyJobs(e.jobsSheet.trim());if(n&&n.length>0){const a=n.filter(e=>"false"!==e.visible&&"FALSE"!==e.visible).filter(e=>JobsLoader.isJobInPublishPeriod(e)).sort((e,n)=>(parseInt(e.order)||999)-(parseInt(n.order)||999));if(a.length>0){const n=a[0];e._displayTotalBonus=n.totalBonus||"";const t=JobsLoader.getMaxMonthlySalary(a);t&&(e._displayMonthlySalary=t)}}}return e}));e.innerHTML=`\n        <div class="jobs-page-header">\n          <h1 class="jobs-page-title">求人している会社一覧</h1>\n          <p class="jobs-page-description">${t.length}社の会社が見つかりました</p>\n        </div>\n        <div class="jobs-grid jobs-page-grid">\n          ${t.map(e=>this.renderJobCard(e)).join("")}\n        </div>\n      `,this.trackJobsPageView(t.length)}catch(n){console.error("求人の取得エラー:",n),e.innerHTML='\n        <div class="jobs-error">\n          <p>データの取得に失敗しました。</p>\n          <button onclick="location.reload()">再読み込み</button>\n        </div>\n      '}},renderJobCard(e){const n=e.badges?e.badges.split(",").map(e=>e.trim()):[],a=Array.isArray(e.features)?e.features:[];let t="";(n.includes("NEW")||n.includes("new"))&&(t+='<span class="job-badge new">NEW</span>'),(n.includes("急募")||n.includes("URGENT"))&&(t+='<span class="job-badge urgent">急募</span>');const s=a.map(e=>`<li>${this.escapeHtml(e)}</li>`).join(""),i=e.imageUrl&&e.imageUrl.trim()?e.imageUrl:JobsLoader.DEFAULT_IMAGE,o=`<img src="${this.escapeHtml(i)}" alt="${this.escapeHtml(e.company)}" onerror="this.parentElement.innerHTML='<div class=\\'job-image-placeholder\\'>${this.escapeHtml(e.company)}</div>'">`,l=e._displayTotalBonus||e.totalBonus||"",r=e._displayMonthlySalary||e.monthlySalary||"",c=l?`\n            <div class="benefit-item highlight">\n              <span class="benefit-label">特典総額</span>\n              <span class="benefit-value">${this.escapeHtml(l)}</span>\n            </div>`:"";return`\n      <article class="job-card" data-job-id="${this.escapeHtml(e.id||"")}">\n        ${t?`<div class="job-card-header">${t}</div>`:""}\n        <div class="job-card-image">\n          ${o}\n        </div>\n        <div class="job-card-body">\n          <h3 class="job-title">${this.escapeHtml(e.title)}</h3>\n          <p class="job-location">${this.escapeHtml(e.location)}</p>\n          <div class="job-benefits">${c}\n            <div class="benefit-item">\n              <span class="benefit-label">月収例</span>\n              <span class="benefit-value">${this.escapeHtml(r)}</span>\n            </div>\n          </div>\n          ${s?`<ul class="job-features">${s}</ul>`:""}\n          <a href="${JobsLoader.getDetailUrl(e)}" class="btn-apply">詳細を見る</a>\n        </div>\n      </article>\n    `},async renderLocationsList(){const e=document.getElementById("jobs-locations-container");if(e)try{const n=await JobsLoader.getLocationList();if(!n||0===n.length)return void(document.getElementById("jobs-locations").style.display="none");const a=n.slice(0,8);e.innerHTML=`\n        <div class="other-locations-grid">\n          ${a.map(e=>`\n            <a href="location.html?prefecture=${encodeURIComponent(e.prefecture)}" class="other-location-card">\n              <span class="other-location-name">${e.prefecture}</span>\n              <span class="other-location-count">${e.count}件の求人</span>\n            </a>\n          `).join("")}\n        </div>\n        <div class="other-locations-more">\n          <a href="location.html" class="btn-more">すべてのエリアを見る</a>\n        </div>\n      `}catch(n){console.error("勤務地リストの取得エラー:",n),e.innerHTML="<p>データの取得に失敗しました</p>"}},escapeHtml(e){if(!e)return"";const n=document.createElement("div");return n.textContent=e,n.innerHTML},trackJobsPageView(e){"function"==typeof gtag&&gtag("event","view_jobs_page",{job_count:e,page_location:window.location.href,page_title:document.title})},initMobileMenu(){const e=document.querySelector(".mobile-menu-btn");if(!e)return;if(document.querySelector(".mobile-nav"))return;const n=document.createElement("nav");n.className="mobile-nav",n.innerHTML='\n      <ul>\n        <li><a href="/#jobs">お仕事紹介</a></li>\n        <li><a href="/#content">コンテンツ</a></li>\n        <li><a href="/#about">当サイトについて</a></li>\n        <li><a href="/#contact">お問い合わせ</a></li>\n        <li><a href="admin.html">管理者</a></li>\n      </ul>\n    ',document.querySelector(".header").after(n),e.addEventListener("click",function(){this.classList.toggle("active"),n.classList.toggle("active")}),n.querySelectorAll("a").forEach(a=>{a.addEventListener("click",()=>{e.classList.remove("active"),n.classList.remove("active")})})}};document.addEventListener("DOMContentLoaded",()=>{JobsPage.init()});