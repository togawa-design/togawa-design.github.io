const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/firestore-service-CkqluxkX.js","js/config-pr2r6KvW.js"])))=>i.map(i=>d[i]);
const t={},e=function(e,o,n){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(o.map(e=>{if((e=function(t){return"/kikanko/"+t}(e))in t)return;t[e]=!0;const o=e.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const s=document.createElement("link");return s.rel=o?"stylesheet":"modulepreload",o||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),o?new Promise((t,o)=>{s.addEventListener("load",t),s.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})};let o=null,n=!1;async function r(){try{const t=await e(()=>import("./config-pr2r6KvW.js"),[]);n=t.useFirestore,n&&(o=await e(()=>import("./firestore-service-CkqluxkX.js"),__vite__mapDeps([0,1])),o.initFirestore())}catch(t){console.warn("[JobsLoader] Firestore初期化スキップ:",t.message),n=!1}}const s="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",a="会社一覧",i="Stats",c="images/default-job.svg",l="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec",u=3e5,m={companies:{data:null,timestamp:0},jobs:new Map},p=()=>`https://docs.google.com/spreadsheets/d/${s}/gviz/tq?tqx=out:csv&sheet=${a}`,d=()=>`https://docs.google.com/spreadsheets/d/${s}/gviz/tq?tqx=out:csv&sheet=${i}`;function h(t){const e=[];let o="",n=!1;for(let r=0;r<t.length;r++){const s=t[r];'"'===s?n&&'"'===t[r+1]?(o+='"',r++):n=!n:","!==s||n?o+=s:(e.push(o.trim()),o="")}return e.push(o.trim()),e}function f(t){const e={id:"id",ID:"id","求人ID":"jobId",jobId:"jobId",job_id:"jobId","会社名":"company",company:"company","タイトル":"title",title:"title","勤務地":"location",location:"location","特典総額":"totalBonus",totalBonus:"totalBonus","月収例":"monthlySalary",monthlySalary:"monthlySalary","特徴":"features",features:"features","バッジ":"badges",badges:"badges","画像URL":"imageUrl",imageUrl:"imageUrl","詳細URL":"detailUrl",detailUrl:"detailUrl","表示":"visible",visible:"visible","表示する":"showCompany","並び順":"order",order:"order","会社ドメイン":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","会社住所":"companyAddress",companyAddress:"companyAddress","説明":"description",description:"description","お仕事内容":"jobContent",jobContent:"jobContent","仕事内容":"jobDescription",jobDescription:"jobDescription","応募資格":"requirements",requirements:"requirements","待遇":"benefits",benefits:"benefits","勤務時間":"workingHours",workingHours:"workingHours","休日":"holidays",holidays:"holidays","デザインパターン":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","パターン":"designPattern",pattern:"designPattern","管理シート":"jobsSheet",jobsSheet:"jobsSheet",jobs_sheet:"jobsSheet","管理シートURL":"manageSheetUrl",manageSheetUrl:"manageSheetUrl","求人管理シートURL":"manageSheetUrl","掲載開始日":"publishStartDate",publishStartDate:"publishStartDate",publish_start_date:"publishStartDate","掲載終了日":"publishEndDate",publishEndDate:"publishEndDate",publish_end_date:"publishEndDate","職種名":"jobType","職種":"jobType",jobType:"jobType",job_type:"jobType","給与":"salary",salary:"salary","雇用形態":"employmentType",employmentType:"employmentType",employment_type:"employmentType","資格・スキル":"skills",skills:"skills","資格":"skills","スキル":"skills","検索タグ":"tags",tags:"tags","メモ":"memo",memo:"memo","動画URL":"videoUrl",videoUrl:"videoUrl",video_url:"videoUrl","動画表示":"showVideoButton",showVideoButton:"showVideoButton",show_video_button:"showVideoButton"},o=t.replace(/"/g,"").trim();if(e[o])return e[o];const n=o.split(/\s+/);return n.length>1&&e[n[0]]?e[n[0]]:n[0]||o}function y(t,e=0,o=1){const n=function(t){const e=[];let o="",n=!1;for(let r=0;r<t.length;r++){const s=t[r];if('"'===s)n&&'"'===t[r+1]?(o+='""',r++):(n=!n,o+=s);else if("\n"!==s||n){if("\r"===s)continue;o+=s}else e.push(o),o=""}return o&&e.push(o),e}(t),r=h(n[e]||""),s=[];for(let a=o;a<n.length;a++){if(!n[a].trim())continue;const t=h(n[a]),e={};r.forEach((o,n)=>{const r=f(o);e[r]=t[n]||""}),e.features?e.features=e.features.split(",").map(t=>t.trim()).filter(t=>t):e.features=[],e.tags?(e.tags=e.tags.split(",").map(t=>t.trim()).filter(t=>t),e.features=[...new Set([...e.features,...e.tags])]):e.tags=[],s.push(e)}return s}function b(t){const e=t.match(/\/spreadsheets\/d\/([a-zA-Z0-9_-]+)/);return e?e[1]:/^[a-zA-Z0-9_-]+$/.test(t)?t:null}async function g(){const t=Date.now();if(m.companies.data&&t-m.companies.timestamp<u)return m.companies.data;try{let e;if(n&&o){const t=await o.getCompanies();if(!t.success)throw new Error(t.error||"Firestoreから会社一覧の取得に失敗");console.log("[JobsLoader] Firestore companies raw data:",t.companies),e=t.companies.map(t=>({id:t.companyDomain,company:t.company,description:t.description||"",jobDescription:t.jobDescription||"",workingHours:t.workingHours||"",companyAddress:t.companyAddress||"",workLocation:t.workLocation||"",designPattern:t.designPattern||"",imageUrl:t.imageUrl||t.logoUrl||"",order:t.order||0,showCompany:t.showCompany?"○":"",companyDomain:t.companyDomain,jobsSheet:t.manageSheetUrl||t.companyDomain}))}else{const t=await fetch(p());if(!t.ok)throw new Error("会社一覧の取得に失敗しました");e=y(await t.text())}return m.companies.data=e,m.companies.timestamp=t,e}catch(e){return console.error("会社一覧の取得エラー:",e),m.companies.data||null}}async function w(t){var e;if(!t)return null;const r=Date.now(),s=t.trim(),a=m.jobs.get(s);if(a&&r-a.timestamp<u)return a.data;try{let a;if(n&&o&&!t.includes("spreadsheets")){const e=t.trim(),n=await o.getJobs(e);if(!n.success)throw new Error(n.error||"Firestoreから求人の取得に失敗");a=n.jobs}else{const o=b(t.trim());if(!o)return null;const n=`https://docs.google.com/spreadsheets/d/${o}/gviz/tq?tqx=out:csv`,r=await fetch(n);if(!r.ok)throw new Error("求人データの取得に失敗しました");const s=await r.text(),i=(null==(e=s.split("\n")[0])?void 0:e.split(",")[0])||"",c=i.includes(" ")&&!i.startsWith('"管理');a=y(s,0,c?1:2)}return m.jobs.set(s,{data:a,timestamp:r}),a}catch(i){return console.error("求人データの取得エラー:",i),(null==a?void 0:a.data)||null}}function S(t){return!(!t.jobsSheet||!t.jobsSheet.trim())&&("○"===t.showCompany||"◯"===t.showCompany)}function D(t){if(!t)return null;const e=t.trim().replace(/\//g,"-"),o=new Date(e);return isNaN(o.getTime())?null:(o.setHours(0,0,0,0),o)}function j(t){const e=new Date;if(e.setHours(0,0,0,0),t.publishStartDate&&t.publishStartDate.trim()){const o=D(t.publishStartDate);if(o&&e<o)return!1}if(t.publishEndDate&&t.publishEndDate.trim()){const o=D(t.publishEndDate);if(o&&e>o)return!1}return!0}function v(t){let e=0,o="";return t.forEach(t=>{if(!t.monthlySalary)return;const n=String(t.monthlySalary);let r=0;const s=n.match(/(\d+(?:\.\d+)?)\s*万/);if(s)r=1e4*parseFloat(s[1]);else{const t=n.match(/(\d{1,3}(?:,\d{3})*)\s*円/);if(t)r=parseInt(t[1].replace(/,/g,""));else{const t=n.match(/[¥￥]\s*(\d{1,3}(?:,\d{3})*|\d+)/);if(t)r=parseInt(t[1].replace(/,/g,""));else{const t=n.match(/(\d{1,3}(?:,\d{3})*|\d+)/);t&&(r=parseInt(t[1].replace(/,/g,"")))}}}r>e&&(e=r,o=n)}),o}async function E(){var t;const e=await g();if(!e)return[];const o=[];for(const r of e){if(!S(r))continue;const e=n&&r.companyDomain?r.companyDomain:null==(t=r.jobsSheet)?void 0:t.trim();if(!e)continue;const s=await w(e);s&&s.forEach(t=>{t.company=r.company,t.companyDomain=r.companyDomain,o.push(t)})}return o}async function U(){const t=await E(),e={};return t.forEach(t=>{const o=t.companyAddress||t.location;if(!o)return;const n=o.match(/^(.+?[都道府県])/),r=n?n[1]:o;e[r]||(e[r]={prefecture:r,jobs:[],count:0}),e[r].jobs.push(t),e[r].count++}),Object.values(e).sort((t,e)=>e.count-t.count)}async function _(t){return(await E()).filter(e=>{const o=e.companyAddress||e.location;return o&&o.includes(t)})}async function L(){const t=await E(),e={};return t.forEach(t=>{var o;const n=null==(o=t.jobType)?void 0:o.trim();n&&(e[n]||(e[n]={jobType:n,count:0}),e[n].count++)}),Object.values(e).sort((t,e)=>e.count-t.count)}async function C(t){const e=await E(),o=t.toLowerCase();return e.filter(t=>[t.title,t.company,t.jobContent,t.jobDescription,t.description,t.benefits,t.requirements,t.companyAddress,t.location,t.jobType,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(o)))}async function T(t){const e=await E(),o=t.toLowerCase();return e.filter(t=>[t.title,t.jobType,t.jobContent,t.jobDescription,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(o)))}async function A(){const t="jobStats";try{const e=localStorage.getItem(t);if(e){const{data:t,timestamp:o}=JSON.parse(e);if(Date.now()-o<18e5)return t}let r;if(n&&o){const t=await o.getJobStats();if(!t.success)throw new Error(t.error||"Firestoreから統計取得に失敗");r=t.stats}else{const t=await fetch(`${l}?action=getJobStats`);if(!t.ok)throw new Error("求人統計の取得に失敗しました");const e=await t.json();if(!e.success)throw new Error(e.error||"求人統計の取得に失敗しました");r=e.stats}return localStorage.setItem(t,JSON.stringify({data:r,timestamp:Date.now()})),r}catch(e){return console.error("求人統計の取得エラー:",e),null}}function k(t){const e=t?t.toLowerCase().trim():"";return["modern","classic","minimal","colorful"].includes(e)?`pattern-${e}`:""}const I={SHEET_ID:s,SHEET_NAME:a,STATS_SHEET_NAME:i,DEFAULT_IMAGE:c,GAS_API_URL:l,get csvUrl(){return p()},get statsUrl(){return d()},getSheetUrl:t=>`https://docs.google.com/spreadsheets/d/${s}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(t)}`,parseCSVLine:h,normalizeHeader:f,parseCSV:y,extractSpreadsheetId:b,fetchCompanies:g,fetchCompanyJobs:w,fetchJobs:g,isCompanyVisible:S,parseDate:D,isJobInPublishPeriod:j,getDetailUrl:function(t){return t.companyDomain&&t.companyDomain.trim()?`company.html?id=${encodeURIComponent(t.companyDomain.trim())}`:t.detailUrl||"#"},getMaxMonthlySalary:v,fetchAllJobs:E,getLocationList:U,getJobTypeList:L,getJobsByLocation:_,getJobsByKeyword:C,getJobsByOccupation:T,fetchStats:async function(){try{const t=await fetch(d());if(!t.ok)throw new Error("実績データの取得に失敗しました");return function(t){const e=t.split("\n"),o={};for(let n=1;n<e.length;n++){if(!e[n].trim())continue;const t=h(e[n]),r=t[0]?t[0].replace(/"/g,"").trim():"",s=t[1]?t[1].replace(/"/g,"").trim():"",a=t[2]?t[2].replace(/"/g,"").trim():"";r&&(o[r]={value:s,label:a})}return o}(await t.text())}catch(t){return console.error("実績データの取得エラー:",t),null}},fetchJobStats:A,getDesignPatternClass:k,escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeHtml(t){if(!t||"<br>"===t||"<div><br></div>"===t)return"";const e=["b","strong","i","em","u","ul","ol","li","br","div","p"],o=document.createElement("div");o.innerHTML=t;return o.querySelectorAll("*").forEach(t=>{if(e.includes(t.tagName.toLowerCase()))for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);else t.replaceWith(...t.childNodes)}),o.innerHTML}};"undefined"!=typeof window&&(window.JobsLoader=I);export{c as D,I as J,e as _,E as a,S as b,T as c,j as d,w as e,g as f,C as g,v as h,r as i,U as j,k,_ as l,A as m,L as n,h as p};
