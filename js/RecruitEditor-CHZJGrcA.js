import{escapeHtml as e,showToast as t}from"./utils-BB91om2o.js";import{s as n}from"./modal-gG-182nw.js";import{s as i,e as s,f as a}from"./image-uploader-D-bYLO1j.js";import{e as o,o as l,q as d}from"./core-DPPhibhC.js";import{s as r}from"./api-5c4h9W6t.js";import"./firestore-service-B8JADViu.js";const c=o;class u{constructor(){this.settings={},this.companyDomain=null,this.company=null,this.isEnabled=!1,this.hasChanges=!1,this.onSettingsChange=null,this.previewDebounceTimer=null,this.draggedSection=null}debouncedPreview(){this.previewDebounceTimer&&clearTimeout(this.previewDebounceTimer),this.previewDebounceTimer=setTimeout(()=>{this.applyPreview()},300)}async enable(e,t,n,i){this.companyDomain=e,this.company=t,this.settings=n||{},this.onSettingsChange=i,this.isEnabled=!0,this.createEditorPanel(),this.populateForm(),this.setupEventListeners(),document.body.classList.add("recruit-edit-mode"),requestAnimationFrame(()=>{this.setupPreviewSortable()}),console.log("[RecruitEditor] ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–")}createEditorPanel(){const t=document.getElementById("recruit-editor-panel");t&&t.remove();const n=document.createElement("div");n.id="recruit-editor-panel",n.className="recruit-editor-panel",n.innerHTML=`\n      <div class="recruit-editor-header">\n        <h2 class="recruit-editor-title">æ¡ç”¨ãƒšãƒ¼ã‚¸ç·¨é›†</h2>\n        <div class="recruit-editor-actions">\n          <div class="preview-mode-toggle" id="preview-mode-toggle">\n            <button type="button" class="btn-preview-mode active" data-mode="pc" title="PCè¡¨ç¤º">\n              ğŸ–¥ï¸\n            </button>\n            <button type="button" class="btn-preview-mode" data-mode="mobile" title="ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤º">\n              ğŸ“±\n            </button>\n          </div>\n          <button type="button" class="btn-close-editor" id="btn-close-editor" title="é–‰ã˜ã‚‹">\n            âœ•\n          </button>\n        </div>\n      </div>\n\n      <div class="recruit-editor-body">\n        \x3c!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ --\x3e\n        <div class="recruit-editor-tabs">\n          <button type="button" class="recruit-editor-tab active" data-tab="settings">è¨­å®š</button>\n          <button type="button" class="recruit-editor-tab" data-tab="design">ãƒ‡ã‚¶ã‚¤ãƒ³</button>\n          <button type="button" class="recruit-editor-tab" data-tab="content">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</button>\n          <button type="button" class="recruit-editor-tab" data-tab="header">ãƒ˜ãƒƒãƒ€ãƒ¼</button>\n          <button type="button" class="recruit-editor-tab" data-tab="sns">SNS</button>\n          <button type="button" class="recruit-editor-tab" data-tab="seo">SEO</button>\n          <button type="button" class="recruit-editor-tab" data-tab="embed">åŸ‹è¾¼</button>\n        </div>\n\n        \x3c!-- è¨­å®šã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content active" data-tab-content="settings">\n          <div class="editor-section">\n            <h3 class="editor-section-title">å…¬é–‹è¨­å®š</h3>\n            <div class="form-group">\n              <label class="toggle-switch">\n                <input type="checkbox" id="edit-is-published" ${this.settings.isPublished?"checked":""}>\n                <span class="toggle-slider"></span>\n                <span class="toggle-label-text">æ¡ç”¨ãƒšãƒ¼ã‚¸ã‚’å…¬é–‹ã™ã‚‹</span>\n              </label>\n              <p class="form-hint">éå…¬é–‹ã«ã™ã‚‹ã¨ã€URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚æ¡ç”¨ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“</p>\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">URLè¨­å®š</h3>\n            <div class="form-group">\n              <label for="edit-custom-slug">ã‚«ã‚¹ã‚¿ãƒ URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>\n              <div class="input-with-prefix">\n                <span class="input-prefix">${window.location.origin}/r/</span>\n                <input type="text" id="edit-custom-slug" placeholder="company-name" pattern="[a-z0-9-]+" title="å°æ–‡å­—è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨å¯">\n              </div>\n              <p class="form-hint">ç©ºæ¬„ã®å ´åˆã¯ä¼šç¤¾IDãŒURLã«ãªã‚Šã¾ã™</p>\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">æ±‚äººä¸€è¦§ã®è¨­å®š</h3>\n            <div class="form-group">\n              <label for="edit-jobs-limit">æ±‚äººã®è¡¨ç¤ºä»¶æ•°</label>\n              <select id="edit-jobs-limit">\n                <option value="0">ã™ã¹ã¦è¡¨ç¤º</option>\n                <option value="3">3ä»¶</option>\n                <option value="5">5ä»¶</option>\n                <option value="10">10ä»¶</option>\n                <option value="20">20ä»¶</option>\n              </select>\n              <p class="form-hint">æ¡ç”¨ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹æ±‚äººã®æœ€å¤§ä»¶æ•°</p>\n            </div>\n            <div class="form-group">\n              <label for="edit-jobs-sort">æ±‚äººã®ä¸¦ã³é †</label>\n              <select id="edit-jobs-sort">\n                <option value="newest">æ–°ã—ã„é †</option>\n                <option value="oldest">å¤ã„é †</option>\n                <option value="salary-high">çµ¦ä¸é«˜ã„é †</option>\n                <option value="salary-low">çµ¦ä¸ä½ã„é †</option>\n              </select>\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">ãƒªãƒ³ã‚¯ãƒ»ãƒãƒŠãƒ¼è¨­å®š</h3>\n            <div class="custom-links-list" id="edit-custom-links">\n              \x3c!-- å‹•çš„ã«è¿½åŠ  --\x3e\n            </div>\n            <button type="button" class="btn-add-link" id="btn-add-custom-link">+ ãƒªãƒ³ã‚¯ã‚’è¿½åŠ </button>\n          </div>\n        </div>\n\n        \x3c!-- ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content" data-tab-content="design">\n          <div class="editor-section">\n            <h3 class="editor-section-title">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</h3>\n            <p class="section-description">æ¥­ç¨®ã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸ã«åˆã‚ã›ã¦æœ€é©ãªãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é¸ã¹ã¾ã™</p>\n            <div class="template-grid" id="template-grid">\n              ${c.map(t=>`\n                <label class="template-item ${this.settings.template===t.id?"selected":""}" data-template="${t.id}">\n                  <input type="radio" name="template" value="${t.id}" ${this.settings.template===t.id?"checked":""}>\n                  <div class="template-preview" style="background: ${t.color}"></div>\n                  <div class="template-info">\n                    <span class="template-name">${e(t.name)}</span>\n                    <span class="template-desc">${e(t.description)}</span>\n                    <span class="template-industries">${t.industries.join(" / ")}</span>\n                  </div>\n                </label>\n              `).join("")}\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content" data-tab-content="content">\n          <div class="editor-section">\n            <h3 class="editor-section-title">ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼</h3>\n            <div class="form-group">\n              <label for="edit-hero-title">ã‚¿ã‚¤ãƒˆãƒ«</label>\n              <input type="text" id="edit-hero-title" placeholder="ã€‡ã€‡ã§åƒã“ã†">\n            </div>\n            <div class="form-group">\n              <label for="edit-hero-subtitle">ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</label>\n              <input type="text" id="edit-hero-subtitle" placeholder="ç§ãŸã¡ã¨ä¸€ç·’ã«åƒãã¾ã›ã‚“ã‹ï¼Ÿ">\n            </div>\n            <div class="form-group">\n              <label>ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ</label>\n              <div class="hero-image-presets" id="hero-image-presets">\n                ${l.map(t=>`\n                  <div class="hero-preset-item" data-url="${e(t.url)}">\n                    <img src="${e(t.thumbnail)}" alt="${e(t.name)}" loading="lazy">\n                  </div>\n                `).join("")}\n              </div>\n              <div class="input-with-button mt-2">\n                <input type="text" id="edit-hero-image" placeholder="ã¾ãŸã¯ç”»åƒURLã‚’å…¥åŠ›">\n                <button type="button" id="btn-upload-hero-edit" class="btn-upload-small">ğŸ“·</button>\n              </div>\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">æ±‚äººã‚»ã‚¯ã‚·ãƒ§ãƒ³</h3>\n            <div class="form-group">\n              <label for="edit-jobs-title">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«</label>\n              <input type="text" id="edit-jobs-title" placeholder="å‹Ÿé›†ä¸­ã®æ±‚äºº">\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">CTAã‚»ã‚¯ã‚·ãƒ§ãƒ³</h3>\n            <div class="form-group">\n              <label for="edit-cta-title">ã‚¿ã‚¤ãƒˆãƒ«</label>\n              <input type="text" id="edit-cta-title" placeholder="ã‚ãªãŸã®å¿œå‹Ÿã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™">\n            </div>\n            <div class="form-group">\n              <label for="edit-cta-text">èª¬æ˜æ–‡</label>\n              <textarea id="edit-cta-text" rows="2" placeholder="æ°—ã«ãªã‚‹æ±‚äººãŒã‚ã‚Œã°ã€ãœã²ãŠæ°—è»½ã«ã”å¿œå‹Ÿãã ã•ã„ã€‚"></textarea>\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">ã‚«ã‚¹ã‚¿ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³</h3>\n            <p class="section-description">ãƒšãƒ¼ã‚¸ã«ç‹¬è‡ªã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã§ãã¾ã™</p>\n            <div class="custom-sections-list" id="edit-custom-sections">\n              \x3c!-- å‹•çš„ã«è¿½åŠ  --\x3e\n            </div>\n            <div class="add-section-buttons">\n              <button type="button" class="btn-open-template-selector" id="btn-open-template-selector-edit">+ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ </button>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content" data-tab-content="header">\n          <div class="editor-section">\n            <h3 class="editor-section-title">ãƒ­ã‚´è¨­å®š</h3>\n            <div class="form-group">\n              <label for="edit-logo-url">ãƒ­ã‚´ç”»åƒ</label>\n              <div class="logo-preview-small" id="edit-logo-preview">\n                <span class="logo-placeholder">ãƒ­ã‚´æœªè¨­å®š</span>\n              </div>\n              <div class="input-with-button">\n                <input type="text" id="edit-logo-url" placeholder="https://example.com/logo.png">\n                <button type="button" id="btn-upload-logo-edit" class="btn-upload-small">ğŸ“·</button>\n              </div>\n            </div>\n            <div class="form-group">\n              <label for="edit-company-name-display">è¡¨ç¤ºä¼šç¤¾å</label>\n              <input type="text" id="edit-company-name-display" placeholder="æ ªå¼ä¼šç¤¾ã€‡ã€‡">\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">CTAãƒãƒ¼è¨­å®š</h3>\n            <div class="form-group">\n              <label for="edit-phone-number">é›»è©±ç•ªå·</label>\n              <input type="text" id="edit-phone-number" placeholder="0120-XXX-XXX">\n            </div>\n            <div class="form-group">\n              <label for="edit-cta-button-text">ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</label>\n              <input type="text" id="edit-cta-button-text" placeholder="ä»Šã™ãå¿œå‹Ÿã™ã‚‹">\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- SNSã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content" data-tab-content="sns">\n          <div class="editor-section">\n            <h3 class="editor-section-title">SNSãƒªãƒ³ã‚¯è¨­å®š</h3>\n            <p class="section-description">å…¥åŠ›ã—ãŸSNSã¯ãƒ•ãƒƒã‚¿ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>\n            <div class="form-group">\n              <label for="edit-sns-twitter">\n                <span class="sns-icon">ğ•</span> X (Twitter)\n              </label>\n              <input type="url" id="edit-sns-twitter" placeholder="https://x.com/yourcompany">\n            </div>\n            <div class="form-group">\n              <label for="edit-sns-instagram">\n                <span class="sns-icon">ğŸ“·</span> Instagram\n              </label>\n              <input type="url" id="edit-sns-instagram" placeholder="https://instagram.com/yourcompany">\n            </div>\n            <div class="form-group">\n              <label for="edit-sns-facebook">\n                <span class="sns-icon">f</span> Facebook\n              </label>\n              <input type="url" id="edit-sns-facebook" placeholder="https://facebook.com/yourcompany">\n            </div>\n            <div class="form-group">\n              <label for="edit-sns-youtube">\n                <span class="sns-icon">â–¶</span> YouTube\n              </label>\n              <input type="url" id="edit-sns-youtube" placeholder="https://youtube.com/@yourcompany">\n            </div>\n            <div class="form-group">\n              <label for="edit-sns-line">\n                <span class="sns-icon">ğŸ’¬</span> LINE\n              </label>\n              <input type="url" id="edit-sns-line" placeholder="https://line.me/yourcompany">\n            </div>\n            <div class="form-group">\n              <label for="edit-sns-tiktok">\n                <span class="sns-icon">â™ª</span> TikTok\n              </label>\n              <input type="url" id="edit-sns-tiktok" placeholder="https://tiktok.com/@yourcompany">\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- SEOã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content" data-tab-content="seo">\n          <div class="editor-section">\n            <h3 class="editor-section-title">OGPè¨­å®š</h3>\n            <div class="form-group">\n              <label for="edit-ogp-title">OGPã‚¿ã‚¤ãƒˆãƒ«</label>\n              <input type="text" id="edit-ogp-title" placeholder="ã€‡ã€‡æ¡ç”¨æƒ…å ±">\n            </div>\n            <div class="form-group">\n              <label for="edit-ogp-description">OGPèª¬æ˜æ–‡</label>\n              <textarea id="edit-ogp-description" rows="2" placeholder="æ¡ç”¨æƒ…å ±ãƒšãƒ¼ã‚¸ã®èª¬æ˜"></textarea>\n            </div>\n            <div class="form-group">\n              <label for="edit-ogp-image">OGPç”»åƒURL</label>\n              <input type="text" id="edit-ogp-image" placeholder="https://example.com/ogp.jpg">\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- åŸ‹è¾¼ã‚¿ãƒ– --\x3e\n        <div class="recruit-editor-tab-content" data-tab-content="embed">\n          <div class="editor-section">\n            <h3 class="editor-section-title">æ¡ç”¨ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯</h3>\n            <p class="section-description">æ¡ç”¨ãƒšãƒ¼ã‚¸ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ã§ãã¾ã™</p>\n            <div class="embed-link-box">\n              <input type="text" id="embed-page-url" readonly class="embed-url-input">\n              <button type="button" class="btn-copy-embed" data-target="embed-page-url" title="ã‚³ãƒ”ãƒ¼">ğŸ“‹</button>\n            </div>\n          </div>\n\n          <div class="editor-section">\n            <h3 class="editor-section-title">ãƒãƒŠãƒ¼å–å¾—</h3>\n            <p class="section-description">è‡ªç¤¾ã‚µã‚¤ãƒˆã«è²¼ã‚Šä»˜ã‘ã¦æ¡ç”¨ãƒšãƒ¼ã‚¸ã¸èª˜å°ã§ãã¾ã™</p>\n            <div class="embed-banners-list" id="embed-banners-list">\n              \x3c!-- ãƒãƒŠãƒ¼1: ã‚·ãƒ³ãƒ—ãƒ«ãƒœã‚¿ãƒ³ --\x3e\n              <div class="embed-banner-item">\n                <div class="embed-banner-preview banner-style-button">\n                  <a href="#">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰</a>\n                </div>\n                <div class="embed-banner-actions">\n                  <button type="button" class="btn-copy-banner" data-banner="button">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>\n                </div>\n              </div>\n\n              \x3c!-- ãƒãƒŠãƒ¼2: å¤§ãã‚ãƒœã‚¿ãƒ³ --\x3e\n              <div class="embed-banner-item">\n                <div class="embed-banner-preview banner-style-button-large">\n                  <a href="#">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰ â†’</a>\n                </div>\n                <div class="embed-banner-actions">\n                  <button type="button" class="btn-copy-banner" data-banner="button-large">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>\n                </div>\n              </div>\n\n              \x3c!-- ãƒãƒŠãƒ¼3: ã‚«ãƒ¼ãƒ‰å‹ --\x3e\n              <div class="embed-banner-item">\n                <div class="embed-banner-preview banner-style-card">\n                  <div class="banner-card-inner">\n                    <span class="banner-card-label">æ¡ç”¨æƒ…å ±</span>\n                    <span class="banner-card-title">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰</span>\n                    <span class="banner-card-arrow">â†’</span>\n                  </div>\n                </div>\n                <div class="embed-banner-actions">\n                  <button type="button" class="btn-copy-banner" data-banner="card">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>\n                </div>\n              </div>\n\n              \x3c!-- ãƒãƒŠãƒ¼4: æ±‚äººå‹Ÿé›†ä¸­ --\x3e\n              <div class="embed-banner-item">\n                <div class="embed-banner-preview banner-style-recruiting">\n                  <div class="banner-recruiting-inner">\n                    <span class="banner-recruiting-badge">ãŸã ã„ã¾</span>\n                    <span class="banner-recruiting-title">æ±‚äººå‹Ÿé›†ä¸­ï¼</span>\n                  </div>\n                </div>\n                <div class="embed-banner-actions">\n                  <button type="button" class="btn-copy-banner" data-banner="recruiting">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>\n                </div>\n              </div>\n\n              \x3c!-- ãƒãƒŠãƒ¼5: ç‰¹è¨­ãƒšãƒ¼ã‚¸å…¬é–‹ä¸­ --\x3e\n              <div class="embed-banner-item">\n                <div class="embed-banner-preview banner-style-special">\n                  <div class="banner-special-inner">\n                    <span class="banner-special-title">æ¡ç”¨ç‰¹è¨­ãƒšãƒ¼ã‚¸</span>\n                    <span class="banner-special-subtitle">å…¬é–‹ä¸­ï¼ï¼</span>\n                  </div>\n                </div>\n                <div class="embed-banner-actions">\n                  <button type="button" class="btn-copy-banner" data-banner="special">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="recruit-editor-footer">\n        <button type="button" class="btn-save-recruit" id="btn-save-recruit">\n          <span>ğŸ’¾</span> ä¿å­˜\n        </button>\n      </div>\n    `,document.body.appendChild(n)}populateForm(){var e;const t=this.settings,n=(null==(e=this.company)?void 0:e.company)||"";this.setCheckboxValue("edit-is-published",!1!==t.isPublished),this.setInputValue("edit-custom-slug",t.customSlug||""),this.setSelectValue("edit-jobs-limit",t.jobsLimit||"0"),this.setSelectValue("edit-jobs-sort",t.jobsSort||"newest");let i=t.customLinks||[];if("string"==typeof i)try{i=JSON.parse(i)}catch{i=[]}this.renderCustomLinks(i);let s=t.template||t.designPattern||"modern";["modern","athome","cute","trust"].includes(s)||(s="modern"),this.setRadioValue("template",s),this.updateTemplateSelection(s),this.setInputValue("edit-hero-title",t.heroTitle||`${n}ã§åƒã“ã†`),this.setInputValue("edit-hero-subtitle",t.heroSubtitle||"ç§ãŸã¡ã¨ä¸€ç·’ã«åƒãã¾ã›ã‚“ã‹ï¼Ÿ"),this.setInputValue("edit-hero-image",t.heroImage||""),this.setInputValue("edit-jobs-title",t.jobsTitle||"å‹Ÿé›†ä¸­ã®æ±‚äºº"),this.setInputValue("edit-cta-title",t.ctaTitle||"ã‚ãªãŸã®å¿œå‹Ÿã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™"),this.setInputValue("edit-cta-text",t.ctaText||"æ°—ã«ãªã‚‹æ±‚äººãŒã‚ã‚Œã°ã€ãœã²ãŠæ°—è»½ã«ã”å¿œå‹Ÿãã ã•ã„ã€‚");let a=t.customSections||[];if("string"==typeof a)try{a=JSON.parse(a)}catch{a=[]}this.renderCustomSections(a),this.setInputValue("edit-logo-url",t.logoUrl||""),this.setInputValue("edit-company-name-display",t.companyNameDisplay||n),this.setInputValue("edit-phone-number",t.phoneNumber||""),this.setInputValue("edit-cta-button-text",t.ctaButtonText||"ä»Šã™ãå¿œå‹Ÿã™ã‚‹"),this.setInputValue("edit-sns-twitter",t.snsTwitter||""),this.setInputValue("edit-sns-instagram",t.snsInstagram||""),this.setInputValue("edit-sns-facebook",t.snsFacebook||""),this.setInputValue("edit-sns-youtube",t.snsYoutube||""),this.setInputValue("edit-sns-line",t.snsLine||""),this.setInputValue("edit-sns-tiktok",t.snsTiktok||""),this.setInputValue("edit-ogp-title",t.ogpTitle||""),this.setInputValue("edit-ogp-description",t.ogpDescription||""),this.setInputValue("edit-ogp-image",t.ogpImage||""),this.updateLogoPreview(t.logoUrl||""),this.updateHeroPresetSelection(t.heroImage||""),this.updateEmbedUrl()}setupEventListeners(){var e,t,n,i,s,a,o,l;document.querySelectorAll(".recruit-editor-tab").forEach(e=>{e.addEventListener("click",()=>this.switchTab(e.dataset.tab))}),null==(e=document.getElementById("btn-close-editor"))||e.addEventListener("click",()=>{this.close()}),document.querySelectorAll(".btn-preview-mode").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.mode;this.setPreviewMode(t)})}),null==(t=document.getElementById("btn-save-recruit"))||t.addEventListener("click",()=>{this.save()}),document.querySelectorAll('input[name="template"]').forEach(e=>{e.addEventListener("change",()=>{this.settings.template=e.value,this.hasChanges=!0,this.updateTemplateSelection(e.value),this.applyPreview()})});["edit-hero-title","edit-hero-subtitle","edit-hero-image","edit-jobs-title","edit-cta-title","edit-cta-text","edit-logo-url","edit-company-name-display","edit-phone-number","edit-cta-button-text","edit-ogp-title","edit-ogp-description","edit-ogp-image","edit-custom-slug","edit-sns-twitter","edit-sns-instagram","edit-sns-facebook","edit-sns-youtube","edit-sns-line","edit-sns-tiktok"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",()=>{this.hasChanges=!0,this.updateSettingsFromForm(),this.debouncedPreview()})}),null==(n=document.getElementById("edit-is-published"))||n.addEventListener("change",()=>{this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()}),["edit-jobs-limit","edit-jobs-sort"].forEach(e=>{var t;null==(t=document.getElementById(e))||t.addEventListener("change",()=>{this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()})}),null==(i=document.getElementById("btn-add-custom-link"))||i.addEventListener("click",()=>{this.addCustomLink()}),null==(s=document.getElementById("btn-open-template-selector-edit"))||s.addEventListener("click",()=>{this.showTemplateSelectorModal()}),document.querySelectorAll("#hero-image-presets .hero-preset-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.url;this.setInputValue("edit-hero-image",t),this.updateHeroPresetSelection(t),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()})}),null==(a=document.getElementById("btn-upload-logo-edit"))||a.addEventListener("click",async()=>{await this.uploadLogo()}),null==(o=document.getElementById("btn-upload-hero-edit"))||o.addEventListener("click",async()=>{await this.uploadHeroImage()}),null==(l=document.getElementById("edit-logo-url"))||l.addEventListener("input",e=>{this.updateLogoPreview(e.target.value)}),document.querySelectorAll(".btn-copy-embed").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t);n&&this.copyToClipboard(n.value)})}),document.querySelectorAll(".btn-copy-banner").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.banner,n=this.generateBannerCode(t);this.copyToClipboard(n)})})}switchTab(e){document.querySelectorAll(".recruit-editor-tab").forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),document.querySelectorAll(".recruit-editor-tab-content").forEach(t=>{t.classList.toggle("active",t.dataset.tabContent===e)})}updateSettingsFromForm(){var e,t,n,i,s,a,o,l,d,r,c,u,p,m,b,h,g,v,y,f,x,S,E;this.settings={...this.settings,companyDomain:this.companyDomain,isPublished:(null==(e=document.getElementById("edit-is-published"))?void 0:e.checked)??!0,customSlug:(null==(t=document.getElementById("edit-custom-slug"))?void 0:t.value)||"",jobsLimit:(null==(n=document.getElementById("edit-jobs-limit"))?void 0:n.value)||"0",jobsSort:(null==(i=document.getElementById("edit-jobs-sort"))?void 0:i.value)||"newest",customLinks:JSON.stringify(this.getCustomLinks()),template:this.getRadioValue("template")||"modern",heroTitle:(null==(s=document.getElementById("edit-hero-title"))?void 0:s.value)||"",heroSubtitle:(null==(a=document.getElementById("edit-hero-subtitle"))?void 0:a.value)||"",heroImage:(null==(o=document.getElementById("edit-hero-image"))?void 0:o.value)||"",jobsTitle:(null==(l=document.getElementById("edit-jobs-title"))?void 0:l.value)||"",ctaTitle:(null==(d=document.getElementById("edit-cta-title"))?void 0:d.value)||"",ctaText:(null==(r=document.getElementById("edit-cta-text"))?void 0:r.value)||"",customSections:JSON.stringify(this.getCustomSections()),logoUrl:(null==(c=document.getElementById("edit-logo-url"))?void 0:c.value)||"",companyNameDisplay:(null==(u=document.getElementById("edit-company-name-display"))?void 0:u.value)||"",phoneNumber:(null==(p=document.getElementById("edit-phone-number"))?void 0:p.value)||"",ctaButtonText:(null==(m=document.getElementById("edit-cta-button-text"))?void 0:m.value)||"",snsTwitter:(null==(b=document.getElementById("edit-sns-twitter"))?void 0:b.value)||"",snsInstagram:(null==(h=document.getElementById("edit-sns-instagram"))?void 0:h.value)||"",snsFacebook:(null==(g=document.getElementById("edit-sns-facebook"))?void 0:g.value)||"",snsYoutube:(null==(v=document.getElementById("edit-sns-youtube"))?void 0:v.value)||"",snsLine:(null==(y=document.getElementById("edit-sns-line"))?void 0:y.value)||"",snsTiktok:(null==(f=document.getElementById("edit-sns-tiktok"))?void 0:f.value)||"",ogpTitle:(null==(x=document.getElementById("edit-ogp-title"))?void 0:x.value)||"",ogpDescription:(null==(S=document.getElementById("edit-ogp-description"))?void 0:S.value)||"",ogpImage:(null==(E=document.getElementById("edit-ogp-image"))?void 0:E.value)||""}}applyPreview(){this.updateSettingsFromForm(),this.onSettingsChange&&this.onSettingsChange(this.settings),requestAnimationFrame(()=>{this.setupPreviewSortable()})}setPreviewMode(e){document.querySelectorAll(".btn-preview-mode").forEach(t=>{t.classList.toggle("active",t.dataset.mode===e)}),"mobile"===e?(document.body.classList.add("preview-mode-mobile"),document.body.classList.remove("preview-mode-pc")):(document.body.classList.add("preview-mode-pc"),document.body.classList.remove("preview-mode-mobile"))}async save(){const e=document.getElementById("btn-save-recruit");if(e)try{e.disabled=!0,e.innerHTML='<span class="loading-spinner-small"></span> ä¿å­˜ä¸­...',this.updateSettingsFromForm(),await r(this.settings),this.hasChanges=!1,t("è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ","success")}catch(n){console.error("[RecruitEditor] ä¿å­˜ã‚¨ãƒ©ãƒ¼:",n),t("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message,"error")}finally{e.disabled=!1,e.innerHTML="<span>ğŸ’¾</span> ä¿å­˜"}}async uploadLogo(){const e=document.getElementById("btn-upload-logo-edit");if(e&&this.companyDomain)try{const n=await i({accept:"image/png,image/jpeg,image/webp,image/svg+xml"});e.disabled=!0,e.textContent="...";const a=await s(n,this.companyDomain);this.setInputValue("edit-logo-url",a),this.updateLogoPreview(a),this.hasChanges=!0,this.updateSettingsFromForm(),t("ãƒ­ã‚´ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ","success")}catch(n){"ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"!==n.message&&t("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message,"error")}finally{e&&(e.disabled=!1,e.textContent="ğŸ“·")}}async uploadHeroImage(){const e=document.getElementById("btn-upload-hero-edit");if(e&&this.companyDomain)try{const n=await i({accept:"image/png,image/jpeg,image/webp"});e.disabled=!0,e.textContent="...";const s=await a(n,this.companyDomain);this.setInputValue("edit-hero-image",s),this.updateHeroPresetSelection(s),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview(),t("ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ","success")}catch(n){"ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"!==n.message&&t("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message,"error")}finally{e&&(e.disabled=!1,e.textContent="ğŸ“·")}}updateLogoPreview(t){const n=document.getElementById("edit-logo-preview");n&&(n.innerHTML=t?`<img src="${e(t)}" alt="ãƒ­ã‚´ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">`:'<span class="logo-placeholder">ãƒ­ã‚´æœªè¨­å®š</span>')}updateTemplateSelection(e){document.querySelectorAll(".template-item").forEach(t=>{t.classList.toggle("selected",t.dataset.template===e)})}updateHeroPresetSelection(e){document.querySelectorAll("#hero-image-presets .hero-preset-item").forEach(t=>{const n=t.dataset.url,i=null==e?void 0:e.split("?")[0],s=null==n?void 0:n.split("?")[0];t.classList.toggle("selected",i&&s&&i===s)})}async close(){if(this.hasChanges){if(!(await n({title:"å¤‰æ›´ã®ç ´æ£„",message:"ä¿å­˜ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚é–‰ã˜ã¾ã™ã‹ï¼Ÿ",confirmText:"é–‰ã˜ã‚‹",cancelText:"ç·¨é›†ã‚’ç¶šã‘ã‚‹",danger:!0})))return}window.location.href=`company-recruit.html?id=${encodeURIComponent(this.companyDomain)}`}setInputValue(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}setCheckboxValue(e,t){const n=document.getElementById(e);n&&(n.checked=!!t)}setSelectValue(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}setRadioValue(e,t){const n=document.querySelector(`input[name="${e}"][value="${t}"]`);n&&(n.checked=!0)}getRadioValue(e){var t;return(null==(t=document.querySelector(`input[name="${e}"]:checked`))?void 0:t.value)||""}renderCustomLinks(t){const n=document.getElementById("edit-custom-links");n&&(n.innerHTML=t.map((t,n)=>`\n      <div class="custom-link-item" data-index="${n}">\n        <div class="custom-link-inputs">\n          <input type="text" class="custom-link-label" placeholder="ãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆ" value="${e(t.label||"")}">\n          <input type="url" class="custom-link-url" placeholder="https://..." value="${e(t.url||"")}">\n        </div>\n        <button type="button" class="btn-remove-link" data-index="${n}">âœ•</button>\n      </div>\n    `).join(""),n.querySelectorAll(".btn-remove-link").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.index,10),n=this.getCustomLinks();n.splice(t,1),this.renderCustomLinks(n),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()})}),n.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>{this.hasChanges=!0,this.updateSettingsFromForm(),this.debouncedPreview()})}))}getCustomLinks(){const e=document.getElementById("edit-custom-links");if(!e)return[];const t=[];return e.querySelectorAll(".custom-link-item").forEach(e=>{var n,i;const s=(null==(n=e.querySelector(".custom-link-label"))?void 0:n.value)||"",a=(null==(i=e.querySelector(".custom-link-url"))?void 0:i.value)||"";(s||a)&&t.push({label:s,url:a})}),t}addCustomLink(){const e=this.getCustomLinks();e.push({label:"",url:""}),this.renderCustomLinks(e),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()}renderCustomSections(t){const n=document.getElementById("edit-custom-sections");n&&(n.innerHTML=(t||[]).map((n,i)=>{const s=d.find(e=>e.id===n.type),a=s?`${s.name}ï¼ˆ${s.label}ï¼‰`:n.type;return`\n        <div class="custom-section-item" data-index="${i}" data-type="${n.type}" draggable="true">\n          <div class="section-item-header">\n            <span class="section-drag-handle" style="display:flex;width:24px;height:24px;background:#e5e7eb;border-radius:4px;align-items:center;justify-content:center;cursor:grab;" title="ãƒ‰ãƒ©ãƒƒã‚°ã§ä¸¦ã³æ›¿ãˆ">â˜°</span>\n            <span class="section-type-badge ${s?"template-badge":""}">${e(a)}</span>\n            <div class="section-item-actions">\n              <button type="button" class="btn-move-section" data-direction="up" data-index="${i}" ${0===i?"disabled":""} title="ä¸Šã¸ç§»å‹•">â†‘</button>\n              <button type="button" class="btn-move-section" data-direction="down" data-index="${i}" ${i===t.length-1?"disabled":""} title="ä¸‹ã¸ç§»å‹•">â†“</button>\n              <button type="button" class="btn-remove-section" data-index="${i}" title="å‰Šé™¤">âœ•</button>\n            </div>\n          </div>\n          <div class="section-item-content">\n            ${this.renderSectionFields(s,n,i)}\n          </div>\n        </div>\n      `}).join(""),this.bindCustomSectionEvents(n),this.bindDragAndDropEvents(n))}renderSectionFields(t,n,i){return t&&t.fields?t.fields.map(t=>{const s=n[t.key]||"";if("text"===t.type)return`\n          <div class="section-field">\n            <label>${e(t.label)}</label>\n            <input type="text" class="section-field-input" data-field="${t.key}"\n                   placeholder="${e(t.placeholder||"")}" value="${e(s)}">\n          </div>\n        `;if("textarea"===t.type)return`\n          <div class="section-field">\n            <label>${e(t.label)}</label>\n            <textarea class="section-field-input" data-field="${t.key}" rows="3"\n                      placeholder="${e(t.placeholder||"")}">${e(s)}</textarea>\n          </div>\n        `;if("image"===t.type)return`\n          <div class="section-field">\n            <label>${e(t.label)}</label>\n            ${s?`<img src="${e(s)}" class="section-image-preview" alt="">`:""}\n            <div class="input-with-button">\n              <input type="url" class="section-field-input section-image-url" data-field="${t.key}"\n                     placeholder="ç”»åƒURL" value="${e(s)}">\n              <button type="button" class="btn-upload-small btn-upload-section-image" data-index="${i}" data-field="${t.key}">ğŸ“·</button>\n            </div>\n          </div>\n        `;if("items"===t.type){const i=Array.isArray(n[t.key])?n[t.key]:[],s=t.maxItems||4;return`\n          <div class="section-field section-items-field" data-field="${t.key}" data-max-items="${s}">\n            <label>${e(t.label)}</label>\n            <div class="section-items-list">\n              ${i.map((n,i)=>`\n                <div class="section-item-entry" data-item-index="${i}">\n                  ${t.itemFields.map(t=>`\n                    <div class="item-field">\n                      <label>${e(t.label)}</label>\n                      ${"textarea"===t.type?`<textarea class="item-field-input" data-field="${t.key}" rows="2"\n                                     placeholder="${e(t.placeholder||"")}">${e(n[t.key]||"")}</textarea>`:`<input type="text" class="item-field-input" data-field="${t.key}"\n                                  placeholder="${e(t.placeholder||"")}" value="${e(n[t.key]||"")}">`}\n                    </div>\n                  `).join("")}\n                  <button type="button" class="btn-remove-item" data-item-index="${i}">âœ•</button>\n                </div>\n              `).join("")}\n            </div>\n            ${i.length<s?'<button type="button" class="btn-add-item">+ é …ç›®ã‚’è¿½åŠ </button>':""}\n          </div>\n        `}if("gallery"===t.type){const s=Array.isArray(n[t.key])?n[t.key]:[],a=t.maxImages||6;return`\n          <div class="section-field section-gallery-field" data-field="${t.key}" data-max-images="${a}">\n            <label>${e(t.label)}</label>\n            <div class="section-gallery-grid">\n              ${s.map((t,n)=>`\n                <div class="gallery-image-item">\n                  <img src="${e(t)}" alt="">\n                  <button type="button" class="btn-remove-gallery-image" data-image-index="${n}">âœ•</button>\n                </div>\n              `).join("")}\n              ${s.length<a?`\n                <button type="button" class="btn-add-gallery-image" data-index="${i}" data-field="${t.key}">+ ç”»åƒè¿½åŠ </button>\n              `:""}\n            </div>\n          </div>\n        `}return""}).join(""):"text"===n.type?`<textarea class="section-content" rows="3" placeholder="ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›">${e(n.content||"")}</textarea>`:"heading"===n.type?`<input type="text" class="section-content" placeholder="è¦‹å‡ºã—ãƒ†ã‚­ã‚¹ãƒˆ" value="${e(n.content||"")}">`:"image"===n.type?`<input type="url" class="section-content" placeholder="ç”»åƒURLï¼ˆhttps://...ï¼‰" value="${e(n.content||"")}">`:""}bindCustomSectionEvents(e){e.querySelectorAll(".btn-remove-section").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.index,10),n=this.getCustomSections();n.splice(t,1),this.renderCustomSections(n),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()})}),e.querySelectorAll(".btn-move-section").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.index,10),n=e.dataset.direction,i=this.getCustomSections();"up"===n&&t>0?[i[t-1],i[t]]=[i[t],i[t-1]]:"down"===n&&t<i.length-1&&([i[t],i[t+1]]=[i[t+1],i[t]]),this.renderCustomSections(i),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()})}),e.querySelectorAll(".section-field-input, .section-content").forEach(e=>{e.addEventListener("input",()=>{this.hasChanges=!0,this.updateSettingsFromForm(),this.debouncedPreview()})}),e.querySelectorAll(".item-field-input").forEach(e=>{e.addEventListener("input",()=>{this.hasChanges=!0,this.updateSettingsFromForm(),this.debouncedPreview()})}),e.querySelectorAll(".btn-upload-section-image").forEach(e=>{e.addEventListener("click",async()=>{await this.uploadSectionImage(e)})}),e.querySelectorAll(".btn-add-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".custom-section-item"),n=parseInt(t.dataset.index,10),i=e.closest(".section-items-field"),s=i.dataset.field,a=parseInt(i.dataset.maxItems,10)||4,o=this.getCustomSections();o[n]&&(Array.isArray(o[n][s])||(o[n][s]=[]),o[n][s].length<a&&(o[n][s].push({}),this.renderCustomSections(o),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()))})}),e.querySelectorAll(".btn-remove-item").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.itemIndex,10),n=e.closest(".custom-section-item"),i=parseInt(n.dataset.index,10),s=this.getCustomSections();s[i]&&Array.isArray(s[i].items)&&(s[i].items.splice(t,1),this.renderCustomSections(s),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview())})}),e.querySelectorAll(".btn-add-gallery-image").forEach(e=>{e.addEventListener("click",async()=>{const n=parseInt(e.dataset.index,10),s=e.dataset.field;try{const e=await i();if(e){const i=await a(e,this.companyDomain),o=this.getCustomSections();o[n][s]||(o[n][s]=[]),o[n][s].push(i),this.renderCustomSections(o),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview(),t("ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ","success")}}catch(o){"ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"!==o.message&&t("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}})}),e.querySelectorAll(".btn-remove-gallery-image").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.imageIndex,10),n=e.closest(".custom-section-item"),i=parseInt(n.dataset.index,10),s=e.closest(".section-gallery-field").dataset.field,a=this.getCustomSections();a[i]&&Array.isArray(a[i][s])&&(a[i][s].splice(t,1),this.renderCustomSections(a),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview())})})}bindDragAndDropEvents(e){let n=null,i=-1;e.querySelectorAll(".custom-section-item").forEach(s=>{s.addEventListener("dragstart",e=>{if(!e.target.closest(".section-drag-handle")&&e.target!==s){if(e.target.closest("input, textarea, select, button"))return void e.preventDefault()}n=s,i=parseInt(s.dataset.index,10),s.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i.toString())}),s.addEventListener("dragend",()=>{n&&n.classList.remove("dragging"),n=null,i=-1,e.querySelectorAll(".custom-section-item").forEach(e=>{e.classList.remove("drag-over")})}),s.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",n&&s!==n&&s.classList.add("drag-over")}),s.addEventListener("dragleave",()=>{s.classList.remove("drag-over")}),s.addEventListener("drop",e=>{if(e.preventDefault(),s.classList.remove("drag-over"),!n||s===n)return;const a=parseInt(s.dataset.index,10);if(i===a)return;const o=this.getCustomSections(),[l]=o.splice(i,1);o.splice(a,0,l),this.renderCustomSections(o),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview(),t("ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç§»å‹•ã—ã¾ã—ãŸ","success")})})}async uploadSectionImage(e){try{const n=await i();if(n){e.disabled=!0,e.textContent="...";const i=await a(n,this.companyDomain),s=e.parentElement.querySelector(".section-image-url");if(s){s.value=i;let t=e.closest(".section-field").querySelector(".section-image-preview");t||(t=document.createElement("img"),t.className="section-image-preview",e.closest(".section-field").insertBefore(t,e.parentElement)),t.src=i}this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview(),t("ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ","success")}}catch(n){"ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"!==n.message&&t("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}finally{e.disabled=!1,e.textContent="ğŸ“·"}}showTemplateSelectorModal(){const t=document.getElementById("template-selector-modal-edit");t&&t.remove();const n=`\n      <div id="template-selector-modal-edit" class="template-modal-overlay">\n        <div class="template-modal">\n          <div class="template-modal-header">\n            <h3>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã™ã‚‹</h3>\n            <button type="button" class="template-modal-close">&times;</button>\n          </div>\n          <div class="template-modal-body">\n            <p class="template-modal-description">è¿½åŠ ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>\n            <div class="template-list">\n              ${d.map(t=>`\n                <div class="template-item" data-template-id="${t.id}">\n                  <div class="template-thumbnail">\n                    <img src='${t.thumbnail}' alt="${e(t.name)}">\n                  </div>\n                  <div class="template-info">\n                    <h4 class="template-name">${e(t.name)}ï¼ˆ${e(t.label)}ï¼‰</h4>\n                    <p class="template-description">${e(t.description)}</p>\n                  </div>\n                  <button type="button" class="btn-add-template" data-template-id="${t.id}">è¿½åŠ ã™ã‚‹</button>\n                </div>\n              `).join("")}\n            </div>\n          </div>\n          <div class="template-modal-footer">\n            <button type="button" class="btn-template-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n          </div>\n        </div>\n      </div>\n    `;document.body.insertAdjacentHTML("beforeend",n);const i=document.getElementById("template-selector-modal-edit");i.querySelector(".template-modal-close").addEventListener("click",()=>{i.remove()}),i.querySelector(".btn-template-cancel").addEventListener("click",()=>{i.remove()}),i.addEventListener("click",e=>{e.target===i&&i.remove()}),i.querySelectorAll(".btn-add-template").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.templateId;this.addCustomSection(t),i.remove()})})}getCustomSections(){const e=document.getElementById("edit-custom-sections");if(!e)return[];const t=[];return e.querySelectorAll(".custom-section-item").forEach(e=>{var n;const i=e.dataset.type,s=d.find(e=>e.id===i),a={type:i};if(s&&s.fields)s.fields.forEach(t=>{if("items"===t.type){const n=[];e.querySelectorAll(".section-item-entry").forEach(e=>{const t={};e.querySelectorAll(".item-field-input").forEach(e=>{t[e.dataset.field]=e.value||""}),n.push(t)}),a[t.key]=n}else if("gallery"===t.type){const n=[];e.querySelectorAll(".gallery-image-item img").forEach(e=>{e.src&&n.push(e.src)}),a[t.key]=n}else{const n=e.querySelector(`.section-field-input[data-field="${t.key}"]`);a[t.key]=(null==n?void 0:n.value)||""}});else{const t=(null==(n=e.querySelector(".section-content"))?void 0:n.value)||"";a.content=t}t.push(a)}),t}addCustomSection(e){const t=d.find(t=>t.id===e),n=this.getCustomSections(),i={type:e};t&&t.fields?t.fields.forEach(e=>{"items"===e.type||"gallery"===e.type?i[e.key]=[]:i[e.key]=""}):i.content="",n.push(i),this.renderCustomSections(n),this.hasChanges=!0,this.updateSettingsFromForm(),this.applyPreview()}updateEmbedUrl(){const e=document.getElementById("embed-page-url");if(e&&this.companyDomain){const t=window.location.origin;e.value=`${t}/company-recruit.html?id=${encodeURIComponent(this.companyDomain)}`}}generateBannerCode(t){var n;const i=`${window.location.origin}/company-recruit.html?id=${encodeURIComponent(this.companyDomain)}`,s=(null==(n=this.company)?void 0:n.company)||"";switch(t){case"button":return`<a href="${i}" target="_blank" rel="noopener" style="display:inline-block;padding:12px 24px;background:#0ea5e9;color:#fff;text-decoration:none;border-radius:6px;font-weight:bold;font-size:14px;">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰</a>`;case"button-large":return`<a href="${i}" target="_blank" rel="noopener" style="display:inline-block;padding:16px 32px;background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;text-decoration:none;border-radius:8px;font-weight:bold;font-size:16px;box-shadow:0 4px 14px rgba(14,165,233,0.4);">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰ â†’</a>`;case"card":return`<a href="${i}" target="_blank" rel="noopener" style="display:block;max-width:300px;padding:20px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;text-decoration:none;box-shadow:0 2px 8px rgba(0,0,0,0.08);"><span style="display:block;font-size:12px;color:#6b7280;margin-bottom:4px;">æ¡ç”¨æƒ…å ±</span><span style="display:block;font-size:16px;font-weight:bold;color:#1f2937;">${e(s)} æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰</span><span style="display:block;margin-top:8px;color:#0ea5e9;font-size:14px;">è©³ã—ãè¦‹ã‚‹ â†’</span></a>`;case"recruiting":return`<a href="${i}" target="_blank" rel="noopener" style="display:inline-block;padding:16px 28px;background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;text-decoration:none;border-radius:8px;text-align:center;box-shadow:0 4px 14px rgba(249,115,22,0.4);"><span style="display:block;font-size:12px;font-weight:500;">ãŸã ã„ã¾</span><span style="display:block;font-size:18px;font-weight:bold;">æ±‚äººå‹Ÿé›†ä¸­ï¼</span></a>`;case"special":return`<a href="${i}" target="_blank" rel="noopener" style="display:inline-block;padding:20px 32px;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;text-decoration:none;border-radius:12px;text-align:center;box-shadow:0 4px 20px rgba(99,102,241,0.4);"><span style="display:block;font-size:14px;font-weight:500;">æ¡ç”¨ç‰¹è¨­ãƒšãƒ¼ã‚¸</span><span style="display:block;font-size:20px;font-weight:bold;margin-top:4px;">å…¬é–‹ä¸­ï¼ï¼</span></a>`;default:return""}}async copyToClipboard(e){try{await navigator.clipboard.writeText(e),t("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ","success")}catch(n){console.error("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—:",n),t("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}}setupPreviewSortable(){const e=document.getElementById("recruit-content");if(!e)return;const t=e.querySelectorAll("section");0!==t.length&&t.forEach(t=>{if(t.querySelector(".recruit-section-drag-handle"))return;const n=this.detectRecruitSectionType(t);t.dataset.section=n,t.classList.add("recruit-sortable-section");const i=document.createElement("div");i.className="recruit-section-drag-handle",i.innerHTML=`\n        <span class="recruit-section-label">${this.getRecruitSectionLabel(n)}</span>\n        <span class="recruit-section-drag-icon">â˜°</span>\n      `,t.insertBefore(i,t.firstChild),t.setAttribute("draggable","true"),t.addEventListener("dragstart",e=>{this.draggedSection=t,t.classList.add("recruit-section-dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage(t,50,30)}),t.addEventListener("dragend",()=>{t.classList.remove("recruit-section-dragging"),this.draggedSection=null,this.saveRecruitSectionOrder()}),t.addEventListener("dragover",n=>{if(n.preventDefault(),n.dataTransfer.dropEffect="move",this.draggedSection&&this.draggedSection!==t){const n=[...e.querySelectorAll("section")];n.indexOf(this.draggedSection)<n.indexOf(t)?t.parentNode.insertBefore(this.draggedSection,t.nextSibling):t.parentNode.insertBefore(this.draggedSection,t)}})})}detectRecruitSectionType(e){if(e.classList.contains("recruit-hero"))return"hero";if(e.classList.contains("recruit-about"))return"company-intro";if(e.classList.contains("recruit-jobs"))return"jobs";if(e.classList.contains("recruit-cta"))return"cta";if(e.id&&e.id.startsWith("custom-section-")){return`custom-${e.id.replace("custom-section-","")}`}return"unknown"}getRecruitSectionLabel(e){return e.startsWith("custom-")?"ã‚«ã‚¹ã‚¿ãƒ ":{hero:"ãƒ’ãƒ¼ãƒ­ãƒ¼","company-intro":"ä¼šç¤¾ç´¹ä»‹",jobs:"æ±‚äººä¸€è¦§",cta:"CTA"}[e]||"ã‚»ã‚¯ã‚·ãƒ§ãƒ³"}saveRecruitSectionOrder(){const e=document.getElementById("recruit-content");if(!e)return;const n=e.querySelectorAll("section"),i=Array.from(n).map(e=>e.dataset.section).filter(e=>e&&"unknown"!==e);this.settings.sectionOrder=i.join(","),this.hasChanges=!0,this.updateSectionOrderInPanel(i),t("ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åºã‚’å¤‰æ›´ã—ã¾ã—ãŸ","success")}updateSectionOrderInPanel(e){document.getElementById("edit-section-order")}}export{u as RecruitEditor};
