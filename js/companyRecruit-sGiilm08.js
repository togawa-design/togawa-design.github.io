const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/RecruitEditor-DdzFvigl.js","js/utils-DCR9QUau.js","js/image-uploader-gAKnoYUY.js","js/core-WpNCZy-k.js","js/api-B1sZYcOA.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-YP0FEG5d.js";import{l as e,_ as t}from"./api-B1sZYcOA.js";import{h as n,g as r,e as o}from"./utils-DCR9QUau.js";import{r as i,a as s,b as a}from"./LayoutComponents-BuXt54tn.js";import"./jobs-loader-CbBJAmIK.js";class c{constructor(){this.companyDomain=null,this.company=null,this.jobs=[],this.recruitSettings=null,this.isEditMode=n("edit"),this.editor=null,this.selectedJobType="all"}async init(){if(this.companyDomain=r("id")||r("c"),this.companyDomain)try{await this.waitForJobsLoader();const[t,n]=await Promise.all([window.JobsLoader.fetchCompanies(),e(this.companyDomain)]);if(this.recruitSettings=n||{},this.company=null==t?void 0:t.find(e=>{var t;return(null==(t=e.companyDomain)?void 0:t.trim())===this.companyDomain&&window.JobsLoader.isCompanyVisible(e)}),!this.company)return void this.showError("指定された会社は見つかりませんでした。");this.jobs=await this.fetchJobs(this.company),this.hideLoading(),this.render(),this.renderLayoutComponents(),this.updateSEO(),this.isEditMode&&this.enableEditMode()}catch(t){console.error("[RecruitPage] 初期化エラー:",t),this.showError("ページの読み込みに失敗しました。")}else this.showError("会社が指定されていません。")}async enableEditMode(){try{const{RecruitEditor:e}=await t(async()=>{const{RecruitEditor:e}=await import("./RecruitEditor-DdzFvigl.js");return{RecruitEditor:e}},__vite__mapDeps([0,1,2,3,4]));this.editor=new e,this.editor.enable(this.companyDomain,this.company,this.recruitSettings,e=>this.onSettingsChange(e)),console.log("[RecruitPage] 編集モード有効化")}catch(e){console.error("[RecruitPage] 編集モードの読み込みエラー:",e)}}onSettingsChange(e){this.recruitSettings=e,this.removeLayoutComponents(),this.render(),this.renderLayoutComponents()}removeLayoutComponents(){var e,t,n;null==(e=document.querySelector(".site-header"))||e.remove(),null==(t=document.querySelector(".fixed-cta-bar"))||t.remove(),null==(n=document.querySelector(".site-footer"))||n.remove(),document.body.classList.remove("has-fixed-header","has-fixed-cta-bar"),document.body.className=document.body.className.replace(/lp-pattern-\S+/g,"").trim(),document.body.removeAttribute("data-layout-style")}waitForJobsLoader(){return new Promise((e,t)=>{const n=Date.now(),r=()=>{window.JobsLoader&&"function"==typeof window.JobsLoader.fetchCompanies?e():Date.now()-n>1e4?t(new Error("JobsLoaderのロードがタイムアウトしました")):setTimeout(r,100)};r()})}async fetchJobs(e){var t;try{const n=null==(t=e.jobsSheet)?void 0:t.trim();if(!n)return console.log("[RecruitPage] jobsSheetが設定されていません"),[];const r=await window.JobsLoader.fetchCompanyJobs(n);if(console.log("[RecruitPage] 取得した全求人:",null==r?void 0:r.length),!(null==r?void 0:r.length))return[];const o=r.filter(e=>"false"!==e.visible&&"FALSE"!==e.visible).filter(e=>window.JobsLoader.isJobInPublishPeriod(e)).sort((e,t)=>(parseInt(e.order)||999)-(parseInt(t.order)||999)).map(t=>({...t,company:e.company,companyDomain:e.companyDomain}));return console.log("[RecruitPage] フィルタ後の求人:",o.length),o}catch(n){return console.error("[RecruitPage] 求人取得エラー:",n),[]}}render(){var e;const t=document.getElementById("recruit-content");if(!t)return;const n=this.getSectionOrder(),r=this.getSectionVisibility(),i=n.map(e=>{if(!1===r[e])return"";switch(e){case"hero":return this.renderHeroSection();case"company-intro":return this.renderCompanyIntroSection();case"jobs":return this.renderJobsSection();case"cta":return this.renderCTASection();default:return""}}).join("");t.innerHTML=i;const s=document.getElementById("header-logo");s&&(null==(e=this.company)?void 0:e.company)&&(s.innerHTML=`<span class="logo-text">${o(this.company.company)}</span>`),this.setupJobTypeTabs(),this.setupVideoButton()}getSectionOrder(){const e=this.recruitSettings||{};return e.sectionOrder?e.sectionOrder.split(",").map(e=>e.trim()).filter(e=>e):["hero","company-intro","jobs","cta"]}getSectionVisibility(){const e=this.recruitSettings||{};if(e.sectionVisibility)try{return JSON.parse(e.sectionVisibility)}catch(t){console.error("[RecruitPage] セクション表示設定のパースエラー:",t)}return{"company-intro":!0}}renderHeroSection(){const e=this.company,t=this.recruitSettings||{},n=t.heroImage||e.imageUrl||"",r=t.heroTitle||`${o(e.company)}で働こう`,i=t.heroSubtitle||(e.description?this.truncateText(e.description,100):"私たちと一緒に働きませんか？"),s="true"===String(t.showVideoButton).toLowerCase(),a=t.videoUrl||"";return`\n      <section class="recruit-hero" id="recruit-hero">\n        <div class="recruit-hero-bg" style="${n?`background-image: url('${o(n)}')`:""}"></div>\n        <div class="recruit-hero-overlay"></div>\n        <div class="recruit-hero-content">\n          <h1 class="recruit-hero-title">${o(r)}</h1>\n          <p class="recruit-hero-subtitle">${o(i)}</p>\n          <div class="recruit-hero-stats">\n            <div class="recruit-stat">\n              <span class="recruit-stat-number">${this.jobs.length}</span>\n              <span class="recruit-stat-label">募集中の求人</span>\n            </div>\n          </div>\n          <div class="recruit-hero-buttons">\n            <a href="#recruit-jobs" class="recruit-hero-cta">求人を見る</a>\n            ${s&&a?`\n              <button type="button" class="recruit-video-button" data-video-url="${o(a)}">\n                <span class="recruit-video-button-icon">▶</span>\n                <span class="recruit-video-button-text">動画を見る</span>\n              </button>\n            `:""}\n          </div>\n        </div>\n      </section>\n    `}renderCompanyIntroSection(){const e=this.company;return e.description||e.jobContent?`\n      <section class="recruit-section recruit-about" id="recruit-about">\n        <div class="recruit-section-inner">\n          <h2 class="recruit-section-title">私たちについて</h2>\n          <div class="recruit-about-content">\n            ${e.imageUrl?`\n              <div class="recruit-about-image">\n                <img src="${o(e.imageUrl)}" alt="${o(e.company)}">\n              </div>\n            `:""}\n            <div class="recruit-about-text">\n              ${e.description?`<p>${this.formatText(e.description)}</p>`:""}\n              ${e.jobContent?`\n                <h3>お仕事内容</h3>\n                <p>${this.formatText(e.jobContent)}</p>\n              `:""}\n            </div>\n          </div>\n        </div>\n      </section>\n    `:""}renderJobsSection(){const e=(this.recruitSettings||{}).jobsTitle||"募集中の求人";if(0===this.jobs.length)return`\n        <section class="recruit-section recruit-jobs" id="recruit-jobs">\n          <div class="recruit-section-inner">\n            <h2 class="recruit-section-title">${o(e)}</h2>\n            <p class="recruit-no-jobs">現在募集中の求人はありません。</p>\n          </div>\n        </section>\n      `;const t=this.renderJobTypeTabs();return`\n      <section class="recruit-section recruit-jobs" id="recruit-jobs">\n        <div class="recruit-section-inner">\n          <h2 class="recruit-section-title">${o(e)}</h2>\n          ${t}\n          <div class="recruit-jobs-grid" id="recruit-jobs-grid">\n            ${this.jobs.map(e=>this.renderJobCard(e)).join("")}\n          </div>\n        </div>\n      </section>\n    `}renderJobTypeTabs(){const e=[...new Set(this.jobs.map(e=>e.jobType).filter(Boolean))];if(e.length<=1)return"";const t={};return this.jobs.forEach(e=>{const n=e.jobType||"その他";t[n]=(t[n]||0)+1}),`\n      <div class="recruit-job-tabs" id="recruit-job-tabs">\n        <button class="recruit-job-tab active" data-type="all">\n          すべて<span class="tab-count">${this.jobs.length}</span>\n        </button>\n        ${e.map(e=>`\n          <button class="recruit-job-tab" data-type="${o(e)}">\n            ${o(e)}<span class="tab-count">${t[e]||0}</span>\n          </button>\n        `).join("")}\n      </div>\n    `}setupJobTypeTabs(){const e=document.getElementById("recruit-job-tabs");e&&e.addEventListener("click",t=>{const n=t.target.closest(".recruit-job-tab");if(!n)return;const r=n.dataset.type;this.filterJobsByType(r),e.querySelectorAll(".recruit-job-tab").forEach(e=>e.classList.remove("active")),n.classList.add("active")})}filterJobsByType(e){this.selectedJobType=e;document.querySelectorAll(".recruit-job-card").forEach(t=>{const n=t.dataset.jobType||"";"all"===e||n===e?(t.style.display="",t.classList.remove("hidden")):(t.style.display="none",t.classList.add("hidden"))})}renderJobCard(e){var t;const n=e.jobId||e["求人ID"]||e.id||"",r=`lp.html?j=${this.companyDomain}_${n}`,i=e.imageUrl||(null==(t=this.company)?void 0:t.imageUrl)||"",s=e.jobType||"",a=function(e){if(!e)return!1;const t=new Date(e);return!isNaN(t.getTime())&&t>=new Date((new Date).getTime()-6048e5)}(e.publishStartDate);return`\n      <a href="${r}" class="recruit-job-card${a?" is-new":""}" data-job-type="${o(s)}">\n        ${a?'<span class="recruit-job-new-tag">✨ NEW</span>':""}\n        <div class="recruit-job-card-image" style="${i?`background-image: url('${o(i)}')`:""}">\n          ${i?"":'<div class="recruit-job-card-placeholder"></div>'}\n        </div>\n        <div class="recruit-job-card-content">\n          ${s?`<span class="recruit-job-card-type">${o(s)}</span>`:""}\n          <h3 class="recruit-job-card-title">${o(e.title||"求人情報")}</h3>\n          ${e.location?`<p class="recruit-job-card-location">${o(e.location)}</p>`:""}\n          ${e.access?`<p class="recruit-job-card-access">${o(e.access)}</p>`:""}\n          <div class="recruit-job-card-highlights">\n            ${e.monthlySalary?`<span class="recruit-highlight salary">${o(e.monthlySalary)}</span>`:""}\n            ${e.totalBonus?`<span class="recruit-highlight bonus">${o(e.totalBonus)}</span>`:""}\n          </div>\n          ${e.features||e.displayedFeatures?`\n            <div class="recruit-job-card-features">\n              ${this.renderFeatures(e.features,e.displayedFeatures)}\n            </div>\n          `:""}\n          <span class="recruit-job-card-link">詳細を見る →</span>\n        </div>\n      </a>\n    `}renderFeatures(e,t=""){if(t&&"string"==typeof t){const e=t.split(/[,、]/).map(e=>e.trim()).filter(e=>e).slice(0,3);if(e.length>0)return e.map(e=>`<span class="recruit-feature-tag">${o(e)}</span>`).join("")}if(!e)return"";if("string"!=typeof e)return"";return e.split(/[,、]/).map(e=>e.trim()).filter(e=>e).slice(0,3).map(e=>`<span class="recruit-feature-tag">${o(e)}</span>`).join("")}renderCTASection(){const e=this.recruitSettings||{},t=e.ctaTitle||"あなたの応募をお待ちしています",n=e.ctaText||"気になる求人があれば、ぜひお気軽にご応募ください。";return`\n      <section class="recruit-section recruit-cta">\n        <div class="recruit-section-inner">\n          <h2 class="recruit-cta-title">${o(t)}</h2>\n          <p class="recruit-cta-text">${o(n)}</p>\n          <a href="#recruit-jobs" class="recruit-cta-button">求人一覧へ戻る</a>\n        </div>\n      </section>\n    `}updateSEO(){const e=this.company,t=this.recruitSettings||{},n=t.ogpTitle||"",r=t.ogpDescription||"",o=t.ogpImage||t.heroImage||e.imageUrl||"",i=n?`${n} | ${e.company}`:`${e.company} 採用情報 | リクエコ求人ナビ`,s=r||(e.description?this.truncateText(e.description,150):`${e.company}の採用情報ページ。募集中の求人をご覧ください。`);document.title=i,this.updateMetaTag("description",s),this.updateMetaTag("og:title",i,"property"),this.updateMetaTag("og:description",s,"property"),o&&this.updateMetaTag("og:image",o,"property")}updateMetaTag(e,t,n="name"){let r=document.querySelector(`meta[${n}="${e}"]`);r||(r=document.createElement("meta"),r.setAttribute(n,e),document.head.appendChild(r)),r.setAttribute("content",t)}truncateText(e,t){if(!e)return"";const n=e.replace(/<[^>]*>/g,"").replace(/\n/g," ");return n.length<=t?n:n.substring(0,t)+"..."}formatText(e){return e?/<[a-z][\s\S]*>/i.test(e)?e:o(e).replace(/\n/g,"<br>"):""}renderLayoutComponents(){var e,t;const n=this.recruitSettings||{},r=n.designPattern||"standard",o=n.layoutStyle||"default",c=document.getElementById("recruit-content"),d=!(!n.logoUrl&&!n.companyNameDisplay),l=!(!n.phoneNumber&&!n.ctaButtonText);if(d)document.body.classList.add("has-fixed-header");else{const e=document.querySelector(".recruit-header");e&&(e.style.display="block"),document.body.classList.add("has-fixed-header")}if(l&&document.body.classList.add("has-fixed-cta-bar"),document.body.setAttribute("data-layout-style",o),document.body.classList.add(`lp-pattern-${r}`),d){const t=i({logoUrl:n.logoUrl||"",companyName:n.companyNameDisplay||(null==(e=this.company)?void 0:e.company)||"",recruitPageUrl:"",showBackLink:!1,designPattern:r});document.body.insertAdjacentHTML("afterbegin",t)}if(c){const e=s({companyName:n.companyNameDisplay||(null==(t=this.company)?void 0:t.company)||"",designPattern:r});c.insertAdjacentHTML("afterend",e)}if(l){const e=a({phoneNumber:n.phoneNumber||"",ctaButtonText:n.ctaButtonText||"今すぐ応募する",ctaUrl:"#recruit-jobs",designPattern:r});document.body.insertAdjacentHTML("beforeend",e)}}showError(e){this.hideLoading();const t=document.getElementById("recruit-content");t&&(t.innerHTML=`\n        <div class="recruit-error">\n          <h2>エラー</h2>\n          <p>${o(e)}</p>\n          <a href="./" class="recruit-error-link">トップページへ戻る</a>\n        </div>\n      `)}hideLoading(){const e=document.getElementById("recruit-loading");e&&(e.style.display="none")}setupVideoButton(){const e=document.querySelector(".recruit-video-button");e&&e.addEventListener("click",t=>{t.preventDefault();const n=e.dataset.videoUrl;n&&this.showVideoModal(n)})}showVideoModal(e){const t=this.getYouTubeEmbedUrl(e);if(!t)return void console.error("[RecruitPage] YouTube URLの解析に失敗:",e);const n=`\n      <div class="recruit-video-modal" id="recruit-video-modal">\n        <div class="recruit-video-modal-backdrop"></div>\n        <div class="recruit-video-modal-content">\n          <button type="button" class="recruit-video-modal-close" aria-label="閉じる">&times;</button>\n          <div class="recruit-video-modal-wrapper">\n            <iframe\n              src="${t}?autoplay=1&rel=0"\n              frameborder="0"\n              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n              allowfullscreen\n            ></iframe>\n          </div>\n        </div>\n      </div>\n    `;document.body.insertAdjacentHTML("beforeend",n);const r=document.getElementById("recruit-video-modal"),o=r.querySelector(".recruit-video-modal-close"),i=r.querySelector(".recruit-video-modal-backdrop");o.addEventListener("click",()=>this.closeVideoModal()),i.addEventListener("click",()=>this.closeVideoModal());const s=e=>{"Escape"===e.key&&(this.closeVideoModal(),document.removeEventListener("keydown",s))};document.addEventListener("keydown",s),document.body.style.overflow="hidden"}closeVideoModal(){const e=document.getElementById("recruit-video-modal");e&&e.remove(),document.body.style.overflow=""}getYouTubeEmbedUrl(e){if(!e)return null;const t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/];for(const n of t){const t=e.match(n);if(t&&t[1])return`https://www.youtube.com/embed/${t[1]}`}return null}}document.addEventListener("DOMContentLoaded",()=>{(new c).init()});
