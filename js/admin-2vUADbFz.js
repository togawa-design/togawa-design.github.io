import"./modulepreload-polyfill-YP0FEG5d.js";import{c as e,g as t,r as n,a,b as o,s as c,d as s,e as i,j as l,f as d,h as r,i as m,k as u,l as p,p as y,m as g,n as v,o as b,q as f,t as h,u as E,v as w,w as I,x as j,y as L,z as B,A as $,B as k,C,D as x,E as S,F as M,G as D,H as A,I as T,J as H,K as q,L as R,M as U,N as z,O as P,P as N,Q as J,R as _,S as O,T as W,U as F,V,W as G,X as K,Y as Z,Z as Y,_ as X,$ as Q,a0 as ee,a1 as te,a2 as ne,a3 as ae,a4 as oe,a5 as ce,a6 as se,a7 as ie,a8 as le,a9 as de,aa as re}from"./auth-BX5ABlML.js";import{f as me,e as ue,a as pe,b as ye}from"./utils-DCR9QUau.js";import{r as ge,h as ve,a as be,u as fe,b as he,s as Ee,p as we,c as Ie,d as je}from"./core-BE8AvM4l.js";import{l as Le}from"./api-B1sZYcOA.js";import{f as Be,a as $e,i as ke}from"./jobs-loader-vTfia0vR.js";import{u as Ce,a as xe}from"./image-uploader-gAKnoYUY.js";import"./LPEditor-DhYOL23n.js";let Se=[],Me=null,De=null,Ae=null,Te=null,He=null,qe=null;async function Re(){const a=document.getElementById("date-range"),o=(null==a?void 0:a.value)||7,c=e.apiEndpoint;if(c)try{await async function(e,a){try{Ue(!0),function(e){const t='<div class="section-loading"><div class="loading-spinner"></div><span>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span></div>';document.querySelectorAll(".stat-value").forEach(e=>{e.dataset.originalText=e.textContent,e.innerHTML='<span class="loading-dots">...</span>'});const n=document.getElementById("daily-chart");n&&e&&(n.innerHTML=t);const a=document.querySelector(".data-table tbody");a&&e&&(a.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;">${t}</td></tr>`);const o=document.getElementById("company-cards");o&&e&&(o.innerHTML=t);const c=document.querySelector("#applications-section .data-table tbody");c&&e&&(c.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:2rem;">${t}</td></tr>`)}(!0);const s={},i=t();i&&(s.Authorization=`Bearer ${i}`);const l=await fetch(`${a}?days=${e}`,{headers:s});if(!l.ok)throw new Error(`API Error: ${l.status}`);const d=await l.json();if(!d.success)throw new Error(d.error||"Unknown error");const r=d.data;r.overview&&(ze("total-pageviews",me(r.overview.pageViews)),ze("total-users",me(r.overview.users)),ze("company-views",me(r.overview.companyViews)),ze("apply-clicks",me(r.overview.applyClicks)),o=r.overview.gender,c=r.overview.age,n(o,c,{maleBarId:"admin-gender-bar-male",femaleBarId:"admin-gender-bar-female",malePercentId:"admin-gender-male-percent",femalePercentId:"admin-gender-female-percent",ageContainerId:"admin-age-bars"})),r.daily&&Pe(r.daily),r.companies&&(Se=r.companies.filter(e=>e.domain&&"(not set)"!==e.domain&&e.name&&"(not set)"!==e.name).map(e=>({name:e.name,domain:e.domain,views:e.views,clicks:e.clicks,pattern:"standard"})),Je(),_e()),r.applications&&function(e){const t=document.querySelector("#applications-table tbody");if(!t)return;const n={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${ue(e.date)}</td>\n      <td>${ue(e.company)}</td>\n      <td><span class="type-badge ${ue(e.type)}">${n[e.type]||ue(e.type)}</span></td>\n      <td>${ue(e.pageType||e.pagePath||"-")}</td>\n      <td>${ue(e.source)}</td>\n    </tr>\n  `).join("")}(r.applications),Ue(!1)}catch(s){console.error("[Admin] API fetch error:",s),Ue(!1),Ne(e)}var o,c}(o,c)}catch(s){console.error("[Admin] API fetch failed, loading mock data:",s),Ne(o)}else Ne(o)}function Ue(e){const t=document.getElementById("refresh-btn");t&&(t.textContent=e?"èª­ã¿è¾¼ã¿ä¸­...":"æ›´æ–°",t.disabled=e)}function ze(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function Pe(e){const t=document.getElementById("daily-chart");if(!t)return;if(!e||0===e.length)return void(t.innerHTML="<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>");Me&&(Me.destroy(),Me=null);const n=e.length>30?e.filter((e,t)=>t%3==0):e;t.innerHTML='<canvas id="daily-chart-canvas"></canvas>';const a=document.getElementById("daily-chart-canvas").getContext("2d");Me=new Chart(a,{type:"line",data:{labels:n.map(e=>e.date),datasets:[{label:"PV",data:n.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:3,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:10},maxRotation:45}}}}})}function Ne(e){const t=80*e,n=45*e,a=12*e;ze("total-pageviews",me(150*e+Math.floor(500*Math.random()))),ze("total-users",me(t+Math.floor(200*Math.random()))),ze("company-views",me(n+Math.floor(100*Math.random()))),ze("apply-clicks",me(a+Math.floor(30*Math.random()))),function(e){const t=[],n=new Date;for(let a=e-1;a>=0;a--){const e=new Date(n);e.setDate(e.getDate()-a),t.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(100+200*Math.random())})}Pe(t)}(e),Se=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",domain:"toyota",views:1250,clicks:89,pattern:"modern"},{name:"æ—¥ç”£è‡ªå‹•è»Š",domain:"nissan",views:980,clicks:67,pattern:"classic"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",domain:"honda",views:856,clicks:54,pattern:"colorful"},{name:"ã‚¹ãƒãƒ«",domain:"subaru",views:654,clicks:43,pattern:"minimal"},{name:"ãƒãƒ„ãƒ€",domain:"mazda",views:523,clicks:32,pattern:"standard"},{name:"ã‚¹ã‚ºã‚­",domain:"suzuki",views:412,clicks:28,pattern:"modern"},{name:"ãƒ€ã‚¤ãƒãƒ„",domain:"daihatsu",views:387,clicks:24,pattern:"classic"},{name:"ä¸‰è±è‡ªå‹•è»Š",domain:"mitsubishi",views:298,clicks:18,pattern:"standard"}],Je(),_e(),function(){const e=document.querySelector("#applications-table tbody");if(!e)return;const t=[{date:"2025/01/17 14:32",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/17 13:15",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"line",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/17 11:48",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Yahooæ¤œç´¢"},{date:"2025/01/17 10:22",company:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/16 18:45",company:"ã‚¹ãƒãƒ«",type:"line",source:"Googleæ¤œç´¢"},{date:"2025/01/16 16:30",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"SNS"},{date:"2025/01/16 14:12",company:"ãƒãƒ„ãƒ€",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/16 11:55",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"}],n={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};e.innerHTML=t.map(e=>`\n    <tr>\n      <td>${ue(e.date)}</td>\n      <td>${ue(e.company)}</td>\n      <td><span class="type-badge ${ue(e.type)}">${n[e.type]}</span></td>\n      <td>${ue(e.source)}</td>\n    </tr>\n  `).join("")}()}function Je(){const e=document.querySelector("#overview-company-table tbody");if(!e)return;const t=[...Se].sort((e,t)=>t.views-e.views);e.innerHTML=t.slice(0,5).map((e,t)=>{const n=(e.clicks/e.views*100).toFixed(1);return`\n      <tr>\n        <td>${t+1}</td>\n        <td>${ue(e.name)}</td>\n        <td>${me(e.views)}</td>\n        <td>${e.clicks}</td>\n        <td>${n}%</td>\n      </tr>\n    `}).join("")}function _e(){const n=document.getElementById("company-cards");n&&(n.innerHTML=Se.map(e=>{const t=(e.clicks/e.views*100).toFixed(1),n=a(e.pattern);return`\n      <div class="company-card" data-domain="${ue(e.domain)}" data-name="${ue(e.name)}" data-views="${e.views}" data-clicks="${e.clicks}">\n        <div class="company-card-header">\n          <h4>${ue(e.name)}</h4>\n          <span class="pattern-badge ${ue(e.pattern)}">${n}</span>\n        </div>\n        <div class="company-card-stats">\n          <div class="card-stat">\n            <span class="stat-value">${me(e.views)}</span>\n            <span class="stat-label">ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${e.clicks}</span>\n            <span class="stat-label">å¿œå‹Ÿã‚¯ãƒªãƒƒã‚¯</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${t}%</span>\n            <span class="stat-label">CVR</span>\n          </div>\n        </div>\n        <button class="btn-view-status" data-domain="${ue(e.domain)}" data-name="${ue(e.name)}">ä¼šç¤¾ã®çŠ¶æ³ã‚’ç¢ºèª</button>\n      </div>\n    `}).join(""),n.querySelectorAll(".btn-view-status").forEach(n=>{n.addEventListener("click",n=>{!async function(n,a){const o=document.getElementById("company-detail-title");o&&(o.textContent=`${a} ã®åˆ†æ`);const c=document.getElementById("detail-view-page-btn");c&&(c.href=`company.html?c=${n}`);document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const s=document.getElementById("section-company-detail");s&&s.classList.add("active");const i=document.getElementById("page-title");i&&(i.textContent="ä¼æ¥­è©³ç´°åˆ†æ");document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")}),function(){const e='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';document.querySelectorAll(".detail-stat-value").forEach(e=>{e.textContent="-"}),document.querySelectorAll(".detail-chart").forEach(t=>{t.innerHTML=e}),document.querySelectorAll(".detail-table-container tbody").forEach(e=>{e.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>'})}();const l=document.getElementById("date-range"),d=(null==l?void 0:l.value)||30;try{await async function(n,a){const o=e.apiEndpoint,c={},s=t();s&&(c.Authorization=`Bearer ${s}`);const i=await fetch(`${o}?type=company-detail&domain=${n}&days=${a}`,{headers:c}),l=await i.json();if(!l.success)throw new Error(l.error||"API Error");!async function(e,t){var n,a;const o=Se.find(e=>e.domain===t)||{},c=(null==(n=e.summary)?void 0:n.totalViews)||o.views||0,s=o.clicks||0,i=c>0?(s/c*100).toFixed(1):0,l=(null==(a=e.summary)?void 0:a.avgDailyViews)||0;ze("detail-total-views",me(c)),ze("detail-total-clicks",me(s)),ze("detail-cvr",`${i}%`),ze("detail-avg-daily",me(Math.round(l))),at(e.daily||[]),ct(e.traffic||[]);const d=e.gender||{};st({male:d.male||0,female:d.female||0,other:d.unknown||0});const r=e.age||{};it((m=r,{"20s":(m["18-24"]||0)+(m["25-34"]||0),"30s":m["35-44"]||0,"40s":m["45-54"]||0,"50s":(m["55-64"]||0)+(m["65+"]||0)}));var m;const u=e.jobs||[];if(u.length>0){ot(u.slice(0,5).map(e=>({title:e.jobTitle||e.pagePath||"ä¸æ˜",applications:e.applications||0})));lt(u.map(e=>({title:e.jobTitle||e.pagePath||"ä¸æ˜",views:e.views||0,applications:e.applications||0,cvr:e.views>0?((e.applications||0)/e.views*100).toFixed(1):"0.0"})))}else ot([]),lt([]);await dt(t)}(l.data,n)}(n,d)}catch(r){console.error("[Admin] Company detail error:",r),function(e){const t=Se.find(t=>t.domain===e)||{views:1e3,clicks:50},n=t.views,a=t.clicks,o=(a/n*100).toFixed(1);ze("detail-total-views",me(n)),ze("detail-total-clicks",me(a)),ze("detail-cvr",`${o}%`),ze("detail-avg-daily",me(Math.round(n/30)));const c=[],s=new Date;for(let l=29;l>=0;l--){const e=new Date(s);e.setDate(e.getDate()-l),c.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(20+60*Math.random())})}at(c);const i=[{title:"è£½é€ ã‚¹ã‚¿ãƒƒãƒ•",applications:23},{title:"çµ„ç«‹ä½œæ¥­å“¡",applications:18},{title:"æ¤œæŸ»ãƒ»æ¤œå“",applications:12},{title:"æ©Ÿæ¢°ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼",applications:8},{title:"ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒ•ãƒˆ",applications:5}];ot(i);ct([{channel:"Organic Search",count:Math.floor(.45*n)},{channel:"Direct",count:Math.floor(.28*n)},{channel:"Social",count:Math.floor(.18*n)},{channel:"Referral",count:Math.floor(.09*n)}]);st({male:Math.floor(.72*a),female:Math.floor(.25*a),other:Math.floor(.03*a)});it({"20s":Math.floor(.35*a),"30s":Math.floor(.32*a),"40s":Math.floor(.23*a),"50s":Math.floor(.1*a)}),lt(i.map(e=>({...e,views:Math.floor(n*(e.applications/a)),cvr:(e.applications/(n*(e.applications/a))*100).toFixed(1)}))),dt(e)}(n)}}(n.target.dataset.domain,n.target.dataset.name)})}))}function Oe(e){const t=document.querySelectorAll(".company-card"),n=e.toLowerCase();t.forEach(e=>{const t=e.dataset.name.toLowerCase(),a=e.dataset.domain.toLowerCase();t.includes(n)||a.includes(n)?e.style.display="":e.style.display="none"})}function We(){const e=document.getElementById("sort-by"),t=(null==e?void 0:e.value)||"views",n=document.getElementById("company-cards");if(!n)return;const a=Array.from(n.querySelectorAll(".company-card"));a.sort((e,n)=>{switch(t){case"views":return parseInt(n.dataset.views)-parseInt(e.dataset.views);case"clicks":return parseInt(n.dataset.clicks)-parseInt(e.dataset.clicks);case"cvr":const t=parseInt(e.dataset.clicks)/parseInt(e.dataset.views);return parseInt(n.dataset.clicks)/parseInt(n.dataset.views)-t;case"name":return e.dataset.name.localeCompare(n.dataset.name,"ja");default:return 0}}),a.forEach(e=>n.appendChild(e))}function Fe(){const n=document.querySelectorAll(".analytics-tab"),a=document.querySelectorAll(".analytics-tab-content");n.forEach(o=>{o.addEventListener("click",()=>{const c=o.dataset.tab;n.forEach(e=>e.classList.remove("active")),o.classList.add("active"),a.forEach(e=>e.classList.remove("active"));const s=document.getElementById(c);s&&(s.classList.add("active"),async function(n){const a=document.getElementById("date-range"),o=(null==a?void 0:a.value)||30,c=e.apiEndpoint;switch(n){case"traffic-behavior-tab":await Promise.all([Ve(o,c),Ke(o,c)]);break;case"conversion-tab":await async function(e,n){try{const a={},o=t();o&&(a.Authorization=`Bearer ${o}`);const c=await fetch(`${n}?type=funnel&days=${e}`,{headers:a}),s=await c.json();s.success&&s.data?Xe(s.data):Qe()}catch(a){console.error("[Admin] Funnel data error:",a),Qe()}}(o,c);break;case"trends-tab":await async function(e,n){try{const a={},o=t();o&&(a.Authorization=`Bearer ${o}`);const c=await fetch(`${n}?type=trends&days=${e}`,{headers:a}),s=await c.json();s.success&&s.data?et(s.data):tt()}catch(a){console.error("[Admin] Trend data error:",a),tt()}}(o,c)}}(c))})})}async function Ve(e,n){try{const a={},o=t();o&&(a.Authorization=`Bearer ${o}`);const c=await fetch(`${n}?type=engagement&days=${e}`,{headers:a}),s=await c.json();s.success&&s.data?function(e){const t=e.overall||{};ze("avg-session-duration",`${t.avgSessionDuration||0}ç§’`),ze("engagement-rate",`${t.engagementRate||0}%`),ze("bounce-rate",`${t.bounceRate||0}%`);const n=document.querySelector("#engagement-company-table tbody");n&&e.byCompany&&e.byCompany.length>0?n.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${ue(e.name||e.domain)}</td>\n        <td>${me(e.views)}</td>\n        <td>${Math.round(e.engagementTime)}ç§’</td>\n        <td>${e.avgTimePerView}ç§’</td>\n      </tr>\n    `).join(""):n&&(n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(s.data):Ge()}catch(a){console.error("[Admin] Engagement data error:",a),Ge()}}function Ge(){ze("avg-session-duration","45.2ç§’"),ze("engagement-rate","68.5%"),ze("bounce-rate","31.5%");const e=document.querySelector("#engagement-company-table tbody");if(e){const t=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",views:1250,time:4500,avg:"3.6"},{name:"æ—¥ç”£è‡ªå‹•è»Š",views:980,time:3200,avg:"3.3"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",views:856,time:2800,avg:"3.3"}];e.innerHTML=t.map(e=>`\n      <tr>\n        <td>${e.name}</td>\n        <td>${me(e.views)}</td>\n        <td>${e.time}ç§’</td>\n        <td>${e.avg}ç§’</td>\n      </tr>\n    `).join("")}}async function Ke(e,n){try{const a={},o=t();o&&(a.Authorization=`Bearer ${o}`);const c=await fetch(`${n}?type=traffic&days=${e}`,{headers:a}),s=await c.json();s.success&&s.data?Ze(s.data):Ye()}catch(a){console.error("[Admin] Traffic data error:",a),Ye()}}function Ze(e){const t=document.getElementById("channel-chart");if(t&&e.channels&&e.channels.length>0){Te&&(Te.destroy(),Te=null),t.innerHTML='<canvas id="channel-chart-canvas"></canvas>';const n=document.getElementById("channel-chart-canvas").getContext("2d");Te=new Chart(n,{type:"bar",data:{labels:e.channels.map(e=>e.channel),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:e.channels.map(e=>e.sessions),backgroundColor:["rgba(99, 102, 241, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},y:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const n=document.querySelector("#source-table tbody");n&&e.sources&&e.sources.length>0?n.innerHTML=e.sources.map(e=>`\n      <tr>\n        <td>${ue(e.source)}</td>\n        <td>${ue(e.medium)}</td>\n        <td>${me(e.sessions)}</td>\n        <td>${me(e.users)}</td>\n      </tr>\n    `).join(""):n&&(n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}function Ye(){Ze({channels:[{channel:"Organic Search",sessions:1250},{channel:"Direct",sessions:890},{channel:"Social",sessions:456},{channel:"Referral",sessions:234}],sources:[{source:"google",medium:"organic",sessions:890,users:756},{source:"(direct)",medium:"(none)",sessions:456,users:412},{source:"yahoo",medium:"organic",sessions:234,users:198}]})}function Xe(e){const t=document.getElementById("funnel-chart");t&&e.funnel&&e.funnel.length>0&&(t.innerHTML=e.funnel.map(e=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${ue(e.stage)}</span>\n        <span class="funnel-stage-count">${me(e.count)}</span>\n        <span class="funnel-stage-rate">${e.rate}%</span>\n      </div>\n    `).join(""));const n=document.getElementById("action-breakdown-chart");if(n&&e.actionBreakdown&&e.actionBreakdown.length>0){He&&(He.destroy(),He=null),n.innerHTML='<canvas id="action-chart-canvas"></canvas>';const t=document.getElementById("action-chart-canvas").getContext("2d");He=new Chart(t,{type:"bar",data:{labels:e.actionBreakdown.map(e=>e.label),datasets:[{label:"ä»¶æ•°",data:e.actionBreakdown.map(e=>e.count),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(245, 158, 11, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},y:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const a=document.querySelector("#company-funnel-table tbody");a&&e.byCompany&&e.byCompany.length>0?a.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${ue(e.domain)}</td>\n        <td>${me(e.views)}</td>\n        <td>${me(e.clicks)}</td>\n        <td>${e.cvr}%</td>\n      </tr>\n    `).join(""):a&&(a.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}function Qe(){Xe({funnel:[{stage:"ã‚µã‚¤ãƒˆè¨ªå•",count:5e3,rate:"100"},{stage:"ä¼æ¥­ãƒšãƒ¼ã‚¸é–²è¦§",count:2500,rate:"50.0"},{stage:"ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«",count:1800,rate:"36.0"},{stage:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",count:150,rate:"6.0"}],actionBreakdown:[{label:"å¿œå‹Ÿãƒœã‚¿ãƒ³",count:89},{label:"LINEç›¸è«‡",count:45},{label:"ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡",count:16}],byCompany:[{domain:"toyota",views:1250,clicks:89,cvr:"7.1"},{domain:"nissan",views:980,clicks:67,cvr:"6.8"},{domain:"honda",views:856,clicks:54,cvr:"6.3"}]})}function et(e){e.insights&&(ze("peak-day",e.insights.peakDay||"-"),ze("peak-hour",e.insights.peakHour||"-"));const t=document.getElementById("day-of-week-chart");if(t&&e.byDayOfWeek&&e.byDayOfWeek.length>0){De&&(De.destroy(),De=null),t.innerHTML='<canvas id="day-of-week-canvas"></canvas>';const n=document.getElementById("day-of-week-canvas").getContext("2d");De=new Chart(n,{type:"bar",data:{labels:e.byDayOfWeek.map(e=>e.day),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:e.byDayOfWeek.map(e=>e.sessions),backgroundColor:"rgba(99, 102, 241, 0.8)",borderColor:"rgba(99, 102, 241, 1)",borderWidth:1,borderRadius:4,barPercentage:.7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6,titleFont:{size:12},bodyFont:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const n=document.getElementById("hour-chart");if(n&&e.byHour&&e.byHour.length>0){Ae&&(Ae.destroy(),Ae=null);const t=[{label:"æ·±å¤œ",hours:[0,1,2,3,4,5]},{label:"æœ",hours:[6,7,8,9,10,11]},{label:"æ˜¼",hours:[12,13,14,15,16,17]},{label:"å¤œ",hours:[18,19,20,21,22,23]}].map(t=>{const n=t.hours.reduce((t,n)=>{const a=e.byHour.find(e=>e.hour===n);return t+(a?a.sessions:0)},0);return{label:t.label,sessions:n}});n.innerHTML='<canvas id="hour-chart-canvas"></canvas>';const a=document.getElementById("hour-chart-canvas").getContext("2d");Ae=new Chart(a,{type:"bar",data:{labels:t.map(e=>e.label),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:t.map(e=>e.sessions),backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1,borderRadius:4,barPercentage:.7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6,titleFont:{size:12},bodyFont:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}}function tt(){ze("peak-day","æœ¨"),ze("peak-hour","14æ™‚");et({byDayOfWeek:[{day:"æ—¥",sessions:380},{day:"æœˆ",sessions:270},{day:"ç«",sessions:245},{day:"æ°´",sessions:244},{day:"æœ¨",sessions:250},{day:"é‡‘",sessions:278},{day:"åœŸ",sessions:358}],byHour:Array.from({length:24},(e,t)=>({hour:t,sessions:Math.floor(50*Math.random())+10}))})}function nt(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-companies");e&&e.classList.add("active"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector('[data-section="companies"]');t&&t.parentElement.classList.add("active");const n=document.getElementById("page-title");n&&(n.textContent="ä¼æ¥­åˆ¥ãƒ‡ãƒ¼ã‚¿")}function at(e){const t=document.getElementById("detail-daily-chart");if(!t||!e.length)return void(t&&(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'));qe&&(qe.destroy(),qe=null),t.innerHTML='<canvas id="detail-daily-canvas"></canvas>';const n=document.getElementById("detail-daily-canvas").getContext("2d");qe=new Chart(n,{type:"line",data:{labels:e.map(e=>e.date),datasets:[{label:"PV",data:e.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:8,cornerRadius:4}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:10}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:9},maxRotation:45}}}}})}function ot(e){const t=document.getElementById("detail-job-chart");if(!t)return;if(!e.length)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=Math.max(...e.map(e=>e.applications));t.innerHTML=`\n    <div class="detail-bar-chart">\n      ${e.slice(0,5).map((e,t)=>{const a=n>0?e.applications/n*100:0;return`\n          <div class="detail-bar-row">\n            <span class="detail-bar-label" title="${ue(e.title)}">${ue(e.title)}</span>\n            <div class="detail-bar-track">\n              <div class="detail-bar-fill job-${t+1}" style="width: ${a}%"></div>\n              <span class="detail-bar-value">${e.applications}ä»¶</span>\n            </div>\n          </div>\n        `}).join("")}\n    </div>\n  `}function ct(e){const t=document.getElementById("detail-traffic-chart");if(!t)return;if(!e.length)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=e.reduce((e,t)=>e+t.count,0),a=["organic","direct","social","referral"];let o=[],c=0;e.forEach((e,t)=>{const s=e.count/n*100,i=a[t%a.length];o.push(`${{organic:"#10b981",direct:"#6366f1",social:"#f59e0b",referral:"#8b5cf6"}[i]} ${c}deg ${c+3.6*s}deg`),c+=3.6*s}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${e.map((e,t)=>{const o=(e.count/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${a[t%a.length]}"></span>\n              <span class="pie-label">${ue(e.channel)}</span>\n              <span class="pie-value">${o}%</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function st(e){const t=document.getElementById("detail-gender-chart");if(!t)return;const n=e.male+e.female+e.other;if(0===n)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=(e.male/n*100).toFixed(1),o=(e.female/n*100).toFixed(1),c=(e.other/n*100).toFixed(1),s=e.male/n*360,i=e.female/n*360;t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(#3b82f6 0deg ${s}deg, #ec4899 ${s}deg ${s+i}deg, #94a3b8 ${s+i}deg 360deg);"></div>\n      <div class="pie-legend">\n        <div class="pie-legend-item">\n          <span class="pie-color male"></span>\n          <span class="pie-label">ç”·æ€§</span>\n          <span class="pie-value">${e.male}äºº (${a}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color female"></span>\n          <span class="pie-label">å¥³æ€§</span>\n          <span class="pie-value">${e.female}äºº (${o}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color other"></span>\n          <span class="pie-label">ãã®ä»–</span>\n          <span class="pie-value">${e.other}äºº (${c}%)</span>\n        </div>\n      </div>\n    </div>\n  `}function it(e){const t=document.getElementById("detail-age-chart");if(!t)return;const n=e["20s"]+e["30s"]+e["40s"]+e["50s"];if(0===n)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=[{key:"20s",label:"20ä»£",color:"age-20s",colorCode:"#3b82f6"},{key:"30s",label:"30ä»£",color:"age-30s",colorCode:"#10b981"},{key:"40s",label:"40ä»£",color:"age-40s",colorCode:"#f59e0b"},{key:"50s",label:"50ä»£ä»¥ä¸Š",color:"age-50s",colorCode:"#ef4444"}];let o=[],c=0;a.forEach(t=>{const a=e[t.key]/n*100;o.push(`${t.colorCode} ${c}deg ${c+3.6*a}deg`),c+=3.6*a}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${a.map(t=>{const a=(e[t.key]/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${t.color}"></span>\n              <span class="pie-label">${t.label}</span>\n              <span class="pie-value">${e[t.key]}äºº (${a}%)</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function lt(e){const t=document.querySelector("#detail-job-table tbody");t&&(e.length?t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${ue(e.title)}</td>\n      <td>${me(e.views)}</td>\n      <td>${e.applications}</td>\n      <td>${e.cvr}%</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}async function dt(n){const a=e.apiEndpoint,o={},c=t();c&&(o.Authorization=`Bearer ${c}`);try{const e=await fetch(`${a}?type=recent-applications&domain=${n}&limit=10`,{headers:o}),t=await e.json();if(t.success&&t.data&&t.data.applications){rt(t.data.applications.map(e=>({date:e.date,job:e.jobTitle||"-",type:e.type||"apply",source:e.source||"Direct"})))}else rt([])}catch(s){console.error("[Admin] Recent applications error:",s),rt([])}}function rt(e){const t=document.querySelector("#detail-recent-applications tbody");if(!t)return;const n={apply:"å¿œå‹Ÿ",line:"LINE",consult:"ç›¸è«‡"};e.length?t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${ue(e.date)}</td>\n      <td>${ue(e.job)}</td>\n      <td><span class="type-badge ${e.type}">${n[e.type]||e.type}</span></td>\n      <td>${ue(e.source)}</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}let mt=null,ut={},pt=null;async function yt(e=null){e&&(pt=e),await async function(){const e=document.getElementById("recruit-company-grid");if(!e)return;try{const t=(await window.JobsLoader.fetchCompanies()).filter(e=>window.JobsLoader.isCompanyVisible(e));if(0===t.length)return void(e.innerHTML='<p class="no-data">è¡¨ç¤ºå¯èƒ½ãªä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“</p>');if(e.innerHTML=t.map(e=>`\n      <div class="lp-company-card" data-company-domain="${ue(e.companyDomain||"")}">\n        <div class="lp-company-card-image" style="${e.imageUrl?`background-image: url('${ue(e.imageUrl)}')`:""}">\n          ${e.imageUrl?"":'<span class="no-image-icon">ğŸ¢</span>'}\n        </div>\n        <div class="lp-company-card-content">\n          <h4 class="lp-company-card-title">${ue(e.company||"ä¼šç¤¾åæœªè¨­å®š")}</h4>\n          <p class="lp-company-card-domain">${ue(e.companyDomain||"")}</p>\n        </div>\n      </div>\n    `).join(""),e.querySelectorAll(".lp-company-card").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.companyDomain,a=t.find(e=>e.companyDomain===n);a&&gt(a)})}),pt){const e=t.find(e=>e.companyDomain===pt);e&&gt(e),pt=null}}catch(t){console.error("[RecruitSettings] ä¼šç¤¾ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<p class="error">ä¼šç¤¾ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}}(),function(){const e=document.getElementById("recruit-company-search");e&&e.addEventListener("input",()=>{const t=e.value.toLowerCase();document.querySelectorAll("#recruit-company-grid .lp-company-card").forEach(e=>{var n,a;const o=(null==(n=e.querySelector(".lp-company-card-title"))?void 0:n.textContent.toLowerCase())||"",c=(null==(a=e.dataset.companyDomain)?void 0:a.toLowerCase())||"";e.style.display=o.includes(t)||c.includes(t)?"":"none"})});const t=document.getElementById("recruit-back-to-companies");t&&t.addEventListener("click",()=>{mt=null,ut={},document.getElementById("recruit-company-select-group").style.display="block",document.getElementById("recruit-editor").style.display="none"});const n=document.getElementById("btn-save-recruit-settings");n&&n.addEventListener("click",async()=>{mt&&await ve(mt.companyDomain,e=>{ut=e})});const a=document.getElementById("btn-reset-recruit-settings");a&&a.addEventListener("click",async()=>{await pe("è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ","æœªä¿å­˜ã®å¤‰æ›´ã¯å¤±ã‚ã‚Œã¾ã™ã€‚")&&mt&&(be(ut,mt.company,mt.description,mt.imageUrl),fe())})}(),ge()}async function gt(e){mt=e,document.getElementById("recruit-company-select-group").style.display="none",document.getElementById("recruit-editor").style.display="block",document.getElementById("recruit-selected-company-name").textContent=e.company,he(e.companyDomain),Ee(e.companyDomain),vt(!0);try{ut=await Le(e.companyDomain)||{},Object.keys(ut).length>0?we(ut,e.company):Ie(e.company,e.description,e.imageUrl),je()}finally{vt(!1)}}function vt(e){const t=document.getElementById("recruit-editor");if(!t)return;t.querySelectorAll("input, select, textarea, button").forEach(t=>{t.disabled=e});const n=document.getElementById("btn-save-recruit-settings"),a=document.getElementById("btn-reset-recruit-settings");n&&(n.disabled=e),a&&(a.disabled=e);const o=t.querySelector(".recruit-loading-overlay");if(e){if(!o){const e=document.createElement("div");e.className="recruit-loading-overlay",e.innerHTML='<div class="loading-spinner"></div><p>èª­ã¿è¾¼ã¿ä¸­...</p>',t.style.position="relative",t.appendChild(e)}}else null==o||o.remove()}let bt=[],ft=[],ht=[],Et=null;async function wt(e=null){e&&(Et=e),await async function(){const e=document.getElementById("job-listings-container");if(!e)return;try{if(ft=await Be(),bt=await $e(),function(){const e=document.getElementById("job-company-filter");if(!e)return;const t=ft.filter(e=>ke(e));e.innerHTML='<option value="">ã™ã¹ã¦ã®ä¼šç¤¾</option>',t.forEach(t=>{const n=document.createElement("option");n.value=t.companyDomain||"",n.textContent=t.company||"ä¼šç¤¾åæœªè¨­å®š",e.appendChild(n)})}(),Et){const e=document.getElementById("job-company-filter");e&&(e.value=Et),Et=null}!function(){const e=document.getElementById("summary-total-jobs"),t=document.getElementById("summary-active-jobs"),n=document.getElementById("summary-draft-jobs"),a=document.getElementById("summary-companies");e&&(e.textContent=bt.length.toString());let c=0,s=0;bt.forEach(e=>{const t=o(e);"active"===t&&c++,"draft"===t&&s++}),t&&(t.textContent=c.toString());n&&(n.textContent=s.toString());const i=new Set(bt.map(e=>e.companyDomain));a&&(a.textContent=i.size.toString())}(),It()}catch(t){console.error("æ±‚äººä¸€è¦§ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<div class="error-message">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}(),function(){const e=document.getElementById("job-company-filter");e&&e.addEventListener("change",It);const t=document.getElementById("job-status-filter");t&&t.addEventListener("change",It);const n=document.getElementById("job-search-input");n&&n.addEventListener("input",function(e,t){let n;return function(...a){const o=()=>{clearTimeout(n),e(...a)};clearTimeout(n),n=setTimeout(o,t)}}(It,300));const a=document.getElementById("job-sort-select");a&&a.addEventListener("change",It)}()}function It(){var e,t,n,a,c;const s=(null==(e=document.getElementById("job-company-filter"))?void 0:e.value)||"",i=(null==(t=document.getElementById("job-status-filter"))?void 0:t.value)||"",l=(null==(a=null==(n=document.getElementById("job-search-input"))?void 0:n.value)?void 0:a.toLowerCase())||"",d=(null==(c=document.getElementById("job-sort-select"))?void 0:c.value)||"id";ht=bt.filter(e=>{if(s&&e.companyDomain!==s)return!1;if(i){if(o(e)!==i)return!1}if(l){if(![e.title||"",e.company||"",e.location||"",e.area||""].join(" ").toLowerCase().includes(l))return!1}return!0}),function(e,t){e.sort((e,n)=>{switch(t){case"id":const t=parseInt(e.id,10),a=parseInt(n.id,10);return isNaN(t)||isNaN(a)?(e.id||"").localeCompare(n.id||""):t-a;case"company":return(e.company||"").localeCompare(n.company||"");case"title":return(e.title||"").localeCompare(n.title||"");case"updated":return new Date(n.updatedAt||0)-new Date(e.updatedAt||0);case"applications":return(n.applicationCount||0)-(e.applicationCount||0);default:return 0}})}(ht,d),function(e){const t=document.getElementById("job-listings-container");if(!t)return;if(0===e.length)return void(t.innerHTML='<div class="no-data">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“</div>');const n={};e.forEach(e=>{const t=e.companyDomain||"unknown";n[t]||(n[t]={company:e.company||"ä¼šç¤¾åæœªè¨­å®š",companyDomain:t,jobs:[]}),n[t].jobs.push(e)});let a="";Object.values(n).forEach(e=>{a+=function(e){const t=ft.find(t=>t.companyDomain===e.companyDomain),n=(null==t?void 0:t.logoUrl)||(null==t?void 0:t.imageUrl)||"";return`\n    <div class="job-listings-company-group">\n      <div class="job-listings-company-header">\n        <div class="company-logo-small">\n          ${n?`<img src="${ue(n)}" alt="${ue(e.company)}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><span class="logo-fallback" style="display:none">ğŸ¢</span>`:'<span class="logo-fallback">ğŸ¢</span>'}\n        </div>\n        <div class="company-info">\n          <h4 class="company-name">${ue(e.company)}</h4>\n          <span class="company-job-count">${e.jobs.length}ä»¶ã®æ±‚äºº</span>\n        </div>\n        <button class="btn-view-company" data-domain="${ue(e.companyDomain)}" title="ä¼šç¤¾è©³ç´°ã‚’è¦‹ã‚‹">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>\n        </button>\n      </div>\n      <div class="job-listings-cards">\n        ${e.jobs.map(e=>function(e){const t=o(e),n={active:"æ²è¼‰ä¸­",draft:"ä¸‹æ›¸ã",expired:"æœŸé™åˆ‡ã‚Œ"}[t],a={active:"status-active",draft:"status-draft",expired:"status-expired"}[t],c=e.imageUrl||"";return`\n    <div class="job-listing-card" data-job-id="${ue(e.id||"")}" data-company-domain="${ue(e.companyDomain||"")}">\n      <div class="job-card-image">\n        ${c?`<img src="${ue(c)}" alt="${ue(e.title||"")}" onerror="this.style.display='none';this.parentElement.classList.add('no-image')">`:'<span class="no-image-icon">ğŸ“„</span>'}\n      </div>\n      <div class="job-card-content">\n        <div class="job-card-header">\n          <h5 class="job-card-title">${ue(e.title||"æ±‚äººã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š")}</h5>\n          <span class="job-card-status ${a}">${n}</span>\n        </div>\n        <div class="job-card-meta">\n          ${e.location?`<span class="job-meta-item"><span class="meta-icon">ğŸ“</span>${ue(e.location)}</span>`:""}\n          ${e.monthlySalary?`<span class="job-meta-item"><span class="meta-icon">ğŸ’°</span>${ue(e.monthlySalary)}</span>`:""}\n        </div>\n        <div class="job-card-stats">\n          <span class="stat-item" title="å¿œå‹Ÿæ•°">ğŸ“ ${e.applicationCount||0}</span>\n          <span class="stat-item" title="é–²è¦§æ•°">ğŸ‘ ${e.viewCount||0}</span>\n        </div>\n      </div>\n      <div class="job-card-actions">\n        <button class="btn-job-action btn-edit-job" title="ç·¨é›†">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n        </button>\n        <button class="btn-job-action btn-preview-job" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>\n        </button>\n      </div>\n    </div>\n  `}(e)).join("")}\n      </div>\n    </div>\n  `}(e)}),t.innerHTML=a,document.querySelectorAll(".job-listing-card").forEach(e=>{e.addEventListener("click",t=>{if(t.target.closest(".btn-job-action")||t.target.closest(".btn-view-company"))return;const n=e.dataset.jobId,a=e.dataset.companyDomain;n&&a&&jt(a,n)})}),document.querySelectorAll(".btn-edit-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;a&&o&&jt(o,a)})}),document.querySelectorAll(".btn-preview-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;if(a&&o){const e=`lp.html?j=${o}_${a}`;window.open(e,"_blank")}})}),document.querySelectorAll(".btn-view-company").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.domain;n&&function(e){var t;const n=ft.find(t=>t.companyDomain===e);if(null==(t=window.AdminDashboard)?void 0:t.navigateToJobManage)window.AdminDashboard.navigateToJobManage(e,(null==n?void 0:n.company)||e,"job-listings");else{const t=document.querySelector('[data-section="company-manage"]');t&&t.click(),setTimeout(()=>{const t=new CustomEvent("openCompanyJobs",{detail:{companyDomain:e}});document.dispatchEvent(t)},100)}}(n)})})}(ht);const r=document.getElementById("job-listings-total");r&&(r.textContent=ht.length.toString())}function jt(e,t){var n;const a=ft.find(t=>t.companyDomain===e);(null==(n=window.AdminDashboard)?void 0:n.navigateToJobManage)?window.AdminDashboard.navigateToJobManage(e,(null==a?void 0:a.company)||e,"job-listings",t):window.location.href=`job-manage.html?domain=${encodeURIComponent(e)}&job=${encodeURIComponent(t)}`}let Lt=[],Bt={domain:null,name:null},$t=null,kt=null,Ct=!1,xt=null;function St(e){e&&Lt.push(e)}let Mt=!1,Dt=null,At=!1,Tt=!1,Ht=null,qt=!1;async function Rt(e,t,n=null){if(Tt)console.log("[JobManageEmbedded] åˆæœŸåŒ–ä¸­ã®ãŸã‚ç„¡è¦–:",e);else{Tt=!0;try{Dt!==e&&(Mt=!1,Dt=e,c(!1),s()),i(e,t,null);const a=document.getElementById("jm-company-name"),o=document.getElementById("jm-company-domain");a&&(a.textContent=t),o&&(o.textContent=e),At||(!function(){var e,t,n,a,o,c,i,d,u,p;document.querySelectorAll("#jm-tabs .jm-tab").forEach(e=>{e.addEventListener("click",()=>{Ot(e.dataset.tab)})}),null==(e=document.getElementById("jm-btn-add-job"))||e.addEventListener("click",Pt),null==(t=document.getElementById("jm-btn-refresh"))||t.addEventListener("click",Ut),null==(n=document.getElementById("jm-job-edit-back-btn"))||n.addEventListener("click",Jt),null==(a=document.getElementById("jm-job-edit-cancel-btn"))||a.addEventListener("click",Jt),null==(o=document.getElementById("jm-job-edit-delete-btn"))||o.addEventListener("click",_t),null==(c=document.getElementById("jm-job-edit-form"))||c.addEventListener("submit",e=>{e.preventDefault(),async function(){var e;const t=e=>{var t,n;return(null==(n=null==(t=document.getElementById(`jm-edit-job-${e}`))?void 0:t.value)?void 0:n.trim())||""},n={id:qt?"":(null==Ht?void 0:Ht.id)||"",title:t("title"),location:t("location"),monthlySalary:t("salary"),totalBonus:t("bonus"),order:t("order"),jobType:t("type"),features:t("features"),badges:t("badges"),jobDescription:t("description"),requirements:t("requirements"),benefits:t("benefits"),workingHours:t("hours"),holidays:t("holidays"),publishStartDate:t("start-date"),publishEndDate:t("end-date"),visible:(null==(e=document.getElementById("jm-edit-job-visible"))?void 0:e.checked)?"true":"false"};if(!n.title||!n.location)return void ye("å‹Ÿé›†ã‚¿ã‚¤ãƒˆãƒ«ã¨å‹¤å‹™åœ°ã¯å¿…é ˆã§ã™","error");const a=r.gasApiUrl,o=document.getElementById("jm-job-edit-save-btn");try{o&&(o.disabled=!0,o.textContent="ä¿å­˜ä¸­...");const e=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveJob",companyDomain:m,job:n,rowIndex:qt?null:null==Ht?void 0:Ht._rowIndex})))),t=`${a}?action=post&data=${encodeURIComponent(e)}`,c=await fetch(t,{method:"GET",redirect:"follow"}),s=await c.text();let i;try{i=JSON.parse(s)}catch{throw new Error("GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™")}if(!i.success)throw new Error(i.error||"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");ye(qt?"æ±‚äººã‚’ä½œæˆã—ã¾ã—ãŸ":"æ±‚äººæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ","success"),Jt(),await Ut()}catch(c){console.error("[JobManageEmbedded] æ±‚äººä¿å­˜ã‚¨ãƒ©ãƒ¼:",c),ye("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+c.message,"error")}finally{o&&(o.disabled=!1,o.textContent="ä¿å­˜")}}()});const y=document.getElementById("jm-job-search"),g=document.getElementById("jm-job-filter-status"),v=document.getElementById("jm-job-filter-area"),b=document.getElementById("jm-btn-clear-filters");if(y){let e;y.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{l.search=y.value.trim(),zt()},300)})}g&&g.addEventListener("change",()=>{l.status=g.value,zt()});v&&v.addEventListener("change",()=>{l.area=v.value,zt()});b&&b.addEventListener("click",()=>{s(),y&&(y.value=""),g&&(g.value=""),v&&(v.value=""),zt()});null==(i=document.getElementById("jm-btn-download-indeed"))||i.addEventListener("click",()=>Wt("indeed")),null==(d=document.getElementById("jm-btn-download-google"))||d.addEventListener("click",()=>Wt("google")),null==(u=document.getElementById("jm-btn-download-jobbox"))||u.addEventListener("click",()=>Wt("jobbox")),null==(p=document.getElementById("jm-btn-download-csv"))||p.addEventListener("click",()=>Wt("csv"))}(),At=!0),n?(!function(){Ht=null,qt=!1,d("jm-edit-job");const e=document.getElementById("jm-job-edit-title"),t=document.getElementById("jm-job-edit-badge");e&&(e.textContent="èª­ã¿è¾¼ã¿ä¸­...");t&&(t.textContent="ç·¨é›†",t.classList.add("edit"));const n=document.getElementById("jm-job-edit-delete-btn");n&&(n.style.display="none");const a=document.getElementById("jm-job-edit-save-btn");a&&(a.disabled=!0);Ot("job-edit")}(),await Ut(),Nt(n)):(Ot("jobs"),await Ut()),Mt=!0}finally{Tt=!1}}}async function Ut(){const e=document.getElementById("jm-jobs-list");e&&(e.innerHTML='<div class="job-cards-loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>');const t=r.gasApiUrl,n=(xt&&xt.abort(),xt=new AbortController,xt);try{const e=`${t}?action=getJobs&domain=${encodeURIComponent(m)}`,a=await fetch(e,{signal:n.signal});if(!a.ok)throw new Error("ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");const o=await a.json();if(!o.success)throw new Error(o.error||"æ±‚äººãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");u(o.jobs||[]),function(e){const t=document.getElementById("jm-job-filter-area");if(!t)return;const n=[...new Set(e.map(e=>e.area).filter(Boolean))];t.innerHTML='<option value="">å…¨ã‚¨ãƒªã‚¢</option>',n.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}(p),zt(),xt=null}catch(a){if("AbortError"===a.name)return void console.log("[JobManageEmbedded] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");console.error("[JobManageEmbedded] æ±‚äººãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",a),e&&(e.innerHTML=`<div class="error-message">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${ue(a.message)}</div>`)}}function zt(){const e=document.getElementById("jm-jobs-list"),t=document.getElementById("jm-jobs-count");if(!e)return;let n=p.filter(e=>{var t;if(l.search&&!(null==(t=e.title)?void 0:t.toLowerCase().includes(l.search.toLowerCase())))return!1;if(l.status){const t=o(e);if("published"===l.status&&"active"!==t)return!1;if("draft"===l.status&&"draft"!==t)return!1;if("expired"===l.status&&"expired"!==t)return!1}return!l.area||e.area===l.area});t&&(t.textContent=n.length.toString()),0!==n.length?(e.innerHTML=n.map(e=>function(e){const t=o(e),n=L(t),a=j(t);return`\n    <div class="job-card-row" data-job-id="${ue(e.id||"")}">\n      <div class="job-col-image">\n        ${e.imageUrl?`<img src="${ue(e.imageUrl)}" alt="" class="job-thumbnail" onerror="this.style.display='none'">`:'<span class="no-image">ğŸ“„</span>'}\n      </div>\n      <div class="job-col-info">\n        <div class="job-title">${ue(e.title||"ç„¡é¡Œ")}</div>\n        <div class="job-tags">\n          ${(e.badges||"").split(",").filter(Boolean).map(e=>`<span class="job-tag">${ue(e.trim())}</span>`).join("")}\n        </div>\n      </div>\n      <div class="job-col-type">${ue(e.jobType||"-")}</div>\n      <div class="job-col-area">${ue(e.area||e.location||"-")}</div>\n      <div class="job-col-deadline">${e.deadline?I(e.deadline):"-"}</div>\n      <div class="job-col-stats">${e.applicationCount||0}</div>\n      <div class="job-col-stats">${e.viewCount||0}</div>\n      <div class="job-col-status"><span class="status-badge ${a}">${n}</span></div>\n      <div class="job-col-actions">\n        <button class="btn-icon btn-edit-job" title="ç·¨é›†">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n        </button>\n        <button class="btn-icon btn-preview-job" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>\n        </button>\n      </div>\n    </div>\n  `}(e)).join(""),document.querySelectorAll("#jm-jobs-list .btn-edit-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-card-row"),a=null==n?void 0:n.dataset.jobId;a&&Nt(a)})}),document.querySelectorAll("#jm-jobs-list .btn-preview-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-card-row"),a=null==n?void 0:n.dataset.jobId;a&&window.open(`lp.html?j=${m}_${a}`,"_blank")})}),document.querySelectorAll("#jm-jobs-list .job-card-row").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.jobId;t&&Nt(t)})})):e.innerHTML='<div class="no-data">è©²å½“ã™ã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“</div>'}function Pt(){Ht=null,qt=!0,d("jm-edit-job");const e=document.getElementById("jm-job-edit-title"),t=document.getElementById("jm-job-edit-badge");e&&(e.textContent="æ–°è¦æ±‚äººä½œæˆ"),t&&(t.textContent="æ–°è¦",t.classList.remove("edit"));const n=document.getElementById("jm-job-edit-delete-btn");n&&(n.style.display="none");const a=document.getElementById("jm-job-edit-save-btn");a&&(a.disabled=!1),Ot("job-edit")}function Nt(e){var t;const n=null==(t=p)?void 0:t.find(t=>t.id===e||t.id===String(e)||String(t.id)===String(e));if(!n)return void ye("æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","error");Ht=n,qt=!1,y(n,"jm-edit-job");const a=document.getElementById("jm-job-edit-title"),o=document.getElementById("jm-job-edit-badge");a&&(a.textContent=n.title||"æ±‚äººç·¨é›†"),o&&(o.textContent="ç·¨é›†",o.classList.add("edit"));const c=document.getElementById("jm-job-edit-delete-btn");c&&(c.style.display="");const s=document.getElementById("jm-job-edit-save-btn");s&&(s.disabled=!1),Ot("job-edit")}function Jt(){Ht=null,qt=!1,Ot("jobs")}async function _t(){if(!Ht)return void ye("å‰Šé™¤å¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“","error");if(!confirm("ã“ã®æ±‚äººã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))return;const e=r.gasApiUrl,t=document.getElementById("jm-job-edit-delete-btn");try{t&&(t.disabled=!0,t.textContent="å‰Šé™¤ä¸­...");const n=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteJob",companyDomain:m,rowIndex:Ht._rowIndex})))),a=`${e}?action=post&data=${encodeURIComponent(n)}`,o=await fetch(a,{method:"GET",redirect:"follow"}),c=await o.text();let s;try{s=JSON.parse(c)}catch{throw new Error("GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™")}if(!s.success)throw new Error(s.error||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");ye("æ±‚äººã‚’å‰Šé™¤ã—ã¾ã—ãŸ","success"),Jt(),await Ut()}catch(n){console.error("[JobManageEmbedded] æ±‚äººå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",n),ye("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message,"error")}finally{t&&(t.disabled=!1,t.textContent="å‰Šé™¤")}}function Ot(e){document.querySelectorAll("#jm-tabs .jm-tab").forEach(t=>{t.classList.toggle("active","job-edit"!==e&&t.dataset.tab===e)});const t=document.getElementById("jm-tabs");t&&(t.style.display="job-edit"===e?"none":""),document.querySelectorAll(".jm-subsection").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`jm-${e}`);n&&n.classList.add("active"),"applicants"===e?g(m):"recruit"===e&&v(m)}async function Wt(e){const t=document.getElementById("jm-feed-status");t&&(t.style.display="flex");try{const t=p.filter(e=>!0===e.visible||"true"===e.visible||"TRUE"===e.visible);let n,a,o;switch(e){case"indeed":n=E(t),a=`${m}_indeed_feed.xml`,o="application/xml";break;case"google":n=h(t),a=`${m}_google_jobs.json`,o="application/ld+json";break;case"jobbox":n=f(t),a=`${m}_jobbox_feed.xml`,o="application/xml";break;case"csv":n=b(t),a=`${m}_jobs.csv`,o="text/csv";break;default:throw new Error("Unknown feed type")}w(n,a,o),ye(`${a} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`)}catch(n){console.error("[JobManageEmbedded] ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",n),ye("ãƒ•ã‚£ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ","error")}finally{t&&(t.style.display="none")}}const Ft="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec";let Vt=!0,Gt=null,Kt=null,Zt=!1;async function Yt(e){var t,n,a,o,c,s,i,l,d;Gt=e,Vt=!e,Kt=null,function(){const e=document.getElementById("ce-company-edit-form");e&&e.reset();["ce-description-editor","ce-job-content-editor","ce-working-hours-editor","ce-work-location-editor"].forEach(e=>{const t=document.getElementById(e);t&&(t.innerHTML="")}),["ce-description","ce-job-content","ce-working-hours","ce-work-location","ce-logo-url"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")}),nn("");const t=document.getElementById("ce-company-domain");t&&(t.readOnly=!1,t.classList.remove("readonly"))}(),function(){const e=document.getElementById("ce-page-title"),t=document.getElementById("ce-edit-badge"),n=document.getElementById("ce-delete-btn"),a=document.getElementById("ce-company-domain");Vt?(e&&(e.textContent="æ–°è¦ä¼šç¤¾ç™»éŒ²"),t&&(t.textContent="æ–°è¦ä½œæˆ",t.classList.remove("edit")),n&&(n.style.display="none")):(e&&(e.textContent="ä¼šç¤¾æƒ…å ±ã®ç·¨é›†"),t&&(t.textContent="ç·¨é›†ä¸­",t.classList.add("edit")),n&&(n.style.display=""),a&&(a.readOnly=!0,a.classList.add("readonly")))}(),Zt||(null==(t=document.getElementById("ce-company-edit-form"))||t.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,t,n,a,o,c,s;!function(){const e=document.getElementById("section-company-edit");e&&e.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=null==t?void 0:t.querySelector('input[type="hidden"]');n&&(n.value=Xt(e.innerHTML))})}();const i=e=>{var t,n;return(null==(n=null==(t=document.getElementById(e))?void 0:t.value)?void 0:n.trim())||""},l=i("ce-logo-url"),d={company:i("ce-company-name"),companyDomain:i("ce-company-domain"),designPattern:(null==(e=document.getElementById("ce-design-pattern"))?void 0:e.value)||"standard",logoUrl:l,imageUrl:l,order:i("ce-order"),companyAddress:i("ce-company-address"),description:(null==(t=document.getElementById("ce-description"))?void 0:t.value)||"",jobDescription:(null==(n=document.getElementById("ce-job-content"))?void 0:n.value)||"",workingHours:(null==(a=document.getElementById("ce-working-hours"))?void 0:a.value)||"",workLocation:(null==(o=document.getElementById("ce-work-location"))?void 0:o.value)||"",showCompany:(null==(c=document.getElementById("ce-show-company"))?void 0:c.checked)?"â—‹":"",visible:(null==(s=document.getElementById("ce-show-company"))?void 0:s.checked)||!1};if(!d.company||!d.companyDomain)return void ye("ä¼šç¤¾åã¨ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å¿…é ˆã§ã™","error");if(!/^[a-z0-9-]+$/.test(d.companyDomain))return void ye("ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯åŠè§’è‹±å°æ–‡å­—ãƒ»æ•°å­—ãƒ»ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨ã§ãã¾ã™","error");const r=document.getElementById("ce-save-btn");r&&(r.disabled=!0,r.innerHTML='<span class="loading-spinner-small"></span> ä¿å­˜ä¸­...');const m=Ft;try{if(m){const e=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveCompany",company:d})))),t=`${m}?action=post&data=${encodeURIComponent(e)}`,n=await fetch(t),a=await n.json();if(!a.success)throw new Error(a.error||"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}localStorage.setItem(`company_data_${d.companyDomain}`,JSON.stringify(d)),ye(Vt?"ä¼šç¤¾ã‚’ç™»éŒ²ã—ã¾ã—ãŸ":"ä¼šç¤¾æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),sn()}catch(u){console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:",u),ye("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+u.message,"error")}finally{r&&(r.disabled=!1,r.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> ä¿å­˜')}}()}),null==(n=document.getElementById("ce-back-btn"))||n.addEventListener("click",sn),null==(a=document.getElementById("ce-cancel-btn"))||a.addEventListener("click",sn),null==(o=document.getElementById("ce-delete-btn"))||o.addEventListener("click",an),null==(c=document.getElementById("ce-delete-modal-close"))||c.addEventListener("click",on),null==(s=document.getElementById("ce-delete-cancel"))||s.addEventListener("click",on),null==(i=document.getElementById("ce-delete-confirm"))||i.addEventListener("click",cn),null==(l=document.getElementById("ce-delete-confirm-modal"))||l.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&on()}),null==(d=document.getElementById("ce-company-domain"))||d.addEventListener("input",e=>{Vt&&(e.target.value=e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,""))}),function(){const e=document.getElementById("ce-logo-upload-btn"),t=document.getElementById("ce-logo-file-input"),n=document.getElementById("ce-logo-remove-btn"),a=document.getElementById("ce-logo-preview"),o=document.getElementById("ce-logo-url");e&&t&&(e.addEventListener("click",()=>{t.click()}),null==a||a.addEventListener("click",()=>{t.click()}),t.addEventListener("change",async e=>{var n,c;const s=e.target.files[0];if(!s)return;const i=null==(c=null==(n=document.getElementById("ce-company-domain"))?void 0:n.value)?void 0:c.trim();if(i)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</span>';const e=await Ce(s,i);o.value=e,nn(e)}catch(l){console.error("ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",l),ye("ãƒ­ã‚´ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+l.message,"error"),nn(o.value)}finally{a.classList.remove("uploading"),t.value=""}else ye("å…ˆã«ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error")}),null==n||n.addEventListener("click",()=>{o.value="",nn("")}),null==a||a.addEventListener("dragover",e=>{e.preventDefault(),a.classList.add("drag-over")}),null==a||a.addEventListener("dragleave",e=>{e.preventDefault(),a.classList.remove("drag-over")}),null==a||a.addEventListener("drop",async e=>{var t,n;e.preventDefault(),a.classList.remove("drag-over");const c=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));if(0===c.length)return;const s=null==(n=null==(t=document.getElementById("ce-company-domain"))?void 0:t.value)?void 0:n.trim();if(s)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</span>';const e=await Ce(c[0],s);o.value=e,nn(e)}catch(i){console.error("ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",i),ye("ãƒ­ã‚´ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+i.message,"error"),nn(o.value)}finally{a.classList.remove("uploading")}else ye("å…ˆã«ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error")}))}(),ln("ce-description-insert-image","ce-description-image-input","ce-description-editor"),ln("ce-job-content-insert-image","ce-job-content-image-input","ce-job-content-editor"),function(){const e=document.getElementById("section-company-edit");if(!e)return;e.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=t.querySelector(".rich-editor-toolbar"),a=t.querySelector('input[type="hidden"]');null==n||n.querySelectorAll(".toolbar-btn:not([id])").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const o=t.dataset.command;o&&(document.execCommand(o,!1,null),e.focus(),Qt(e,a))})}),e.addEventListener("input",()=>{Qt(e,a)}),e.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),e.addEventListener("keydown",t=>{if(t.ctrlKey||t.metaKey){switch(t.key.toLowerCase()){case"b":t.preventDefault(),document.execCommand("bold",!1,null);break;case"i":t.preventDefault(),document.execCommand("italic",!1,null);break;case"u":t.preventDefault(),document.execCommand("underline",!1,null)}Qt(e,a)}})})}(),Zt=!0),Vt||await async function(){const e=sessionStorage.getItem("editing_company_data");if(e){try{const t=JSON.parse(e);if(t.companyDomain===Gt||t.company_domain===Gt)return Kt=t,tn(t),void sessionStorage.removeItem("editing_company_data")}catch(a){console.error("sessionStorageãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:",a)}sessionStorage.removeItem("editing_company_data")}const t=localStorage.getItem(`company_data_${Gt}`);if(t)try{const e=JSON.parse(t);return Kt=e,void tn(e)}catch(a){console.error("localStorageãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:",a)}const n=Ft;try{const e=`${n}?action=getCompany&domain=${encodeURIComponent(Gt)}`,t=await fetch(e),a=await t.json();if(!a.success||!a.company)return ye("ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","error"),void sn();Kt=a.company,tn(a.company)}catch(o){console.error("ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",o),ye("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: "+o.message,"error")}}()}function Xt(e){if(!e||"<br>"===e||"<div><br></div>"===e)return"";const t=["b","strong","i","em","u","ul","ol","li","br","div","p","img"],n=["src","alt","style"],a=document.createElement("div");a.innerHTML=e;return a.querySelectorAll("*").forEach(e=>{if(t.includes(e.tagName.toLowerCase())){Array.from(e.attributes).forEach(t=>{n.includes(t.name)||e.removeAttribute(t.name)}),"img"!==e.tagName.toLowerCase()||e.style.maxWidth||(e.style.maxWidth="100%")}else e.replaceWith(...e.childNodes)}),a.innerHTML}function Qt(e,t){if(t){const n=Xt(e.innerHTML);t.value=n}}function en(e,t){const n=document.getElementById(e),a=null==n?void 0:n.closest(".rich-editor-container"),o=null==a?void 0:a.querySelector('input[type="hidden"]');n&&(n.innerHTML=t||"",o&&(o.value=t||""))}function tn(e){const t=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t||"")};t("ce-company-name",e.company),t("ce-company-domain",e.companyDomain||e.company_domain),t("ce-design-pattern",e.designPattern||"standard"),t("ce-order",e.order),t("ce-company-address",e.companyAddress||e.location);const n=e.logoUrl||e.imageUrl||"";t("ce-logo-url",n),nn(n);const a=document.getElementById("ce-show-company");if(a&&(a.checked="â—‹"===e.showCompany||!0===e.showCompany||"true"===e.showCompany||!0===e.visible),en("ce-description-editor",e.description||""),en("ce-job-content-editor",e.jobDescription||e.jobContent||""),en("ce-working-hours-editor",e.workingHours||""),en("ce-work-location-editor",e.workLocation||""),e.company){const t=document.getElementById("ce-page-title");t&&(t.textContent=`${e.company} ã®ç·¨é›†`)}}function nn(e){const t=document.getElementById("ce-logo-preview"),n=document.getElementById("ce-logo-remove-btn");t&&(e?(t.innerHTML=`<img src="${ue(e)}" alt="ä¼šç¤¾ãƒ­ã‚´">`,n&&(n.style.display="")):(t.innerHTML='<span class="upload-placeholder">ãƒ­ã‚´ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>',n&&(n.style.display="none")))}function an(){var e;const t=document.getElementById("ce-delete-confirm-modal"),n=(null==(e=document.getElementById("ce-company-name"))?void 0:e.value)||"",a=document.getElementById("ce-delete-company-name");a&&(a.textContent=n),t&&(t.style.display="flex")}function on(){const e=document.getElementById("ce-delete-confirm-modal");e&&(e.style.display="none")}async function cn(){const e=Ft,t=document.getElementById("ce-delete-confirm");t&&(t.disabled=!0,t.textContent="å‰Šé™¤ä¸­...");try{if(e){const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteCompany",domain:Gt})))),n=`${e}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n),o=await a.json();if(!o.success)throw new Error(o.error||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}localStorage.removeItem(`company_data_${Gt}`),ye("ä¼šç¤¾ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),on(),sn()}catch(n){console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",n),ye("å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+n.message,"error")}finally{t&&(t.disabled=!1,t.textContent="å‰Šé™¤ã™ã‚‹")}}function sn(){var e,t,n;(null==(e=window.AdminDashboard)?void 0:e.navigateBack)?window.AdminDashboard.navigateBack():null==(n=null==(t=window.AdminDashboard)?void 0:t.switchSection)||n.call(t,"company-manage")}function ln(e,t,n){const a=document.getElementById(e),o=document.getElementById(t),c=document.getElementById(n);a&&o&&c&&(a.addEventListener("click",()=>{o.click()}),o.addEventListener("change",async e=>{var t,n;const a=e.target.files[0];if(!a)return;const s=null==(n=null==(t=document.getElementById("ce-company-domain"))?void 0:t.value)?void 0:n.trim();if(s)try{const e=`img-placeholder-${Date.now()}`,t=document.createElement("img");t.id=e,t.src=URL.createObjectURL(a),t.alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...",t.className="uploading",t.style.maxWidth="100%",t.style.opacity="0.5",c.focus();const n=window.getSelection();if(n.rangeCount>0){const e=n.getRangeAt(0);e.insertNode(t),e.setStartAfter(t),e.collapse(!0),n.removeAllRanges(),n.addRange(e)}else c.appendChild(t);const o=await xe(a,s),i=document.getElementById(e);i&&(i.src=o,i.alt="",i.className="",i.style.opacity="1",i.removeAttribute("id"));const l=c.closest(".rich-editor-container"),d=null==l?void 0:l.querySelector('input[type="hidden"]');d&&(d.value=Xt(c.innerHTML))}catch(i){console.error("ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",i),ye("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+i.message,"error");const e=c.querySelector("img.uploading");e&&e.remove()}finally{o.value=""}else ye("å…ˆã«ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error")}))}function dn(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="flex"),t&&(t.style.display="none")}function rn(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="none"),t&&(t.style.display="flex"),function(){oe();const e=O(),t=document.getElementById("nav-admin"),n=document.getElementById("nav-company");if(_())t&&(t.style.display="block"),n&&(n.style.display="none");else{t&&(t.style.display="none"),n&&(n.style.display="block"),un("job-listings");const a=document.querySelector(".sidebar-header p");a&&e&&(a.textContent=`${e} ç®¡ç†ç”»é¢`)}}()}function mn(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.remove("open"),t&&t.classList.remove("active"),n&&n.classList.remove("active"),document.body.style.overflow=""}function un(e){if(Ct)return;Ct=!0,mn(),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector(`[data-section="${e}"]`);t&&t.parentElement.classList.add("active"),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`section-${e}`);n&&n.classList.add("active");const a={overview:"æ¦‚è¦","analytics-detail":"è©³ç´°åˆ†æ","company-manage":"ä¼šç¤¾ç®¡ç†","job-listings":"æ±‚äººä¸€è¦§","job-manage":"æ±‚äººç®¡ç†","company-edit":"ä¼šç¤¾ç·¨é›†","lp-settings":"LPè¨­å®š","recruit-settings":"æ¡ç”¨ãƒšãƒ¼ã‚¸è¨­å®š","applicant-select":"å¿œå‹Ÿè€…ç®¡ç†","company-users":"ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",settings:"è¨­å®š"},o=document.getElementById("page-title");o&&("job-manage"===e&&Bt.name?o.textContent=`${Bt.name} ã®æ±‚äººç®¡ç†`:o.textContent=a[e]||e),"company-manage"===e&&P(),"lp-settings"===e&&(A(),S()),"recruit-settings"===e&&yt(),"job-listings"===e&&wt();const c=document.querySelector(".header-actions");if(c){const t=["overview","analytics-detail"];c.style.display=t.includes(e)?"":"none"}if(document.body.classList.toggle("lp-settings-active","lp-settings"===e),"applicant-select"===e&&async function(){const e=document.getElementById("applicant-company-grid");if(!e)return;if(e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>',!_()){const e=O();if(e)return void(window.location.href=`job-manage.html?domain=${encodeURIComponent(e)}`)}try{const t=await Be();if(!t||0===t.length)return void(e.innerHTML='<div class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');let n=t.filter(e=>ke(e));if(!_()){const e=O();n=n.filter(t=>t.companyDomain===e)}if(0===n.length)return void(e.innerHTML='<div class="loading-cell">è¡¨ç¤ºå¯èƒ½ãªä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“</div>');e.innerHTML=n.map(e=>`\n      <a href="job-manage.html?domain=${encodeURIComponent(e.companyDomain)}" class="company-select-card">\n        <div class="company-select-icon">ğŸ¢</div>\n        <div class="company-select-info">\n          <h4>${ue(e.company)}</h4>\n          <p>${ue(e.companyDomain)}</p>\n        </div>\n        <div class="company-select-arrow">â†’</div>\n      </a>\n    `).join("")}catch(t){console.error("ä¼šç¤¾ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}(),"company-users"===e&&fn(),"job-manage"===e&&Bt.domain&&Bt.name){const e=kt;kt=null,Rt(Bt.domain,Bt.name,e)}"company-edit"===e&&Yt($t),requestAnimationFrame(()=>{Ct=!1})}function pn(){const e=Lt.pop()||null;Bt.domain=null,Bt.name=null,$t=null,un(e||"job-listings")}function yn(){const e=document.getElementById("mobile-menu-btn");e&&e.addEventListener("click",()=>{const e=document.getElementById("admin-sidebar");e&&e.classList.contains("open")?mn():function(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.add("open"),t&&t.classList.add("active"),n&&n.classList.add("active"),document.body.style.overflow="hidden"}()});const t=document.getElementById("sidebar-close-btn");t&&t.addEventListener("click",mn);const n=document.getElementById("mobile-overlay");n&&n.addEventListener("click",mn),document.querySelectorAll(".login-tab").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;document.querySelectorAll(".login-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active");const n=document.getElementById("company-login-form"),a=document.getElementById("login-form");"company"===t?(n&&(n.style.display="block"),a&&(a.style.display="none")):(n&&(n.style.display="none"),a&&(a.style.display="block"))})});const a=document.getElementById("company-login-form");a&&a.addEventListener("submit",async e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("company-username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("company-password"))?void 0:n.value)||"",c=document.getElementById("company-login-error");c&&(c.style.display="none");const s=await F(a,o);s.success?window.location.href=`job-manage.html?domain=${encodeURIComponent(s.companyDomain)}&company=${encodeURIComponent(s.companyName||s.companyDomain)}`:c&&(c.textContent=s.error,c.style.display="block")});const o=document.getElementById("login-form");o&&o.addEventListener("submit",e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("password"))?void 0:n.value)||"",c=document.getElementById("login-error"),s=V(a,o);s.success?(c&&(c.style.display="none"),rn(),Re()):c&&(c.textContent=s.error,c.style.display="block")});const c=document.getElementById("logout-btn");c&&c.addEventListener("click",()=>{G(),dn()}),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();un(e.currentTarget.dataset.section)})});const s=document.getElementById("date-range");s&&s.addEventListener("change",()=>Re());const i=document.getElementById("refresh-btn");i&&i.addEventListener("click",()=>Re());const l=document.getElementById("company-search");l&&l.addEventListener("input",e=>Oe(e.target.value));const d=document.getElementById("sort-by");d&&d.addEventListener("change",()=>We());const r=document.getElementById("google-login-btn");r&&r.addEventListener("click",async()=>{const e=document.getElementById("login-error"),t=await K();t.success?(e&&(e.style.display="none"),rn(),Re()):e&&(e.textContent=t.error,e.style.display="block")});const m=document.getElementById("btn-add-company");m&&m.addEventListener("click",()=>U());const u=document.getElementById("lp-job-select");u&&u.addEventListener("change",e=>D(e.target.value));const p=document.getElementById("btn-save-lp-settings");p&&p.addEventListener("click",()=>{M()});const y=document.getElementById("btn-reset-lp-settings");y&&y.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-job-select"))?void 0:e.value;t&&D(t)});const g=document.getElementById("btn-toggle-preview");g&&g.addEventListener("click",()=>x());const v=document.getElementById("btn-close-preview");v&&v.addEventListener("click",()=>C()),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");document.querySelectorAll(".preview-device-btn").forEach(e=>{e.classList.toggle("active",e.dataset.device===t)}),n&&n.setAttribute("data-device",t)})});document.querySelectorAll("#lp-editor input, #lp-editor textarea").forEach(e=>{e.addEventListener("input",()=>k())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>B())}),$(),Z(),Y(),X(),document.querySelectorAll('#lp-section-order input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>B())}),document.querySelectorAll(".collapsible-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".collapsible");t&&t.classList.toggle("collapsed")})}),document.querySelectorAll("#ad-tracking-section, #ogp-section").forEach(e=>{e.classList.add("collapsed")});const b=document.getElementById("save-password");b&&b.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("new-password"))?void 0:e.value;t&&t.length>=4?(localStorage.setItem("admin_password",t),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ")):alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")});const f=document.getElementById("feed-status"),h=()=>{f&&(f.style.display="flex")},E=()=>{f&&(f.style.display="none")},w=document.getElementById("btn-download-indeed");w&&w.addEventListener("click",async()=>{try{h(),await Q(),alert("Indeed XMLãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{E()}});const I=document.getElementById("btn-download-google");I&&I.addEventListener("click",async()=>{try{h(),await ee(),alert("Google JSON-LDã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{E()}});const j=document.getElementById("btn-download-jobbox");j&&j.addEventListener("click",async()=>{try{h(),await te(),alert("æ±‚äººãƒœãƒƒã‚¯ã‚¹XMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{E()}});const L=document.getElementById("btn-download-csv");L&&L.addEventListener("click",async()=>{try{h(),await ne(),alert("CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{E()}});const S=document.getElementById("btn-add-company-user");S&&S.addEventListener("click",()=>{hn(null,"")});const A=document.getElementById("btn-bulk-generate");A&&A.addEventListener("click",()=>async function(){if(!confirm("æœªç™ºè¡Œã®å…¨ä¼šç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ"))return;const e=gn.filter(e=>ke(e)),t=[];for(const s of e){if(await se(s.companyDomain))continue;const e=ce(s.companyDomain),n=ae();(await ie(e,n,s.companyDomain,s.company)).success&&t.push({company:s.company,domain:s.companyDomain,username:e,password:n})}if(0===t.length)return void alert("ç™ºè¡Œå¯¾è±¡ã®ä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");let n=`${t.length}ç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\n\n`;t.forEach(e=>{n+=`ã€${e.company}ã€‘\nID: ${e.username}\nPW: ${e.password}\n\n`});const a=new Blob([n],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(a),c=document.createElement("a");c.href=o,c.download=`company-users-${(new Date).toISOString().split("T")[0]}.txt`,c.click(),URL.revokeObjectURL(o),alert(`${t.length}ç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\nãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`),await fn()}());const T=document.getElementById("company-user-modal-close");T&&T.addEventListener("click",En);const H=document.getElementById("company-user-modal-cancel");H&&H.addEventListener("click",En);const q=document.getElementById("company-user-form");q&&q.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,t,n,a,o;const c=null==(e=document.getElementById("cu-company-select"))?void 0:e.value,s=null==(n=null==(t=document.getElementById("cu-username"))?void 0:t.value)?void 0:n.trim(),i=null==(a=document.getElementById("cu-password"))?void 0:a.value,l=null==(o=document.getElementById("cu-is-active"))?void 0:o.checked;if(!c||!s)return void alert("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const d=document.getElementById("company-user-modal-save");d&&(d.disabled=!0,d.textContent="ä¿å­˜ä¸­...");try{if(bn){const e={username:s,isActive:l};i&&(e.password=i);const t=await le(bn,e);if(!t.success)throw new Error(t.error);alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),En()}else{if(!i)return void alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const e=await ie(s,i,c);if(!e.success)throw new Error(e.error);document.getElementById("cu-issued-username").textContent=s,document.getElementById("cu-issued-password").textContent=i,document.getElementById("cu-credentials-display").style.display="block",d&&(d.textContent="å®Œäº†",d.onclick=()=>{En(),fn()}),alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’æ§ãˆã¦ãã ã•ã„ã€‚")}await fn()}catch(r){console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿å­˜ã‚¨ãƒ©ãƒ¼:",r),alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+r.message)}finally{d&&!bn||d&&(d.disabled=!1,d.textContent="ä¿å­˜")}}()});const R=document.getElementById("company-user-delete");R&&R.addEventListener("click",wn);const z=document.getElementById("cu-generate-password");z&&z.addEventListener("click",()=>{const e=document.getElementById("cu-password");e&&(e.value=ae())});const P=document.getElementById("cu-copy-credentials");P&&P.addEventListener("click",In);const N=document.getElementById("company-user-modal");N&&N.addEventListener("click",e=>{e.target===N&&En()}),document.addEventListener("navigateToSection",e=>{const{section:t,companyDomain:n,company:a}=e.detail;"job-listings"===t?(n&&function(e){if(Et=e,bt.length>0){const t=document.getElementById("job-company-filter");t&&(t.value=e||"",It())}}(n),un("job-listings")):"recruit-settings"===t&&(n&&function(e){pt=e}(n),un("recruit-settings"))});const J=document.getElementById("jm-back-btn");J&&J.addEventListener("click",pn)}let gn=[],vn=[],bn=null;async function fn(){const e=document.getElementById("company-users-tbody");if(e){e.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>';try{gn=await Be(),vn=await W();const t={};vn.forEach(e=>{t[e.companyDomain]||(t[e.companyDomain]=[]),t[e.companyDomain].push(e)});const n=gn.filter(e=>ke(e));if(0===n.length)return void(e.innerHTML='<tr><td colspan="6" class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');let a="";n.forEach(e=>{const n=t[e.companyDomain]||[];0===n.length?a+=`\n          <tr data-company-domain="${ue(e.companyDomain)}">\n            <td>${ue(e.company)}</td>\n            <td><span class="badge warning">æœªç™ºè¡Œ</span></td>\n            <td><span class="badge">-</span></td>\n            <td>-</td>\n            <td>-</td>\n            <td>\n              <button class="btn-small btn-primary btn-issue-user" data-domain="${ue(e.companyDomain)}" data-company="${ue(e.company)}">\n                IDç™ºè¡Œ\n              </button>\n            </td>\n          </tr>\n        `:n.forEach((t,o)=>{const c=!1!==t.isActive,s=t.createdAt?new Date(t.createdAt).toLocaleDateString("ja-JP"):"-",i=t.lastLogin?new Date(t.lastLogin).toLocaleString("ja-JP"):"æœªãƒ­ã‚°ã‚¤ãƒ³";a+=`\n            <tr data-user-id="${ue(t.id)}">\n              ${0===o?`<td rowspan="${n.length}">${ue(e.company)}</td>`:""}\n              <td><code>${ue(t.username)}</code></td>\n              <td>${c?'<span class="badge success">æœ‰åŠ¹</span>':'<span class="badge">ç„¡åŠ¹</span>'}</td>\n              <td>${s}</td>\n              <td>${i}</td>\n              <td>\n                <div class="action-buttons">\n                  <button class="btn-small btn-secondary btn-reset-password" data-user-id="${ue(t.id)}" data-username="${ue(t.username)}">\n                    PWå†ç™ºè¡Œ\n                  </button>\n                  <button class="btn-small btn-edit-user" data-user-id="${ue(t.id)}">ç·¨é›†</button>\n                </div>\n              </td>\n            </tr>\n          `})}),e.innerHTML=a,document.querySelectorAll(".btn-issue-user").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.domain;e.dataset.company,hn(null,t)})}),document.querySelectorAll(".btn-edit-user").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.userId,n=vn.find(e=>e.id===t);if(n){const e=gn.find(e=>e.companyDomain===n.companyDomain);hn(n,n.companyDomain,(null==e?void 0:e.company)||n.companyDomain)}})}),document.querySelectorAll(".btn-reset-password").forEach(e=>{e.addEventListener("click",async()=>{const t=e.dataset.userId,n=e.dataset.username;await async function(e,t){if(!confirm(`${t} ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ`))return;const n=ae();try{const a=await re(e,n);if(!a.success)throw new Error(a.error);const o=`æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\n\nãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${t}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${n}\n\nâ€»ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å†è¡¨ç¤ºã§ãã¾ã›ã‚“ã€‚å¿…ãšæ§ãˆã¦ãã ã•ã„ã€‚`;try{await navigator.clipboard.writeText(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${t}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${n}`),alert(o+"\n\nï¼ˆã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼‰")}catch{alert(o)}}catch(a){console.error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†ç™ºè¡Œã‚¨ãƒ©ãƒ¼:",a),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}}(t,n)})})}catch(t){console.error("ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>'}}}function hn(e,t,n){const a=document.getElementById("company-user-modal"),o=document.getElementById("company-user-modal-title"),c=document.getElementById("cu-company-select"),s=document.getElementById("cu-username"),i=document.getElementById("cu-password"),l=document.getElementById("cu-is-active"),d=document.getElementById("company-user-delete"),r=document.getElementById("cu-credentials-display");if(!a)return;const m=gn.filter(e=>ke(e));c.innerHTML=m.map(e=>`\n    <option value="${ue(e.companyDomain)}" ${e.companyDomain===t?"selected":""}>\n      ${ue(e.company)}\n    </option>\n  `).join(""),e?(o.textContent="ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·¨é›†",s.value=e.username||"",i.value="",i.placeholder="å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›",i.required=!1,l.checked=!1!==e.isActive,d.style.display="",bn=e.id):(o.textContent="ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ",s.value=ce(t),i.value=ae(),i.placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",i.required=!0,l.checked=!0,d.style.display="none",bn=null),r.style.display="none",a.style.display="flex"}function En(){const e=document.getElementById("company-user-modal");e&&(e.style.display="none"),bn=null}async function wn(){if(bn&&confirm("ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))try{const e=await de(bn);if(!e.success)throw new Error(e.error);alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),En(),await fn()}catch(e){console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",e),alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}}function In(){var e,t;const n=null==(e=document.getElementById("cu-issued-username"))?void 0:e.textContent,a=null==(t=document.getElementById("cu-issued-password"))?void 0:t.textContent;if(n&&a){const e=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${n}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${a}`;navigator.clipboard.writeText(e).then(()=>{alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")}).catch(()=>{alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ")})}}function jn(){const n=localStorage.getItem("admin_password");n&&(e.credentials.password=n),N(),J()?(rn(),document.addEventListener("authReady",()=>{Re()},{once:!0}),setTimeout(()=>{t()||Re()},3e3)):dn(),yn(),Fe(),function(){const e=document.getElementById("btn-back-to-companies");e&&e.addEventListener("click",nt)}()}"undefined"!=typeof window&&(window.AdminDashboard={config:e,spreadsheetConfig:{sheetId:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",companySheetName:"ä¼šç¤¾ä¸€è¦§",lpSettingsSheetName:"LPè¨­å®š",gasApiUrl:"https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec"},init:jn,switchSection:un,getIdToken:t,navigateToJobManage:function(e,t,n="job-listings",a=null){!function(e,t){Bt.domain=e,Bt.name=t}(e,t),a&&function(e){kt=e}(a),St(n),un("job-manage")},navigateBack:pn,navigateToCompanyEdit:function(e,t="company-manage"){!function(e){$t=e}(e),St(t),un("company-edit")}},window.AdminAnalytics={loadDashboardData:Re,filterCompanies:Oe,sortCompanies:We},window.AdminCompany={loadCompanyManageData:P,editCompany:z,showCompanyModal:U,closeCompanyModal:R,saveCompanyData:q,renderCompanyTable:H,openJobsArea:T,loadCompanyListForLP:A,loadLPSettings:D,saveLPSettings:M,renderHeroImagePresets:S,toggleLPPreview:x,closeLPPreview:C,debouncedUpdatePreview:k,initSectionSortable:$,updateLPPreview:B,getPatternLabel:e=>({standard:"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰",modern:"ãƒ¢ãƒ€ãƒ³",classic:"ã‚¯ãƒ©ã‚·ãƒƒã‚¯",minimal:"ãƒŸãƒ‹ãƒãƒ«",colorful:"ã‚«ãƒ©ãƒ•ãƒ«"}[e]||"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰")}),document.addEventListener("DOMContentLoaded",()=>{jn()});
