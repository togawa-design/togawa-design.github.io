import"./modulepreload-polyfill-YP0FEG5d.js";import{f as e,e as t}from"./utils-BE8OECDH.js";import{d as n,a,b as o,c as s}from"./job-feed-generator-BbzggbON.js";import{f as i,i as c}from"./jobs-loader-CErzUEmq.js";const l={credentials:{username:"admin",password:"receco2025"},sessionKey:"rikueco_admin_session",gaPropertyId:"G-E1XC94EG05",gaApiKey:"AIzaSyAIC2WGg5dnvMh6TO4sivpbk4HtpYw4tbo",apiEndpoint:"https://asia-northeast1-generated-area-484613-e3.cloudfunctions.net/getAnalyticsData",firebaseConfig:{apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"}},d="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",r="ä¼šç¤¾ä¸€è¦§",m="LPè¨­å®š",p="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec";function u(e){return{standard:"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰",modern:"ãƒ¢ãƒ€ãƒ³",classic:"ã‚¯ãƒ©ã‚·ãƒƒã‚¯",minimal:"ãƒŸãƒ‹ãƒãƒ«",colorful:"ã‚«ãƒ©ãƒ•ãƒ«"}[e]||"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰"}const g=[{id:"teamwork-1",name:"ãƒãƒ¼ãƒ ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°",url:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=400&q=60"},{id:"teamwork-2",name:"ã‚ªãƒ•ã‚£ã‚¹ãƒ¯ãƒ¼ã‚¯",url:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400&q=60"},{id:"teamwork-3",name:"ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",url:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=400&q=60"},{id:"teamwork-4",name:"ãƒ“ã‚¸ãƒã‚¹æ¡æ‰‹",url:"https://images.unsplash.com/photo-1521791136064-7986c2920216?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521791136064-7986c2920216?w=400&q=60"},{id:"teamwork-5",name:"ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—",url:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=400&q=60"},{id:"work-1",name:"è£½é€ ãƒ©ã‚¤ãƒ³",url:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&q=60"},{id:"work-2",name:"å€‰åº«ä½œæ¥­",url:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=400&q=60"},{id:"work-3",name:"å»ºè¨­ç¾å ´",url:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=400&q=60"},{id:"work-4",name:"å·¥å ´ä½œæ¥­",url:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=400&q=60"},{id:"work-5",name:"ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯",url:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=400&q=60"}];let y=null,v=null,h=null;function f(){return h}let b=[];async function w(){const n=document.getElementById("date-range"),a=(null==n?void 0:n.value)||7,o=l.apiEndpoint;if(o)try{await async function(n,a){try{$(!0),function(e){const t='<div class="section-loading"><div class="loading-spinner"></div><span>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span></div>';document.querySelectorAll(".stat-value").forEach(e=>{e.dataset.originalText=e.textContent,e.innerHTML='<span class="loading-dots">...</span>'});const n=document.getElementById("daily-chart");n&&e&&(n.innerHTML=t);const a=document.querySelector(".data-table tbody");a&&e&&(a.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;">${t}</td></tr>`);const o=document.getElementById("company-cards");o&&e&&(o.innerHTML=t);const s=document.querySelector("#applications-section .data-table tbody");s&&e&&(s.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:2rem;">${t}</td></tr>`)}(!0);const o={},s=f();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?days=${n}`,{headers:o});if(!i.ok)throw new Error(`API Error: ${i.status}`);const c=await i.json();if(!c.success)throw new Error(c.error||"Unknown error");const l=c.data;l.overview&&(E("total-pageviews",e(l.overview.pageViews)),E("total-users",e(l.overview.users)),E("company-views",e(l.overview.companyViews)),E("apply-clicks",e(l.overview.applyClicks))),l.daily&&function(e){const t=document.getElementById("daily-chart");if(!t)return;if(!e||0===e.length)return void(t.innerHTML="<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>");const n=Math.max(...e.map(e=>e.views)),a=e.length>30?e.filter((e,t)=>t%3==0):e;t.innerHTML=`\n    <div class="simple-chart">\n      <div class="chart-bars">\n        ${a.map(e=>`\n            <div class="chart-bar-wrapper">\n              <div class="chart-bar" style="height: ${n>0?e.views/n*100:0}%">\n                <span class="bar-value">${e.views}</span>\n              </div>\n              <span class="bar-label">${e.date}</span>\n            </div>\n          `).join("")}\n      </div>\n    </div>\n  `}(l.daily),l.companies&&(b=l.companies.filter(e=>e.domain&&"(not set)"!==e.domain&&e.name&&"(not set)"!==e.name).map(e=>({name:e.name,domain:e.domain,views:e.views,clicks:e.clicks,pattern:"standard"})),L(),k()),l.applications&&function(e){const n=document.querySelector("#applications-table tbody");if(!n)return;const a={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};if(!e||0===e.length)return void(n.innerHTML='<tr><td colspan="4" class="loading-cell">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${t(e.date)}</td>\n      <td>${t(e.company)}</td>\n      <td><span class="type-badge ${t(e.type)}">${a[e.type]||t(e.type)}</span></td>\n      <td>${t(e.source)}</td>\n    </tr>\n  `).join("")}(l.applications),$(!1)}catch(o){console.error("[Admin] API fetch error:",o),$(!1),I(n)}}(a,o)}catch(s){console.error("[Admin] API fetch failed, loading mock data:",s),I(a)}else I(a)}function $(e){const t=document.getElementById("refresh-btn");t&&(t.textContent=e?"èª­ã¿è¾¼ã¿ä¸­...":"æ›´æ–°",t.disabled=e)}function E(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function I(n){const a=80*n,o=45*n,s=12*n;E("total-pageviews",e(150*n+Math.floor(500*Math.random()))),E("total-users",e(a+Math.floor(200*Math.random()))),E("company-views",e(o+Math.floor(100*Math.random()))),E("apply-clicks",e(s+Math.floor(30*Math.random()))),function(e){const t=document.getElementById("daily-chart");if(!t)return;const n=[],a=new Date;for(let i=e-1;i>=0;i--){const e=new Date(a);e.setDate(e.getDate()-i),n.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(100+200*Math.random()),clicks:Math.floor(5+20*Math.random())})}const o=Math.max(...n.map(e=>e.views)),s=e>30?n.filter((e,t)=>t%3==0):n;t.innerHTML=`\n    <div class="simple-chart">\n      <div class="chart-bars">\n        ${s.map(e=>`\n            <div class="chart-bar-wrapper">\n              <div class="chart-bar" style="height: ${e.views/o*100}%">\n                <span class="bar-value">${e.views}</span>\n              </div>\n              <span class="bar-label">${e.date}</span>\n            </div>\n          `).join("")}\n      </div>\n    </div>\n  `}(n),b=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",domain:"toyota",views:1250,clicks:89,pattern:"modern"},{name:"æ—¥ç”£è‡ªå‹•è»Š",domain:"nissan",views:980,clicks:67,pattern:"classic"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",domain:"honda",views:856,clicks:54,pattern:"colorful"},{name:"ã‚¹ãƒãƒ«",domain:"subaru",views:654,clicks:43,pattern:"minimal"},{name:"ãƒãƒ„ãƒ€",domain:"mazda",views:523,clicks:32,pattern:"standard"},{name:"ã‚¹ã‚ºã‚­",domain:"suzuki",views:412,clicks:28,pattern:"modern"},{name:"ãƒ€ã‚¤ãƒãƒ„",domain:"daihatsu",views:387,clicks:24,pattern:"classic"},{name:"ä¸‰è±è‡ªå‹•è»Š",domain:"mitsubishi",views:298,clicks:18,pattern:"standard"}],L(),k(),function(){const e=document.querySelector("#applications-table tbody");if(!e)return;const n=[{date:"2025/01/17 14:32",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/17 13:15",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"line",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/17 11:48",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Yahooæ¤œç´¢"},{date:"2025/01/17 10:22",company:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/16 18:45",company:"ã‚¹ãƒãƒ«",type:"line",source:"Googleæ¤œç´¢"},{date:"2025/01/16 16:30",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"SNS"},{date:"2025/01/16 14:12",company:"ãƒãƒ„ãƒ€",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/16 11:55",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"}],a={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};e.innerHTML=n.map(e=>`\n    <tr>\n      <td>${t(e.date)}</td>\n      <td>${t(e.company)}</td>\n      <td><span class="type-badge ${t(e.type)}">${a[e.type]}</span></td>\n      <td>${t(e.source)}</td>\n    </tr>\n  `).join("")}()}function L(){const n=document.querySelector("#overview-company-table tbody");if(!n)return;const a=[...b].sort((e,t)=>t.views-e.views);n.innerHTML=a.slice(0,5).map((n,a)=>{const o=(n.clicks/n.views*100).toFixed(1);return`\n      <tr>\n        <td>${a+1}</td>\n        <td>${t(n.name)}</td>\n        <td>${e(n.views)}</td>\n        <td>${n.clicks}</td>\n        <td>${o}%</td>\n      </tr>\n    `}).join("")}function k(){const n=document.getElementById("company-cards");n&&(n.innerHTML=b.map(n=>{const a=(n.clicks/n.views*100).toFixed(1),o=u(n.pattern);return`\n      <div class="company-card" data-domain="${t(n.domain)}" data-name="${t(n.name)}" data-views="${n.views}" data-clicks="${n.clicks}">\n        <div class="company-card-header">\n          <h4>${t(n.name)}</h4>\n          <span class="pattern-badge ${t(n.pattern)}">${o}</span>\n        </div>\n        <div class="company-card-stats">\n          <div class="card-stat">\n            <span class="stat-value">${e(n.views)}</span>\n            <span class="stat-label">ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${n.clicks}</span>\n            <span class="stat-label">å¿œå‹Ÿã‚¯ãƒªãƒƒã‚¯</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${a}%</span>\n            <span class="stat-label">CVR</span>\n          </div>\n        </div>\n        <button class="btn-view-status" data-domain="${t(n.domain)}" data-name="${t(n.name)}">ä¼šç¤¾ã®çŠ¶æ³ã‚’ç¢ºèª</button>\n      </div>\n    `}).join(""),n.querySelectorAll(".btn-view-status").forEach(t=>{t.addEventListener("click",t=>{!async function(t,n){const a=document.getElementById("company-detail-title");a&&(a.textContent=`${n} ã®åˆ†æ`);const o=document.getElementById("detail-view-page-btn");o&&(o.href=`company.html?c=${t}`);document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const s=document.getElementById("section-company-detail");s&&s.classList.add("active");const i=document.getElementById("page-title");i&&(i.textContent="ä¼æ¥­è©³ç´°åˆ†æ");document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")}),function(){const e='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';document.querySelectorAll(".detail-stat-value").forEach(e=>{e.textContent="-"}),document.querySelectorAll(".detail-chart").forEach(t=>{t.innerHTML=e}),document.querySelectorAll(".detail-table-container tbody").forEach(e=>{e.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>'})}();const c=document.getElementById("date-range"),d=(null==c?void 0:c.value)||30;try{await async function(t,n){const a=l.apiEndpoint,o={},s=f();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=company-detail&domain=${t}&days=${n}`,{headers:o}),c=await i.json();if(!c.success)throw new Error(c.error||"API Error");!async function(t,n){var a,o;const s=b.find(e=>e.domain===n)||{},i=(null==(a=t.summary)?void 0:a.totalViews)||s.views||0,c=s.clicks||0,l=i>0?(c/i*100).toFixed(1):0,d=(null==(o=t.summary)?void 0:o.avgDailyViews)||0;E("detail-total-views",e(i)),E("detail-total-clicks",e(c)),E("detail-cvr",`${l}%`),E("detail-avg-daily",e(Math.round(d))),D(t.daily||[]),H(t.traffic||[]);const r=t.gender||{};P({male:r.male||0,female:r.female||0,other:r.unknown||0});const m=t.age||{};U((p=m,{"20s":(p["18-24"]||0)+(p["25-34"]||0),"30s":p["35-44"]||0,"40s":p["45-54"]||0,"50s":(p["55-64"]||0)+(p["65+"]||0)})),j([]),R([]),await G(n);var p}(c.data,t)}(t,d)}catch(r){console.error("[Admin] Company detail error:",r),function(t){const n=b.find(e=>e.domain===t)||{views:1e3,clicks:50},a=n.views,o=n.clicks,s=(o/a*100).toFixed(1);E("detail-total-views",e(a)),E("detail-total-clicks",e(o)),E("detail-cvr",`${s}%`),E("detail-avg-daily",e(Math.round(a/30)));const i=[],c=new Date;for(let e=29;e>=0;e--){const t=new Date(c);t.setDate(t.getDate()-e),i.push({date:`${t.getMonth()+1}/${t.getDate()}`,views:Math.floor(20+60*Math.random())})}D(i);const l=[{title:"è£½é€ ã‚¹ã‚¿ãƒƒãƒ•",applications:23},{title:"çµ„ç«‹ä½œæ¥­å“¡",applications:18},{title:"æ¤œæŸ»ãƒ»æ¤œå“",applications:12},{title:"æ©Ÿæ¢°ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼",applications:8},{title:"ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒ•ãƒˆ",applications:5}];j(l);H([{channel:"Organic Search",count:Math.floor(.45*a)},{channel:"Direct",count:Math.floor(.28*a)},{channel:"Social",count:Math.floor(.18*a)},{channel:"Referral",count:Math.floor(.09*a)}]);P({male:Math.floor(.72*o),female:Math.floor(.25*o),other:Math.floor(.03*o)});U({"20s":Math.floor(.35*o),"30s":Math.floor(.32*o),"40s":Math.floor(.23*o),"50s":Math.floor(.1*o)}),R(l.map(e=>({...e,views:Math.floor(a*(e.applications/o)),cvr:(e.applications/(a*(e.applications/o))*100).toFixed(1)}))),G(t)}(t)}}(t.target.dataset.domain,t.target.dataset.name)})}))}function B(e){const t=document.querySelectorAll(".company-card"),n=e.toLowerCase();t.forEach(e=>{const t=e.dataset.name.toLowerCase(),a=e.dataset.domain.toLowerCase();t.includes(n)||a.includes(n)?e.style.display="":e.style.display="none"})}function S(){const e=document.getElementById("sort-by"),t=(null==e?void 0:e.value)||"views",n=document.getElementById("company-cards");if(!n)return;const a=Array.from(n.querySelectorAll(".company-card"));a.sort((e,n)=>{switch(t){case"views":return parseInt(n.dataset.views)-parseInt(e.dataset.views);case"clicks":return parseInt(n.dataset.clicks)-parseInt(e.dataset.clicks);case"cvr":const t=parseInt(e.dataset.clicks)/parseInt(e.dataset.views);return parseInt(n.dataset.clicks)/parseInt(n.dataset.views)-t;case"name":return e.dataset.name.localeCompare(n.dataset.name,"ja");default:return 0}}),a.forEach(e=>n.appendChild(e))}function M(){const n=document.querySelectorAll(".analytics-tab"),a=document.querySelectorAll(".analytics-tab-content");n.forEach(o=>{o.addEventListener("click",()=>{const s=o.dataset.tab;n.forEach(e=>e.classList.remove("active")),o.classList.add("active"),a.forEach(e=>e.classList.remove("active"));const i=document.getElementById(s);i&&(i.classList.add("active"),async function(n){const a=document.getElementById("date-range"),o=(null==a?void 0:a.value)||30,s=l.apiEndpoint;switch(n){case"engagement-tab":await async function(n,a){try{const o={},s=f();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=engagement&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){const a=n.overall||{};E("avg-session-duration",`${a.avgSessionDuration||0}ç§’`),E("engagement-rate",`${a.engagementRate||0}%`),E("bounce-rate",`${a.bounceRate||0}%`);const o=document.querySelector("#engagement-company-table tbody");o&&n.byCompany&&n.byCompany.length>0?o.innerHTML=n.byCompany.map(n=>`\n      <tr>\n        <td>${t(n.name||n.domain)}</td>\n        <td>${e(n.views)}</td>\n        <td>${Math.round(n.engagementTime)}ç§’</td>\n        <td>${n.avgTimePerView}ç§’</td>\n      </tr>\n    `).join(""):o&&(o.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(c.data):T()}catch(o){console.error("[Admin] Engagement data error:",o),T()}}(o,s);break;case"traffic-tab":await async function(n,a){try{const o={},s=f();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=traffic&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){const a=document.getElementById("channel-chart");if(a&&n.channels&&n.channels.length>0){const o=Math.max(...n.channels.map(e=>e.sessions));a.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.channels.map(n=>{const a=o>0?n.sessions/o*100:0;return`\n            <div class="bar-row">\n              <span class="bar-label">${t(n.channel)}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${a}%"></div>\n                <span class="bar-value">${e(n.sessions)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const o=document.querySelector("#source-table tbody");o&&n.sources&&n.sources.length>0?o.innerHTML=n.sources.map(n=>`\n      <tr>\n        <td>${t(n.source)}</td>\n        <td>${t(n.medium)}</td>\n        <td>${e(n.sessions)}</td>\n        <td>${e(n.users)}</td>\n      </tr>\n    `).join(""):o&&(o.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(c.data):A()}catch(o){console.error("[Admin] Traffic data error:",o),A()}}(o,s);break;case"funnel-tab":await async function(n,a){try{const o={},s=f();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=funnel&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){const a=document.getElementById("funnel-chart");a&&n.funnel&&n.funnel.length>0&&(a.innerHTML=n.funnel.map(n=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${t(n.stage)}</span>\n        <span class="funnel-stage-count">${e(n.count)}</span>\n        <span class="funnel-stage-rate">${n.rate}%</span>\n      </div>\n    `).join(""));const o=document.getElementById("action-breakdown-chart");if(o&&n.actionBreakdown&&n.actionBreakdown.length>0){const a=Math.max(...n.actionBreakdown.map(e=>e.count));o.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.actionBreakdown.map(n=>{const o=a>0?n.count/a*100:0;return`\n            <div class="bar-row">\n              <span class="bar-label">${t(n.label)}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${o}%"></div>\n                <span class="bar-value">${e(n.count)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const s=document.querySelector("#company-funnel-table tbody");s&&n.byCompany&&n.byCompany.length>0?s.innerHTML=n.byCompany.map(n=>`\n      <tr>\n        <td>${t(n.domain)}</td>\n        <td>${e(n.views)}</td>\n        <td>${e(n.clicks)}</td>\n        <td>${n.cvr}%</td>\n      </tr>\n    `).join(""):s&&(s.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(c.data):q()}catch(o){console.error("[Admin] Funnel data error:",o),q()}}(o,s);break;case"trends-tab":await async function(n,a){try{const o={},s=f();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=trends&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){n.insights&&(E("peak-day",n.insights.peakDay||"-"),E("peak-hour",n.insights.peakHour||"-"));const a=document.getElementById("day-of-week-chart");if(a&&n.byDayOfWeek&&n.byDayOfWeek.length>0){const o=Math.max(...n.byDayOfWeek.map(e=>e.sessions));a.innerHTML=`\n      <div class="day-chart">\n        ${n.byDayOfWeek.map(n=>`\n            <div class="day-bar" style="height: ${o>0?n.sessions/o*100:0}%" data-day="${t(n.day)}">\n              <span class="day-value">${e(n.sessions)}</span>\n            </div>\n          `).join("")}\n      </div>\n    `}const o=document.getElementById("hour-chart");if(o&&n.byHour&&n.byHour.length>0){const e=Math.max(...n.byHour.map(e=>e.sessions));o.innerHTML=`\n      <div class="hour-chart">\n        ${n.byHour.map(t=>`\n            <div class="hour-bar" style="height: ${e>0?t.sessions/e*100:0}%" data-hour="${t.hour}"></div>\n          `).join("")}\n      </div>\n    `}}(c.data):x()}catch(o){console.error("[Admin] Trend data error:",o),x()}}(o,s)}}(s))})})}function T(){E("avg-session-duration","45.2ç§’"),E("engagement-rate","68.5%"),E("bounce-rate","31.5%");const t=document.querySelector("#engagement-company-table tbody");if(t){const n=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",views:1250,time:4500,avg:"3.6"},{name:"æ—¥ç”£è‡ªå‹•è»Š",views:980,time:3200,avg:"3.3"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",views:856,time:2800,avg:"3.3"}];t.innerHTML=n.map(t=>`\n      <tr>\n        <td>${t.name}</td>\n        <td>${e(t.views)}</td>\n        <td>${t.time}ç§’</td>\n        <td>${t.avg}ç§’</td>\n      </tr>\n    `).join("")}}function A(){const t=document.getElementById("channel-chart");if(t){const n=[{channel:"Organic Search",sessions:1250},{channel:"Direct",sessions:890},{channel:"Social",sessions:456},{channel:"Referral",sessions:234}],a=1250;t.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.map(t=>{const n=t.sessions/a*100;return`\n            <div class="bar-row">\n              <span class="bar-label">${t.channel}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${e(t.sessions)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const n=document.querySelector("#source-table tbody");if(n){const t=[{source:"google",medium:"organic",sessions:890,users:756},{source:"(direct)",medium:"(none)",sessions:456,users:412},{source:"yahoo",medium:"organic",sessions:234,users:198}];n.innerHTML=t.map(t=>`\n      <tr>\n        <td>${t.source}</td>\n        <td>${t.medium}</td>\n        <td>${e(t.sessions)}</td>\n        <td>${e(t.users)}</td>\n      </tr>\n    `).join("")}}function q(){const t=document.getElementById("funnel-chart");if(t){const n=[{stage:"ã‚µã‚¤ãƒˆè¨ªå•",count:5e3,rate:"100"},{stage:"ä¼æ¥­ãƒšãƒ¼ã‚¸é–²è¦§",count:2500,rate:"50.0"},{stage:"ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«",count:1800,rate:"36.0"},{stage:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",count:150,rate:"6.0"}];t.innerHTML=n.map(t=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${t.stage}</span>\n        <span class="funnel-stage-count">${e(t.count)}</span>\n        <span class="funnel-stage-rate">${t.rate}%</span>\n      </div>\n    `).join("")}const n=document.getElementById("action-breakdown-chart");if(n){const e=[{label:"å¿œå‹Ÿãƒœã‚¿ãƒ³",count:89},{label:"LINEç›¸è«‡",count:45},{label:"ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡",count:16}],t=89;n.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${e.map(e=>{const n=e.count/t*100;return`\n            <div class="bar-row">\n              <span class="bar-label">${e.label}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${e.count}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const a=document.querySelector("#company-funnel-table tbody");if(a){const t=[{domain:"toyota",views:1250,clicks:89,cvr:"7.1"},{domain:"nissan",views:980,clicks:67,cvr:"6.8"},{domain:"honda",views:856,clicks:54,cvr:"6.3"}];a.innerHTML=t.map(t=>`\n      <tr>\n        <td>${t.domain}</td>\n        <td>${e(t.views)}</td>\n        <td>${t.clicks}</td>\n        <td>${t.cvr}%</td>\n      </tr>\n    `).join("")}}function x(){E("peak-day","æœ¨"),E("peak-hour","14æ™‚");const e=document.getElementById("day-of-week-chart");if(e){const t=[{day:"æ—¥",sessions:120},{day:"æœˆ",sessions:180},{day:"ç«",sessions:220},{day:"æ°´",sessions:250},{day:"æœ¨",sessions:280},{day:"é‡‘",sessions:240},{day:"åœŸ",sessions:150}],n=280;e.innerHTML=`\n      <div class="day-chart">\n        ${t.map(e=>`\n            <div class="day-bar" style="height: ${e.sessions/n*100}%" data-day="${e.day}">\n              <span class="day-value">${e.sessions}</span>\n            </div>\n          `).join("")}\n      </div>\n    `}const t=document.getElementById("hour-chart");if(t){const e=[];for(let t=0;t<24;t++){let n=10;t>=9&&t<=18&&(n=30+Math.floor(50*Math.random())),t>=12&&t<=15&&(n=50+Math.floor(40*Math.random())),e.push({hour:t,sessions:n})}const n=Math.max(...e.map(e=>e.sessions));t.innerHTML=`\n      <div class="hour-chart">\n        ${e.map(e=>`\n            <div class="hour-bar" style="height: ${e.sessions/n*100}%" data-hour="${e.hour}"></div>\n          `).join("")}\n      </div>\n    `}}function C(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-companies");e&&e.classList.add("active"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector('[data-section="companies"]');t&&t.parentElement.classList.add("active");const n=document.getElementById("page-title");n&&(n.textContent="ä¼æ¥­åˆ¥ãƒ‡ãƒ¼ã‚¿")}function D(e){const t=document.getElementById("detail-daily-chart");if(!t||!e.length)return void(t&&(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'));const n=Math.max(...e.map(e=>e.views));t.innerHTML=`\n    <div class="detail-line-chart">\n      ${e.map((e,t)=>{const a=n>0?e.views/n*100:0;return`\n          <div class="detail-line-bar" style="height: ${Math.max(a,2)}%" data-date="${e.date}">\n            <span class="bar-tooltip">${e.date}: ${e.views}ä»¶</span>\n          </div>\n        `}).join("")}\n    </div>\n  `}function j(e){const n=document.getElementById("detail-job-chart");if(!n)return;if(!e.length)return void(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=Math.max(...e.map(e=>e.applications));n.innerHTML=`\n    <div class="detail-bar-chart">\n      ${e.slice(0,5).map((e,n)=>{const o=a>0?e.applications/a*100:0;return`\n          <div class="detail-bar-row">\n            <span class="detail-bar-label" title="${t(e.title)}">${t(e.title)}</span>\n            <div class="detail-bar-track">\n              <div class="detail-bar-fill job-${n+1}" style="width: ${o}%"></div>\n              <span class="detail-bar-value">${e.applications}ä»¶</span>\n            </div>\n          </div>\n        `}).join("")}\n    </div>\n  `}function H(e){const n=document.getElementById("detail-traffic-chart");if(!n)return;if(!e.length)return void(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=e.reduce((e,t)=>e+t.count,0),o=["organic","direct","social","referral"];let s=[],i=0;e.forEach((e,t)=>{const n=e.count/a*100,c=o[t%o.length];s.push(`${{organic:"#10b981",direct:"#6366f1",social:"#f59e0b",referral:"#8b5cf6"}[c]} ${i}deg ${i+3.6*n}deg`),i+=3.6*n}),n.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${s.join(", ")});"></div>\n      <div class="pie-legend">\n        ${e.map((e,n)=>{const s=(e.count/a*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${o[n%o.length]}"></span>\n              <span class="pie-label">${t(e.channel)}</span>\n              <span class="pie-value">${s}%</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function P(e){const t=document.getElementById("detail-gender-chart");if(!t)return;const n=e.male+e.female+e.other;if(0===n)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=(e.male/n*100).toFixed(1),o=(e.female/n*100).toFixed(1),s=(e.other/n*100).toFixed(1),i=e.male/n*360,c=e.female/n*360;t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(#3b82f6 0deg ${i}deg, #ec4899 ${i}deg ${i+c}deg, #94a3b8 ${i+c}deg 360deg);"></div>\n      <div class="pie-legend">\n        <div class="pie-legend-item">\n          <span class="pie-color male"></span>\n          <span class="pie-label">ç”·æ€§</span>\n          <span class="pie-value">${e.male}äºº (${a}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color female"></span>\n          <span class="pie-label">å¥³æ€§</span>\n          <span class="pie-value">${e.female}äºº (${o}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color other"></span>\n          <span class="pie-label">ãã®ä»–</span>\n          <span class="pie-value">${e.other}äºº (${s}%)</span>\n        </div>\n      </div>\n    </div>\n  `}function U(e){const t=document.getElementById("detail-age-chart");if(!t)return;const n=e["20s"]+e["30s"]+e["40s"]+e["50s"];if(0===n)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=[{key:"20s",label:"20ä»£",color:"age-20s",colorCode:"#3b82f6"},{key:"30s",label:"30ä»£",color:"age-30s",colorCode:"#10b981"},{key:"40s",label:"40ä»£",color:"age-40s",colorCode:"#f59e0b"},{key:"50s",label:"50ä»£ä»¥ä¸Š",color:"age-50s",colorCode:"#ef4444"}];let o=[],s=0;a.forEach(t=>{const a=e[t.key]/n*100;o.push(`${t.colorCode} ${s}deg ${s+3.6*a}deg`),s+=3.6*a}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${a.map(t=>{const a=(e[t.key]/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${t.color}"></span>\n              <span class="pie-label">${t.label}</span>\n              <span class="pie-value">${e[t.key]}äºº (${a}%)</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function R(n){const a=document.querySelector("#detail-job-table tbody");a&&(n.length?a.innerHTML=n.map(n=>`\n    <tr>\n      <td>${t(n.title)}</td>\n      <td>${e(n.views)}</td>\n      <td>${n.applications}</td>\n      <td>${n.cvr}%</td>\n    </tr>\n  `).join(""):a.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}async function G(e){const t=l.apiEndpoint,n={},a=f();a&&(n.Authorization=`Bearer ${a}`);try{const a=await fetch(`${t}?type=recent-applications&domain=${e}&limit=10`,{headers:n}),o=await a.json();if(o.success&&o.data&&o.data.applications){O(o.data.applications.map(e=>({date:e.date,job:e.jobTitle||"-",type:e.type||"apply",source:e.source||"Direct"})))}else O([])}catch(o){console.error("[Admin] Recent applications error:",o),O([])}}function O(e){const n=document.querySelector("#detail-recent-applications tbody");if(!n)return;const a={apply:"å¿œå‹Ÿ",line:"LINE",consult:"ç›¸è«‡"};e.length?n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${t(e.date)}</td>\n      <td>${t(e.job)}</td>\n      <td><span class="type-badge ${e.type}">${a[e.type]||e.type}</span></td>\n      <td>${t(e.source)}</td>\n    </tr>\n  `).join(""):n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}function N(e){const t=[];let n="",a=!1;for(let o=0;o<e.length;o++){const s=e[o];'"'===s?a&&'"'===e[o+1]?(n+='"',o++):a=!a:","!==s||a?n+=s:(t.push(n.trim()),n="")}return t.push(n.trim()),t}function _(e){const t=e.replace(/"/g,"").trim();return{"ä¼šç¤¾å":"company",company:"company","ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","è¡¨ç¤ºã™ã‚‹":"showCompany",showCompany:"showCompany",visible:"showCompany","ç”»åƒURL":"imageUrl",imageUrl:"imageUrl",image_url:"imageUrl","èª¬æ˜":"description",description:"description","ä¸¦ã³é †":"order",order:"order","ç®¡ç†ã‚·ãƒ¼ãƒˆ":"manageSheetUrl","ç®¡ç†ã‚·ãƒ¼ãƒˆURL":"manageSheetUrl",manageSheetUrl:"manageSheetUrl"}[t]||t}let z=[],F=!1;function V(){return z}async function K(){const e=document.getElementById("company-manage-tbody");if(e){e.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>';try{const t=`https://docs.google.com/spreadsheets/d/${d}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(r)}`,n=await fetch(t);if(!n.ok)throw new Error("ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");let a=function(e){const t=e.split("\n"),n=N(t[0]||""),a=[];for(let o=1;o<t.length;o++){if(!t[o].trim())continue;const e=N(t[o]),s={};n.forEach((t,n)=>{const a=_(t);s[a]=e[n]||""}),a.push(s)}return a}(await n.text());if(a=a.map(e=>{if(e.companyDomain){const n=localStorage.getItem(`company_data_${e.companyDomain}`);if(n)try{const t=JSON.parse(n);return{...e,...t}}catch(t){console.error("ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:",t)}}return e}),0===a.length)return void(e.innerHTML='<tr><td colspan="6" class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');z=a,Y()}catch(t){console.error("ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>'}}}function W(e){window.location.href=`company-edit.html?domain=${encodeURIComponent(e)}`}function J(){window.location.href="company-edit.html"}function X(){const e=document.getElementById("company-modal");e&&(e.style.display="none"),F=!1}function Y(){const e=document.getElementById("company-manage-tbody");if(!e)return;const n=z||[];0!==n.length?(e.innerHTML=n.map(e=>`\n    <tr data-domain="${t(e.companyDomain||"")}">\n      <td>${t(e.company||"")}</td>\n      <td><code>${t(e.companyDomain||"")}</code></td>\n      <td><span class="badge ${e.designPattern||"standard"}">${u(e.designPattern||"standard")}</span></td>\n      <td>${"â—‹"===e.showCompany||"â—¯"===e.showCompany?'<span class="badge success">è¡¨ç¤º</span>':'<span class="badge">éè¡¨ç¤º</span>'}</td>\n      <td>\n        <div class="action-buttons">\n          <button class="btn-small btn-edit" data-action="edit" data-domain="${t(e.companyDomain||"")}">ç·¨é›†</button>\n          <button class="btn-small btn-primary" data-action="jobs" data-domain="${t(e.companyDomain||"")}">æ±‚äººç®¡ç†</button>\n          <a href="lp.html?c=${t(e.companyDomain||"")}" target="_blank" class="btn-small btn-view">LPç¢ºèª</a>\n        </div>\n      </td>\n    </tr>\n  `).join(""),e.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a=t.dataset.domain;"edit"===n?W(a):"jobs"===n&&Q(a)})):e.innerHTML='<tr><td colspan="5" class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}function Q(e){const t=null==z?void 0:z.find(t=>t.companyDomain===e);if(!t)return void alert("ä¼šç¤¾æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const n=new URLSearchParams;n.set("domain",e),n.set("company",t.company||e),t.manageSheetUrl&&n.set("sheetUrl",t.manageSheetUrl),window.location.href=`job-manage.html?${n.toString()}`}let Z=null;async function ee(){const e=document.getElementById("lp-company-select");if(!e)return;let n=V();n&&0!==n.length||(await K(),n=V());const a=n.filter(e=>e.companyDomain&&("â—‹"===e.showCompany||"â—¯"===e.showCompany));e.innerHTML='<option value="">-- ä¼šç¤¾ã‚’é¸æŠ --</option>'+a.map(e=>`<option value="${t(e.companyDomain)}">${t(e.company)}</option>`).join("")}async function te(e){const t=document.getElementById("lp-editor"),n=document.getElementById("lp-preview-btn"),a=document.getElementById("lp-edit-mode-btn");if(!e)return void(t&&(t.style.display="none"));t&&(t.style.display="block"),n&&(n.href=`lp.html?c=${encodeURIComponent(e)}`),a&&(a.href=`lp.html?c=${encodeURIComponent(e)}&edit`),ce();const o=V(),s=null==o?void 0:o.find(t=>t.companyDomain===e);if(s){const e=document.querySelector(`input[name="design-pattern"][value="${s.designPattern||"standard"}"]`);e&&(e.checked=!0)}try{const t=`https://docs.google.com/spreadsheets/d/${d}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(m)}`,n=await fetch(t);if(n.ok){const t=function(e,t){const n=e.split("\n"),a=N(n[0]||"");for(let o=1;o<n.length;o++){if(!n[o].trim())continue;const e=N(n[o]),s={};if(a.forEach((t,n)=>{const a=t.replace(/"/g,"").trim();s[a]=e[n]||""}),s.companyDomain===t||s["ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³"]===t){const e={heroTitle:s.heroTitle||s["ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«"]||"",heroSubtitle:s.heroSubtitle||s["ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«"]||"",heroImage:s.heroImage||s["ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ"]||"",ctaText:s.ctaText||s["CTAãƒ†ã‚­ã‚¹ãƒˆ"]||"",faq:s.faq||s.FAQ||"",designPattern:s.designPattern||s["ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³"]||"",sectionOrder:s.sectionOrder||s["ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åº"]||"",sectionVisibility:s.sectionVisibility||s["ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º"]||"",tiktokPixelId:s.tiktokPixelId||s["TikTok Pixel ID"]||"",googleAdsId:s.googleAdsId||s["Google Ads ID"]||"",googleAdsLabel:s.googleAdsLabel||s["Google Ads ãƒ©ãƒ™ãƒ«"]||"",ogpTitle:s.ogpTitle||s["OGPã‚¿ã‚¤ãƒˆãƒ«"]||"",ogpDescription:s.ogpDescription||s["OGPèª¬æ˜æ–‡"]||"",ogpImage:s.ogpImage||s["OGPç”»åƒ"]||""};for(let t=1;t<=6;t++)e[`pointTitle${t}`]=s[`pointTitle${t}`]||s[`ãƒã‚¤ãƒ³ãƒˆ${t}ã‚¿ã‚¤ãƒˆãƒ«`]||"",e[`pointDesc${t}`]=s[`pointDesc${t}`]||s[`ãƒã‚¤ãƒ³ãƒˆ${t}èª¬æ˜`]||"";return e}}return null}(await n.text(),e);if(t){ne("lp-hero-title",t.heroTitle),ne("lp-hero-subtitle",t.heroSubtitle),ne("lp-hero-image",t.heroImage);const e=[];for(let n=1;n<=6;n++){const a=t[`pointTitle${n}`]||"",o=t[`pointDesc${n}`]||"";(a||o)&&e.push({title:a,desc:o})}if(ae(e.length>0?e:[{title:"",desc:""},{title:"",desc:""},{title:"",desc:""}]),ne("lp-cta-text",t.ctaText||"ä»Šã™ãå¿œå‹Ÿã™ã‚‹"),ne("lp-faq",t.faq),t.designPattern){const e=document.querySelector(`input[name="design-pattern"][value="${t.designPattern}"]`);e&&(e.checked=!0)}return t.sectionOrder&&function(e){const t=document.getElementById("lp-section-order");if(!t||!e)return;const n=e.split(",").map(e=>e.trim()).filter(e=>e);if(0===n.length)return;const a=Array.from(t.querySelectorAll(".section-order-item")),o={};a.forEach(e=>{o[e.dataset.section]=e}),n.forEach(e=>{const n=o[e];n&&t.appendChild(n)})}(t.sectionOrder),t.sectionVisibility&&function(e){if(!e)return;try{const t=JSON.parse(e);["points","jobs","details","faq"].forEach(e=>{if(void 0!==t[e]){const n=document.getElementById(`section-${e}-visible`);n&&(n.checked=t[e])}})}catch(t){console.error("ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºçŠ¶æ…‹ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:",t)}}(t.sectionVisibility),ne("lp-tiktok-pixel",t.tiktokPixelId),ne("lp-google-ads-id",t.googleAdsId),ne("lp-google-ads-label",t.googleAdsLabel),ne("lp-ogp-title",t.ogpTitle),ne("lp-ogp-description",t.ogpDescription),ne("lp-ogp-image",t.ogpImage),void le(t.heroImage||"")}}}catch(i){console.log("LPè¨­å®šã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")}!function(){["lp-hero-title","lp-hero-subtitle","lp-hero-image","lp-faq","lp-tiktok-pixel","lp-google-ads-id","lp-google-ads-label","lp-ogp-title","lp-ogp-description","lp-ogp-image"].forEach(e=>ne(e,"")),ne("lp-cta-text","ä»Šã™ãå¿œå‹Ÿã™ã‚‹"),ae();const e=document.querySelector('input[name="design-pattern"][value="standard"]');e&&(e.checked=!0);le("")}()}function ne(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}function ae(e=[{title:"",desc:""},{title:"",desc:""},{title:"",desc:""}]){const n=document.getElementById("point-inputs-container");n&&(n.innerHTML=e.map((e,n)=>`\n    <div class="point-input-group" data-point-index="${n}">\n      <label>ãƒã‚¤ãƒ³ãƒˆ${n+1}</label>\n      <input type="text" class="point-title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" value="${t(e.title||"")}">\n      <input type="text" class="point-desc" placeholder="èª¬æ˜æ–‡" value="${t(e.desc||"")}">\n      <button type="button" class="btn-remove-point" title="å‰Šé™¤">&times;</button>\n    </div>\n  `).join(""),n.querySelectorAll(".btn-remove-point").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".point-input-group");t&&n.children.length>1&&(t.remove(),oe(),se(),pe())})}),n.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>pe())}),se())}function oe(){const e=document.getElementById("point-inputs-container");e&&e.querySelectorAll(".point-input-group").forEach((e,t)=>{e.dataset.pointIndex=t;const n=e.querySelector("label");n&&(n.textContent=`ãƒã‚¤ãƒ³ãƒˆ${t+1}`)})}function se(){const e=document.getElementById("point-inputs-container"),t=document.getElementById("btn-add-point");if(!e||!t)return;const n=e.children.length;t.disabled=n>=6}function ie(){const e=document.getElementById("point-inputs-container");if(!e)return;const t=e.children.length;if(t>=6)return;const n=t,a=document.createElement("div");a.className="point-input-group",a.dataset.pointIndex=n,a.innerHTML=`\n    <label>ãƒã‚¤ãƒ³ãƒˆ${n+1}</label>\n    <input type="text" class="point-title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" value="">\n    <input type="text" class="point-desc" placeholder="èª¬æ˜æ–‡" value="">\n    <button type="button" class="btn-remove-point" title="å‰Šé™¤">&times;</button>\n  `,a.querySelector(".btn-remove-point").addEventListener("click",()=>{e.children.length>1&&(a.remove(),oe(),se(),pe())}),a.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>pe())}),e.appendChild(a),se(),a.querySelector(".point-title").focus()}function ce(){const e=document.getElementById("hero-image-presets");e&&(e.innerHTML=g.map(e=>`\n    <div class="hero-image-preset" data-url="${t(e.url)}" title="${t(e.name)}">\n      <img src="${t(e.thumbnail)}" alt="${t(e.name)}" loading="lazy">\n      <span class="preset-name">${t(e.name)}</span>\n      <span class="preset-check">âœ“</span>\n    </div>\n  `).join(""),e.querySelectorAll(".hero-image-preset").forEach(e=>{e.addEventListener("click",()=>{!function(e){const t=document.getElementById("lp-hero-image");t&&(t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})));le(e)}(e.dataset.url)})}))}function le(e){const t=document.getElementById("hero-image-presets");t&&t.querySelectorAll(".hero-image-preset").forEach(t=>{const n=t.dataset.url,a=(null==e?void 0:e.split("?")[0])||"",o=(null==n?void 0:n.split("?")[0])||"";a&&o&&a===o?t.classList.add("selected"):t.classList.remove("selected")})}async function de(){var e,t,n,a,o,s,i,c,l,d,r,m,u,g,y;const v=null==(e=document.getElementById("lp-company-select"))?void 0:e.value;if(!v)return void alert("ä¼šç¤¾ã‚’é¸æŠã—ã¦ãã ã•ã„");const h=function(){const e=document.getElementById("point-inputs-container");if(!e)return[];const t=[];return e.querySelectorAll(".point-input-group").forEach(e=>{var n,a;const o=(null==(n=e.querySelector(".point-title"))?void 0:n.value)||"",s=(null==(a=e.querySelector(".point-desc"))?void 0:a.value)||"";t.push({title:o,desc:s})}),t}(),f={companyDomain:v,designPattern:(null==(t=document.querySelector('input[name="design-pattern"]:checked'))?void 0:t.value)||"standard",heroTitle:(null==(n=document.getElementById("lp-hero-title"))?void 0:n.value)||"",heroSubtitle:(null==(a=document.getElementById("lp-hero-subtitle"))?void 0:a.value)||"",heroImage:(null==(o=document.getElementById("lp-hero-image"))?void 0:o.value)||"",ctaText:(null==(s=document.getElementById("lp-cta-text"))?void 0:s.value)||"",faq:(null==(i=document.getElementById("lp-faq"))?void 0:i.value)||"",sectionOrder:re().join(","),sectionVisibility:JSON.stringify(me())};for(let p=0;p<6;p++)f[`pointTitle${p+1}`]=(null==(c=h[p])?void 0:c.title)||"",f[`pointDesc${p+1}`]=(null==(l=h[p])?void 0:l.desc)||"";f.tiktokPixelId=(null==(d=document.getElementById("lp-tiktok-pixel"))?void 0:d.value)||"",f.googleAdsId=(null==(r=document.getElementById("lp-google-ads-id"))?void 0:r.value)||"",f.googleAdsLabel=(null==(m=document.getElementById("lp-google-ads-label"))?void 0:m.value)||"",f.ogpTitle=(null==(u=document.getElementById("lp-ogp-title"))?void 0:u.value)||"",f.ogpDescription=(null==(g=document.getElementById("lp-ogp-description"))?void 0:g.value)||"",f.ogpImage=(null==(y=document.getElementById("lp-ogp-image"))?void 0:y.value)||"";const b=p;try{const e=document.getElementById("btn-save-lp-settings");e&&(e.disabled=!0,e.textContent="ä¿å­˜ä¸­...");const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveLPSettings",settings:f})))),n=`${b}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n,{method:"GET",redirect:"follow"}),o=await a.text();let s;try{s=JSON.parse(o)}catch(w){throw e&&(e.disabled=!1,e.textContent="LPè¨­å®šã‚’ä¿å­˜"),new Error(`GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™: ${o.substring(0,200)}`)}if(e&&(e.disabled=!1,e.textContent="LPè¨­å®šã‚’ä¿å­˜"),!s.success)return void alert("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(s.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));localStorage.removeItem(`lp_settings_${v}`),alert(`LPè¨­å®šã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã—ã¾ã—ãŸã€‚\n\nä¼šç¤¾: ${v}\nãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³: ${f.designPattern}`)}catch($){console.error("GAS APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:",$),alert("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚"),function(e,t){const n=`lp_settings_${t}`;localStorage.setItem(n,JSON.stringify(e)),alert(`LPè¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸã€‚\n\næ³¨æ„: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•ä¿å­˜ã™ã‚‹ã«ã¯ã€è¨­å®šç”»é¢ã§GAS API URLã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\n\nä¼šç¤¾: ${t}\nãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³: ${e.designPattern}`)}(f,v)}}function re(){const e=document.getElementById("lp-section-order");return e?Array.from(e.querySelectorAll("li")).map(e=>e.dataset.section):["hero","points","jobs","details","faq","apply"]}function me(){var e,t,n,a;return{points:(null==(e=document.getElementById("section-points-visible"))?void 0:e.checked)??!0,jobs:(null==(t=document.getElementById("section-jobs-visible"))?void 0:t.checked)??!0,details:(null==(n=document.getElementById("section-details-visible"))?void 0:n.checked)??!0,faq:(null==(a=document.getElementById("section-faq-visible"))?void 0:a.checked)??!0}}function pe(){Z&&clearTimeout(Z),Z=setTimeout(()=>{ye()},300)}function ue(){const e=document.getElementById("lp-preview-container"),t=document.getElementById("btn-toggle-preview");e&&("none"===e.style.display?(e.style.display="flex",t&&(t.textContent="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’éš ã™"),ye()):(e.style.display="none",t&&(t.textContent="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º")))}function ge(){const e=document.getElementById("lp-preview-container"),t=document.getElementById("btn-toggle-preview");e&&(e.style.display="none"),t&&(t.textContent="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º")}function ye(){console.log("LP Preview update triggered")}function ve(){const e=document.getElementById("lp-section-order");if(!e)return;let t=null;e.querySelectorAll(".section-order-item").forEach(n=>{n.setAttribute("draggable","true"),n.addEventListener("dragstart",e=>{t=n,n.classList.add("dragging"),e.dataTransfer.effectAllowed="move"}),n.addEventListener("dragend",()=>{n.classList.remove("dragging"),t=null,ye()}),n.addEventListener("dragover",n=>{n.preventDefault(),n.dataTransfer.dropEffect="move";const a=(o=e,s=n.clientY,[...o.querySelectorAll(".section-order-item:not(.dragging)")].reduce((e,t)=>{const n=t.getBoundingClientRect(),a=s-n.top-n.height/2;return a<0&&a>e.offset?{offset:a,element:t}:e},{offset:Number.NEGATIVE_INFINITY}).element);var o,s;null==a?e.appendChild(t):e.insertBefore(t,a)})})}function he(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="flex"),t&&(t.style.display="none")}function fe(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="none"),t&&(t.style.display="flex")}function be(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.remove("open"),t&&t.classList.remove("active"),n&&n.classList.remove("active"),document.body.style.overflow=""}function we(e){be(),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const n=document.querySelector(`[data-section="${e}"]`);n&&n.parentElement.classList.add("active"),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const a=document.getElementById(`section-${e}`);a&&a.classList.add("active");const o={overview:"æ¦‚è¦",companies:"ä¼æ¥­åˆ¥ãƒ‡ãƒ¼ã‚¿","company-manage":"ä¼šç¤¾ç®¡ç†","lp-settings":"LPè¨­å®š",applications:"å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿","applicant-select":"å¿œå‹Ÿè€…ç®¡ç†",settings:"è¨­å®š"},s=document.getElementById("page-title");s&&(s.textContent=o[e]||e),"company-manage"===e&&K(),"lp-settings"===e&&(ee(),ce()),"applicant-select"===e&&async function(){const e=document.getElementById("applicant-company-grid");if(!e)return;e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';try{const n=await i();if(!n||0===n.length)return void(e.innerHTML='<div class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=n.filter(e=>c(e));if(0===a.length)return void(e.innerHTML='<div class="loading-cell">è¡¨ç¤ºå¯èƒ½ãªä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“</div>');e.innerHTML=a.map(e=>`\n      <a href="applicants.html?domain=${encodeURIComponent(e.companyDomain)}" class="company-select-card">\n        <div class="company-select-icon">ğŸ¢</div>\n        <div class="company-select-info">\n          <h4>${t(e.company)}</h4>\n          <p>${t(e.companyDomain)}</p>\n        </div>\n        <div class="company-select-arrow">â†’</div>\n      </a>\n    `).join("")}catch(n){console.error("ä¼šç¤¾ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",n),e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}()}function $e(){const e=document.getElementById("mobile-menu-btn");e&&e.addEventListener("click",()=>{const e=document.getElementById("admin-sidebar");e&&e.classList.contains("open")?be():function(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.add("open"),t&&t.classList.add("active"),n&&n.classList.add("active"),document.body.style.overflow="hidden"}()});const t=document.getElementById("sidebar-close-btn");t&&t.addEventListener("click",be);const i=document.getElementById("mobile-overlay");i&&i.addEventListener("click",be);const c=document.getElementById("login-form");c&&c.addEventListener("submit",e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("password"))?void 0:n.value)||"",s=document.getElementById("login-error"),i=function(e,t){return e===l.credentials.username&&t===l.credentials.password?(sessionStorage.setItem(l.sessionKey,"authenticated"),{success:!0}):{success:!1,error:"ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"}}(a,o);i.success?(s&&(s.style.display="none"),fe(),w()):s&&(s.textContent=i.error,s.style.display="block")});const d=document.getElementById("logout-btn");d&&d.addEventListener("click",()=>{sessionStorage.removeItem(l.sessionKey),sessionStorage.removeItem("auth_method"),y&&y.signOut(),he()}),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();we(e.currentTarget.dataset.section)})});const r=document.getElementById("date-range");r&&r.addEventListener("change",()=>w());const m=document.getElementById("refresh-btn");m&&m.addEventListener("click",()=>w());const p=document.getElementById("company-search");p&&p.addEventListener("input",e=>B(e.target.value));const u=document.getElementById("sort-by");u&&u.addEventListener("change",()=>S());const g=document.getElementById("google-login-btn");g&&g.addEventListener("click",async()=>{const e=document.getElementById("login-error"),t=await async function(){if(!y)return{success:!1,error:"Firebaseèªè¨¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“"};try{const e=new firebase.auth.GoogleAuthProvider,t=await y.signInWithPopup(e);return v=t.user,h=await t.user.getIdToken(),sessionStorage.setItem(l.sessionKey,"authenticated"),sessionStorage.setItem("auth_method","google"),{success:!0,user:v,idToken:h}}catch(e){return console.error("Google login error:",e),{success:!1,error:"Googleãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message}}}();t.success?(e&&(e.style.display="none"),fe(),w()):e&&(e.textContent=t.error,e.style.display="block")});const f=document.getElementById("btn-add-company");f&&f.addEventListener("click",()=>J());const b=document.getElementById("lp-company-select");b&&b.addEventListener("change",e=>te(e.target.value));const $=document.getElementById("btn-save-lp-settings");$&&$.addEventListener("click",()=>de());const E=document.getElementById("btn-reset-lp-settings");E&&E.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-company-select"))?void 0:e.value;t&&te(t)});const I=document.getElementById("btn-toggle-preview");I&&I.addEventListener("click",()=>ue());const L=document.getElementById("btn-close-preview");L&&L.addEventListener("click",()=>ge()),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");document.querySelectorAll(".preview-device-btn").forEach(e=>{e.classList.toggle("active",e.dataset.device===t)}),n&&n.setAttribute("data-device",t)})});document.querySelectorAll("#lp-editor input, #lp-editor textarea").forEach(e=>{e.addEventListener("input",()=>pe())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>ye())}),ve(),function(){const e=document.getElementById("btn-add-point");e&&e.addEventListener("click",ie),ae()}(),document.querySelectorAll('#lp-section-order input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>ye())});const k=document.getElementById("save-password");k&&k.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("new-password"))?void 0:e.value;t&&t.length>=4?(localStorage.setItem("admin_password",t),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ")):alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")});const M=document.getElementById("feed-status"),T=()=>{M&&(M.style.display="flex")},A=()=>{M&&(M.style.display="none")},q=document.getElementById("btn-download-indeed");q&&q.addEventListener("click",async()=>{try{T(),await n(),alert("Indeed XMLãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{A()}});const x=document.getElementById("btn-download-google");x&&x.addEventListener("click",async()=>{try{T(),await a(),alert("Google JSON-LDã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{A()}});const C=document.getElementById("btn-download-jobbox");C&&C.addEventListener("click",async()=>{try{T(),await o(),alert("æ±‚äººãƒœãƒƒã‚¯ã‚¹XMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{A()}});const D=document.getElementById("btn-download-csv");D&&D.addEventListener("click",async()=>{try{T(),await s(),alert("CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{A()}})}function Ee(){const e=localStorage.getItem("admin_password");e&&(l.credentials.password=e),"undefined"!=typeof firebase&&(firebase.initializeApp(l.firebaseConfig),y=firebase.auth(),y.onAuthStateChanged(async e=>{if(e){v=e;try{if(h=await e.getIdToken(),console.log("[Admin] Firebase ID token obtained"),sessionStorage.getItem(l.sessionKey)){const t=new CustomEvent("authReady",{detail:{user:e,idToken:h}});document.dispatchEvent(t)}}catch(t){console.error("[Admin] Failed to get ID token:",t)}}else v=null,h=null})),sessionStorage.getItem(l.sessionKey)?(fe(),document.addEventListener("authReady",()=>{w()},{once:!0}),setTimeout(()=>{f()||(console.log("[Admin] Auth timeout, loading with mock data"),w())},3e3)):he(),$e(),M(),function(){const e=document.getElementById("btn-back-to-companies");e&&e.addEventListener("click",C)}()}"undefined"!=typeof window&&(window.AdminDashboard={config:l,spreadsheetConfig:{sheetId:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",companySheetName:"ä¼šç¤¾ä¸€è¦§",lpSettingsSheetName:"LPè¨­å®š",gasApiUrl:"https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec"},init:Ee,switchSection:we,getIdToken:f},window.AdminAnalytics={loadDashboardData:w,filterCompanies:B,sortCompanies:S},window.AdminCompany={loadCompanyManageData:K,editCompany:W,showCompanyModal:J,closeCompanyModal:X,saveCompanyData:async function(){var e,t,n,a,o,s,i;const c=document.getElementById("edit-company-domain"),l=(null==c?void 0:c.value.trim().toLowerCase())||"",d={company:(null==(e=document.getElementById("edit-company-name"))?void 0:e.value.trim())||"",company_domain:l,companyDomain:l,designPattern:(null==(t=document.getElementById("edit-design-pattern"))?void 0:t.value)||"standard",imageUrl:(null==(n=document.getElementById("edit-image-url"))?void 0:n.value.trim())||"",order:(null==(a=document.getElementById("edit-order"))?void 0:a.value)||"",description:(null==(o=document.getElementById("edit-description"))?void 0:o.value.trim())||"",showCompany:(null==(s=document.getElementById("edit-show-company"))?void 0:s.checked)?"â—‹":"",visible:(null==(i=document.getElementById("edit-show-company"))?void 0:i.checked)?"â—‹":""};if(!d.company||!d.companyDomain)return void alert("ä¼šç¤¾åã¨ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å¿…é ˆã§ã™");if(!/^[a-z0-9-]+$/.test(d.companyDomain))return void alert("ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯åŠè§’è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨ã§ãã¾ã™");if(F&&(null==z?void 0:z.find(e=>e.companyDomain===d.companyDomain)))return void alert("ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™");const r=p;try{const e=document.getElementById("company-modal-save");e&&(e.disabled=!0,e.textContent="ä¿å­˜ä¸­...");const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveCompany",company:d})))),n=`${r}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n,{method:"GET",redirect:"follow"}),o=await a.json();if(e&&(e.disabled=!1,e.textContent="ä¿å­˜"),!o.success)return void alert("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(o.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));if(localStorage.removeItem(`company_data_${d.companyDomain}`),F)z.push(d);else{const e=z.findIndex(e=>e.companyDomain===d.companyDomain);-1!==e&&(z[e]=d)}X(),Y(),alert(`ä¼šç¤¾æƒ…å ±ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã—ã¾ã—ãŸã€‚\n\nä¼šç¤¾å: ${d.company}\nãƒ‰ãƒ¡ã‚¤ãƒ³: ${d.companyDomain}`)}catch(m){console.error("GAS APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:",m),alert("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚"),function(e){const t=`company_data_${e.companyDomain}`;if(localStorage.setItem(t,JSON.stringify(e)),F)z.push(e);else{const t=z.findIndex(t=>t.companyDomain===e.companyDomain);-1!==t&&(z[t]=e)}X(),Y(),alert(`ä¼šç¤¾æƒ…å ±ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã—ãŸã€‚\n\næ³¨æ„: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•ä¿å­˜ã™ã‚‹ã«ã¯ã€è¨­å®šç”»é¢ã§GAS API URLã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\n\nä¼šç¤¾å: ${e.company}\nãƒ‰ãƒ¡ã‚¤ãƒ³: ${e.companyDomain}`)}(d)}},renderCompanyTable:Y,openJobsArea:Q,loadCompanyListForLP:ee,loadLPSettings:te,saveLPSettings:de,renderHeroImagePresets:ce,toggleLPPreview:ue,closeLPPreview:ge,debouncedUpdatePreview:pe,initSectionSortable:ve,updateLPPreview:ye,getPatternLabel:e=>({standard:"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰",modern:"ãƒ¢ãƒ€ãƒ³",classic:"ã‚¯ãƒ©ã‚·ãƒƒã‚¯",minimal:"ãƒŸãƒ‹ãƒãƒ«",colorful:"ã‚«ãƒ©ãƒ•ãƒ«"}[e]||"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰")}),document.addEventListener("DOMContentLoaded",()=>{Ee()});
