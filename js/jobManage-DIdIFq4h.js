import"./modulepreload-polyfill-YP0FEG5d.js";import{e}from"./utils-BE8OECDH.js";import{g as t,e as n,f as o,h as a,i as s}from"./job-feed-generator-BunZ_8BQ.js";import"./jobs-loader-Foiii4G8.js";const l={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"};let i=null,c=[],d=[],r=1;let u=null,m=[];const p={new:"新規",contacted:"連絡済み",interviewing:"面接調整中",interviewed:"面接済み",hired:"採用",rejected:"不採用",withdrawn:"辞退"},y={apply:"応募",line:"LINE相談",consult:"お問い合わせ"},g={immediate:"すぐにでも","within-week":"1週間以内","within-month":"1ヶ月以内","within-2months":"2ヶ月以内",undecided:"未定・相談したい"},h={first_contact:{subject:"初回連絡",body:"{applicantName}様\n\nこの度は「{jobTitle}」にご応募いただき、誠にありがとうございます。\n\nご応募内容を確認させていただきました。\nつきましては、一度お電話にてお話をさせていただければと思います。\n\nご都合の良い日時をいくつかお知らせいただけますでしょうか。\n（平日10:00〜18:00の間でお願いできますと幸いです）\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n何卒よろしくお願いいたします。"},schedule_interview:{subject:"面接日程調整",body:"{applicantName}様\n\nお世話になっております。\n\n面接の日程調整についてご連絡いたします。\n\n下記の日程でご都合の良い日時はございますでしょうか。\n\n【候補日】\n・◯月◯日（◯）◯◯:00〜\n・◯月◯日（◯）◯◯:00〜\n・◯月◯日（◯）◯◯:00〜\n\n上記以外でもご調整可能ですので、ご希望の日時がございましたらお知らせください。\n\n何卒よろしくお願いいたします。"},interview_reminder:{subject:"面接リマインダー",body:"{applicantName}様\n\nお世話になっております。\n\n面接日程のリマインドをお送りいたします。\n\n【面接日時】◯月◯日（◯）◯◯:00〜\n【場所】〒◯◯◯-◯◯◯◯ ◯◯県◯◯市◯◯\n【持ち物】履歴書、筆記用具\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n当日お会いできることを楽しみにしております。"},document_request:{subject:"書類提出依頼",body:"{applicantName}様\n\nお世話になっております。\n\n選考を進めるにあたり、下記の書類をご提出いただけますでしょうか。\n\n【提出書類】\n・履歴書（写真貼付）\n・職務経歴書\n\n【提出方法】\nマイページからアップロード、またはメールにてご送付ください。\n\n【提出期限】\n◯月◯日（◯）まで\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n何卒よろしくお願いいたします。"},result_pending:{subject:"選考結果待ち",body:"{applicantName}様\n\nお世話になっております。\n\n先日は面接にお越しいただき、誠にありがとうございました。\n\n現在、社内にて選考を進めております。\n結果につきましては、◯月◯日頃までにご連絡させていただく予定です。\n\n今しばらくお待ちいただけますようお願い申し上げます。"},offer:{subject:"内定通知",body:"{applicantName}様\n\nお世話になっております。\n\nこの度は「{jobTitle}」の選考にご参加いただき、誠にありがとうございました。\n\n慎重に検討させていただいた結果、{applicantName}様を採用させていただくことになりました。\n\nつきましては、入社に関する詳細についてご説明させていただきたく、\nお電話にてご連絡させていただきます。\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n{applicantName}様と一緒に働けることを楽しみにしております。"},rejection:{subject:"不採用通知",body:"{applicantName}様\n\nお世話になっております。\n\nこの度は「{jobTitle}」にご応募いただき、誠にありがとうございました。\n\n慎重に検討させていただきましたが、誠に残念ながら今回はご期待に沿えない結果となりました。\n\nご応募いただいたことに心より感謝申し上げますとともに、\n{applicantName}様の今後のご活躍をお祈り申し上げます。"}};function b(){return firebase.apps.length||firebase.initializeApp(l),firebase.firestore()}function f(){const t=document.getElementById("detail-assignee");if(t){const n=t.value;t.innerHTML='<option value="">未割当</option>'+m.map(t=>`<option value="${e(t)}">${e(t)}</option>`).join(""),t.value=n}}async function v(){var e;const t=document.getElementById("new-assignee-name"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)if(m.includes(n))alert("この担当者は既に登録されています");else try{const e=b().collection("settings").doc(i||"global");m.push(n),await e.set({assignees:m,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),f(),I();const t=document.getElementById("detail-assignee");t&&(t.value=n)}catch(o){console.error("Failed to add assignee:",o),alert("担当者の追加に失敗しました: "+o.message)}else alert("担当者名を入力してください")}function E(){const e=document.getElementById("assignee-modal"),t=document.getElementById("new-assignee-name");e&&(e.style.display="flex"),t&&(t.value="",t.focus())}function I(){const e=document.getElementById("assignee-modal");e&&(e.style.display="none")}async function w(){const e=document.getElementById("applicants-list");e&&(e.innerHTML='<div class="loading-message">データを読み込み中...</div>');try{let e=b().collection("applications");i&&(e=e.where("companyDomain","==",i)),e=e.orderBy("createdAt","desc");const t=await e.get();c=[],t.forEach(e=>{c.push({id:e.id,...e.data()})}),B(),j()}catch(t){console.error("Failed to load applicants:",t),e&&(e.innerHTML='<div class="empty-message">データの読み込みに失敗しました</div>')}}function B(){var e,t,n,o;const a=(null==(e=document.getElementById("filter-status"))?void 0:e.value)||"",s=(null==(t=document.getElementById("filter-type"))?void 0:t.value)||"",l=(null==(o=null==(n=document.getElementById("filter-search"))?void 0:n.value)?void 0:o.toLowerCase())||"";d=c.filter(e=>{var t;if(a&&(e.status||"new")!==a)return!1;if(s&&e.type!==s)return!1;if(l){const n=(e.jobTitle||"").toLowerCase(),o=(e.applicantName||(null==(t=e.applicant)?void 0:t.name)||"").toLowerCase();if(!n.includes(l)&&!o.includes(l))return!1}return!0}),r=1,L(),$()}function j(){const e=c.length,t=c.filter(e=>!e.status||"new"===e.status).length,n=c.filter(e=>["contacted","interviewing","interviewed"].includes(e.status)).length,o=c.filter(e=>["hired","rejected","withdrawn"].includes(e.status)).length,a=document.getElementById("stat-total"),s=document.getElementById("stat-new"),l=document.getElementById("stat-progress"),i=document.getElementById("stat-complete");a&&(a.textContent=e),s&&(s.textContent=t),l&&(l.textContent=n),i&&(i.textContent=o)}function L(){const t=document.getElementById("applicants-list");if(!t)return;if(0===d.length)return void(t.innerHTML='<div class="empty-message">応募データがありません</div>');const n=20*(r-1),o=n+20,a=d.slice(n,o);t.innerHTML=a.map(t=>{var n,o;const a=A((null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.timestamp||t.createdAt)),s=t.status||"new",l=y[t.type]||t.type||"-",i=p[s]||s,c=t.applicantName||(null==(o=t.applicant)?void 0:o.name)||"-",d=u===t.id;let r="type-apply";return"line"===t.type&&(r="type-line"),"consult"===t.type&&(r="type-consult"),`\n      <div class="applicant-card ${d?"selected":""}" data-id="${e(t.id)}">\n        <div class="applicant-card-main">\n          <div class="applicant-card-header">\n            <span class="applicant-card-name">${e(c)}</span>\n            <span class="applicant-card-type ${r}">${e(l)}</span>\n          </div>\n          <div class="applicant-card-job">${e(t.jobTitle||"-")}</div>\n          <div class="applicant-card-meta">\n            <span>${e(a)}</span>\n            ${t.assignee?`<span>担当: ${e(t.assignee)}</span>`:""}\n          </div>\n        </div>\n        <div class="applicant-card-status">\n          <span class="status-badge status-${e(s)}">${e(i)}</span>\n        </div>\n      </div>\n    `}).join(""),t.querySelectorAll(".applicant-card").forEach(e=>{e.addEventListener("click",()=>{!function(e){var t,n,o,a,s,l,i;const d=c.find(t=>t.id===e);if(!d)return;u=e,document.querySelectorAll(".applicant-card").forEach(t=>{t.classList.toggle("selected",t.dataset.id===e)});const r=document.getElementById("detail-empty"),m=document.getElementById("detail-content");r&&(r.style.display="none");m&&(m.style.display="flex");const p=d.applicantName||(null==(t=d.applicant)?void 0:t.name)||"-",h=d.applicantPhone||(null==(n=d.applicant)?void 0:n.phone)||"-",b=d.applicantEmail||(null==(o=d.applicant)?void 0:o.email)||"-",f=(null==(a=d.applicant)?void 0:a.age)||"-",v=(null==(s=d.applicant)?void 0:s.address)||"-",E=(null==(l=d.applicant)?void 0:l.startDate)||"-";document.getElementById("detail-name").textContent=p,document.getElementById("detail-job-title").textContent=d.jobTitle||"-",document.getElementById("detail-phone").textContent=h,document.getElementById("detail-email").textContent=b,document.getElementById("detail-age").textContent=f,document.getElementById("detail-address").textContent=v,document.getElementById("detail-start-date").textContent=g[E]||E;const I=(null==(i=d.createdAt)?void 0:i.toDate)?d.createdAt.toDate():new Date(d.timestamp||d.createdAt);document.getElementById("detail-datetime").textContent=A(I,!0),document.getElementById("detail-type").textContent=y[d.type]||d.type||"-",document.getElementById("detail-source").textContent=M(d.source);const w=d.status||"new";document.querySelectorAll(".status-btn").forEach(e=>{e.classList.toggle("active",e.dataset.status===w)});const B=document.getElementById("detail-assignee");B&&(B.value=d.assignee||"");const j=document.getElementById("detail-notes");j&&(j.value=d.notes||"");T(d.history||[]),k(e)}(e.dataset.id)})})}function $(){const e=document.getElementById("pagination");if(!e)return;const t=Math.ceil(d.length/20);if(t<=1)return void(e.innerHTML="");let n="";n+=`<button class="page-btn" ${1===r?"disabled":""} data-page="${r-1}">前へ</button>`;for(let o=1;o<=t;o++)1===o||o===t||o>=r-2&&o<=r+2?n+=`<button class="page-btn ${o===r?"active":""}" data-page="${o}">${o}</button>`:o!==r-3&&o!==r+3||(n+='<span class="page-ellipsis">...</span>');n+=`<button class="page-btn" ${r===t?"disabled":""} data-page="${r+1}">次へ</button>`,e.innerHTML=n,e.querySelectorAll(".page-btn").forEach(e=>{e.addEventListener("click",()=>{e.disabled||(r=parseInt(e.dataset.page),L(),$())})})}function x(){u=null,document.querySelectorAll(".applicant-card").forEach(e=>{e.classList.remove("selected")});const e=document.getElementById("detail-empty"),t=document.getElementById("detail-content");e&&(e.style.display="flex"),t&&(t.style.display="none")}async function k(t){const n=document.getElementById("messages-container");if(n){n.innerHTML='<p class="no-data">読み込み中...</p>';try{const n=b(),o=await n.collection("messages").where("applicationId","==",t).orderBy("createdAt","asc").get(),a=[];o.forEach(e=>{a.push({id:e.id,...e.data()})}),function(t){const n=document.getElementById("messages-container");if(!n)return;if(!t||0===t.length)return void(n.innerHTML='<p class="no-data">メッセージはありません</p>');n.innerHTML=t.map(t=>{var n;const o=(null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.createdAt),a="company"===t.from;return`\n      <div class="message-item ${a?"message-company":"message-applicant"}">\n        <div class="message-header">\n          <span class="message-sender">${e(a?"会社":"応募者")}</span>\n          <span class="message-date">${A(o,!0)}</span>\n        </div>\n        <div class="message-content">${e(t.content).replace(/\n/g,"<br>")}</div>\n      </div>\n    `}).join(""),n.scrollTop=n.scrollHeight}(a)}catch(o){console.error("Failed to load messages:",o),n.innerHTML='<p class="no-data">メッセージの読み込みに失敗しました</p>'}}}async function S(){var e;if(!u)return;const t=document.getElementById("new-message-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(!n)return void alert("メッセージを入力してください");const o=document.getElementById("btn-send-message");o&&(o.disabled=!0,o.textContent="送信中...");try{const e=b(),o=c.find(e=>e.id===u);await e.collection("messages").add({applicationId:u,companyDomain:(null==o?void 0:o.companyDomain)||i,from:"company",content:n,read:!1,createdAt:firebase.firestore.FieldValue.serverTimestamp()}),t.value="",await k(u)}catch(a){console.error("Failed to send message:",a),alert("メッセージの送信に失敗しました: "+a.message)}finally{o&&(o.disabled=!1,o.textContent="送信")}}function T(t){const n=document.getElementById("detail-history");n&&(t&&0!==t.length?n.innerHTML=t.map(t=>{var n;return`\n      <div class="history-item">\n        <div class="history-date">${A((null==(n=t.date)?void 0:n.toDate)?t.date.toDate():new Date(t.date),!0)}</div>\n        <div class="history-text">${e(t.text)}</div>\n      </div>\n    `}).join(""):n.innerHTML='<p class="no-data">対応履歴はありません</p>')}async function D(){var e,t;if(!u)return;const n=(null==(e=document.getElementById("detail-notes"))?void 0:e.value)||"",o=(null==(t=document.getElementById("detail-assignee"))?void 0:t.value)||"",a=document.getElementById("btn-save-notes");a&&(a.disabled=!0,a.textContent="保存中...");try{const e=b();await e.collection("applications").doc(u).update({notes:n,assignee:o,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const t=c.findIndex(e=>e.id===u);-1!==t&&(c[t].notes=n,c[t].assignee=o),L()}catch(s){console.error("Failed to save notes:",s),alert("保存に失敗しました")}finally{a&&(a.disabled=!1,a.textContent="保存")}}async function C(){var e;if(!u)return;const t=document.getElementById("new-history-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)try{const e=b(),o=c.find(e=>e.id===u),a=(null==o?void 0:o.history)||[];a.push({date:new Date,text:n}),await e.collection("applications").doc(u).update({history:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const s=c.findIndex(e=>e.id===u);-1!==s&&(c[s].history=a),T(a),t.value=""}catch(o){console.error("Failed to add history:",o),alert("履歴の追加に失敗しました: "+o.message)}else alert("対応内容を入力してください")}function q(){if(0===d.length)return void alert("エクスポートするデータがありません");const e=d.map(e=>{var t,n,o,a,s,l,i;const c=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),d=e.applicantName||(null==(n=e.applicant)?void 0:n.name)||"",r=e.applicantPhone||(null==(o=e.applicant)?void 0:o.phone)||"",u=e.applicantEmail||(null==(a=e.applicant)?void 0:a.email)||"",m=(null==(s=e.applicant)?void 0:s.age)||"",h=(null==(l=e.applicant)?void 0:l.address)||"",b=(null==(i=e.applicant)?void 0:i.startDate)||"";return[A(c,!0),y[e.type]||e.type||"",d,r,u,m,h,g[b]||b,e.jobTitle||"",M(e.source),p[e.status||"new"],e.assignee||"",(e.notes||"").replace(/"/g,'""')]}),t=[["日時","種別","応募者名","電話番号","メール","年齢","現住所","希望勤務開始日","求人タイトル","流入元","ステータス","担当者","メモ"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),n=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`applicants-${i||"all"}-${function(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}${n}${o}`}(new Date)}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function A(e,t=!1){if(!e||isNaN(e.getTime()))return"-";const n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");if(!t)return`${n}/${o}/${a}`;return`${n}/${o}/${a} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function M(e){if(!e||"direct"===e)return"直接アクセス";try{const t=new URL(e).hostname;return t.includes("google")?"Google検索":t.includes("yahoo")?"Yahoo!検索":t.includes("tiktok")?"TikTok広告":t.includes("instagram")||t.includes("fb")||t.includes("facebook")?"Meta広告":t.includes("twitter")||t.includes("x.com")?"X(Twitter)":t.includes("line")?"LINE":t}catch{return e||"不明"}}function H(){var e,t,n,o,a,s,l,i,d,r,m,p,y,g,f,L,$,k,T;let A;null==(e=document.getElementById("btn-refresh"))||e.addEventListener("click",w),null==(t=document.getElementById("btn-refresh-applicants"))||t.addEventListener("click",w),null==(n=document.getElementById("btn-export-csv"))||n.addEventListener("click",q),null==(o=document.getElementById("filter-status"))||o.addEventListener("change",B),null==(a=document.getElementById("filter-type"))||a.addEventListener("change",B),null==(s=document.getElementById("filter-search"))||s.addEventListener("input",()=>{clearTimeout(A),A=setTimeout(B,300)}),null==(l=document.getElementById("btn-close-detail"))||l.addEventListener("click",x),document.querySelectorAll(".status-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.status;t&&async function(e){if(u)try{const t=b();await t.collection("applications").doc(u).update({status:e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const n=c.findIndex(e=>e.id===u);-1!==n&&(c[n].status=e),document.querySelectorAll(".status-btn").forEach(t=>{t.classList.toggle("active",t.dataset.status===e)}),B(),j()}catch(t){console.error("Failed to update status:",t),alert("ステータスの更新に失敗しました")}}(t)})}),null==(i=document.getElementById("btn-save-notes"))||i.addEventListener("click",D),null==(d=document.getElementById("btn-add-history"))||d.addEventListener("click",C),null==(r=document.getElementById("new-history-text"))||r.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),C())}),null==(m=document.getElementById("btn-send-message"))||m.addEventListener("click",S),null==(p=document.getElementById("new-message-text"))||p.addEventListener("keydown",e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),S())}),null==(y=document.getElementById("message-template-select"))||y.addEventListener("change",e=>{!function(e){var t;if(!e)return;const n=h[e];if(!n)return;const o=c.find(e=>e.id===u);if(!o)return;const a=o.applicantName||(null==(t=o.applicant)?void 0:t.name)||"お客様",s=o.jobTitle||"求人";let l=n.body.replace(/{applicantName}/g,a).replace(/{jobTitle}/g,s);const i=document.getElementById("new-message-text");i&&(i.value=l,i.focus());const d=document.getElementById("message-template-select");d&&(d.value="")}(e.target.value)}),null==(g=document.getElementById("btn-add-assignee"))||g.addEventListener("click",E),null==(f=document.getElementById("assignee-modal-close"))||f.addEventListener("click",I),null==(L=document.getElementById("assignee-modal-cancel"))||L.addEventListener("click",I),null==($=document.getElementById("assignee-modal-save"))||$.addEventListener("click",v),null==(k=document.getElementById("assignee-modal"))||k.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&I()}),null==(T=document.getElementById("new-assignee-name"))||T.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),v())})}async function _(e,t){i=e,H(),await async function(){try{const e=b().collection("settings").doc(i||"global"),t=await e.get();m=t.exists&&t.data().assignees?t.data().assignees:[],f()}catch(e){console.error("Failed to load assignees:",e),m=[]}}(),await w()}const N="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec",X={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"},F="rikueco_admin_session",O="rikueco_user_role",R="rikueco_user_company",P="admin";function U(){return sessionStorage.getItem(O)===P}function J(e){return!!U()||sessionStorage.getItem(R)===e}let V=null,G=null,K=null,Y=[],W=null,z=!1,Z=[],Q=null,ee=null;function te(e){if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return"";return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}async function ne(){const t=document.getElementById("jobs-tbody");if(!t)return;t.innerHTML='<tr><td colspan="6" class="loading-cell">データを読み込み中...</td></tr>';const n=N;try{const o=`${n}?action=getJobs&domain=${encodeURIComponent(V)}`,a=await fetch(o);if(!a.ok)throw new Error("データの取得に失敗しました");const s=await a.json();if(!s.success)throw new Error(s.error||"求人データの取得に失敗しました");if(Y=s.jobs||[],0===Y.length)return void(t.innerHTML='<tr><td colspan="6" class="loading-cell">求人データがありません</td></tr>');!function(){const t=document.getElementById("jobs-tbody");if(!t)return;const n=Y||[];0!==n.length?(t.innerHTML=n.map(t=>{const n=t.monthlySalary?`¥${Number(t.monthlySalary).toLocaleString()}`:"-",o="true"===t.visible||"TRUE"===t.visible||!0===t.visible;return`\n      <tr data-row="${t._rowIndex}">\n        <td>${e(t.id||"-")}</td>\n        <td>${e(t.title||"-")}</td>\n        <td>${e(t.location||"-")}</td>\n        <td>${n}</td>\n        <td>${o?'<span class="badge success">公開</span>':'<span class="badge">非公開</span>'}</td>\n        <td>\n          <div class="action-buttons">\n            <button class="btn-small btn-edit" data-row="${t._rowIndex}">編集</button>\n          </div>\n        </td>\n      </tr>\n    `}).join(""),t.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",()=>{ae(parseInt(e.dataset.row,10))})})):t.innerHTML='<tr><td colspan="6" class="loading-cell">求人データがありません</td></tr>'}()}catch(o){console.error("求人データの読み込みエラー:",o),t.innerHTML=`<tr><td colspan="6" class="loading-cell">データの読み込みに失敗しました: ${e(o.message)}</td></tr>`}}function oe(){W=null,z=!0;const e=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t)};document.getElementById("job-modal-title").textContent="新規求人作成",e("edit-job-title",""),e("edit-job-location",""),e("edit-job-salary",""),e("edit-job-bonus",""),e("edit-job-order",""),e("edit-job-features",""),e("edit-job-badges",""),e("edit-job-description",""),e("edit-job-requirements",""),e("edit-job-benefits",""),e("edit-job-hours",""),e("edit-job-holidays",""),e("edit-job-start-date",""),e("edit-job-end-date","");const t=document.getElementById("edit-job-visible");t&&(t.checked=!0);const n=document.getElementById("job-modal-delete");n&&(n.style.display="none");const o=document.getElementById("job-modal");o&&(o.style.display="flex")}function ae(e){const t=null==Y?void 0:Y.find(t=>t._rowIndex===e);if(!t)return void alert("求人データが見つかりません");W=t,z=!1;const n=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t||"")};document.getElementById("job-modal-title").textContent="求人情報の編集",n("edit-job-title",t.title),n("edit-job-location",t.location),n("edit-job-salary",t.monthlySalary),n("edit-job-bonus",t.totalBonus),n("edit-job-order",t.order),n("edit-job-features",t.features),n("edit-job-badges",t.badges),n("edit-job-description",t.jobDescription),n("edit-job-requirements",t.requirements),n("edit-job-benefits",t.benefits),n("edit-job-hours",t.workingHours),n("edit-job-holidays",t.holidays),t.publishStartDate?n("edit-job-start-date",te(t.publishStartDate)):n("edit-job-start-date",""),t.publishEndDate?n("edit-job-end-date",te(t.publishEndDate)):n("edit-job-end-date","");const o=document.getElementById("edit-job-visible");o&&(o.checked="true"===t.visible||"TRUE"===t.visible||!0===t.visible);const a=document.getElementById("job-modal-delete");a&&(a.style.display="");const s=document.getElementById("job-modal");s&&(s.style.display="flex")}function se(){const e=document.getElementById("job-modal");e&&(e.style.display="none"),W=null,z=!1}async function le(){var e;if(!V)return void alert("会社が選択されていません");const t=e=>{var t,n;return(null==(n=null==(t=document.getElementById(e))?void 0:t.value)?void 0:n.trim())||""},n={title:t("edit-job-title"),location:t("edit-job-location"),monthlySalary:t("edit-job-salary"),totalBonus:t("edit-job-bonus"),order:t("edit-job-order"),features:t("edit-job-features"),badges:t("edit-job-badges"),jobDescription:t("edit-job-description"),requirements:t("edit-job-requirements"),benefits:t("edit-job-benefits"),workingHours:t("edit-job-hours"),holidays:t("edit-job-holidays"),publishStartDate:t("edit-job-start-date"),publishEndDate:t("edit-job-end-date"),visible:(null==(e=document.getElementById("edit-job-visible"))?void 0:e.checked)?"true":"false"};if(!n.title||!n.location)return void alert("募集タイトルと勤務地は必須です");const o=N,a=document.getElementById("job-modal-save");try{a&&(a.disabled=!0,a.textContent="保存中...");const e=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveJob",companyDomain:V,job:n,rowIndex:z?null:W._rowIndex})))),t=`${o}?action=post&data=${encodeURIComponent(e)}`,l=await fetch(t,{method:"GET",redirect:"follow"}),i=await l.text();let c;try{c=JSON.parse(i)}catch(s){throw console.error("JSON parse error:",s),new Error(`GASからの応答が不正です: ${i.substring(0,200)}`)}if(!c.success)return void alert("保存に失敗しました: "+(c.error||"不明なエラー"));se(),await ne(),alert(z?"求人を作成しました":"求人情報を更新しました")}catch(l){console.error("求人保存エラー:",l),alert("保存中にエラーが発生しました: "+l.message)}finally{a&&(a.disabled=!1,a.textContent="保存")}}async function ie(){if(!W||!V)return void alert("削除対象が選択されていません");if(!confirm("この求人を削除してもよろしいですか？"))return;const e=N,t=document.getElementById("job-modal-delete");try{t&&(t.disabled=!0,t.textContent="削除中...");const o=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteJob",companyDomain:V,rowIndex:W._rowIndex})))),a=`${e}?action=post&data=${encodeURIComponent(o)}`,s=await fetch(a,{method:"GET",redirect:"follow"}),l=await s.text();let i;try{i=JSON.parse(l)}catch(n){throw console.error("JSON parse error:",n),new Error("GASからの応答が不正です")}if(!i.success)return void alert("削除に失敗しました: "+(i.error||"不明なエラー"));se(),await ne(),alert("求人を削除しました")}catch(o){console.error("求人削除エラー:",o),alert("削除中にエラーが発生しました: "+o.message)}finally{t&&(t.disabled=!1,t.textContent="削除")}}function ce(){return Y.filter(e=>("true"===e.visible||"TRUE"===e.visible||!0===e.visible)&&e.title).map(e=>({...e,company:G,companyDomain:V,companyAddress:e.location||""}))}function de(){const e=document.getElementById("feed-status");e&&(e.style.display="flex")}function re(){const e=document.getElementById("feed-status");e&&(e.style.display="none")}async function ue(){const e=ce();if(0!==e.length)try{de();const o=t(e);n(o,`indeed-${V}.xml`,"application/xml")}catch(o){alert("フィード生成に失敗しました: "+o.message)}finally{re()}else alert("ダウンロードできる求人がありません")}async function me(){const e=ce();if(0!==e.length)try{de();const t=o(e);n(t,`google-jobs-${V}.json`,"application/json")}catch(t){alert("フィード生成に失敗しました: "+t.message)}finally{re()}else alert("ダウンロードできる求人がありません")}async function pe(){const e=ce();if(0!==e.length)try{de();const t=a(e);n(t,`jobbox-${V}.xml`,"application/xml")}catch(t){alert("フィード生成に失敗しました: "+t.message)}finally{re()}else alert("ダウンロードできる求人がありません")}async function ye(){const e=ce();if(0!==e.length)try{de();const t=s(e);n(t,`jobs-${V}.csv`,"text/csv;charset=utf-8")}catch(t){alert("フィード生成に失敗しました: "+t.message)}finally{re()}else alert("ダウンロードできる求人がありません")}async function ge(){const t=document.getElementById("analytics-period");let n=7;switch((null==t?void 0:t.value)||"7days"){case"7days":n=7;break;case"30days":case"last-month":n=30;break;case"month":n=(new Date).getDate();break}const o=document.getElementById("job-analytics-tbody"),a=document.getElementById("source-analytics-tbody"),s=document.getElementById("device-analytics-tbody");o&&(o.innerHTML='<tr><td colspan="5" class="loading-cell">データを読み込み中...</td></tr>'),a&&(a.innerHTML='<tr><td colspan="3" class="loading-cell">読み込み中...</td></tr>'),s&&(s.innerHTML='<tr><td colspan="3" class="loading-cell">読み込み中...</td></tr>');try{const t="https://asia-northeast1-generated-area-484613-e3.cloudfunctions.net/getAnalyticsData",o=await fetch(`${t}?type=overview&days=${n}`),a=await o.json(),s=await fetch(`${t}?type=traffic&days=${n}`),l=await s.json();let i=null;if(V){const e=await fetch(`${t}?type=company-detail&days=${n}&domain=${encodeURIComponent(V)}`);i=await e.json()}if(!a.success)throw new Error(a.error||"データ取得エラー");ee={overview:a.data,traffic:l.data,companyDetail:null==i?void 0:i.data},function(t){const{overview:n,traffic:o,companyDetail:a}=t;document.getElementById("analytics-pv").textContent=((null==n?void 0:n.pageViews)||0).toLocaleString(),document.getElementById("analytics-users").textContent=((null==n?void 0:n.users)||0).toLocaleString();const s=(null==n?void 0:n.sessions)||0,l=(null==n?void 0:n.pageViews)||0,i=s>0?(l/s).toFixed(1):"-";document.getElementById("analytics-pages-per-session").textContent=i,document.getElementById("analytics-avg-time").textContent="-";const c=document.getElementById("job-analytics-tbody");c&&((null==a?void 0:a.jobs)&&a.jobs.length>0?c.innerHTML=a.jobs.map(t=>`\n        <tr>\n          <td>${e(t.jobTitle||t.pagePath||"不明")}</td>\n          <td>${t.views||0}</td>\n          <td>${t.users||"-"}</td>\n          <td>-</td>\n          <td>-</td>\n        </tr>\n      `).join(""):c.innerHTML='\n        <tr>\n          <td colspan="5" class="loading-cell">\n            この会社の求人別データはまだありません。<br>\n            <small>※ GA4でカスタムイベント（view_job_detail）の設定が必要です</small>\n          </td>\n        </tr>\n      ');const d=document.getElementById("source-analytics-tbody");if(d){const t=(null==o?void 0:o.sources)||[];if(t.length>0){const n=t.reduce((e,t)=>e+(t.sessions||0),0);d.innerHTML=t.slice(0,10).map(t=>{const o=n>0?Math.round(t.sessions/n*100):0;return`\n          <tr>\n            <td>${e(t.source||"(direct)")}</td>\n            <td>${t.sessions||0}</td>\n            <td>${o}%</td>\n          </tr>\n        `}).join("")}else if((null==o?void 0:o.channels)&&o.channels.length>0){const t=o.channels.reduce((e,t)=>e+(t.sessions||0),0);d.innerHTML=o.channels.map(n=>{const o=t>0?Math.round(n.sessions/t*100):0;return`\n          <tr>\n            <td>${e(n.channel||"不明")}</td>\n            <td>${n.sessions||0}</td>\n            <td>${o}%</td>\n          </tr>\n        `}).join("")}else d.innerHTML='<tr><td colspan="3" class="loading-cell">データがありません</td></tr>'}const r=document.getElementById("device-analytics-tbody");if(r){const t=(null==o?void 0:o.devices)||[];if(t.length>0){const n=t.reduce((e,t)=>e+(t.sessions||0),0);r.innerHTML=t.map(t=>{const o="mobile"===t.device?"モバイル":"desktop"===t.device?"デスクトップ":"tablet"===t.device?"タブレット":t.device,a=n>0?Math.round(t.sessions/n*100):0;return`\n          <tr>\n            <td>${e(o)}</td>\n            <td>${t.sessions||0}</td>\n            <td>${a}%</td>\n          </tr>\n        `}).join("")}else r.innerHTML='<tr><td colspan="3" class="loading-cell">データがありません</td></tr>'}}(ee)}catch(l){console.error("アクセス解析データ取得エラー:",l),function(){document.getElementById("analytics-pv").textContent="- (未連携)",document.getElementById("analytics-users").textContent="-",document.getElementById("analytics-pages-per-session").textContent="-",document.getElementById("analytics-avg-time").textContent="-";const e=document.getElementById("job-analytics-tbody");e&&(e.innerHTML='\n      <tr>\n        <td colspan="5" class="loading-cell">\n          アクセス解析データがありません。<br>\n          Google Analyticsとの連携を設定すると、詳細なアクセスデータを確認できます。\n        </td>\n      </tr>\n    ');const t=document.getElementById("source-analytics-tbody");t&&(t.innerHTML='<tr><td colspan="3" class="loading-cell">データなし</td></tr>');const n=document.getElementById("device-analytics-tbody");n&&(n.innerHTML='<tr><td colspan="3" class="loading-cell">データなし</td></tr>')}()}}async function he(e,t){if(!V)return[];try{const n=firebase.firestore();return(await n.collection("applications").where("companyDomain","==",V).where("createdAt",">=",e).where("createdAt","<=",t).orderBy("createdAt","desc").get()).docs.map(e=>{var t,n;return{id:e.id,...e.data(),createdAt:(null==(n=null==(t=e.data().createdAt)?void 0:t.toDate)?void 0:n.call(t))||new Date(e.data().createdAt)}})}catch(n){return console.error("応募データ取得エラー:",n),[]}}async function be(e,t){const n=t.getTime()-e.getTime(),o=new Date(e.getTime()-1),a=new Date(o.getTime()-n);return await he(a,o)}function fe(e){const t={new:"新規",contacted:"連絡済",interviewing:"面接中",hired:"採用",rejected:"不採用",withdrawn:"辞退"},n={};Object.values(t).forEach(e=>{n[e]=0}),e.forEach(e=>{const o=e.status||"new",a=t[o]||"新規";n[a]=(n[a]||0)+1});const o=e.length;return Object.entries(n).map(([e,t])=>({status:e,count:t,percentage:o>0?Math.round(t/o*100):0}))}function ve(e){const t={google:"Google検索",indeed:"Indeed",jobbox:"求人ボックス",direct:"直接流入",line:"LINE",other:"その他"},n={};e.forEach(e=>{let o=e.source||e.utmSource||"other";o=o.includes("google")?"google":o.includes("indeed")?"indeed":o.includes("jobbox")||o.includes("stanby")?"jobbox":o.includes("line")?"line":"direct"===o||"(direct)"===o?"direct":"other";const a=t[o]||"その他";n[a]=(n[a]||0)+1});const o=e.length;return Object.entries(n).map(([e,t])=>({source:e,count:t,percentage:o>0?Math.round(t/o*100):0})).sort((e,t)=>t.count-e.count)}function Ee(e){const t={};return e.forEach(e=>{const n=e.assignee||"未割当";t[n]||(t[n]={assignee:n,handled:0,pending:0});"new"===(e.status||"new")?t[n].pending++:t[n].handled++}),Object.values(t).sort((e,t)=>t.handled-e.handled)}function Ie(t){const{applications:n,comparison:o,period:a}=t,s=n.length,l=o.length,i=l>0?Math.round((s-l)/l*100):0,c=i>=0?`+${i}%`:`${i}%`,d=n.filter(e=>"hired"===e.status).length,r=n.filter(e=>"new"===e.status||"contacted"===e.status).length;document.getElementById("summary-total").textContent=s,document.getElementById("summary-change").textContent=c,document.getElementById("summary-change").className="summary-value "+(i>=0?"positive":"negative"),document.getElementById("summary-hired").textContent=d,document.getElementById("summary-pending").textContent=r;const u=fe(n);document.getElementById("status-breakdown").innerHTML=u.map(t=>`\n    <tr>\n      <td>${e(t.status)}</td>\n      <td>${t.count}</td>\n      <td>${t.percentage}%</td>\n    </tr>\n  `).join("");const m=function(e){const t={};return e.forEach(e=>{const n=e.jobId||"unknown",o=e.jobTitle||"不明な求人";t[n]||(t[n]={jobId:n,jobTitle:o,count:0}),t[n].count++}),Object.values(t).sort((e,t)=>t.count-e.count).slice(0,5)}(n),p=document.getElementById("job-performance");0===m.length?p.innerHTML='<tr><td colspan="4">データがありません</td></tr>':p.innerHTML=m.map(t=>{const n=Y.find(e=>e.id===t.jobId),o=(null==n?void 0:n.pageViews)||"-",a="-"!==o&&o>0?(t.count/o*100).toFixed(1)+"%":"-";return`\n        <tr>\n          <td>${e(t.jobTitle)}</td>\n          <td>${t.count}</td>\n          <td>${o}</td>\n          <td>${a}</td>\n        </tr>\n      `}).join("");const y=ve(n),g=document.getElementById("source-breakdown");0===y.length?g.innerHTML='<tr><td colspan="3">データがありません</td></tr>':g.innerHTML=y.map(t=>`\n      <tr>\n        <td>${e(t.source)}</td>\n        <td>${t.count}</td>\n        <td>${t.percentage}%</td>\n      </tr>\n    `).join("");const h=Ee(n),b=document.getElementById("assignee-breakdown");0===h.length?b.innerHTML='<tr><td colspan="3">データがありません</td></tr>':b.innerHTML=h.map(t=>`\n      <tr>\n        <td>${e(t.assignee)}</td>\n        <td>${t.handled}</td>\n        <td>${t.pending}</td>\n      </tr>\n    `).join(""),document.getElementById("report-empty").style.display="none",document.getElementById("report-content").style.display="block",document.getElementById("report-actions").style.display="flex"}async function we(){const e=document.getElementById("report-period").value;let t,n;if("custom"===e){const e=document.getElementById("report-from"),o=document.getElementById("report-to");if(!e.value||!o.value)return void alert("開始日と終了日を指定してください");t=new Date(e.value),t.setHours(0,0,0,0),n=new Date(o.value),n.setHours(23,59,59,999)}else{const o=function(e){const t=new Date;let n,o;switch(e){case"week":{const e=t.getDay();n=new Date(t),n.setDate(t.getDate()-e),n.setHours(0,0,0,0),o=new Date(t),o.setHours(23,59,59,999);break}case"last-week":{const e=t.getDay();o=new Date(t),o.setDate(t.getDate()-e-1),o.setHours(23,59,59,999),n=new Date(o),n.setDate(o.getDate()-6),n.setHours(0,0,0,0);break}case"month":n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t),o.setHours(23,59,59,999);break;case"last-month":n=new Date(t.getFullYear(),t.getMonth()-1,1),o=new Date(t.getFullYear(),t.getMonth(),0,23,59,59,999);break;default:n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t)}return{start:n,end:o}}(e);t=o.start,n=o.end}document.getElementById("report-loading").style.display="flex",document.getElementById("report-empty").style.display="none",document.getElementById("report-content").style.display="none",document.getElementById("report-actions").style.display="none";try{const[e,o]=await Promise.all([he(t,n),be(t,n)]);Z=e,Q={applications:e,comparison:o,period:{start:t,end:n}},Ie(Q)}catch(o){console.error("レポート生成エラー:",o),alert("レポートの生成に失敗しました: "+o.message)}finally{document.getElementById("report-loading").style.display="none"}}function Be(){if(!Q||!Q.applications.length)return void alert("レポートデータがありません");const{applications:e,period:t}=Q,n=[["応募日時","求人タイトル","氏名","ステータス","流入元","担当者"],...e.map(e=>[e.createdAt?new Date(e.createdAt).toLocaleString("ja-JP"):"",e.jobTitle||"",e.name||"",e.status||"new",e.source||e.utmSource||"",e.assignee||""])].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),o=new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a;const l=t.start.toISOString().split("T")[0],i=t.end.toISOString().split("T")[0];s.download=`report-${V}-${l}-${i}.csv`,s.click(),URL.revokeObjectURL(a)}function je(){if(!Q||!Q.applications.length)return void alert("レポートデータがありません");if("undefined"==typeof XLSX)return void alert("Excelライブラリが読み込まれていません");const{applications:e,period:t}=Q,n=XLSX.utils.book_new(),o=[["レポート期間",`${t.start.toLocaleDateString("ja-JP")} 〜 ${t.end.toLocaleDateString("ja-JP")}`],["会社",G],[""],["総応募数",e.length],["採用数",e.filter(e=>"hired"===e.status).length],["対応中",e.filter(e=>"new"===e.status||"contacted"===e.status).length]],a=XLSX.utils.aoa_to_sheet(o);XLSX.utils.book_append_sheet(n,a,"サマリー");const s=e.map(e=>[e.createdAt?new Date(e.createdAt).toLocaleString("ja-JP"):"",e.jobTitle||"",e.name||"",e.phone||"",e.email||"",e.status||"new",e.source||e.utmSource||"",e.assignee||""]),l=XLSX.utils.aoa_to_sheet([["応募日時","求人タイトル","氏名","電話番号","メール","ステータス","流入元","担当者"],...s]);XLSX.utils.book_append_sheet(n,l,"応募一覧");const i=fe(e).map(e=>[e.status,e.count,`${e.percentage}%`]),c=XLSX.utils.aoa_to_sheet([["ステータス","件数","割合"],...i]);XLSX.utils.book_append_sheet(n,c,"ステータス別");const d=ve(e).map(e=>[e.source,e.count,`${e.percentage}%`]),r=XLSX.utils.aoa_to_sheet([["流入元","件数","割合"],...d]);XLSX.utils.book_append_sheet(n,r,"流入元別");const u=Ee(e).map(e=>[e.assignee,e.handled,e.pending]),m=XLSX.utils.aoa_to_sheet([["担当者","対応済","未対応"],...u]);XLSX.utils.book_append_sheet(n,m,"担当者別");const p=t.start.toISOString().split("T")[0],y=t.end.toISOString().split("T")[0];XLSX.writeFile(n,`report-${V}-${p}-${y}.xlsx`)}function Le(e){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(`section-${e}`);t&&t.classList.add("active"),document.querySelectorAll(".sidebar-nav a").forEach(t=>{t.dataset.section===e&&t.closest("li").classList.add("active")});const n=document.getElementById("page-title"),o=document.querySelector(".header-actions");"jobs"===e?(n&&(n.textContent=`${G} の求人一覧`),o&&(o.style.display="flex")):"analytics"===e?(n&&(n.textContent="アクセス解析"),o&&(o.style.display="none")):"reports"===e?(n&&(n.textContent="応募レポート"),o&&(o.style.display="none")):"applicants"===e?(n&&(n.textContent="応募者管理"),o&&(o.style.display="none"),$e||($e=!0,_(V))):"lp-settings"===e?(n&&(n.textContent="LP設定"),o&&(o.style.display="none"),async function(){xe||qe();try{const t=`https://docs.google.com/spreadsheets/d/${De}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(Ce)}`,n=await fetch(t);if(n.ok){const t=function(e,t){const n=e.split("\n");if(n.length<2)return null;const o=Me(n[0]);for(let a=1;a<n.length;a++){if(!n[a].trim())continue;const e=Me(n[a]),s={};if(o.forEach((t,n)=>{const o=t.replace(/"/g,"").trim();s[o]=e[n]||""}),s.companyDomain===t||s["会社ドメイン"]===t){const e={heroTitle:s.heroTitle||s["ヒーロータイトル"]||"",heroSubtitle:s.heroSubtitle||s["ヒーローサブタイトル"]||"",heroImage:s.heroImage||s["ヒーロー画像"]||"",ctaText:s.ctaText||s["CTAテキスト"]||"",faq:s.faq||s.FAQ||"",designPattern:s.designPattern||s["デザインパターン"]||"",sectionVisibility:s.sectionVisibility||s["セクション表示"]||""};for(let t=1;t<=6;t++)e[`pointTitle${t}`]=s[`pointTitle${t}`]||s[`ポイント${t}タイトル`]||"",e[`pointDesc${t}`]=s[`pointDesc${t}`]||s[`ポイント${t}説明`]||"";return e}}return null}(await n.text(),V);if(t){Ae("lp-hero-title-company",t.heroTitle),Ae("lp-hero-subtitle-company",t.heroSubtitle),Ae("lp-hero-image-company",t.heroImage);const n=[];for(let e=1;e<=6;e++){const o=t[`pointTitle${e}`]||"",a=t[`pointDesc${e}`]||"";(o||a)&&n.push({title:o,desc:a})}if(_e(n.length>0?n:[{title:"",desc:""},{title:"",desc:""},{title:"",desc:""}]),Ae("lp-cta-text-company",t.ctaText||"今すぐ応募する"),Ae("lp-faq-company",t.faq),t.designPattern){const e=document.querySelector(`input[name="design-pattern-company"][value="${t.designPattern}"]`);e&&(e.checked=!0)}if(t.sectionVisibility)try{const e=JSON.parse(t.sectionVisibility);document.getElementById("section-points-visible-company").checked=!1!==e.points,document.getElementById("section-jobs-visible-company").checked=!1!==e.jobs,document.getElementById("section-details-visible-company").checked=!1!==e.details,document.getElementById("section-faq-visible-company").checked=!1!==e.faq}catch(e){console.warn("セクション表示設定のパースに失敗:",e)}return void He(t.heroImage||"")}}}catch(e){console.log("LP設定シートが見つかりません:",e)}Oe()}()):"settings"===e&&(n&&(n.textContent="アカウント設定"),o&&(o.style.display="none"))}let $e=!1,xe=!1;const ke=[{id:"teamwork-1",name:"チームミーティング",url:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=400&q=60"},{id:"teamwork-2",name:"オフィスワーク",url:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400&q=60"},{id:"teamwork-3",name:"コラボレーション",url:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=400&q=60"},{id:"work-1",name:"製造ライン",url:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&q=60"},{id:"work-2",name:"倉庫作業",url:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=400&q=60"},{id:"work-3",name:"建設現場",url:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=400&q=60"},{id:"work-4",name:"工場作業",url:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=400&q=60"},{id:"work-5",name:"チームワーク",url:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=400&q=60"}],Se=6,Te="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec",De="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",Ce="LP設定";function qe(){const t=document.getElementById("lp-url-display");t&&(t.textContent=`${window.location.origin}/lp.html?c=${V}`);const n=document.getElementById("lp-preview-btn-company");n&&(n.href=`lp.html?c=${encodeURIComponent(V)}`),function(){const t=document.getElementById("hero-image-presets-company");if(!t)return;t.innerHTML=ke.map(t=>`\n    <div class="hero-image-preset" data-url="${e(t.url)}" title="${e(t.name)}">\n      <img src="${e(t.thumbnail)}" alt="${e(t.name)}" loading="lazy">\n      <span class="preset-name">${e(t.name)}</span>\n      <span class="preset-check">✓</span>\n    </div>\n  `).join(""),t.querySelectorAll(".hero-image-preset").forEach(e=>{e.addEventListener("click",()=>{!function(e){const t=document.getElementById("lp-hero-image-company");t&&(t.value=e);He(e)}(e.dataset.url)})})}();const o=document.getElementById("btn-add-point-company");o&&o.addEventListener("click",Fe);const a=document.getElementById("btn-save-lp-settings-company");a&&a.addEventListener("click",Re);const s=document.getElementById("btn-reset-lp-settings-company");s&&s.addEventListener("click",()=>{confirm("LP設定をリセットしますか？")&&Oe()}),xe=!0}function Ae(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}function Me(e){const t=[];let n="",o=!1;for(let a=0;a<e.length;a++){const s=e[a];'"'===s?o=!o:","!==s||o?n+=s:(t.push(n.trim()),n="")}return t.push(n.trim()),t}function He(e){const t=document.getElementById("hero-image-presets-company");t&&t.querySelectorAll(".hero-image-preset").forEach(t=>{const n=t.dataset.url,o=(null==e?void 0:e.split("?")[0])||"",a=(null==n?void 0:n.split("?")[0])||"";o&&a&&o===a?t.classList.add("selected"):t.classList.remove("selected")})}function _e(t=[{title:"",desc:""},{title:"",desc:""},{title:"",desc:""}]){const n=document.getElementById("point-inputs-container-company");n&&(n.innerHTML=t.map((t,n)=>`\n    <div class="point-input-group" data-point-index="${n}">\n      <label>ポイント${n+1}</label>\n      <input type="text" class="point-title" placeholder="タイトル" value="${e(t.title||"")}">\n      <input type="text" class="point-desc" placeholder="説明文" value="${e(t.desc||"")}">\n      <button type="button" class="btn-remove-point" title="削除">&times;</button>\n    </div>\n  `).join(""),n.querySelectorAll(".btn-remove-point").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".point-input-group");t&&n.children.length>1&&(t.remove(),Ne(),Xe())})}),Xe())}function Ne(){const e=document.getElementById("point-inputs-container-company");e&&e.querySelectorAll(".point-input-group").forEach((e,t)=>{e.dataset.pointIndex=t;const n=e.querySelector("label");n&&(n.textContent=`ポイント${t+1}`)})}function Xe(){const e=document.getElementById("point-inputs-container-company"),t=document.getElementById("btn-add-point-company");e&&t&&(t.disabled=e.children.length>=Se)}function Fe(){const e=document.getElementById("point-inputs-container-company");if(!e||e.children.length>=Se)return;const t=e.children.length,n=document.createElement("div");n.className="point-input-group",n.dataset.pointIndex=t,n.innerHTML=`\n    <label>ポイント${t+1}</label>\n    <input type="text" class="point-title" placeholder="タイトル" value="">\n    <input type="text" class="point-desc" placeholder="説明文" value="">\n    <button type="button" class="btn-remove-point" title="削除">&times;</button>\n  `,n.querySelector(".btn-remove-point").addEventListener("click",()=>{e.children.length>1&&(n.remove(),Ne(),Xe())}),e.appendChild(n),Xe(),n.querySelector(".point-title").focus()}function Oe(){Ae("lp-hero-title-company",""),Ae("lp-hero-subtitle-company",""),Ae("lp-hero-image-company",""),Ae("lp-cta-text-company","今すぐ応募する"),Ae("lp-faq-company",""),_e();const e=document.querySelector('input[name="design-pattern-company"][value="standard"]');e&&(e.checked=!0),document.getElementById("section-points-visible-company").checked=!0,document.getElementById("section-jobs-visible-company").checked=!0,document.getElementById("section-details-visible-company").checked=!0,document.getElementById("section-faq-visible-company").checked=!0,He("")}async function Re(){var e,t,n,o,a,s,l,i,c,d,r,u;const m=function(){const e=document.getElementById("point-inputs-container-company");if(!e)return[];const t=[];return e.querySelectorAll(".point-input-group").forEach(e=>{var n,o;const a=(null==(n=e.querySelector(".point-title"))?void 0:n.value)||"",s=(null==(o=e.querySelector(".point-desc"))?void 0:o.value)||"";t.push({title:a,desc:s})}),t}(),p={points:!1!==(null==(e=document.getElementById("section-points-visible-company"))?void 0:e.checked),jobs:!1!==(null==(t=document.getElementById("section-jobs-visible-company"))?void 0:t.checked),details:!1!==(null==(n=document.getElementById("section-details-visible-company"))?void 0:n.checked),faq:!1!==(null==(o=document.getElementById("section-faq-visible-company"))?void 0:o.checked)},y={companyDomain:V,designPattern:(null==(a=document.querySelector('input[name="design-pattern-company"]:checked'))?void 0:a.value)||"standard",heroTitle:(null==(s=document.getElementById("lp-hero-title-company"))?void 0:s.value)||"",heroSubtitle:(null==(l=document.getElementById("lp-hero-subtitle-company"))?void 0:l.value)||"",heroImage:(null==(i=document.getElementById("lp-hero-image-company"))?void 0:i.value)||"",ctaText:(null==(c=document.getElementById("lp-cta-text-company"))?void 0:c.value)||"",faq:(null==(d=document.getElementById("lp-faq-company"))?void 0:d.value)||"",sectionVisibility:JSON.stringify(p)};for(let E=0;E<6;E++)y[`pointTitle${E+1}`]=(null==(r=m[E])?void 0:r.title)||"",y[`pointDesc${E+1}`]=(null==(u=m[E])?void 0:u.desc)||"";const g=document.getElementById("btn-save-lp-settings-company"),h=document.getElementById("lp-save-message"),b=document.getElementById("lp-error-message");g&&(g.disabled=!0,g.textContent="保存中..."),h&&(h.style.display="none"),b&&(b.style.display="none");try{const e=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveLPSettings",settings:y})))),t=`${Te}?action=post&data=${encodeURIComponent(e)}`,n=await fetch(t,{method:"GET",redirect:"follow"}),o=await n.text();let a;try{a=JSON.parse(o)}catch(f){throw new Error("サーバーからの応答が不正です")}if(g&&(g.disabled=!1,g.textContent="LP設定を保存"),!a.success)throw new Error(a.error||"保存に失敗しました");h&&(h.textContent="LP設定を保存しました",h.style.display="block",setTimeout(()=>{h.style.display="none"},3e3))}catch(v){console.error("LP設定保存エラー:",v),g&&(g.disabled=!1,g.textContent="LP設定を保存"),b&&(b.textContent="LP設定の保存に失敗しました: "+v.message,b.style.display="block")}}function Pe(){const e=document.getElementById("password-change-form");e&&e.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("current-password").value,o=document.getElementById("new-password").value,a=document.getElementById("confirm-password").value,s=document.getElementById("password-change-error"),l=document.getElementById("password-change-success");if(s.style.display="none",l.style.display="none",o!==a)return s.textContent="新しいパスワードが一致しません",void(s.style.display="block");if(o.length<8)return s.textContent="パスワードは8文字以上で設定してください",void(s.style.display="block");try{const t=await async function(e,t){if("undefined"==typeof firebase||!firebase.firestore)return{success:!1,error:"データベースが初期化されていません"};const n=firebase.firestore(),o=sessionStorage.getItem("company_user_id");if(!o)try{const o=await n.collection("company_users").where("companyDomain","==",V).limit(1).get();if(o.empty)return{success:!1,error:"ユーザー情報が見つかりません"};const a=o.docs[0];return a.data().password!==e?{success:!1,error:"現在のパスワードが正しくありません"}:(await n.collection("company_users").doc(a.id).update({password:t,passwordChangedAt:firebase.firestore.FieldValue.serverTimestamp()}),{success:!0})}catch(a){return console.error("Password change error:",a),{success:!1,error:a.message}}try{const a=await n.collection("company_users").where("username","==",o).limit(1).get();if(a.empty)return{success:!1,error:"ユーザー情報が見つかりません"};const s=a.docs[0];return s.data().password!==e?{success:!1,error:"現在のパスワードが正しくありません"}:(await n.collection("company_users").doc(s.id).update({password:t,passwordChangedAt:firebase.firestore.FieldValue.serverTimestamp()}),{success:!0})}catch(a){return console.error("Password change error:",a),{success:!1,error:a.message}}}(n,o);t.success?(l.textContent="パスワードを変更しました",l.style.display="block",e.reset()):(s.textContent=t.error,s.style.display="block")}catch(i){console.error("Password change error:",i),s.textContent="パスワードの変更に失敗しました",s.style.display="block"}})}function Ue(){const t=document.querySelector(".feed-section");t&&(t.style.display="none");const n=document.querySelector('.sidebar-nav a[data-section="back"]');n&&(n.style.display="none");const o=document.getElementById("btn-back-admin");o&&(o.style.display="none");const a=document.getElementById("btn-logout");a&&(a.style.display="block",a.addEventListener("click",()=>{sessionStorage.removeItem(F),sessionStorage.removeItem(O),sessionStorage.removeItem(R),sessionStorage.removeItem("auth_method"),sessionStorage.removeItem("company_user_id"),"undefined"!=typeof firebase&&firebase.auth&&firebase.auth().signOut(),window.location.href="admin.html"}));const s=document.getElementById("nav-settings-item");s&&(s.style.display="block");const l=document.getElementById("nav-lp-settings-item");l&&(l.style.display="block"),qe(),Pe();const i=document.getElementById("company-name");i&&(i.innerHTML=`${e(G)} <span class="badge info">会社ユーザー</span>`)}async function Je(){if("undefined"==typeof firebase?console.warn("[JobManager] Firebase not loaded"):firebase.apps.length||firebase.initializeApp(X),!sessionStorage.getItem(F))return void(window.location.href="admin.html");const e=new URLSearchParams(window.location.search);V=e.get("domain"),G=e.get("company")||V,K=e.get("sheetUrl");const t=e.get("section");if(t&&["analytics","reports","applicants"].includes(t)&&Le(t),!V)return alert("会社ドメインが指定されていません"),void(window.location.href="admin.html");if(!J(V))return alert("この会社へのアクセス権限がありません"),void(window.location.href="admin.html");U()||Ue();const n=document.getElementById("page-title");n&&!t&&(n.textContent=`${G} の求人一覧`);const o=document.getElementById("company-name");o&&(o.textContent=G);const a=document.getElementById("btn-open-sheet");var s,l,i,c,d,r,u,m,p,y,g,h,b,f,v,E;K&&a?(a.href=K,a.style.display=""):a&&(a.style.display="none"),null==(s=document.getElementById("btn-add-job"))||s.addEventListener("click",oe),null==(l=document.getElementById("btn-refresh"))||l.addEventListener("click",ne),null==(i=document.getElementById("job-modal-close"))||i.addEventListener("click",se),null==(c=document.getElementById("job-modal-cancel"))||c.addEventListener("click",se),null==(d=document.getElementById("job-modal-delete"))||d.addEventListener("click",ie),null==(r=document.getElementById("job-edit-form"))||r.addEventListener("submit",e=>{e.preventDefault(),le()}),null==(u=document.getElementById("job-modal"))||u.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&se()}),null==(m=document.getElementById("btn-download-indeed"))||m.addEventListener("click",ue),null==(p=document.getElementById("btn-download-google"))||p.addEventListener("click",me),null==(y=document.getElementById("btn-download-jobbox"))||y.addEventListener("click",pe),null==(g=document.getElementById("btn-download-csv"))||g.addEventListener("click",ye),document.querySelectorAll(".sidebar-nav a[data-section]").forEach(e=>{e.addEventListener("click",t=>{const n=e.dataset.section;n&&"back"!==n&&(t.preventDefault(),Le(n))})}),null==(h=document.getElementById("report-period"))||h.addEventListener("change",e=>{const t=document.getElementById("report-custom-dates");t&&(t.style.display="custom"===e.target.value?"flex":"none")}),null==(b=document.getElementById("btn-generate-report"))||b.addEventListener("click",we),null==(f=document.getElementById("btn-report-csv"))||f.addEventListener("click",Be),null==(v=document.getElementById("btn-report-excel"))||v.addEventListener("click",je),null==(E=document.getElementById("btn-load-analytics"))||E.addEventListener("click",ge),await ne()}"undefined"!=typeof window&&(window.JobManager={init:Je,loadJobsData:ne,showJobModal:oe,editJob:ae,closeJobModal:se,saveJobData:le,deleteJob:ie}),document.addEventListener("DOMContentLoaded",()=>{Je()});
