const t="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",e="会社一覧",o="Stats",n="images/default-job.svg",s="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec",a=3e5,r={companies:{data:null,timestamp:0},jobs:new Map},i=()=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${e}`,c=()=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${o}`;function l(t){const e=[];let o="",n=!1;for(let s=0;s<t.length;s++){const a=t[s];'"'===a?n&&'"'===t[s+1]?(o+='"',s++):n=!n:","!==a||n?o+=a:(e.push(o.trim()),o="")}return e.push(o.trim()),e}function u(t){const e={id:"id",ID:"id","求人ID":"jobId",jobId:"jobId",job_id:"jobId","会社名":"company",company:"company","タイトル":"title",title:"title","勤務地":"location",location:"location","特典総額":"totalBonus",totalBonus:"totalBonus","月収例":"monthlySalary",monthlySalary:"monthlySalary","特徴":"features",features:"features","バッジ":"badges",badges:"badges","画像URL":"imageUrl",imageUrl:"imageUrl","詳細URL":"detailUrl",detailUrl:"detailUrl","表示":"visible",visible:"visible","表示する":"showCompany","並び順":"order",order:"order","会社ドメイン":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","会社住所":"companyAddress",companyAddress:"companyAddress","説明":"description",description:"description","お仕事内容":"jobContent",jobContent:"jobContent","仕事内容":"jobDescription",jobDescription:"jobDescription","応募資格":"requirements",requirements:"requirements","待遇":"benefits",benefits:"benefits","勤務時間":"workingHours",workingHours:"workingHours","休日":"holidays",holidays:"holidays","デザインパターン":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","パターン":"designPattern",pattern:"designPattern","管理シート":"jobsSheet",jobsSheet:"jobsSheet",jobs_sheet:"jobsSheet","管理シートURL":"manageSheetUrl",manageSheetUrl:"manageSheetUrl","求人管理シートURL":"manageSheetUrl","掲載開始日":"publishStartDate",publishStartDate:"publishStartDate",publish_start_date:"publishStartDate","掲載終了日":"publishEndDate",publishEndDate:"publishEndDate",publish_end_date:"publishEndDate","職種名":"jobType","職種":"jobType",jobType:"jobType",job_type:"jobType","給与":"salary",salary:"salary","雇用形態":"employmentType",employmentType:"employmentType",employment_type:"employmentType","資格・スキル":"skills",skills:"skills","資格":"skills","スキル":"skills","検索タグ":"tags",tags:"tags","メモ":"memo",memo:"memo","動画URL":"videoUrl",videoUrl:"videoUrl",video_url:"videoUrl","動画表示":"showVideoButton",showVideoButton:"showVideoButton",show_video_button:"showVideoButton"},o=t.replace(/"/g,"").trim();if(e[o])return e[o];const n=o.split(/\s+/);return n.length>1&&e[n[0]]?e[n[0]]:n[0]||o}function m(t,e=0,o=1){const n=t.split("\n"),s=l(n[e]||""),a=[];for(let r=o;r<n.length;r++){if(!n[r].trim())continue;const t=l(n[r]),e={};s.forEach((o,n)=>{const s=u(o);e[s]=t[n]||""}),e.features?e.features=e.features.split(",").map(t=>t.trim()).filter(t=>t):e.features=[],e.tags?(e.tags=e.tags.split(",").map(t=>t.trim()).filter(t=>t),e.features=[...new Set([...e.features,...e.tags])]):e.tags=[],a.push(e)}return a}function p(t){const e=t.match(/\/spreadsheets\/d\/([a-zA-Z0-9_-]+)/);return e?e[1]:/^[a-zA-Z0-9_-]+$/.test(t)?t:null}async function d(){const t=Date.now();if(r.companies.data&&t-r.companies.timestamp<a)return r.companies.data;try{const e=await fetch(i());if(!e.ok)throw new Error("会社一覧の取得に失敗しました");const o=m(await e.text());return r.companies.data=o,r.companies.timestamp=t,o}catch(e){return console.error("会社一覧の取得エラー:",e),r.companies.data||null}}async function h(t){var e;if(!t)return null;const o=p(t.trim());if(!o)return null;const n=Date.now(),s=r.jobs.get(o);if(s&&n-s.timestamp<a)return s.data;try{const t=`https://docs.google.com/spreadsheets/d/${o}/gviz/tq?tqx=out:csv`,s=await fetch(t);if(!s.ok)throw new Error("求人データの取得に失敗しました");const a=await s.text(),i=(null==(e=a.split("\n")[0])?void 0:e.split(",")[0])||"",c=i.includes(" ")&&!i.startsWith('"管理'),l=m(a,0,c?1:2);return r.jobs.set(o,{data:l,timestamp:n}),l}catch(i){return console.error("求人データの取得エラー:",i),(null==s?void 0:s.data)||null}}function f(t){return!(!t.jobsSheet||!t.jobsSheet.trim())&&("○"===t.showCompany||"◯"===t.showCompany)}function b(t){if(!t)return null;const e=t.trim().replace(/\//g,"-"),o=new Date(e);return isNaN(o.getTime())?null:(o.setHours(0,0,0,0),o)}function y(t){const e=new Date;if(e.setHours(0,0,0,0),t.publishStartDate&&t.publishStartDate.trim()){const o=b(t.publishStartDate);if(o&&e<o)return!1}if(t.publishEndDate&&t.publishEndDate.trim()){const o=b(t.publishEndDate);if(o&&e>o)return!1}return!0}function g(t){let e=0,o="";return t.forEach(t=>{if(!t.monthlySalary)return;const n=t.monthlySalary;let s=0;const a=n.match(/(\d+(?:\.\d+)?)\s*万/);if(a)s=1e4*parseFloat(a[1]);else{const t=n.match(/(\d{1,3}(?:,\d{3})*)\s*円/);if(t)s=parseInt(t[1].replace(/,/g,""));else{const t=n.match(/[¥￥]\s*(\d{1,3}(?:,\d{3})*|\d+)/);if(t)s=parseInt(t[1].replace(/,/g,""));else{const t=n.match(/(\d{1,3}(?:,\d{3})*|\d+)/);t&&(s=parseInt(t[1].replace(/,/g,"")))}}}s>e&&(e=s,o=n)}),o}async function w(){var t;const e=await d();if(!e)return[];const o=[];for(const n of e){if(!f(n))continue;const e=null==(t=n.jobsSheet)?void 0:t.trim();if(!e)continue;const s=await h(e);s&&s.forEach(t=>{t.company=n.company,t.companyDomain=n.companyDomain,o.push(t)})}return o}async function j(){const t=await w(),e={};return t.forEach(t=>{const o=t.companyAddress||t.location;if(!o)return;const n=o.match(/^(.+?[都道府県])/),s=n?n[1]:o;e[s]||(e[s]={prefecture:s,jobs:[],count:0}),e[s].jobs.push(t),e[s].count++}),Object.values(e).sort((t,e)=>e.count-t.count)}async function S(t){return(await w()).filter(e=>{const o=e.companyAddress||e.location;return o&&o.includes(t)})}async function D(){const t=await w(),e={};return t.forEach(t=>{var o;const n=null==(o=t.jobType)?void 0:o.trim();n&&(e[n]||(e[n]={jobType:n,count:0}),e[n].count++)}),Object.values(e).sort((t,e)=>e.count-t.count)}async function v(t){const e=await w(),o=t.toLowerCase();return e.filter(t=>[t.title,t.company,t.jobContent,t.jobDescription,t.description,t.benefits,t.requirements,t.companyAddress,t.location,t.jobType,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(o)))}async function E(t){const e=await w(),o=t.toLowerCase();return e.filter(t=>[t.title,t.jobType,t.jobContent,t.jobDescription,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(o)))}async function U(){const t="jobStats";try{const e=localStorage.getItem(t);if(e){const{data:t,timestamp:o}=JSON.parse(e);if(Date.now()-o<18e5)return t}const o=await fetch(`${s}?action=getJobStats`);if(!o.ok)throw new Error("求人統計の取得に失敗しました");const n=await o.json();if(!n.success)throw new Error(n.error||"求人統計の取得に失敗しました");return localStorage.setItem(t,JSON.stringify({data:n.stats,timestamp:Date.now()})),n.stats}catch(e){return console.error("求人統計の取得エラー:",e),null}}function C(t){const e=t?t.toLowerCase().trim():"";return["modern","classic","minimal","colorful"].includes(e)?`pattern-${e}`:""}const T={SHEET_ID:t,SHEET_NAME:e,STATS_SHEET_NAME:o,DEFAULT_IMAGE:n,GAS_API_URL:s,get csvUrl(){return i()},get statsUrl(){return c()},getSheetUrl:e=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(e)}`,parseCSVLine:l,normalizeHeader:u,parseCSV:m,extractSpreadsheetId:p,fetchCompanies:d,fetchCompanyJobs:h,fetchJobs:d,isCompanyVisible:f,parseDate:b,isJobInPublishPeriod:y,getDetailUrl:function(t){return t.companyDomain&&t.companyDomain.trim()?`company.html?id=${encodeURIComponent(t.companyDomain.trim())}`:t.detailUrl||"#"},getMaxMonthlySalary:g,fetchAllJobs:w,getLocationList:j,getJobTypeList:D,getJobsByLocation:S,getJobsByKeyword:v,getJobsByOccupation:E,fetchStats:async function(){try{const t=await fetch(c());if(!t.ok)throw new Error("実績データの取得に失敗しました");return function(t){const e=t.split("\n"),o={};for(let n=1;n<e.length;n++){if(!e[n].trim())continue;const t=l(e[n]),s=t[0]?t[0].replace(/"/g,"").trim():"",a=t[1]?t[1].replace(/"/g,"").trim():"",r=t[2]?t[2].replace(/"/g,"").trim():"";s&&(o[s]={value:a,label:r})}return o}(await t.text())}catch(t){return console.error("実績データの取得エラー:",t),null}},fetchJobStats:U,getDesignPatternClass:C,escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeHtml(t){if(!t||"<br>"===t||"<div><br></div>"===t)return"";const e=["b","strong","i","em","u","ul","ol","li","br","div","p"],o=document.createElement("div");o.innerHTML=t;return o.querySelectorAll("*").forEach(t=>{if(e.includes(t.tagName.toLowerCase()))for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);else t.replaceWith(...t.childNodes)}),o.innerHTML}};"undefined"!=typeof window&&(window.JobsLoader=T);export{n as D,T as J,w as a,E as b,y as c,h as d,g as e,d as f,v as g,j as h,f as i,C as j,S as k,U as l,D as m,l as p};
