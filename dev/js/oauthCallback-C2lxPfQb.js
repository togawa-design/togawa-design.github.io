import"./modulepreload-polyfill-YP0FEG5d.js";function e(e){document.getElementById("loading").style.display="none",document.getElementById("error").style.display="block",document.getElementById("error-message").textContent=e,document.querySelector("#error .close-btn").style.display="inline-block"}!async function(){const o=new URLSearchParams(window.location.search),t=o.get("code"),n=o.get("state"),r=o.get("error");if(r)return void e("Googleからのエラー: "+r);if(!t||!n)return void e("認可コードまたはステートが見つかりません");let s;try{s=JSON.parse(atob(n))}catch(d){return void e("ステートの解析に失敗しました")}const{companyDomain:a,companyUserId:c,staffName:l}=s;try{const e=await fetch("https://asia-northeast1-generated-area-484613-e3-90bd4.cloudfunctions.net/exchangeCalendarToken",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,companyDomain:a,companyUserId:c,staffName:l})});if(!e.ok){const o=await e.json().catch(()=>({}));throw new Error(o.error||"トークン交換に失敗しました")}document.getElementById("loading").style.display="none",document.getElementById("success").style.display="block",document.querySelector("#success .close-btn").style.display="inline-block",window.opener&&window.opener.postMessage({type:"CALENDAR_CONNECTED"},"*"),setTimeout(()=>{window.close()},3e3)}catch(i){console.error("Token exchange error:",i),e(i.message||"連携処理中にエラーが発生しました")}}();
