const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/job-edit-utils-DcWUcJyi.js","js/utils-BNVq905i.js","js/env-config-DknF4WGE.js","js/firestore-service-B91FO87B.js","js/image-uploader-CMmi_cQM.js","js/jobs-loader-CXaJNGTC.js","js/LPEditor-DCIKBMfO.js","js/modal-BOD5e818.js","js/core-D9Duf6oe.js","js/api-CFJD9K9_.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-YP0FEG5d.js";import{_ as e,i as t,f as n,a,b as o}from"./jobs-loader-CXaJNGTC.js";import{c as s,b as i,i as c,s as l,a as r,d,g as m,e as u,f as p,h as y,j as g,k as v}from"./firestore-service-B91FO87B.js";import{i as b,g as f,a as h,r as E,b as w,s as j,m as I,c as B,d as L,e as $,f as k,h as x,j as D,k as S,l as A,n as C,o as T,p as M,q as H,t as q,u as R,v as _,w as P,x as U,y as F,z,A as N,B as J,C as V,D as O,E as W,F as G,G as Y,H as K,I as X,J as Z,K as Q,L as ee,M as te,N as ne,O as ae,P as oe,Q as se,R as ie,S as ce,T as le,U as re,V as de,W as me,X as ue,Y as pe,Z as ye,_ as ge,$ as ve,a0 as be,a1 as fe,a2 as he,a3 as Ee,a4 as we,a5 as je,a6 as Ie,a7 as Be,a8 as Le,a9 as $e,aa as ke,ab as xe,ac as De,ad as Se,ae as Ae,af as Ce}from"./job-edit-utils-DcWUcJyi.js";import{formatNumber as Te,escapeHtml as Me,showConfirm as He,showToast as qe}from"./utils-BNVq905i.js";import{a as Re}from"./env-config-DknF4WGE.js";import{r as _e,i as Pe,a as Ue,s as Fe,h as ze,b as Ne,u as Je,c as Ve,d as Oe,e as We,f as Ge,g as Ye,j as Ke,p as Xe,k as Ze,l as Qe,m as et}from"./core-D9Duf6oe.js";import{l as tt}from"./api-CFJD9K9_.js";import{s as nt}from"./modal-BOD5e818.js";import{i as at,g as ot,c as st,a as it,b as ct,f as lt,d as rt,e as dt,r as mt,h as ut}from"./index-B9fNBF6a.js";import{s as pt,u as yt,a as gt,b as vt}from"./image-uploader-CMmi_cQM.js";import"./LPEditor-DCIKBMfO.js";let bt=null,ft=null,ht=null,Et=null,wt=null;function jt(e){if(wt=e,"undefined"==typeof flatpickr)return void console.warn("[DatePicker] flatpickr not loaded");flatpickr.localize(flatpickr.l10ns.ja);const t=new Date,n=new Date;n.setMonth(t.getMonth()-1),bt=n,ft=t,function(){const e=document.getElementById("date-range-start"),t=document.getElementById("date-range-end");if(!e||!t)return;const n={dateFormat:"Y/m/d",maxDate:"today",disableMobile:!0};ht=flatpickr(e,{...n,defaultDate:bt,onChange:e=>{e[0]&&(bt=e[0],ft&&e[0]>ft&&(ft=e[0],null==Et||Et.setDate(ft)),It())}}),Et=flatpickr(t,{...n,defaultDate:ft,onChange:e=>{e[0]&&(ft=e[0],bt&&e[0]<bt&&(bt=e[0],null==ht||ht.setDate(bt)),It())}})}(),function(){const e=document.getElementById("jm-analytics-start-date"),t=document.getElementById("jm-analytics-end-date");if(!e||!t)return;const n={dateFormat:"Y/m/d",maxDate:"today",disableMobile:!0};flatpickr(e,{...n,defaultDate:bt,onChange:e=>{e[0]&&(bt=e[0],null==ht||ht.setDate(e[0]),ft&&e[0]>ft&&(ft=e[0],null==Et||Et.setDate(ft)))}}),flatpickr(t,{...n,defaultDate:ft,onChange:e=>{e[0]&&(ft=e[0],null==Et||Et.setDate(e[0]),bt&&e[0]<bt&&(bt=e[0],null==ht||ht.setDate(bt)))}})}()}function It(){wt&&wt(Bt())}function Bt(){const e=bt||new Date(Date.now()-2592e6),t=ft||new Date;return{startDate:e,endDate:t,days:Math.round((t-e)/864e5),startDateStr:Lt(e),endDateStr:Lt(t)}}function Lt(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}let $t=[],kt=null,xt=null,Dt=null,St=null,At=null,Ct=null;function Tt(e,t={}){const n=new URL(e,window.location.origin);if(Object.entries(t).forEach(([e,t])=>{null!=t&&n.searchParams.set(e,t)}),!b()){const e=h();e&&n.searchParams.set("company_domain",e)}return n.toString()}async function Mt(){const{days:e}=Bt(),t=s.apiEndpoint;if(function(){if(b())return;const e=document.getElementById("overview-company-ranking");e&&(e.style.display="none");const t=document.getElementById("tab-recruitment-management");t&&(t.style.display="none");const n=document.getElementById("recruitment-management-tab");n&&n.classList.remove("active");const a=document.getElementById("tab-companies");a&&(a.style.display="none");const o=document.getElementById("companies-tab");o&&o.classList.remove("active");const s=document.getElementById("tab-conversion"),i=document.getElementById("conversion-tab");s&&i&&(s.classList.add("active"),i.classList.add("active"));const c=document.getElementById("engagement-company-section");c&&(c.style.display="none");const l=document.getElementById("company-cvr-section");l&&(l.style.display="none")}(),t)try{await async function(e,t){try{Ht(!0),function(e){const t='<div class="section-loading"><div class="loading-spinner"></div><span>データを読み込み中...</span></div>';document.querySelectorAll(".stat-value").forEach(e=>{e.dataset.originalText=e.textContent,e.innerHTML='<span class="loading-dots">...</span>'});const n=document.getElementById("daily-chart");n&&e&&(n.innerHTML=t);const a=document.querySelector(".data-table tbody");a&&e&&(a.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;">${t}</td></tr>`);const o=document.getElementById("company-cards");o&&e&&(o.innerHTML=t);const s=document.querySelector("#applications-section .data-table tbody");s&&e&&(s.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:2rem;">${t}</td></tr>`)}(!0);const o={},s=f();s&&(o.Authorization=`Bearer ${s}`);let i=`${t}?days=${e}`;if(!b()){const e=h();e&&(i+=`&company_domain=${encodeURIComponent(e)}`)}const c=await fetch(i,{headers:o});if(!c.ok)throw new Error(`API Error: ${c.status}`);const l=await c.json();if(!l.success)throw new Error(l.error||"Unknown error");const r=l.data;r.overview&&(qt("total-pageviews",Te(r.overview.pageViews)),qt("total-users",Te(r.overview.users)),qt("company-views",Te(r.overview.companyViews)),qt("apply-clicks",Te(r.overview.applyClicks)),n=r.overview.gender,a=r.overview.age,E(n,a,{maleBarId:"admin-gender-bar-male",femaleBarId:"admin-gender-bar-female",malePercentId:"admin-gender-male-percent",femalePercentId:"admin-gender-female-percent",ageContainerId:"admin-age-bars"})),r.daily&&Rt(r.daily),r.companies&&($t=r.companies.filter(e=>e.domain&&"(not set)"!==e.domain&&e.name&&"(not set)"!==e.name).map(e=>({name:e.name,domain:e.domain,views:e.views,clicks:e.clicks,pattern:"standard"})),Pt(),Ut()),r.applications&&function(e){const t=document.querySelector("#applications-table tbody");if(!t)return;const n={apply:"応募ボタン",line:"LINE相談",consult:"相談フォーム"};if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">応募データがありません</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Me(e.date)}</td>\n      <td>${Me(e.company)}</td>\n      <td><span class="type-badge ${Me(e.type)}">${n[e.type]||Me(e.type)}</span></td>\n      <td>${Me(e.pageType||e.pagePath||"-")}</td>\n      <td>${Me(e.source)}</td>\n    </tr>\n  `).join("")}(r.applications),Ht(!1)}catch(o){console.error("[Admin] API fetch error:",o),Ht(!1),_t(e)}var n,a}(e,t)}catch(n){console.error("[Admin] API fetch failed, loading mock data:",n),_t(e)}else _t(e)}function Ht(e){const t=document.getElementById("refresh-btn");t&&(t.textContent=e?"読み込み中...":"更新",t.disabled=e)}function qt(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function Rt(e){const t=document.getElementById("daily-chart");if(!t)return;if(!e||0===e.length)return void(t.innerHTML="<p>データがありません</p>");kt&&(kt.destroy(),kt=null);const n=e.length>30?e.filter((e,t)=>t%3==0):e;t.innerHTML='<canvas id="daily-chart-canvas"></canvas>';const a=document.getElementById("daily-chart-canvas").getContext("2d");kt=new Chart(a,{type:"line",data:{labels:n.map(e=>e.date),datasets:[{label:"PV",data:n.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:3,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:10},maxRotation:45}}}}})}function _t(e){const t=80*e,n=45*e,a=12*e;qt("total-pageviews",Te(150*e+Math.floor(500*Math.random()))),qt("total-users",Te(t+Math.floor(200*Math.random()))),qt("company-views",Te(n+Math.floor(100*Math.random()))),qt("apply-clicks",Te(a+Math.floor(30*Math.random()))),function(e){const t=[],n=new Date;for(let a=e-1;a>=0;a--){const e=new Date(n);e.setDate(e.getDate()-a),t.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(100+200*Math.random())})}Rt(t)}(e),$t=[{name:"トヨタ自動車",domain:"toyota",views:1250,clicks:89,pattern:"modern"},{name:"日産自動車",domain:"nissan",views:980,clicks:67,pattern:"classic"},{name:"本田技研工業",domain:"honda",views:856,clicks:54,pattern:"colorful"},{name:"スバル",domain:"subaru",views:654,clicks:43,pattern:"minimal"},{name:"マツダ",domain:"mazda",views:523,clicks:32,pattern:"standard"},{name:"スズキ",domain:"suzuki",views:412,clicks:28,pattern:"modern"},{name:"ダイハツ",domain:"daihatsu",views:387,clicks:24,pattern:"classic"},{name:"三菱自動車",domain:"mitsubishi",views:298,clicks:18,pattern:"standard"}],Pt(),Ut(),function(){const e=document.querySelector("#applications-table tbody");if(!e)return;const t=[{date:"2025/01/17 14:32",company:"トヨタ自動車",type:"apply",source:"Google検索"},{date:"2025/01/17 13:15",company:"日産自動車",type:"line",source:"直接アクセス"},{date:"2025/01/17 11:48",company:"トヨタ自動車",type:"apply",source:"Yahoo検索"},{date:"2025/01/17 10:22",company:"本田技研工業",type:"apply",source:"直接アクセス"},{date:"2025/01/16 18:45",company:"スバル",type:"line",source:"Google検索"},{date:"2025/01/16 16:30",company:"トヨタ自動車",type:"apply",source:"SNS"},{date:"2025/01/16 14:12",company:"マツダ",type:"apply",source:"Google検索"},{date:"2025/01/16 11:55",company:"日産自動車",type:"apply",source:"直接アクセス"}],n={apply:"応募ボタン",line:"LINE相談",consult:"相談フォーム"};e.innerHTML=t.map(e=>`\n    <tr>\n      <td>${Me(e.date)}</td>\n      <td>${Me(e.company)}</td>\n      <td><span class="type-badge ${Me(e.type)}">${n[e.type]}</span></td>\n      <td>${Me(e.source)}</td>\n    </tr>\n  `).join("")}()}function Pt(){const e=document.querySelector("#overview-company-table tbody");if(!e)return;const t=[...$t].sort((e,t)=>t.views-e.views);e.innerHTML=t.slice(0,5).map((e,t)=>{const n=(e.clicks/e.views*100).toFixed(1);return`\n      <tr>\n        <td>${t+1}</td>\n        <td>${Me(e.name)}</td>\n        <td>${Te(e.views)}</td>\n        <td>${e.clicks}</td>\n        <td>${n}%</td>\n      </tr>\n    `}).join("")}function Ut(){const e=document.getElementById("company-cards");e&&(e.innerHTML=$t.map(e=>{const t=(e.clicks/e.views*100).toFixed(1),n=i(e.pattern);return`\n      <div class="company-card" data-domain="${Me(e.domain)}" data-name="${Me(e.name)}" data-views="${e.views}" data-clicks="${e.clicks}">\n        <div class="company-card-header">\n          <h4>${Me(e.name)}</h4>\n          <span class="pattern-badge ${Me(e.pattern)}">${n}</span>\n        </div>\n        <div class="company-card-stats">\n          <div class="card-stat">\n            <span class="stat-value">${Te(e.views)}</span>\n            <span class="stat-label">ページビュー</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${e.clicks}</span>\n            <span class="stat-label">応募クリック</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${t}%</span>\n            <span class="stat-label">CVR</span>\n          </div>\n        </div>\n        <button class="btn-view-status" data-domain="${Me(e.domain)}" data-name="${Me(e.name)}">会社の状況を確認</button>\n      </div>\n    `}).join(""),e.querySelectorAll(".btn-view-status").forEach(e=>{e.addEventListener("click",e=>{!async function(e,t){const n=document.getElementById("company-detail-title");n&&(n.textContent=`${t} の分析`);const a=document.getElementById("detail-view-page-btn");a&&(a.href=`company.html?c=${e}`);document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const o=document.getElementById("section-company-detail");o&&o.classList.add("active");const i=document.getElementById("page-title");i&&(i.textContent="企業詳細分析");document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")}),function(){const e='<div class="loading-placeholder">データを読み込み中...</div>';document.querySelectorAll(".detail-stat-value").forEach(e=>{e.textContent="-"}),document.querySelectorAll(".detail-chart").forEach(t=>{t.innerHTML=e}),document.querySelectorAll(".detail-table-container tbody").forEach(e=>{e.innerHTML='<tr><td colspan="4" class="loading-cell">データを読み込み中...</td></tr>'})}();const{days:c}=Bt();try{await async function(e,t){const n=s.apiEndpoint,a={},o=f();o&&(a.Authorization=`Bearer ${o}`);const i=await fetch(`${n}?type=company-detail&domain=${e}&days=${t}`,{headers:a}),c=await i.json();if(!c.success)throw new Error(c.error||"API Error");!async function(e,t){var n,a;const o=$t.find(e=>e.domain===t)||{},s=(null==(n=e.summary)?void 0:n.totalViews)||o.views||0,i=o.clicks||0,c=s>0?(i/s*100).toFixed(1):0,l=(null==(a=e.summary)?void 0:a.avgDailyViews)||0;qt("detail-total-views",Te(s)),qt("detail-total-clicks",Te(i)),qt("detail-cvr",`${c}%`),qt("detail-avg-daily",Te(Math.round(l))),en(e.daily||[]),nn(e.traffic||[]);const r=e.gender||{};an({male:r.male||0,female:r.female||0,other:r.unknown||0});const d=e.age||{};on((m=d,{"20s":(m["18-24"]||0)+(m["25-34"]||0),"30s":m["35-44"]||0,"40s":m["45-54"]||0,"50s":(m["55-64"]||0)+(m["65+"]||0)}));var m;const u=e.jobs||[];if(u.length>0){tn(u.slice(0,5).map(e=>({title:e.jobTitle||e.pagePath||"不明",applications:e.applications||0})));sn(u.map(e=>({title:e.jobTitle||e.pagePath||"不明",views:e.views||0,applications:e.applications||0,cvr:e.views>0?((e.applications||0)/e.views*100).toFixed(1):"0.0"})))}else tn([]),sn([]);await cn(t)}(c.data,e)}(e,c)}catch(l){console.error("[Admin] Company detail error:",l),function(e){const t=$t.find(t=>t.domain===e)||{views:1e3,clicks:50},n=t.views,a=t.clicks,o=(a/n*100).toFixed(1);qt("detail-total-views",Te(n)),qt("detail-total-clicks",Te(a)),qt("detail-cvr",`${o}%`),qt("detail-avg-daily",Te(Math.round(n/30)));const s=[],i=new Date;for(let l=29;l>=0;l--){const e=new Date(i);e.setDate(e.getDate()-l),s.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(20+60*Math.random())})}en(s);const c=[{title:"製造スタッフ",applications:23},{title:"組立作業員",applications:18},{title:"検査・検品",applications:12},{title:"機械オペレーター",applications:8},{title:"フォークリフト",applications:5}];tn(c);nn([{channel:"Organic Search",count:Math.floor(.45*n)},{channel:"Direct",count:Math.floor(.28*n)},{channel:"Social",count:Math.floor(.18*n)},{channel:"Referral",count:Math.floor(.09*n)}]);an({male:Math.floor(.72*a),female:Math.floor(.25*a),other:Math.floor(.03*a)});on({"20s":Math.floor(.35*a),"30s":Math.floor(.32*a),"40s":Math.floor(.23*a),"50s":Math.floor(.1*a)}),sn(c.map(e=>({...e,views:Math.floor(n*(e.applications/a)),cvr:(e.applications/(n*(e.applications/a))*100).toFixed(1)}))),cn(e)}(e)}}(e.target.dataset.domain,e.target.dataset.name)})}))}function Ft(e){const t=document.querySelectorAll(".company-card"),n=e.toLowerCase();t.forEach(e=>{const t=e.dataset.name.toLowerCase(),a=e.dataset.domain.toLowerCase();t.includes(n)||a.includes(n)?e.style.display="":e.style.display="none"})}function zt(){const e=document.getElementById("sort-by"),t=(null==e?void 0:e.value)||"views",n=document.getElementById("company-cards");if(!n)return;const a=Array.from(n.querySelectorAll(".company-card"));a.sort((e,n)=>{switch(t){case"views":return parseInt(n.dataset.views)-parseInt(e.dataset.views);case"clicks":return parseInt(n.dataset.clicks)-parseInt(e.dataset.clicks);case"cvr":const t=parseInt(e.dataset.clicks)/parseInt(e.dataset.views);return parseInt(n.dataset.clicks)/parseInt(n.dataset.views)-t;case"name":return e.dataset.name.localeCompare(n.dataset.name,"ja");default:return 0}}),a.forEach(e=>n.appendChild(e))}function Nt(){const e=document.querySelectorAll(".analytics-tab"),t=document.querySelectorAll(".analytics-tab-content");e.forEach(n=>{n.addEventListener("click",()=>{const a=n.dataset.tab;e.forEach(e=>e.classList.remove("active")),n.classList.add("active"),t.forEach(e=>e.classList.remove("active"));const o=document.getElementById(a);o&&(o.classList.add("active"),async function(e){const{days:t}=Bt(),n=s.apiEndpoint;switch(e){case"recruitment-management-tab":await mn();break;case"traffic-behavior-tab":await Promise.all([Jt(t,n),Ot(t,n)]);break;case"conversion-tab":await async function(e,t){try{const n={},a=f();a&&(n.Authorization=`Bearer ${a}`);const o=Tt(t,{type:"funnel",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?Yt(i.data):Kt()}catch(n){console.error("[Admin] Funnel data error:",n),Kt()}}(t,n);break;case"trends-tab":await async function(e,t){try{const n={},a=f();a&&(n.Authorization=`Bearer ${a}`);const o=Tt(t,{type:"trends",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?Xt(i.data):Zt()}catch(n){console.error("[Admin] Trend data error:",n),Zt()}}(t,n)}}(a))})})}async function Jt(e,t){try{const n={},a=f();a&&(n.Authorization=`Bearer ${a}`);const o=Tt(t,{type:"engagement",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?function(e){const t=e.overall||{};qt("avg-session-duration",`${t.avgSessionDuration||0}秒`),qt("engagement-rate",`${t.engagementRate||0}%`),qt("bounce-rate",`${t.bounceRate||0}%`);const n=document.querySelector("#engagement-company-table tbody");n&&e.byCompany&&e.byCompany.length>0?n.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${Me(e.name||e.domain)}</td>\n        <td>${Te(e.views)}</td>\n        <td>${Math.round(e.engagementTime)}秒</td>\n        <td>${e.avgTimePerView}秒</td>\n      </tr>\n    `).join(""):n&&(n.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}(i.data):Vt()}catch(n){console.error("[Admin] Engagement data error:",n),Vt()}}function Vt(){qt("avg-session-duration","45.2秒"),qt("engagement-rate","68.5%"),qt("bounce-rate","31.5%");const e=document.querySelector("#engagement-company-table tbody");if(e){const t=[{name:"トヨタ自動車",views:1250,time:4500,avg:"3.6"},{name:"日産自動車",views:980,time:3200,avg:"3.3"},{name:"本田技研工業",views:856,time:2800,avg:"3.3"}];e.innerHTML=t.map(e=>`\n      <tr>\n        <td>${e.name}</td>\n        <td>${Te(e.views)}</td>\n        <td>${e.time}秒</td>\n        <td>${e.avg}秒</td>\n      </tr>\n    `).join("")}}async function Ot(e,t){try{const n={},a=f();a&&(n.Authorization=`Bearer ${a}`);const o=Tt(t,{type:"traffic",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?Wt(i.data):Gt()}catch(n){console.error("[Admin] Traffic data error:",n),Gt()}}function Wt(e){const t=document.getElementById("channel-chart");if(t&&e.channels&&e.channels.length>0){St&&(St.destroy(),St=null),t.innerHTML='<canvas id="channel-chart-canvas"></canvas>';const n=document.getElementById("channel-chart-canvas").getContext("2d");St=new Chart(n,{type:"bar",data:{labels:e.channels.map(e=>e.channel),datasets:[{label:"セッション数",data:e.channels.map(e=>e.sessions),backgroundColor:["rgba(99, 102, 241, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},y:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const n=document.querySelector("#source-table tbody");n&&e.sources&&e.sources.length>0?n.innerHTML=e.sources.map(e=>`\n      <tr>\n        <td>${Me(e.source)}</td>\n        <td>${Me(e.medium)}</td>\n        <td>${Te(e.sessions)}</td>\n        <td>${Te(e.users)}</td>\n      </tr>\n    `).join(""):n&&(n.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}function Gt(){Wt({channels:[{channel:"Organic Search",sessions:1250},{channel:"Direct",sessions:890},{channel:"Social",sessions:456},{channel:"Referral",sessions:234}],sources:[{source:"google",medium:"organic",sessions:890,users:756},{source:"(direct)",medium:"(none)",sessions:456,users:412},{source:"yahoo",medium:"organic",sessions:234,users:198}]})}function Yt(e){const t=document.getElementById("funnel-chart");t&&e.funnel&&e.funnel.length>0&&(t.innerHTML=e.funnel.map(e=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${Me(e.stage)}</span>\n        <span class="funnel-stage-count">${Te(e.count)}</span>\n        <span class="funnel-stage-rate">${e.rate}%</span>\n      </div>\n    `).join(""));const n=document.getElementById("action-breakdown-chart");if(n&&e.actionBreakdown&&e.actionBreakdown.length>0){At&&(At.destroy(),At=null),n.innerHTML='<canvas id="action-chart-canvas"></canvas>';const t=document.getElementById("action-chart-canvas").getContext("2d");At=new Chart(t,{type:"bar",data:{labels:e.actionBreakdown.map(e=>e.label),datasets:[{label:"件数",data:e.actionBreakdown.map(e=>e.count),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(245, 158, 11, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},y:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const a=document.querySelector("#company-funnel-table tbody");a&&e.byCompany&&e.byCompany.length>0?a.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${Me(e.domain)}</td>\n        <td>${Te(e.views)}</td>\n        <td>${Te(e.clicks)}</td>\n        <td>${e.cvr}%</td>\n      </tr>\n    `).join(""):a&&(a.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}function Kt(){Yt({funnel:[{stage:"サイト訪問",count:5e3,rate:"100"},{stage:"企業ページ閲覧",count:2500,rate:"50.0"},{stage:"ページスクロール",count:1800,rate:"36.0"},{stage:"アクション",count:150,rate:"6.0"}],actionBreakdown:[{label:"応募ボタン",count:89},{label:"LINE相談",count:45},{label:"フォーム送信",count:16}],byCompany:[{domain:"toyota",views:1250,clicks:89,cvr:"7.1"},{domain:"nissan",views:980,clicks:67,cvr:"6.8"},{domain:"honda",views:856,clicks:54,cvr:"6.3"}]})}function Xt(e){e.insights&&(qt("peak-day",e.insights.peakDay||"-"),qt("peak-hour",e.insights.peakHour||"-"));const t=document.getElementById("day-of-week-chart");if(t&&e.byDayOfWeek&&e.byDayOfWeek.length>0){xt&&(xt.destroy(),xt=null),t.innerHTML='<canvas id="day-of-week-canvas"></canvas>';const n=document.getElementById("day-of-week-canvas").getContext("2d");xt=new Chart(n,{type:"bar",data:{labels:e.byDayOfWeek.map(e=>e.day),datasets:[{label:"セッション数",data:e.byDayOfWeek.map(e=>e.sessions),backgroundColor:"rgba(99, 102, 241, 0.8)",borderColor:"rgba(99, 102, 241, 1)",borderWidth:1,borderRadius:4,barPercentage:.7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6,titleFont:{size:12},bodyFont:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const n=document.getElementById("hour-chart");if(n&&e.byHour&&e.byHour.length>0){Dt&&(Dt.destroy(),Dt=null);const t=[{label:"深夜",hours:[0,1,2,3,4,5]},{label:"朝",hours:[6,7,8,9,10,11]},{label:"昼",hours:[12,13,14,15,16,17]},{label:"夜",hours:[18,19,20,21,22,23]}].map(t=>{const n=t.hours.reduce((t,n)=>{const a=e.byHour.find(e=>e.hour===n);return t+(a?a.sessions:0)},0);return{label:t.label,sessions:n}});n.innerHTML='<canvas id="hour-chart-canvas"></canvas>';const a=document.getElementById("hour-chart-canvas").getContext("2d");Dt=new Chart(a,{type:"bar",data:{labels:t.map(e=>e.label),datasets:[{label:"セッション数",data:t.map(e=>e.sessions),backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1,borderRadius:4,barPercentage:.7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6,titleFont:{size:12},bodyFont:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}}function Zt(){qt("peak-day","木"),qt("peak-hour","14時");Xt({byDayOfWeek:[{day:"日",sessions:380},{day:"月",sessions:270},{day:"火",sessions:245},{day:"水",sessions:244},{day:"木",sessions:250},{day:"金",sessions:278},{day:"土",sessions:358}],byHour:Array.from({length:24},(e,t)=>({hour:t,sessions:Math.floor(50*Math.random())+10}))})}function Qt(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-companies");e&&e.classList.add("active"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector('[data-section="companies"]');t&&t.parentElement.classList.add("active");const n=document.getElementById("page-title");n&&(n.textContent="企業別データ")}function en(e){const t=document.getElementById("detail-daily-chart");if(!t||!e.length)return void(t&&(t.innerHTML='<div class="loading-placeholder">データがありません</div>'));Ct&&(Ct.destroy(),Ct=null),t.innerHTML='<canvas id="detail-daily-canvas"></canvas>';const n=document.getElementById("detail-daily-canvas").getContext("2d");Ct=new Chart(n,{type:"line",data:{labels:e.map(e=>e.date),datasets:[{label:"PV",data:e.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:8,cornerRadius:4}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:10}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:9},maxRotation:45}}}}})}function tn(e){const t=document.getElementById("detail-job-chart");if(!t)return;if(!e.length)return void(t.innerHTML='<div class="loading-placeholder">データがありません</div>');const n=Math.max(...e.map(e=>e.applications));t.innerHTML=`\n    <div class="detail-bar-chart">\n      ${e.slice(0,5).map((e,t)=>{const a=n>0?e.applications/n*100:0;return`\n          <div class="detail-bar-row">\n            <span class="detail-bar-label" title="${Me(e.title)}">${Me(e.title)}</span>\n            <div class="detail-bar-track">\n              <div class="detail-bar-fill job-${t+1}" style="width: ${a}%"></div>\n              <span class="detail-bar-value">${e.applications}件</span>\n            </div>\n          </div>\n        `}).join("")}\n    </div>\n  `}function nn(e){const t=document.getElementById("detail-traffic-chart");if(!t)return;if(!e.length)return void(t.innerHTML='<div class="loading-placeholder">データがありません</div>');const n=e.reduce((e,t)=>e+t.count,0),a=["organic","direct","social","referral"];let o=[],s=0;e.forEach((e,t)=>{const i=e.count/n*100,c=a[t%a.length];o.push(`${{organic:"#10b981",direct:"#6366f1",social:"#f59e0b",referral:"#8b5cf6"}[c]} ${s}deg ${s+3.6*i}deg`),s+=3.6*i}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${e.map((e,t)=>{const o=(e.count/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${a[t%a.length]}"></span>\n              <span class="pie-label">${Me(e.channel)}</span>\n              <span class="pie-value">${o}%</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function an(e){const t=document.getElementById("detail-gender-chart");if(!t)return;const n=e.male+e.female+e.other;if(0===n)return void(t.innerHTML='<div class="loading-placeholder">データがありません</div>');const a=(e.male/n*100).toFixed(1),o=(e.female/n*100).toFixed(1),s=(e.other/n*100).toFixed(1),i=e.male/n*360,c=e.female/n*360;t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(#3b82f6 0deg ${i}deg, #ec4899 ${i}deg ${i+c}deg, #94a3b8 ${i+c}deg 360deg);"></div>\n      <div class="pie-legend">\n        <div class="pie-legend-item">\n          <span class="pie-color male"></span>\n          <span class="pie-label">男性</span>\n          <span class="pie-value">${e.male}人 (${a}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color female"></span>\n          <span class="pie-label">女性</span>\n          <span class="pie-value">${e.female}人 (${o}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color other"></span>\n          <span class="pie-label">その他</span>\n          <span class="pie-value">${e.other}人 (${s}%)</span>\n        </div>\n      </div>\n    </div>\n  `}function on(e){const t=document.getElementById("detail-age-chart");if(!t)return;const n=e["20s"]+e["30s"]+e["40s"]+e["50s"];if(0===n)return void(t.innerHTML='<div class="loading-placeholder">データがありません</div>');const a=[{key:"20s",label:"20代",color:"age-20s",colorCode:"#3b82f6"},{key:"30s",label:"30代",color:"age-30s",colorCode:"#10b981"},{key:"40s",label:"40代",color:"age-40s",colorCode:"#f59e0b"},{key:"50s",label:"50代以上",color:"age-50s",colorCode:"#ef4444"}];let o=[],s=0;a.forEach(t=>{const a=e[t.key]/n*100;o.push(`${t.colorCode} ${s}deg ${s+3.6*a}deg`),s+=3.6*a}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${a.map(t=>{const a=(e[t.key]/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${t.color}"></span>\n              <span class="pie-label">${t.label}</span>\n              <span class="pie-value">${e[t.key]}人 (${a}%)</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function sn(e){const t=document.querySelector("#detail-job-table tbody");t&&(e.length?t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Me(e.title)}</td>\n      <td>${Te(e.views)}</td>\n      <td>${e.applications}</td>\n      <td>${e.cvr}%</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}async function cn(e){const t=s.apiEndpoint,n={},a=f();a&&(n.Authorization=`Bearer ${a}`);try{const a=await fetch(`${t}?type=recent-applications&domain=${e}&limit=10`,{headers:n}),o=await a.json();if(o.success&&o.data&&o.data.applications){ln(o.data.applications.map(e=>({date:e.date,job:e.jobTitle||"-",type:e.type||"apply",source:e.source||"Direct"})))}else ln([])}catch(o){console.error("[Admin] Recent applications error:",o),ln([])}}function ln(e){const t=document.querySelector("#detail-recent-applications tbody");if(!t)return;const n={apply:"応募",line:"LINE",consult:"相談"};e.length?t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Me(e.date)}</td>\n      <td>${Me(e.job)}</td>\n      <td><span class="type-badge ${e.type}">${n[e.type]||e.type}</span></td>\n      <td>${Me(e.source)}</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>'}function rn(){const e=document.getElementById("btn-back-to-companies");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",Qt),e.setAttribute("data-listener-attached","true"))}let dn=[];async function mn(){try{const e=firebase.firestore(),t=await e.collection("applications").orderBy("createdAt","desc").get(),n=[];t.forEach(e=>{n.push({id:e.id,...e.data()})}),dn=n,function(e){const t=document.getElementById("recruitment-alerts");if(!t)return;const n=new Date,a=1728e5,o=e.filter(e=>{var t;if("new"!==e.status&&void 0!==e.status)return!1;const o=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt);return n-o>a});if(0===o.length)return void(t.innerHTML='<div class="no-alerts"><span class="alert-icon">✓</span> 対応が必要なアラートはありません</div>');t.innerHTML=o.map(e=>{var t,a;const o=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),s=Math.floor((n-o)/36e5),i=e.applicantName||(null==(a=e.applicant)?void 0:a.name)||"名前未設定",c=e.companyName||e.companyDomain||"-";return`\n      <div class="alert-card alert-warning">\n        <div class="alert-header">\n          <span class="alert-icon">⚠️</span>\n          <span class="alert-title">${Me(i)} - ${Me(e.jobTitle||"求人未設定")}</span>\n        </div>\n        <div class="alert-body">\n          <p>企業: ${Me(c)}</p>\n          <p>応募から <strong>${s}時間</strong> 経過（初回連絡未完了）</p>\n        </div>\n      </div>\n    `}).join("")}(n),function(e){const t=document.getElementById("recruitment-funnel-chart"),n=document.getElementById("funnel-stats");if(!t)return;const a=document.getElementById("funnel-period"),o=parseInt((null==a?void 0:a.value)||"30"),s=new Date;s.setDate(s.getDate()-o);const i=e.filter(e=>{var t;return((null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt))>=s}),c={total:i.length,new:0,contacted:0,interviewing:0,interviewed:0,hired:0,joined:0};i.forEach(e=>{const t=e.status||"new";["new","contacted","interviewing","interviewed","hired","joined"].includes(t)&&c.new++,["contacted","interviewing","interviewed","hired","joined"].includes(t)&&c.contacted++,["interviewing","interviewed","hired","joined"].includes(t)&&c.interviewing++,["interviewed","hired","joined"].includes(t)&&c.interviewed++,["hired","joined"].includes(t)&&c.hired++,"joined"===t&&c.joined++});const l=[{label:"応募",count:c.new,color:"#3b82f6"},{label:"連絡済",count:c.contacted,color:"#8b5cf6"},{label:"面接",count:c.interviewing+c.interviewed,color:"#f59e0b"},{label:"内定",count:c.hired,color:"#10b981"},{label:"入社",count:c.joined,color:"#059669"}],r=Math.max(...l.map(e=>e.count),1);if(t.innerHTML=`\n    <div class="funnel-stages">\n      ${l.map((e,t)=>{const n=Math.max(e.count/r*100,10),a=0===t?100:l[0].count>0?(e.count/l[0].count*100).toFixed(1):0;return`\n          <div class="funnel-stage">\n            <div class="funnel-label">${e.label}</div>\n            <div class="funnel-bar-wrapper">\n              <div class="funnel-bar" style="width: ${n}%; background: ${e.color};">\n                <span class="funnel-count">${Te(e.count)}</span>\n              </div>\n            </div>\n            <div class="funnel-rate">${a}%</div>\n          </div>\n        `}).join("")}\n    </div>\n  `,n){const e=c.new>0?(c.hired/c.new*100).toFixed(1):0,t=c.hired>0?(c.joined/c.hired*100).toFixed(1):0;n.innerHTML=`\n      <div class="funnel-stat-card">\n        <div class="funnel-stat-value">${e}%</div>\n        <div class="funnel-stat-label">応募→内定率</div>\n      </div>\n      <div class="funnel-stat-card">\n        <div class="funnel-stat-value">${t}%</div>\n        <div class="funnel-stat-label">内定→入社率</div>\n      </div>\n    `}a&&!a.hasAttribute("data-listener-attached")&&(a.addEventListener("change",()=>{mn()}),a.setAttribute("data-listener-attached","true"))}(n),function(e){const t=e.filter(e=>e.statusHistory&&e.statusHistory.length>0),n={firstResponse:[],interviewSetup:[],decision:[],total:[]};t.forEach(e=>{var t,a,o,s,i,c,l;const r=e.statusHistory,d=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),m=r.find(e=>"contacted"===e.status);if(m){const e=(null==(a=m.timestamp)?void 0:a.toDate)?m.timestamp.toDate():new Date(m.timestamp);n.firstResponse.push((e-d)/36e5)}const u=r.find(e=>"interviewing"===e.status);if(m&&u){const e=(null==(o=m.timestamp)?void 0:o.toDate)?m.timestamp.toDate():new Date(m.timestamp),t=(null==(s=u.timestamp)?void 0:s.toDate)?u.timestamp.toDate():new Date(u.timestamp);n.interviewSetup.push((t-e)/864e5)}const p=r.find(e=>"interviewed"===e.status),y=r.find(e=>"hired"===e.status||"ng"===e.status||"rejected"===e.status);if(p&&y){const e=(null==(i=p.timestamp)?void 0:i.toDate)?p.timestamp.toDate():new Date(p.timestamp),t=(null==(c=y.timestamp)?void 0:c.toDate)?y.timestamp.toDate():new Date(y.timestamp);n.decision.push((t-e)/864e5)}const g=r.find(e=>"joined"===e.status);if(g){const e=(null==(l=g.timestamp)?void 0:l.toDate)?g.timestamp.toDate():new Date(g.timestamp);n.total.push((e-d)/864e5)}});const a=e=>e.length>0?e.reduce((e,t)=>e+t,0)/e.length:null,o=a(n.firstResponse),s=a(n.interviewSetup),i=a(n.decision),c=a(n.total),l=(e,t)=>{const n=document.getElementById(e);n&&(n.textContent=t)};l("lead-time-first-response",null!==o?`${o.toFixed(1)}時間`:"-"),l("lead-time-interview-setup",null!==s?`${s.toFixed(1)}日`:"-"),l("lead-time-decision",null!==i?`${i.toFixed(1)}日`:"-"),l("lead-time-total",null!==c?`${c.toFixed(1)}日`:"-")}(n),function(e){const t=document.getElementById("lead-time-distribution-chart");if(!t)return;const n=[];e.forEach(e=>{var t,a;if(!e.statusHistory||0===e.statusHistory.length)return;const o=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),s=e.statusHistory.find(e=>"contacted"===e.status);if(s){const e=(((null==(a=s.timestamp)?void 0:a.toDate)?s.timestamp.toDate():new Date(s.timestamp))-o)/36e5;e>=0&&n.push(e)}});const a=[{label:"0-6h",min:0,max:6,count:0,class:""},{label:"6-12h",min:6,max:12,count:0,class:""},{label:"12-24h",min:12,max:24,count:0,class:"warning"},{label:"24-48h",min:24,max:48,count:0,class:"warning"},{label:"48h+",min:48,max:1/0,count:0,class:"danger"}];n.forEach(e=>{for(const t of a)if(e>=t.min&&e<t.max){t.count++;break}});const o=n.length,s=Math.max(...a.map(e=>e.count),1);if(0===o)return void(t.innerHTML='<div class="no-data">レスポンスデータがまだありません</div>');t.innerHTML=`\n    <div class="distribution-bars">\n      ${a.map(e=>{const t=o>0?(e.count/o*100).toFixed(0):0,n=s>0?Math.max(e.count/s*150,4):4;return`\n          <div class="distribution-bar-group">\n            <div class="distribution-bar ${e.class}" style="height: ${n}px;">\n              <span class="distribution-bar-value">${t}%</span>\n            </div>\n            <div class="distribution-bar-label">${e.label}</div>\n          </div>\n        `}).join("")}\n    </div>\n    <div class="distribution-legend">\n      <div class="distribution-legend-item">\n        <span class="distribution-legend-color good"></span>\n        <span>理想（12h以内）</span>\n      </div>\n      <div class="distribution-legend-item">\n        <span class="distribution-legend-color warning"></span>\n        <span>注意（12-48h）</span>\n      </div>\n      <div class="distribution-legend-item">\n        <span class="distribution-legend-color danger"></span>\n        <span>要改善（48h+）</span>\n      </div>\n    </div>\n  `}(n),function(e){const t=document.querySelector("#assignee-performance-table tbody");if(!t)return;const n={};e.forEach(e=>{var t,a;const o=e.assignee||e.handler||e.担当者||"未割当";n[o]||(n[o]={name:o,total:0,contacted:0,hired:0,joined:0,responseTimes:[]}),n[o].total++;const s=e.status||"new";if(["contacted","interviewing","interviewed","hired","joined"].includes(s)&&n[o].contacted++,["hired","joined"].includes(s)&&n[o].hired++,"joined"===s&&n[o].joined++,e.statusHistory&&e.statusHistory.length>0){const s=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),i=e.statusHistory.find(e=>"contacted"===e.status);if(i){const e=(((null==(a=i.timestamp)?void 0:a.toDate)?i.timestamp.toDate():new Date(i.timestamp))-s)/36e5;e>=0&&n[o].responseTimes.push(e)}}});const a=Object.values(n).map(e=>{const t=e.responseTimes.length>0?e.responseTimes.reduce((e,t)=>e+t,0)/e.responseTimes.length:null,n=e.total>0?e.hired/e.total*100:0,a=e.hired>0?e.joined/e.hired*100:0;return{...e,avgResponse:t,hiringRate:n,acceptanceRate:a}}).sort((e,t)=>t.total-e.total);if(0===a.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">データがありません</td></tr>');const o=e=>null===e?"":e<=12?"performance-good":e<=24?"performance-warning":"performance-danger",s=e=>e>=40?"performance-good":e>=25?"performance-warning":"performance-danger";t.innerHTML=a.map(e=>{const t=null!==e.avgResponse?`${e.avgResponse.toFixed(1)}時間`:"-";return`\n      <tr>\n        <td>${Me(e.name)}</td>\n        <td>${Te(e.total)}</td>\n        <td class="${o(e.avgResponse)}">${t}</td>\n        <td class="${s(e.hiringRate)}">${e.hiringRate.toFixed(1)}%</td>\n        <td class="${s(e.acceptanceRate)}">${e.acceptanceRate.toFixed(1)}%</td>\n      </tr>\n    `}).join("")}(n),function(e){const t=document.querySelector("#company-recruitment-table tbody");if(!t)return;const n={};e.forEach(e=>{const t=e.companyDomain||"unknown",a=e.companyName||e.companyDomain||"不明";n[t]||(n[t]={domain:t,name:a,total:0,interviewing:0,hired:0,joined:0}),n[t].total++;const o=e.status||"new";["interviewing","interviewed"].includes(o)&&n[t].interviewing++,["hired","joined"].includes(o)&&n[t].hired++,"joined"===o&&n[t].joined++});const a=Object.values(n).sort((e,t)=>t.total-e.total);if(0===a.length)return void(t.innerHTML='<tr><td colspan="6" class="loading-cell">データがありません</td></tr>');t.innerHTML=a.map(e=>{const t=e.total>0?(e.hired/e.total*100).toFixed(1):0;return`\n      <tr data-company-domain="${Me(e.domain)}" data-company-name="${Me(e.name)}">\n        <td>${Me(e.name)}</td>\n        <td>${Te(e.total)}</td>\n        <td>${Te(e.interviewing)}</td>\n        <td>${Te(e.hired)}</td>\n        <td>${Te(e.joined)}</td>\n        <td>${t}%</td>\n      </tr>\n    `}).join(""),t.querySelectorAll("tr[data-company-domain]").forEach(e=>{e.addEventListener("click",()=>{!function(e,t){const n=document.getElementById("recruitment-overview-section"),a=document.getElementById("recruitment-detail-section"),o=document.getElementById("recruitment-detail-company-name");if(!n||!a)return;n.style.display="none",a.style.display="block",o&&(o.textContent=t);const s=dn.filter(t=>t.companyDomain===e);(function(e){const t=document.getElementById("company-funnel-chart"),n=document.getElementById("company-funnel-stats");if(!t)return;const a={total:e.length,new:0,contacted:0,interviewing:0,interviewed:0,hired:0,joined:0};e.forEach(e=>{const t=e.status||"new";["new","contacted","interviewing","interviewed","hired","joined"].includes(t)&&a.new++,["contacted","interviewing","interviewed","hired","joined"].includes(t)&&a.contacted++,["interviewing","interviewed","hired","joined"].includes(t)&&a.interviewing++,["interviewed","hired","joined"].includes(t)&&a.interviewed++,["hired","joined"].includes(t)&&a.hired++,"joined"===t&&a.joined++});const o=[{label:"応募",count:a.new,color:"#3b82f6"},{label:"連絡済",count:a.contacted,color:"#8b5cf6"},{label:"面接",count:a.interviewing+a.interviewed,color:"#f59e0b"},{label:"内定",count:a.hired,color:"#10b981"},{label:"入社",count:a.joined,color:"#059669"}],s=Math.max(...o.map(e=>e.count),1);if(t.innerHTML=`\n    <div class="funnel-stages">\n      ${o.map((e,t)=>{const n=Math.max(e.count/s*100,10),a=0===t?100:o[0].count>0?(e.count/o[0].count*100).toFixed(1):0;return`\n          <div class="funnel-stage">\n            <div class="funnel-label">${e.label}</div>\n            <div class="funnel-bar-wrapper">\n              <div class="funnel-bar" style="width: ${n}%; background: ${e.color};">\n                <span class="funnel-count">${Te(e.count)}</span>\n              </div>\n            </div>\n            <div class="funnel-rate">${a}%</div>\n          </div>\n        `}).join("")}\n    </div>\n  `,n){const e=a.new>0?(a.hired/a.new*100).toFixed(1):0,t=a.hired>0?(a.joined/a.hired*100).toFixed(1):0;n.innerHTML=`\n      <div class="funnel-stat-card">\n        <div class="funnel-stat-value">${e}%</div>\n        <div class="funnel-stat-label">応募→内定率</div>\n      </div>\n      <div class="funnel-stat-card">\n        <div class="funnel-stat-value">${t}%</div>\n        <div class="funnel-stat-label">内定→入社率</div>\n      </div>\n    `}})(s),function(e){const t=e.filter(e=>e.statusHistory&&e.statusHistory.length>0),n={firstResponse:[],interviewSetup:[],decision:[],total:[]};t.forEach(e=>{var t,a,o,s,i,c,l;const r=e.statusHistory,d=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),m=r.find(e=>"contacted"===e.status);if(m){const e=(null==(a=m.timestamp)?void 0:a.toDate)?m.timestamp.toDate():new Date(m.timestamp);n.firstResponse.push((e-d)/36e5)}const u=r.find(e=>"interviewing"===e.status);if(m&&u){const e=(null==(o=m.timestamp)?void 0:o.toDate)?m.timestamp.toDate():new Date(m.timestamp),t=(null==(s=u.timestamp)?void 0:s.toDate)?u.timestamp.toDate():new Date(u.timestamp);n.interviewSetup.push((t-e)/864e5)}const p=r.find(e=>"interviewed"===e.status),y=r.find(e=>"hired"===e.status||"ng"===e.status||"rejected"===e.status);if(p&&y){const e=(null==(i=p.timestamp)?void 0:i.toDate)?p.timestamp.toDate():new Date(p.timestamp),t=(null==(c=y.timestamp)?void 0:c.toDate)?y.timestamp.toDate():new Date(y.timestamp);n.decision.push((t-e)/864e5)}const g=r.find(e=>"joined"===e.status);if(g){const e=(null==(l=g.timestamp)?void 0:l.toDate)?g.timestamp.toDate():new Date(g.timestamp);n.total.push((e-d)/864e5)}});const a=e=>e.length>0?e.reduce((e,t)=>e+t,0)/e.length:null,o=a(n.firstResponse),s=a(n.interviewSetup),i=a(n.decision),c=a(n.total),l=(e,t)=>{const n=document.getElementById(e);n&&(n.textContent=t)};l("company-lead-time-first-response",null!==o?`${o.toFixed(1)}時間`:"-"),l("company-lead-time-interview-setup",null!==s?`${s.toFixed(1)}日`:"-"),l("company-lead-time-decision",null!==i?`${i.toFixed(1)}日`:"-"),l("company-lead-time-total",null!==c?`${c.toFixed(1)}日`:"-")}(s),function(e){const t=document.getElementById("company-distribution-chart");if(!t)return;const n=[];e.forEach(e=>{var t,a;if(!e.statusHistory||0===e.statusHistory.length)return;const o=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),s=e.statusHistory.find(e=>"contacted"===e.status);if(s){const e=(((null==(a=s.timestamp)?void 0:a.toDate)?s.timestamp.toDate():new Date(s.timestamp))-o)/36e5;e>=0&&n.push(e)}});const a=[{label:"0-6h",min:0,max:6,count:0,class:""},{label:"6-12h",min:6,max:12,count:0,class:""},{label:"12-24h",min:12,max:24,count:0,class:"warning"},{label:"24-48h",min:24,max:48,count:0,class:"warning"},{label:"48h+",min:48,max:1/0,count:0,class:"danger"}];n.forEach(e=>{for(const t of a)if(e>=t.min&&e<t.max){t.count++;break}});const o=n.length,s=Math.max(...a.map(e=>e.count),1);if(0===o)return void(t.innerHTML='<div class="no-data">レスポンスデータがまだありません</div>');t.innerHTML=`\n    <div class="distribution-bars">\n      ${a.map(e=>{const t=o>0?(e.count/o*100).toFixed(0):0,n=s>0?Math.max(e.count/s*150,4):4;return`\n          <div class="distribution-bar-group">\n            <div class="distribution-bar ${e.class}" style="height: ${n}px;">\n              <span class="distribution-bar-value">${t}%</span>\n            </div>\n            <div class="distribution-bar-label">${e.label}</div>\n          </div>\n        `}).join("")}\n    </div>\n    <div class="distribution-legend">\n      <div class="distribution-legend-item">\n        <span class="distribution-legend-color good"></span>\n        <span>理想（12h以内）</span>\n      </div>\n      <div class="distribution-legend-item">\n        <span class="distribution-legend-color warning"></span>\n        <span>注意（12-48h）</span>\n      </div>\n      <div class="distribution-legend-item">\n        <span class="distribution-legend-color danger"></span>\n        <span>要改善（48h+）</span>\n      </div>\n    </div>\n  `}(s),function(e){const t=document.querySelector("#company-assignee-table tbody");if(!t)return;const n={};e.forEach(e=>{var t,a;const o=e.assignee||e.handler||e.担当者||"未割当";n[o]||(n[o]={name:o,total:0,contacted:0,hired:0,joined:0,responseTimes:[]}),n[o].total++;const s=e.status||"new";if(["contacted","interviewing","interviewed","hired","joined"].includes(s)&&n[o].contacted++,["hired","joined"].includes(s)&&n[o].hired++,"joined"===s&&n[o].joined++,e.statusHistory&&e.statusHistory.length>0){const s=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.createdAt),i=e.statusHistory.find(e=>"contacted"===e.status);if(i){const e=(((null==(a=i.timestamp)?void 0:a.toDate)?i.timestamp.toDate():new Date(i.timestamp))-s)/36e5;e>=0&&n[o].responseTimes.push(e)}}});const a=Object.values(n).map(e=>{const t=e.responseTimes.length>0?e.responseTimes.reduce((e,t)=>e+t,0)/e.responseTimes.length:null,n=e.total>0?e.hired/e.total*100:0,a=e.hired>0?e.joined/e.hired*100:0;return{...e,avgResponse:t,hiringRate:n,acceptanceRate:a}}).sort((e,t)=>t.total-e.total);if(0===a.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">データがありません</td></tr>');const o=e=>null===e?"":e<=12?"performance-good":e<=24?"performance-warning":"performance-danger",s=e=>e>=40?"performance-good":e>=25?"performance-warning":"performance-danger";t.innerHTML=a.map(e=>{const t=null!==e.avgResponse?`${e.avgResponse.toFixed(1)}時間`:"-";return`\n      <tr>\n        <td>${Me(e.name)}</td>\n        <td>${Te(e.total)}</td>\n        <td class="${o(e.avgResponse)}">${t}</td>\n        <td class="${s(e.hiringRate)}">${e.hiringRate.toFixed(1)}%</td>\n        <td class="${s(e.acceptanceRate)}">${e.acceptanceRate.toFixed(1)}%</td>\n      </tr>\n    `}).join("")}(s)}(e.dataset.companyDomain,e.dataset.companyName)})})}(n),function(){const e=document.getElementById("btn-back-to-recruitment-overview");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",un),e.setAttribute("data-listener-attached","true"))}()}catch(e){console.error("[Admin] Failed to load recruitment data:",e);const t=document.getElementById("recruitment-alerts");t&&(t.innerHTML='<div class="error-message">データの読み込みに失敗しました</div>')}}function un(){const e=document.getElementById("recruitment-overview-section"),t=document.getElementById("recruitment-detail-section");e&&(e.style.display="block"),t&&(t.style.display="none")}const pn=Re.pageAnalytics;let yn="all";async function gn(){try{const t=b()?null:h(),{days:n}=Bt(),a=new URLSearchParams({type:"overview",days:n});t&&a.set("company_domain",t),"all"!==yn&&a.set("page_type",yn);const o=new URLSearchParams({type:"overview",days:n});t&&o.set("company_domain",t);const[s,i]=await Promise.all([fetch(`${pn}?${a}`),fetch(`${pn}?${o}`)]),c=await s.json(),l=await i.json();c.success&&(e=c.data,vn("pa-total-views",Te(e.totalPageViews||0)),vn("pa-unique-visitors",Te(e.totalUniqueVisitors||0)),vn("pa-cta-clicks",Te(e.totalCtaClicks||0)),vn("pa-avg-time",function(e){if(!e||e<=0)return"-";const t=Math.round(e);return t>=60?`${Math.floor(t/60)}分${t%60}秒`:`${t}秒`}(e.avgTimeOnPage||0)),function(e){const t=document.getElementById("pa-referrer-chart");if(!t)return;const n=Object.values(e).reduce((e,t)=>e+t,0);if(0===n)return void(t.innerHTML='<div class="no-data">データがありません</div>');const a={google:"Google検索",yahoo:"Yahoo検索",direct:"直接流入",indeed:"Indeed",jobbox:"求人ボックス",internal:"サイト内",twitter:"Twitter/X",facebook:"Facebook",line:"LINE",other:"その他"},o=Object.entries(e).sort((e,t)=>t[1]-e[1]).slice(0,6).map(([e,t])=>{const o=(t/n*100).toFixed(1),s=a[e]||e;return`\n      <div class="referrer-bar-row">\n        <span class="referrer-label">${Me(s)}</span>\n        <div class="referrer-bar-container">\n          <div class="referrer-bar" style="width: ${o}%"></div>\n        </div>\n        <span class="referrer-value">${Te(t)} (${o}%)</span>\n      </div>\n    `}).join("");t.innerHTML=o}(e.byReferrer||{}),function(e){const t=document.getElementById("pa-device-chart");if(!t)return;const n=Object.values(e).reduce((e,t)=>e+t,0);if(0===n)return void(t.innerHTML='<div class="no-data">データがありません</div>');const a={mobile:"モバイル",desktop:"デスクトップ",tablet:"タブレット"},o={mobile:"#6366f1",desktop:"#22c55e",tablet:"#f59e0b"},s=`\n    <div class="device-pie-chart">\n      ${Object.entries(e).sort((e,t)=>t[1]-e[1]).map(([e,t])=>{const s=(t/n*100).toFixed(1),i=a[e]||e;return`\n          <div class="device-item">\n            <div class="device-color" style="background: ${o[e]||"#94a3b8"}"></div>\n            <span class="device-label">${Me(i)}</span>\n            <span class="device-value">${Te(t)} (${s}%)</span>\n          </div>\n        `}).join("")}\n    </div>\n  `;t.innerHTML=s}(e.byDevice||{})),l.success&&function(e){var t,n,a,o,s,i,c,l;const r=(null==(n=null==(t=e.byPageType)?void 0:t.lp)?void 0:n.views)||0,d=(null==(o=null==(a=e.byPageType)?void 0:a.lp)?void 0:o.clicks)||0,m=r>0?(d/r*100).toFixed(1):"0.0";vn("pa-lp-views",Te(r)),vn("pa-lp-clicks",Te(d)),vn("pa-lp-cvr",`${m}%`);const u=(null==(i=null==(s=e.byPageType)?void 0:s.recruit)?void 0:i.views)||0,p=(null==(l=null==(c=e.byPageType)?void 0:c.recruit)?void 0:l.clicks)||0,y=u>0?(p/u*100).toFixed(1):"0.0";vn("pa-recruit-views",Te(u)),vn("pa-recruit-clicks",Te(p)),vn("pa-recruit-cvr",`${y}%`)}(l.data);const r=new URLSearchParams({type:"lp",days:n});t&&r.set("company_domain",t);const d=await fetch(`${pn}?${r}`),m=await d.json();m.success&&function(e){const t=document.querySelector("#pa-lp-table tbody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="6" class="loading-cell">データがありません</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Me(e.companyName||e.companyDomain)}</td>\n      <td>${Me(e.jobTitle||"-")}</td>\n      <td>${Te(e.pageViews||0)}</td>\n      <td>${Te(e.uniqueVisitors||0)}</td>\n      <td>${Te(e.ctaClicks||0)}</td>\n      <td>${e.cvr||"0.0"}%</td>\n    </tr>\n  `).join("")}(m.data);const u=new URLSearchParams({type:"recruit",days:n});t&&u.set("company_domain",t);const p=await fetch(`${pn}?${u}`),y=await p.json();y.success&&function(e){const t=document.querySelector("#pa-recruit-table tbody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">データがありません</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Me(e.companyName||e.companyDomain)}</td>\n      <td>${Te(e.pageViews||0)}</td>\n      <td>${Te(e.uniqueVisitors||0)}</td>\n      <td>${Te(e.ctaClicks||0)}</td>\n      <td>${e.cvr||"0.0"}%</td>\n    </tr>\n  `).join("")}(y.data)}catch(t){console.error("[PageAnalytics] データ読み込みエラー:",t),function(){vn("pa-total-views","-"),vn("pa-unique-visitors","-"),vn("pa-cta-clicks","-"),vn("pa-avg-time","-"),vn("pa-lp-views","-"),vn("pa-lp-clicks","-"),vn("pa-lp-cvr","-"),vn("pa-recruit-views","-"),vn("pa-recruit-clicks","-"),vn("pa-recruit-cvr","-");const e=document.getElementById("pa-referrer-chart");e&&(e.innerHTML='<div class="no-data">データがありません</div>');const t=document.getElementById("pa-device-chart");t&&(t.innerHTML='<div class="no-data">データがありません</div>');const n=document.querySelector("#pa-lp-table tbody");n&&(n.innerHTML='<tr><td colspan="6" class="loading-cell">データがありません</td></tr>');const a=document.querySelector("#pa-recruit-table tbody");a&&(a.innerHTML='<tr><td colspan="5" class="loading-cell">データがありません</td></tr>')}()}var e}function vn(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}let bn=null,fn={},hn=null;async function En(e=null){e&&(hn=e),await async function(){const e=document.getElementById("recruit-company-grid");if(!e)return;try{const t=(await window.JobsLoader.fetchCompanies()).filter(e=>window.JobsLoader.isCompanyVisible(e));if(!b()){const e=h(),n=t.find(t=>t.companyDomain===e);if(n){document.getElementById("recruit-company-select-group").style.display="none";const e=document.getElementById("recruit-back-to-companies");return e&&(e.style.display="none"),void wn(n)}}if(0===t.length)return void(e.innerHTML='<p class="no-data">表示可能な会社がありません</p>');if(e.innerHTML=t.map(e=>`\n      <div class="lp-company-card" data-company-domain="${Me(e.companyDomain||"")}">\n        <div class="lp-company-card-image" style="${e.imageUrl?`background-image: url('${Me(e.imageUrl)}')`:""}">\n          ${e.imageUrl?"":'<span class="no-image-icon">🏢</span>'}\n        </div>\n        <div class="lp-company-card-content">\n          <h4 class="lp-company-card-title">${Me(e.company||"会社名未設定")}</h4>\n          <p class="lp-company-card-domain">${Me(e.companyDomain||"")}</p>\n        </div>\n      </div>\n    `).join(""),e.querySelectorAll(".lp-company-card").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.companyDomain,a=t.find(e=>e.companyDomain===n);a&&wn(a)})}),hn){const e=t.find(e=>e.companyDomain===hn);e&&wn(e),hn=null}}catch(t){console.error("[RecruitSettings] 会社一覧の読み込みエラー:",t),e.innerHTML='<p class="error">会社一覧の読み込みに失敗しました</p>'}}(),function(){const e=document.getElementById("recruit-company-search");e&&e.addEventListener("input",()=>{const t=e.value.toLowerCase();document.querySelectorAll("#recruit-company-grid .lp-company-card").forEach(e=>{var n,a;const o=(null==(n=e.querySelector(".lp-company-card-title"))?void 0:n.textContent.toLowerCase())||"",s=(null==(a=e.dataset.companyDomain)?void 0:a.toLowerCase())||"";e.style.display=o.includes(t)||s.includes(t)?"":"none"})});const t=document.getElementById("recruit-back-to-companies");t&&!t.hasAttribute("data-listener-attached")&&(t.addEventListener("click",()=>{bn=null,fn={},document.getElementById("recruit-company-select-group").style.display="block",document.getElementById("recruit-editor").style.display="none";const e=document.getElementById("recruit-url-display");e&&(e.style.display="none")}),t.setAttribute("data-listener-attached","true"));const n=document.getElementById("btn-save-recruit-settings");n&&n.addEventListener("click",async()=>{bn&&await ze(bn.companyDomain,e=>{fn=e})});const a=document.getElementById("btn-reset-recruit-settings");a&&a.addEventListener("click",async()=>{await He("設定をリセットしますか？","未保存の変更は失われます。")&&bn&&(Ne(fn,bn.company,bn.description,bn.imageUrl),Je())});const o=document.getElementById("btn-add-custom-link");o&&o.addEventListener("click",()=>{Ve()});const s=document.getElementById("btn-open-template-selector");s&&s.addEventListener("click",()=>{Oe()});const i=document.getElementById("btn-copy-recruit-url");i&&i.addEventListener("click",()=>{const e=document.getElementById("recruit-embed-url");e&&e.value&&In(e.value)});document.querySelectorAll("#recruit-embed-banners .btn-copy-banner").forEach(e=>{e.addEventListener("click",()=>{if(!bn)return;const t=function(e,t,n){const a=`${window.location.origin}/company-recruit.html?id=${encodeURIComponent(t)}`,o=Me(n||"");switch(e){case"button":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:12px 24px;background:#0ea5e9;color:#fff;text-decoration:none;border-radius:6px;font-weight:bold;font-size:14px;">採用情報はこちら</a>`;case"button-large":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:16px 32px;background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;text-decoration:none;border-radius:8px;font-weight:bold;font-size:16px;box-shadow:0 4px 14px rgba(14,165,233,0.4);">採用情報はこちら →</a>`;case"card":return`<a href="${a}" target="_blank" rel="noopener" style="display:block;max-width:300px;padding:20px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;text-decoration:none;box-shadow:0 2px 8px rgba(0,0,0,0.08);"><span style="display:block;font-size:12px;color:#6b7280;margin-bottom:4px;">採用情報</span><span style="display:block;font-size:16px;font-weight:bold;color:#1f2937;">${o} 採用情報はこちら</span><span style="display:block;margin-top:8px;color:#0ea5e9;font-size:14px;">詳しく見る →</span></a>`;case"recruiting":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:16px 28px;background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;text-decoration:none;border-radius:8px;text-align:center;box-shadow:0 4px 14px rgba(249,115,22,0.4);"><span style="display:block;font-size:12px;font-weight:500;">ただいま</span><span style="display:block;font-size:18px;font-weight:bold;">求人募集中！</span></a>`;case"special":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:20px 32px;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;text-decoration:none;border-radius:12px;text-align:center;box-shadow:0 4px 20px rgba(99,102,241,0.4);"><span style="display:block;font-size:14px;font-weight:500;">採用特設ページ</span><span style="display:block;font-size:20px;font-weight:bold;margin-top:4px;">公開中！！</span></a>`;default:return""}}(e.dataset.banner,bn.companyDomain,bn.company);In(t)})}),w({toggleContainerSelector:".preview-device-toggle",previewPanelSelector:"#recruit-preview-panel"}),j([{selector:"#recruit-hero-title",maxLength:40},{selector:"#recruit-hero-subtitle",maxLength:80},{selector:"#recruit-cta-title",maxLength:30},{selector:"#recruit-meta-title",maxLength:60},{selector:"#recruit-meta-description",maxLength:160}]),I("#recruit-settings-form",["recruit-hero-title"]),B("recruit-autosave-indicator")}(),function(){const e=document.getElementById("recruit-layout-style-grid");if(!e)return;e.innerHTML=We.map((e,t)=>`\n    <label class="layout-option">\n      <input type="radio" name="recruit-layout-style" value="${Me(e.id)}" ${0===t?"checked":""}>\n      <div class="layout-preview" style="position: relative;">\n        <div class="template-color-preview" style="\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          width: 24px;\n          height: 24px;\n          border-radius: 4px;\n          background: ${e.color};\n          border: 2px solid rgba(255,255,255,0.8);\n          box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n        "></div>\n        <span class="layout-name">${Me(e.name)}</span>\n        <span class="layout-desc">${Me(e.description)}</span>\n        <span class="layout-industries" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">${e.industries.join(" / ")}</span>\n      </div>\n    </label>\n  `).join(""),e.querySelectorAll('input[name="recruit-layout-style"]').forEach(e=>{e.addEventListener("change",()=>{Je()})})}(),_e(),Pe(),Ue(),Fe()}async function wn(e){bn=e,document.getElementById("recruit-company-select-group").style.display="none",document.getElementById("recruit-editor").style.display="block",document.getElementById("recruit-selected-company-name").textContent=e.company,function(e){const t=document.getElementById("recruit-url-display"),n=document.getElementById("recruit-url-link");if(!t||!n)return;const a=`${window.location.origin}/company-recruit.html?id=${encodeURIComponent(e)}`;n.href=a,n.textContent=a,t.style.display="block";const o=document.getElementById("recruit-embed-url");o&&(o.value=a)}(e.companyDomain),Ge(e.companyDomain),Ye(e.companyDomain),Ke(e.companyDomain),jn(!0);try{fn=await tt(e.companyDomain)||{},Object.keys(fn).length>0?Xe(fn,e.company):Ze(e.company,e.description,e.imageUrl),await async function(e){try{const t=e.manageSheetUrl||e.jobsSheet;if(!t)return void et([]);const n=await window.JobsLoader.fetchCompanyJobs(t);if(!(null==n?void 0:n.length))return void et([]);const a=n.filter(e=>"false"!==e.visible&&"FALSE"!==e.visible).filter(e=>window.JobsLoader.isJobInPublishPeriod(e)).sort((e,t)=>(parseInt(e.order)||999)-(parseInt(t.order)||999));et(a)}catch(t){console.error("[RecruitSettings] 求人データ読み込みエラー:",t),et([])}}(e),Qe(),L({containerId:"recruit-form-progress",fillId:"recruit-progress-fill",countId:"recruit-progress-count",totalSections:12,checkComplete:()=>{var e,t,n,a,o;let s=0;return s++,document.querySelector("#recruit-layout-style-grid .template-option.selected")&&s++,((null==(e=document.getElementById("recruit-header-logo"))?void 0:e.value)||(null==(t=document.getElementById("recruit-header-company-name"))?void 0:t.value))&&s++,(null==(n=document.getElementById("recruit-hero-title"))?void 0:n.value)&&s++,(null==(a=document.getElementById("recruit-company-intro"))?void 0:a.value)&&s++,s++,(null==(o=document.getElementById("recruit-cta-title"))?void 0:o.value)&&s++,s++,s++,s++,s++,s++,s}})}finally{jn(!1)}}function jn(e){const t=document.getElementById("recruit-editor");if(!t)return;t.querySelectorAll("input, select, textarea, button").forEach(t=>{t.disabled=e});const n=document.getElementById("btn-save-recruit-settings"),a=document.getElementById("btn-reset-recruit-settings");n&&(n.disabled=e),a&&(a.disabled=e);const o=t.querySelector(".recruit-loading-overlay");if(e){if(!o){const e=document.createElement("div");e.className="recruit-loading-overlay",e.innerHTML='<div class="loading-spinner"></div><p>読み込み中...</p>',t.style.position="relative",t.appendChild(e)}}else null==o||o.remove()}async function In(t){try{await navigator.clipboard.writeText(t);const{showToast:n}=await e(async()=>{const{showToast:e}=await import("./utils-BNVq905i.js");return{showToast:e}},[]);n("コピーしました","success")}catch(n){console.error("クリップボードへのコピーに失敗:",n);const{showToast:t}=await e(async()=>{const{showToast:e}=await import("./utils-BNVq905i.js");return{showToast:e}},[]);t("コピーに失敗しました","error")}}let Bn=[],Ln=[],$n=[],kn=null;async function xn(e=null){await t(),e&&(kn=e),await Dn(),function(){const e=document.getElementById("job-company-filter");e&&e.addEventListener("change",Sn);const t=document.getElementById("job-status-filter");t&&t.addEventListener("change",Sn);const n=document.getElementById("job-search-input");n&&n.addEventListener("input",function(e,t){let n;return function(...a){const o=()=>{clearTimeout(n),e(...a)};clearTimeout(n),n=setTimeout(o,t)}}(Sn,300));const a=document.getElementById("job-sort-select");a&&a.addEventListener("change",Sn)}()}async function Dn(){const e=document.getElementById("job-listings-container");if(e)try{if(Ln=await n(),Bn=await a(),!b()){const e=h();e&&(Bn=Bn.filter(t=>t.companyDomain===e))}if(function(){const e=document.getElementById("job-company-filter");if(!e)return;if(!b()){const t=e.closest(".filter-group")||e.parentElement;return void(t&&(t.style.display="none"))}const t=Ln.filter(e=>o(e));e.innerHTML='<option value="">すべての会社</option>',t.forEach(t=>{const n=document.createElement("option");n.value=t.companyDomain||"",n.textContent=t.company||"会社名未設定",e.appendChild(n)})}(),kn){const e=document.getElementById("job-company-filter");e&&(e.value=kn),kn=null}!function(){const e=document.getElementById("summary-total-jobs"),t=document.getElementById("summary-active-jobs"),n=document.getElementById("summary-draft-jobs"),a=document.getElementById("summary-companies");e&&(e.textContent=Bn.length.toString());let o=0,s=0;Bn.forEach(e=>{const t=$(e);"active"===t&&o++,"draft"===t&&s++}),t&&(t.textContent=o.toString());n&&(n.textContent=s.toString());const i=new Set(Bn.map(e=>e.companyDomain));a&&(a.textContent=i.size.toString())}(),Sn()}catch(t){console.error("求人一覧の読み込みエラー:",t),e.innerHTML='<div class="error-message">データの読み込みに失敗しました</div>'}}function Sn(){var e,t,n,a,o;const s=(null==(e=document.getElementById("job-company-filter"))?void 0:e.value)||"",i=(null==(t=document.getElementById("job-status-filter"))?void 0:t.value)||"",r=(null==(a=null==(n=document.getElementById("job-search-input"))?void 0:n.value)?void 0:a.toLowerCase())||"",d=(null==(o=document.getElementById("job-sort-select"))?void 0:o.value)||"id";$n=Bn.filter(e=>{if(s&&e.companyDomain!==s)return!1;if(i){if($(e)!==i)return!1}if(r){if(![e.title||"",e.company||"",e.location||"",e.area||""].join(" ").toLowerCase().includes(r))return!1}return!0}),function(e,t){e.sort((e,n)=>{switch(t){case"id":const t=parseInt(e.id,10),a=parseInt(n.id,10);return isNaN(t)||isNaN(a)?(e.id||"").localeCompare(n.id||""):t-a;case"company":return(e.company||"").localeCompare(n.company||"");case"title":return(e.title||"").localeCompare(n.title||"");case"updated":return new Date(n.updatedAt||0)-new Date(e.updatedAt||0);case"applications":return(n.applicationCount||0)-(e.applicationCount||0);default:return 0}})}($n,d),function(e){const t=document.getElementById("job-listings-container");if(!t)return;if(0===e.length)return void(t.innerHTML='<div class="no-data">条件に一致する求人がありません</div>');const n={};e.forEach(e=>{const t=e.companyDomain||"unknown";n[t]||(n[t]={company:e.company||"会社名未設定",companyDomain:t,jobs:[]}),n[t].jobs.push(e)});let a="";Object.values(n).forEach(e=>{a+=function(e){const t=Ln.find(t=>t.companyDomain===e.companyDomain),n=(null==t?void 0:t.logoUrl)||(null==t?void 0:t.imageUrl)||"";return`\n    <div class="job-listings-company-group">\n      <div class="job-listings-company-header">\n        <div class="company-logo-small">\n          ${n?`<img src="${Me(n)}" alt="${Me(e.company)}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><span class="logo-fallback" style="display:none">🏢</span>`:'<span class="logo-fallback">🏢</span>'}\n        </div>\n        <div class="company-info">\n          <h4 class="company-name">${Me(e.company)}</h4>\n          <span class="company-job-count">${e.jobs.length}件の求人</span>\n        </div>\n        <button class="btn-view-company" data-domain="${Me(e.companyDomain)}" title="会社詳細を見る">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>\n        </button>\n      </div>\n      <div class="job-listings-cards">\n        ${e.jobs.map(e=>function(e){const t=$(e),n={active:"掲載中",draft:"下書き",expired:"期限切れ"}[t],a={active:"status-active",draft:"status-draft",expired:"status-expired"}[t],o=e.jobLogo||e.imageUrl||"",s=e.memo&&e.memo.trim();return`\n    <div class="job-listing-card" data-job-id="${Me(e.id||"")}" data-company-domain="${Me(e.companyDomain||"")}" ${s?`data-memo="${Me(e.memo)}"`:""}>\n      <div class="job-card-image">\n        ${o?`<img src="${Me(o)}" alt="${Me(e.title||"")}" onerror="this.style.display='none';this.parentElement.classList.add('no-image')">`:'<span class="no-image-icon">📄</span>'}\n      </div>\n      <div class="job-card-content">\n        <div class="job-card-header">\n          <h5 class="job-card-title">${Me(e.title||"求人タイトル未設定")}</h5>\n          <span class="job-card-status ${a}">${n}</span>\n        </div>\n        <div class="job-card-meta">\n          ${e.location?`<span class="job-meta-item"><span class="meta-icon">📍</span>${Me(e.location)}</span>`:""}\n          ${e.monthlySalary?`<span class="job-meta-item"><span class="meta-icon">💰</span>${Me(e.monthlySalary)}</span>`:""}\n        </div>\n        <div class="job-card-stats">\n          <span class="stat-item" title="応募数">📝 ${e.applicationCount||0}</span>\n          <span class="stat-item" title="閲覧数">👁 ${e.viewCount||0}</span>\n        </div>\n      </div>\n      <div class="job-card-actions">\n        ${s?'<button class="btn-job-action btn-memo-icon" data-tooltip="メモを表示"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"/></svg></button>':""}\n        <button class="btn-job-action btn-edit-job" data-tooltip="編集">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n        </button>\n        <button class="btn-job-action btn-preview-job" data-tooltip="プレビュー">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>\n        </button>\n        <button class="btn-job-action btn-duplicate-job" data-tooltip="複製">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n        </button>\n      </div>\n    </div>\n  `}(e)).join("")}\n      </div>\n    </div>\n  `}(e)}),t.innerHTML=a,document.querySelectorAll(".job-listing-card").forEach(e=>{e.addEventListener("click",t=>{if(t.target.closest(".btn-job-action")||t.target.closest(".btn-view-company"))return;const n=e.dataset.jobId,a=e.dataset.companyDomain;n&&a&&An(a,n)})}),document.querySelectorAll(".btn-edit-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;a&&o&&An(o,a)})}),document.querySelectorAll(".btn-preview-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;if(a&&o){const e=`lp.html?j=${o}_${a}`;window.open(e,"_blank")}})}),document.querySelectorAll(".btn-view-company").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.domain;n&&function(e){var t;const n=Ln.find(t=>t.companyDomain===e);if(null==(t=window.AdminDashboard)?void 0:t.navigateToJobManage)window.AdminDashboard.navigateToJobManage(e,(null==n?void 0:n.company)||e,"job-listings");else{const t=document.querySelector('[data-section="company-manage"]');t&&t.click(),setTimeout(()=>{const t=new CustomEvent("openCompanyJobs",{detail:{companyDomain:e}});document.dispatchEvent(t)},100)}}(n)})}),document.querySelectorAll(".btn-memo-icon").forEach(e=>{e.addEventListener("click",t=>{var n,a;t.stopPropagation();const o=e.closest(".job-listing-card"),s=null==o?void 0:o.dataset.memo;null==(a=null==(n=null==o?void 0:o.querySelector(".job-card-title"))?void 0:n.textContent)||a.replace(/\s+/g," ").trim(),s&&function(e,t,n){const a=document.querySelector(".memo-popup");a&&a.remove();const o=document.createElement("div");o.className="memo-popup",o.innerHTML=`\n    <div class="memo-popup-header">\n      <span class="memo-popup-title">📝 メモ</span>\n      <button class="memo-popup-close" aria-label="閉じる">&times;</button>\n    </div>\n    <div class="memo-popup-content">${Me(e)}</div>\n  `,document.body.appendChild(o);const s=n.getBoundingClientRect(),i=o.getBoundingClientRect();let c=s.bottom+8,l=s.left-i.width/2+s.width/2;l<10&&(l=10),l+i.width>window.innerWidth-10&&(l=window.innerWidth-i.width-10),c+i.height>window.innerHeight-10&&(c=s.top-i.height-8),o.style.top=`${c}px`,o.style.left=`${l}px`,o.querySelector(".memo-popup-close").addEventListener("click",()=>{o.remove()});const r=e=>{o.contains(e.target)||e.target===n||(o.remove(),document.removeEventListener("click",r))};setTimeout(()=>{document.addEventListener("click",r)},0);const d=e=>{"Escape"===e.key&&(o.remove(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d)}(s,0,e)})}),document.querySelectorAll(".btn-duplicate-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;a&&o&&async function(e,t){const n=Bn.find(n=>n.companyDomain===e&&String(n.id)===String(t));if(n){if(confirm(`「${n.title||"求人"}」を複製しますか？`))try{const t={...n};delete t.id,delete t._docId,delete t.createdAt,delete t.updatedAt,t.title=`${n.title||"求人"} (コピー)`,t.visible=!1,t.applicationCount=0,t.viewCount=0,c();const a=await l(e,t,null);console.log("[JobListings] 複製結果:",a),qe("求人を複製しました","success"),await Dn()}catch(a){console.error("求人複製エラー:",a),qe("求人の複製に失敗しました","error")}}else qe("求人が見つかりません","error")}(o,a)})}),document.querySelectorAll(".btn-job-action[data-tooltip]").forEach(e=>{e.addEventListener("mouseenter",Cn),e.addEventListener("mouseleave",Tn)})}($n);const m=document.getElementById("job-listings-total");m&&(m.textContent=$n.length.toString())}function An(e,t){var n;const a=Ln.find(t=>t.companyDomain===e);(null==(n=window.AdminDashboard)?void 0:n.navigateToJobManage)?window.AdminDashboard.navigateToJobManage(e,(null==a?void 0:a.company)||e,"job-listings",t):window.location.href=`job-manage.html?domain=${encodeURIComponent(e)}&job=${encodeURIComponent(t)}`}function Cn(e){const t=e.currentTarget,n=t.dataset.tooltip;if(!n)return;Tn();const a=document.createElement("div");a.className="action-tooltip",a.textContent=n,a.id="action-tooltip-active",document.body.appendChild(a);const o=t.getBoundingClientRect(),s=a.getBoundingClientRect();let i=o.bottom+6,c=o.left+o.width/2-s.width/2;c<8&&(c=8),c+s.width>window.innerWidth-8&&(c=window.innerWidth-s.width-8),a.style.top=`${i}px`,a.style.left=`${c}px`}function Tn(){const e=document.getElementById("action-tooltip-active");e&&e.remove()}let Mn={domain:null,name:null},Hn=null,qn=null,Rn=null,_n=!1,Pn=null;function Un(e,t){Mn.domain=e,Mn.name=t}function Fn(){_n=!1}const zn={interval:3e4,prefix:"admin_draft",showRestorePrompt:!0,onSave:null,onRestore:null},Nn=new Map;function Jn(e,t){for(const[n,a]of Object.entries(t)){e.querySelectorAll(`[name="${n}"]`).forEach(e=>{"checkbox"===e.type?e.checked=!0===a||"on"===a||a===e.value:"radio"===e.type?e.checked=e.value===a:"SELECT"===e.tagName&&Array.isArray(a)?Array.from(e.options).forEach(e=>{e.selected=a.includes(e.value)}):e.value=a,e.dispatchEvent(new Event("change",{bubbles:!0}))})}}function Vn(e){try{const t=localStorage.getItem(e);if(!t)return null;const n=JSON.parse(t),a=864e5;return Date.now()-n.savedAt>a?(localStorage.removeItem(e),null):n}catch(t){return console.warn("下書き取得に失敗:",t),null}}function On(e,t,n=null,a={}){if(!e)return{cleanup:()=>{},save:()=>{},clear:()=>{},restore:()=>!1};const o={...zn,...a},s=function(e,t,n){return`${n}_${e}_${t||"new"}`}(t,n,o.prefix);Nn.has(s)&&Nn.get(s).cleanup();let i=null,c=null;const l=()=>{const t=function(e){const t=new FormData(e),n={};for(const[a,o]of t.entries())void 0!==n[a]?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(o)):n[a]=o;return e.querySelectorAll('input[type="checkbox"]').forEach(e=>{t.has(e.name)||(n[e.name]=!1)}),n}(e),n=JSON.stringify(t);if(n===c)return!1;const a=function(e,t){try{const n={data:t,savedAt:Date.now()};return localStorage.setItem(e,JSON.stringify(n)),!0}catch(n){return console.warn("下書き保存に失敗:",n),!1}}(s,t);return a&&(c=n,o.onSave&&o.onSave(t)),a},r=()=>{!function(e){try{localStorage.removeItem(e)}catch(t){console.warn("下書き削除に失敗:",t)}}(s),c=null},d=()=>{i||(i=setInterval(()=>{l()},o.interval),e.addEventListener("submit",r))},m=()=>{i&&(clearInterval(i),i=null)};d();const u={cleanup:()=>{m(),e.removeEventListener("submit",r),Nn.delete(s)},save:l,clear:r,restore:async()=>{const t=Vn(s);if(!t)return!1;if(o.showRestorePrompt){const e=new Date(t.savedAt).toLocaleString("ja-JP");if(!(await nt({title:"下書きの復元",message:`${e} に保存された下書きがあります。復元しますか？`,confirmText:"復元する",cancelText:"破棄する"})))return r(),!1}return Jn(e,t.data),o.onRestore&&o.onRestore(t.data),qe("下書きを復元しました","info"),!0},silentRestore:()=>{const t=Vn(s);return!!t&&(Jn(e,t.data),o.onRestore&&o.onRestore(t.data),!0)},start:d,stop:m};return Nn.set(s,u),u}let Wn=!1,Gn=null,Yn=!1,Kn=!1,Xn=null,Zn=!1,Qn=null,ea=null,ta={},na=null,aa=null,oa=null,sa=[];async function ia(e,t,n=null){if(Kn)console.log("[JobManageEmbedded] 初期化中のため無視:",e);else{Kn=!0;try{Gn!==e&&(Wn=!1,Gn=e,k(!1),x()),D(e,t,null);const a=document.getElementById("jm-company-name"),o=document.getElementById("jm-company-domain");a&&(a.textContent=t),o&&(o.textContent=e),Yn||(!function(){var e,t,n,a,o,s,i,c,l,r,d,m,u,p,y,g,v,b,f,h,E,w,j,I,B,L,$,k,D;document.querySelectorAll("#jm-tabs .jm-tab").forEach(e=>{e.addEventListener("click",()=>{ba(e.dataset.tab)})}),null==(e=document.getElementById("jm-btn-add-job"))||e.addEventListener("click",ma),null==(t=document.getElementById("jm-btn-refresh"))||t.addEventListener("click",ca),null==(n=document.getElementById("jm-job-edit-back-btn"))||n.addEventListener("click",ya),null==(a=document.getElementById("jm-job-edit-cancel-btn"))||a.addEventListener("click",ya),null==(o=document.getElementById("jm-job-edit-delete-btn"))||o.addEventListener("click",va),null==(s=document.getElementById("jm-job-edit-form"))||s.addEventListener("submit",e=>{e.preventDefault(),ga()});const A=document.getElementById("jm-job-search"),C=document.getElementById("jm-job-filter-status"),T=document.getElementById("jm-job-filter-area"),M=document.getElementById("jm-btn-clear-filters");if(A){let e;A.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{S.search=A.value.trim(),la()},300)})}C&&C.addEventListener("change",()=>{S.status=C.value,la()});T&&T.addEventListener("change",()=>{S.area=T.value,la()});M&&M.addEventListener("click",()=>{x(),A&&(A.value=""),C&&(C.value=""),T&&(T.value=""),la()});null==(i=document.getElementById("jm-btn-download-indeed"))||i.addEventListener("click",()=>Da("indeed")),null==(c=document.getElementById("jm-btn-download-google"))||c.addEventListener("click",()=>Da("google")),null==(l=document.getElementById("jm-btn-download-jobbox"))||l.addEventListener("click",()=>Da("jobbox")),null==(r=document.getElementById("jm-btn-download-csv"))||r.addEventListener("click",()=>Da("csv")),null==(d=document.getElementById("jm-edit-job-salary-type"))||d.addEventListener("change",$a),null==(m=document.getElementById("jm-btn-add-working-hours"))||m.addEventListener("click",xa),ka(),z({featuresGridId:pa.featuresGridId,displayedContainerId:pa.containerId,checkboxName:pa.checkboxName,onWarning:pa.onWarning}),null==(u=document.getElementById("jm-edit-job-logo"))||u.addEventListener("input",ja),null==(p=document.getElementById("jm-btn-clear-logo"))||p.addEventListener("click",Ia),null==(y=document.getElementById("jm-btn-upload-logo"))||y.addEventListener("click",Ba),null==(g=document.getElementById("jm-edit-job-show-video"))||g.addEventListener("change",La),Ea(),null==(v=document.getElementById("jm-btn-calendar-settings"))||v.addEventListener("click",Sa),null==(b=document.getElementById("jm-calendar-settings-close"))||b.addEventListener("click",Aa),null==(f=document.getElementById("jm-calendar-settings-close-btn"))||f.addEventListener("click",Aa),null==(h=document.getElementById("jm-calendar-settings-modal"))||h.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&Aa()}),null==(E=document.getElementById("jm-btn-schedule-interview"))||E.addEventListener("click",Ma),null==(w=document.getElementById("jm-interview-modal-close"))||w.addEventListener("click",Ha),null==(j=document.getElementById("jm-interview-modal-cancel"))||j.addEventListener("click",Ha),null==(I=document.getElementById("jm-interview-modal-save"))||I.addEventListener("click",Pa),null==(B=document.getElementById("jm-interview-modal"))||B.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&Ha()}),null==(L=document.getElementById("jm-interview-staff"))||L.addEventListener("change",qa),null==($=document.getElementById("jm-btn-prev-week"))||$.addEventListener("click",()=>_a(-1)),null==(k=document.getElementById("jm-btn-next-week"))||k.addEventListener("click",()=>_a(1)),function(){const e=document.getElementById("jm-btn-sort-mode"),t=document.getElementById("jm-btn-save-sort"),n=document.getElementById("jm-btn-cancel-sort");e&&e.addEventListener("click",Ja);t&&t.addEventListener("click",Oa);n&&n.addEventListener("click",()=>Va(!0))}(),null==(D=document.getElementById("jm-btn-load-analytics"))||D.addEventListener("click",fa),Ea()}(),Yn=!0);const s=Rn;Rn=null,n?(!function(){Xn=null,Zn=!1,A("jm-edit-job");const e=document.getElementById("jm-job-edit-title"),t=document.getElementById("jm-job-edit-badge");e&&(e.textContent="読み込み中...");t&&(t.textContent="編集",t.classList.add("edit"));const n=document.getElementById("jm-job-edit-delete-btn");n&&(n.style.display="none");const a=document.getElementById("jm-job-edit-save-btn");a&&(a.disabled=!0);ba("job-edit")}(),await ca(),ua(n)):s?(ba(s),["jobs","analytics","reports"].includes(s)&&await ca()):(ba("jobs"),await ca()),Wn=!0}finally{Kn=!1}}}async function ca(){const e=document.getElementById("jm-jobs-list");e&&(e.innerHTML='<div class="job-cards-loading">データを読み込み中...</div>'),Pn&&Pn.abort(),Pn=new AbortController;try{c();const e=await r(C);if(!e.success)throw new Error(e.error||"求人データの取得に失敗しました");T(e.jobs||[]),function(e){const t=document.getElementById("jm-job-filter-area");if(!t)return;const n=[...new Set(e.map(e=>e.area).filter(Boolean))];t.innerHTML='<option value="">全エリア</option>',n.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}(M),la(),Fa(),Pn=null}catch(t){if("AbortError"===t.name)return void console.log("[JobManageEmbedded] リクエストがキャンセルされました");console.error("[JobManageEmbedded] 求人データ読み込みエラー:",t),e&&(e.innerHTML=`<div class="error-message">データの読み込みに失敗しました: ${Me(t.message)}</div>`)}}function la(){const e=document.getElementById("jm-jobs-list"),t=document.getElementById("jm-jobs-count");if(!e)return;let n=M.filter(e=>{var t;if(S.search&&!(null==(t=e.title)?void 0:t.toLowerCase().includes(S.search.toLowerCase())))return!1;if(S.status){const t=$(e);if("published"===S.status&&"active"!==t)return!1;if("draft"===S.status&&"draft"!==t)return!1;if("expired"===S.status&&"expired"!==t)return!1}return!S.area||e.area===S.area});n.sort((e,t)=>(parseInt(e.order)||999)-(parseInt(t.order)||999)),t&&(t.textContent=n.length.toString()),0!==n.length?(e.innerHTML=n.map(e=>function(e){const t=$(e),n=O(t),a=V(t),o=parseInt(e.order)||999,s=e.jobLogo||e.imageUrl||"";return`\n    <div class="job-listing-card" data-job-id="${Me(e.id||"")}" data-order="${o}" draggable="false">\n      <span class="job-card-drag-handle" title="ドラッグして並び替え">☰</span>\n      <span class="job-order-badge">${o<999?o:"-"}</span>\n      <div class="job-card-image">\n        ${s?`<img src="${Me(s)}" alt="${Me(e.title||"")}" onerror="this.style.display='none';this.parentElement.classList.add('no-image')">`:'<span class="no-image-icon">📄</span>'}\n      </div>\n      <div class="job-card-content">\n        <div class="job-card-header">\n          <h5 class="job-card-title">${Me(e.title||"求人タイトル未設定")}</h5>\n          <span class="job-card-status ${a}">${n}</span>\n        </div>\n        <div class="job-card-meta">\n          ${e.location||e.area?`<span class="job-meta-item"><span class="meta-icon">📍</span>${Me(e.area||e.location)}</span>`:""}\n          ${e.monthlySalary?`<span class="job-meta-item"><span class="meta-icon">💰</span>${Me(e.monthlySalary)}</span>`:""}\n          ${e.jobType?`<span class="job-meta-item"><span class="meta-icon">💼</span>${Me(e.jobType)}</span>`:""}\n          ${e.employmentType?`<span class="job-meta-item"><span class="meta-icon">👤</span>${Me(e.employmentType)}</span>`:""}\n        </div>\n        <div class="job-card-stats">\n          <span class="stat-item" title="応募数">📝 ${e.applicationCount||0}</span>\n          <span class="stat-item" title="閲覧数">👁 ${e.viewCount||0}</span>\n        </div>\n      </div>\n      <div class="job-card-actions">\n        <button class="btn-job-action btn-edit-job" title="編集">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n        </button>\n        <button class="btn-job-action btn-duplicate-job" title="複製">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n        </button>\n        <button class="btn-job-action btn-preview-job" title="プレビュー">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>\n        </button>\n      </div>\n    </div>\n  `}(e)).join(""),document.querySelectorAll("#jm-jobs-list .btn-edit-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId;a&&ua(a)})}),document.querySelectorAll("#jm-jobs-list .btn-preview-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId;a&&window.open(`lp.html?j=${C}_${a}`,"_blank")})}),document.querySelectorAll("#jm-jobs-list .btn-duplicate-job").forEach(e=>{e.addEventListener("click",async t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId;a&&await async function(e){const t=M.find(t=>String(t.id)===String(e)||String(t._docId)===String(e));if(t){if(await nt({title:"求人の複製",message:`「${t.title||"求人"}」を複製しますか？`,confirmText:"複製する",cancelText:"キャンセル"}))try{const e={...t};delete e.id,delete e._docId,delete e.createdAt,delete e.updatedAt,e.title=`${t.title||"求人"} (コピー)`,e.visible="false",e.applicationCount=0,e.viewCount=0,c();const n=await l(C,e,null);if(!n.success)throw new Error(n.error||"複製に失敗しました");qe("求人を複製しました","success"),await ca(),n.jobId&&ua(n.jobId)}catch(n){console.error("[JobManageEmbedded] 求人複製エラー:",n),qe("求人の複製に失敗しました: "+n.message,"error")}}else qe("求人が見つかりません","error")}(a)})}),document.querySelectorAll("#jm-jobs-list .job-listing-card").forEach(e=>{e.addEventListener("click",t=>{if(t.target.closest(".btn-job-action"))return;const n=e.dataset.jobId;n&&ua(n)})})):e.innerHTML='<div class="no-data">該当する求人がありません</div>'}function ra(e){da();const t=document.getElementById("jm-job-edit-form");t&&(ea=function(e,t){if(!e)return()=>{};const n=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),t&&t())};return e.addEventListener("keydown",n),()=>{e.removeEventListener("keydown",n)}}(t,()=>{ga()}),Qn=On(t,"job-edit",e,{interval:3e4,showRestorePrompt:!0,onSave:()=>{console.log("[JobEdit] 下書きを自動保存しました")}}),e||autoSave.restore())}function da(e=!1){Qn&&(e&&Qn.clear(),Qn.cleanup(),Qn=null),ea&&(ea(),ea=null)}function ma(){Xn=null,Zn=!0,A("jm-edit-job");const e=document.getElementById("jm-edit-job-memo");e&&(e.value="");const t=document.getElementById("jm-edit-job-salary-type");t&&(t.value="");const n=document.getElementById("jm-edit-job-salary-other");n&&(n.value="");const a=document.getElementById("jm-salary-other-group");a&&(a.style.display="none");const o=document.getElementById("jm-edit-job-daily-salary");o&&(o.value="");const s=document.getElementById("jm-daily-salary-group");s&&(s.style.display="none");const i=document.getElementById("jm-edit-job-monthly-salary");i&&(i.value="");const c=document.getElementById("jm-monthly-salary-group");c&&(c.style.display="none");const l=document.getElementById("jm-edit-job-yearly-salary");l&&(l.value="");const r=document.getElementById("jm-yearly-salary-group");r&&(r.style.display="none");const d=document.getElementById("jm-working-hours-list");d&&(d.innerHTML='\n      <div class="multi-input-item">\n        <input type="text" class="jm-working-hours-input" placeholder="例: 8:00〜17:00">\n        <button type="button" class="btn-remove-item" title="削除">×</button>\n      </div>\n    ',ka()),document.querySelectorAll('#jm-features-checkbox-grid input[type="checkbox"]').forEach(e=>{e.checked=!1});const m=document.getElementById("jm-displayed-features-container");m&&(m.innerHTML='<div class="displayed-features-empty">上記から特徴を選択すると、ここに表示されます</div>');const u=document.getElementById("jm-edit-job-logo");u&&(u.value="");const p=document.getElementById("jm-job-logo-preview");p&&(p.style.display="none");const y=document.getElementById("jm-job-logo-preview-img");y&&(y.src="");const g=document.getElementById("jm-edit-job-show-video");g&&(g.checked=!1);const v=document.getElementById("jm-edit-job-video-url");v&&(v.value="");const b=document.getElementById("jm-video-url-group");b&&(b.style.display="none");const f=document.getElementById("jm-job-edit-title"),h=document.getElementById("jm-job-edit-badge");f&&(f.textContent="新規求人作成"),h&&(h.textContent="新規",h.classList.remove("edit"));const E=document.getElementById("jm-job-edit-delete-btn");E&&(E.style.display="none");const w=document.getElementById("jm-job-edit-save-btn");w&&(w.disabled=!1),ba("job-edit"),ra(null)}function ua(e){var t;const n=null==(t=M)?void 0:t.find(t=>t.id===e||t.id===String(e)||String(t.id)===String(e));if(!n)return void qe("求人データが見つかりません","error");Xn=n,Zn=!1,H(n,"jm-edit-job");const a=document.getElementById("jm-edit-job-memo");a&&(a.value=n.memo||""),function(e){const t=document.getElementById("jm-edit-job-salary-type"),n=document.getElementById("jm-edit-job-salary-other"),a=document.getElementById("jm-salary-other-group");t&&(e.salaryType?t.value=e.salaryType:e.monthlySalary?t.value="月給":t.value="");n&&a&&("その他"===e.salaryType||e.salaryOther?(n.value=e.salaryOther||"",a.style.display="block"):(n.value="",a.style.display="none"));const o=document.getElementById("jm-edit-job-daily-salary"),s=document.getElementById("jm-daily-salary-group");o&&(o.value=e.dailySalaryExample||"");s&&(s.style.display="日給"===e.salaryType?"block":"none");const i=document.getElementById("jm-edit-job-monthly-salary"),c=document.getElementById("jm-monthly-salary-group");i&&(i.value=e.monthlySalaryExample||"");c&&(c.style.display="月給"===e.salaryType?"block":"none");const l=document.getElementById("jm-edit-job-yearly-salary"),r=document.getElementById("jm-yearly-salary-group");l&&(l.value=e.yearlySalaryExample||"");r&&(r.style.display="月給"===e.salaryType?"block":"none")}(n),function(e){const t=document.getElementById("jm-working-hours-list");if(!t)return;const n=e.workingHours||"",a=("string"==typeof n?n:String(n)).split(/[|\n]/).map(e=>e.trim()).filter(e=>e);0===a.length&&a.push("");t.innerHTML=a.map(e=>`\n    <div class="multi-input-item">\n      <input type="text" class="jm-working-hours-input" placeholder="例: 8:00〜17:00" value="${Me(e)}">\n      <button type="button" class="btn-remove-item" title="削除">×</button>\n    </div>\n  `).join(""),ka()}(n),function(e){const t=e.features||"",n=t.split(",").map(e=>e.trim()).filter(e=>e);document.querySelectorAll('#jm-features-checkbox-grid input[type="checkbox"]').forEach(e=>{e.checked=!1}),n.forEach(e=>{const t=document.querySelector(`#jm-features-checkbox-grid input[value="${e}"]`);t&&(t.checked=!0)});const a=e.displayedFeatures||"",o=a.split(",").map(e=>e.trim()).filter(e=>e);!function(e,t=[]){J({containerId:pa.containerId,checkboxName:pa.checkboxName,checkedFeatures:e,selectedDisplayed:t,onWarning:pa.onWarning})}(n,o)}(n),function(e){const t=document.getElementById("jm-edit-job-logo"),n=document.getElementById("jm-job-logo-preview"),a=document.getElementById("jm-job-logo-preview-img"),o=e.jobLogo||e.imageUrl||"";t&&(t.value=o);n&&a&&(o?(a.src=o,n.style.display="block"):(a.src="",n.style.display="none"))}(n),function(e){const t=document.getElementById("jm-edit-job-show-video"),n=document.getElementById("jm-edit-job-video-url"),a=document.getElementById("jm-video-url-group");t&&(t.checked="true"===String(e.showVideoButton).toLowerCase());n&&(n.value=e.videoUrl||"");a&&(a.style.display=(null==t?void 0:t.checked)?"block":"none")}(n);const o=document.getElementById("jm-job-edit-title"),s=document.getElementById("jm-job-edit-badge");o&&(o.textContent=n.title||"求人編集"),s&&(s.textContent="編集",s.classList.add("edit"));const i=document.getElementById("jm-job-edit-delete-btn");i&&(i.style.display="");const c=document.getElementById("jm-job-edit-save-btn");c&&(c.disabled=!1),ba("job-edit"),ra(e)}const pa={containerId:"jm-displayed-features-container",featuresGridId:"jm-features-checkbox-grid",checkboxName:"jm-displayed-features",onWarning:e=>qe(e,"warning")};function ya(){da(),Xn=null,Zn=!1,ba("jobs")}async function ga(){var e,t;const n=e=>{var t,n;return(null==(n=null==(t=document.getElementById(`jm-edit-job-${e}`))?void 0:t.value)?void 0:n.trim())||""},a=n("salary-type"),o=n("salary"),s=n("salary-other"),i=n("daily-salary"),r=n("monthly-salary"),d=n("yearly-salary"),p=document.querySelectorAll("#jm-working-hours-list .jm-working-hours-input"),y=Array.from(p).map(e=>e.value.trim()).filter(e=>e).join(" | "),g=document.querySelectorAll('#jm-features-checkbox-grid input[type="checkbox"]:checked'),v=Array.from(g).map(e=>e.value).join(","),b=document.querySelectorAll('#jm-displayed-features-container input[type="checkbox"]:checked'),f=Array.from(b).map(e=>e.value).join(","),h=n("logo"),E=(null==(e=document.getElementById("jm-edit-job-show-video"))?void 0:e.checked)?"true":"false",w=n("video-url"),j={id:Zn?"":(null==Xn?void 0:Xn.id)||"",memo:n("memo"),title:n("title"),employmentType:n("employment-type"),location:n("location"),access:n("access"),salaryType:a,monthlySalary:o,salaryOther:s,dailySalaryExample:i,monthlySalaryExample:r,yearlySalaryExample:d,totalBonus:n("bonus"),order:n("order"),jobType:n("type"),features:v,displayedFeatures:f,badges:"",jobDescription:n("description"),requirements:n("requirements"),benefits:n("benefits"),workingHours:y,holidays:n("holidays"),publishStartDate:n("start-date"),publishEndDate:n("end-date"),visible:(null==(t=document.getElementById("jm-edit-job-visible"))?void 0:t.checked)?"true":"false",jobLogo:h,showVideoButton:E,videoUrl:w};if(!j.title||!j.location)return void qe("募集タイトルと勤務地は必須です","error");const I=document.getElementById("jm-job-edit-save-btn");try{I&&(I.disabled=!0,I.textContent="保存中..."),c();const e=Zn?null:(null==Xn?void 0:Xn._docId)||(null==Xn?void 0:Xn.id),t=await l(C,j,e);if(console.log("[JobManageEmbedded] Firestore保存結果:",t),!t.success)throw new Error(t.error||"保存に失敗しました");if("true"===E&&w){const e=Zn?t.jobId:(null==Xn?void 0:Xn.id)||"";e&&await async function(e,t,n,a){try{const o=await m(C,e);let s;if(o.success&&o.settings)s={...o.settings,showVideoButton:n,videoUrl:a};else{const o={version:2,sections:[{id:"hero-cta-1",type:"heroCta",data:{title:`${t.title||""}で一緒に働きませんか？`,subtitle:"",backgroundImage:"",showVideoButton:"true"===n,videoUrl:a||""}},{id:"job-info-1",type:"jobInfo",data:{}},{id:"cta-1",type:"cta",data:{title:"今すぐ応募する"}}]};s={jobId:e,companyDomain:C,company:N,jobTitle:t.title||"",showVideoButton:n,videoUrl:a,lpContent:JSON.stringify(o)}}const i=await u(C,e,s);i.success?console.log("[JobManageEmbedded] 動画設定をLPに同期しました"):console.warn("[JobManageEmbedded] LP同期エラー:",i.error)}catch(o){console.warn("[JobManageEmbedded] LP同期中にエラー:",o.message)}}(e,j,E,w)}Qn&&Qn.clear(),qe(Zn?"求人を作成しました":"求人情報を更新しました","success"),ya(),await ca()}catch(B){console.error("[JobManageEmbedded] 求人保存エラー:",B),qe("保存に失敗しました: "+B.message,"error")}finally{I&&(I.disabled=!1,I.textContent="保存")}}async function va(){if(!Xn)return void qe("削除対象が選択されていません","error");if(!(await nt({title:"求人の削除",message:"この求人を削除してもよろしいですか？",confirmText:"削除する",cancelText:"キャンセル",danger:!0})))return;const e=document.getElementById("jm-job-edit-delete-btn");try{e&&(e.disabled=!0,e.textContent="削除中..."),c();const t=Xn._docId||Xn.id,n=await d(C,t);if(!n.success)throw new Error(n.error||"削除に失敗しました");qe("求人を削除しました","success"),ya(),await ca()}catch(t){console.error("[JobManageEmbedded] 求人削除エラー:",t),qe("削除に失敗しました: "+t.message,"error")}finally{e&&(e.disabled=!1,e.textContent="削除")}}function ba(e){document.querySelectorAll("#jm-tabs .jm-tab").forEach(t=>{t.classList.toggle("active","job-edit"!==e&&t.dataset.tab===e)});const t=document.getElementById("jm-tabs");t&&(t.style.display="job-edit"===e?"none":""),document.querySelectorAll(".jm-subsection").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`jm-${e}`);n&&n.classList.add("active"),"jobs"===e?0===M.length?ca():la():"analytics"===e?Ea():"applicants"===e?at(C,N,"jm-"):"recruit"===e&&q(C)}async function fa(){const e=document.getElementById("jm-btn-load-analytics");e&&(e.disabled=!0,e.textContent="読み込み中...");try{const e=document.getElementById("jm-analytics-start-date"),t=document.getElementById("jm-analytics-end-date"),n=(null==e?void 0:e.value)||"",a=(null==t?void 0:t.value)||"";if(!n||!a)return void qe("期間を選択してください","error");const o=new Date(n),s=new Date(a),i=Math.ceil((s-o)/864e5)+1,c=Re.pageAnalytics,l=new URLSearchParams({type:"overview",days:i.toString(),company_domain:C}),r=await fetch(`${c}?${l}`),d=await r.json();if(d.success&&d.data){const e=d.data;document.getElementById("jm-analytics-pv").textContent=(e.totalPageViews||0).toLocaleString(),document.getElementById("jm-analytics-users").textContent=(e.totalUniqueVisitors||0).toLocaleString(),document.getElementById("jm-analytics-pages-per-session").textContent=e.totalUniqueVisitors>0?(e.totalPageViews/e.totalUniqueVisitors).toFixed(1):"-",document.getElementById("jm-analytics-avg-time").textContent=e.avgTimeOnPage?function(e){if(!e||isNaN(e))return"-";const t=Math.floor(e/60),n=Math.floor(e%60);return t>0?`${t}分${n}秒`:`${n}秒`}(e.avgTimeOnPage):"-";const t=new URLSearchParams({type:"lp",days:i.toString(),company_domain:C}),n=await fetch(`${c}?${t}`),a=await n.json();a.success&&a.data&&ha(a.data),qe("データを取得しました")}else document.getElementById("jm-analytics-pv").textContent="0",document.getElementById("jm-analytics-users").textContent="0",document.getElementById("jm-analytics-pages-per-session").textContent="-",document.getElementById("jm-analytics-avg-time").textContent="-",ha([]),qe("データがありません")}catch(t){console.error("[JobManageEmbedded] Analytics load error:",t),qe("データの取得に失敗しました","error")}finally{e&&(e.disabled=!1,e.textContent="データ取得")}}function ha(e){const t=document.querySelector("#jm-analytics .analytics-table tbody");t&&(e&&0!==e.length?t.innerHTML=e.map((e,t)=>`\n    <tr>\n      <td>${t+1}</td>\n      <td>${Me(e.jobTitle||e.jobId||"-")}</td>\n      <td>${(e.pageViews||0).toLocaleString()}</td>\n      <td>${(e.ctaClicks||0).toLocaleString()}</td>\n      <td>${e.cvr||"0.0"}%</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="5" class="no-data">データがありません</td></tr>')}function Ea(){const e=document.getElementById("jm-analytics-start-date"),t=document.getElementById("jm-analytics-end-date"),n=document.querySelectorAll("#jm-analytics .date-preset-btn");if(!e||!t)return;const a=new Date,o=new Date(a);o.setDate(a.getDate()-29),t.value=wa(a),e.value=wa(o),t.max=wa(a),e.max=wa(a),n.forEach(a=>{a.addEventListener("click",()=>{const o=a.dataset.preset,{start:s,end:i}=function(e){const t=new Date;let n,a;switch(e){case"7days":a=new Date(t),n=new Date(t),n.setDate(t.getDate()-6);break;case"30days":default:a=new Date(t),n=new Date(t),n.setDate(t.getDate()-29);break;case"90days":a=new Date(t),n=new Date(t),n.setDate(t.getDate()-89)}return{start:n,end:a}}(o);e.value=wa(s),t.value=wa(i),n.forEach(e=>e.classList.remove("active")),a.classList.add("active")})}),e.addEventListener("change",()=>{n.forEach(e=>e.classList.remove("active"))}),t.addEventListener("change",()=>{n.forEach(e=>e.classList.remove("active"))})}function wa(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function ja(){const e=document.getElementById("jm-edit-job-logo"),t=document.getElementById("jm-job-logo-preview"),n=document.getElementById("jm-job-logo-preview-img");if(!e||!t||!n)return;const a=e.value.trim();a?(n.src=a,n.onerror=()=>{t.style.display="none"},n.onload=()=>{t.style.display="block"}):(t.style.display="none",n.src="")}function Ia(){const e=document.getElementById("jm-edit-job-logo"),t=document.getElementById("jm-job-logo-preview"),n=document.getElementById("jm-job-logo-preview-img");e&&(e.value=""),t&&(t.style.display="none"),n&&(n.src="")}async function Ba(){const e=document.getElementById("jm-edit-job-logo"),t=document.getElementById("jm-job-logo-preview"),n=document.getElementById("jm-job-logo-preview-img"),a=document.getElementById("jm-logo-upload-progress"),o=document.getElementById("jm-btn-upload-logo");try{const s=await pt({accept:"image/*"});a&&(a.style.display="flex"),o&&(o.disabled=!0);const i=await yt(s,C);e&&(e.value=i),n&&(n.src=i,n.onload=()=>{t&&(t.style.display="block")}),qe("画像をアップロードしました")}catch(s){"ファイルが選択されませんでした"!==s.message&&(console.error("[JobManageEmbedded] ロゴアップロードエラー:",s),qe("画像のアップロードに失敗しました: "+s.message,"error"))}finally{a&&(a.style.display="none"),o&&(o.disabled=!1)}}function La(){const e=document.getElementById("jm-edit-job-show-video"),t=document.getElementById("jm-video-url-group");e&&t&&(e.checked?t.style.display="block":t.style.display="none")}function $a(){const e=document.getElementById("jm-edit-job-salary-type"),t=document.getElementById("jm-salary-other-group"),n=document.getElementById("jm-daily-salary-group"),a=document.getElementById("jm-monthly-salary-group"),o=document.getElementById("jm-yearly-salary-group");if(!e)return;const s=e.value;t&&(t.style.display="その他"===s?"block":"none"),n&&(n.style.display="日給"===s?"block":"none"),a&&(a.style.display="月給"===s?"block":"none"),o&&(o.style.display="月給"===s?"block":"none")}function ka(){const e=document.getElementById("jm-working-hours-list");e&&e.querySelectorAll(".btn-remove-item").forEach(t=>{t.addEventListener("click",()=>{e.querySelectorAll(".multi-input-item").length>1&&t.closest(".multi-input-item").remove()})})}function xa(){const e=document.getElementById("jm-working-hours-list");if(!e)return;const t=document.createElement("div");t.className="multi-input-item",t.innerHTML='\n    <input type="text" class="jm-working-hours-input" placeholder="例: 8:00〜17:00">\n    <button type="button" class="btn-remove-item" title="削除">×</button>\n  ',e.appendChild(t);t.querySelector(".btn-remove-item").addEventListener("click",()=>{e.querySelectorAll(".multi-input-item").length>1&&t.remove()}),t.querySelector("input").focus()}async function Da(e){const t=document.getElementById("jm-feed-status");t&&(t.style.display="flex");try{const t=M.filter(e=>!0===e.visible||"true"===e.visible||"TRUE"===e.visible);let n,a,o;switch(e){case"indeed":n=U(t),a=`${C}_indeed_feed.xml`,o="application/xml";break;case"google":n=P(t),a=`${C}_google_jobs.json`,o="application/ld+json";break;case"jobbox":n=_(t),a=`${C}_jobbox_feed.xml`,o="application/xml";break;case"csv":n=R(t),a=`${C}_jobs.csv`,o="text/csv";break;default:throw new Error("Unknown feed type")}F(n,a,o),qe(`${a} をダウンロードしました`)}catch(n){console.error("[JobManageEmbedded] フィード生成エラー:",n),qe("フィードの生成に失敗しました","error")}finally{t&&(t.style.display="none")}}async function Sa(){const e=document.getElementById("jm-calendar-settings-modal");e&&(e.style.display="flex",await async function(){ta={};try{const t=firebase.firestore(),n=await t.collection("company_users").where("companyDomain","==",C).where("isActive","==",!0).get();sa=[],n.forEach(e=>{sa.push({id:e.id,...e.data()})});for(const a of sa)try{const e=await it(C,a.id);e.integration&&(ta[a.id]=e.integration)}catch(e){console.log(`No calendar integration for user ${a.id}`)}Ca()}catch(t){console.error("Failed to load calendar integrations:",t),qe("カレンダー連携情報の取得に失敗しました","error")}}())}function Aa(){const e=document.getElementById("jm-calendar-settings-modal");e&&(e.style.display="none")}function Ca(){const e=document.getElementById("jm-calendar-integrations-list");e&&(0!==sa.length?(e.innerHTML=sa.map(e=>{const t=ta[e.id],n=null==t?void 0:t.isActive;return`\n      <div class="calendar-integration-item" data-user-id="${Me(e.id)}">\n        <div class="calendar-integration-info">\n          <div class="calendar-integration-icon">👤</div>\n          <div class="calendar-integration-details">\n            <strong>${Me(e.name||e.username)}</strong>\n            ${n?`<small>${Me(t.email||"")}</small>`:""}\n          </div>\n        </div>\n        <div class="calendar-integration-actions">\n          ${n?`<span class="calendar-status connected">連携中</span>\n               <button class="btn-disconnect-calendar" data-user-id="${Me(e.id)}">解除</button>`:`<button class="btn-connect-calendar" data-user-id="${Me(e.id)}" data-user-name="${Me(e.name||e.username)}">\n                 Googleカレンダーと連携\n               </button>`}\n        </div>\n      </div>\n    `}).join(""),e.querySelectorAll(".btn-connect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e,t){try{const n=await dt(C,e,t);window.open(n.authUrl,"calendar-auth","width=600,height=700");const a=setInterval(async()=>{var t;try{const n=await it(C,e);(null==(t=n.integration)?void 0:t.isActive)&&(clearInterval(a),ta[e]=n.integration,Ca(),qe("カレンダー連携が完了しました"))}catch(n){}},2e3);setTimeout(()=>clearInterval(a),6e4)}catch(n){console.error("Failed to initiate calendar auth:",n),qe("カレンダー連携の開始に失敗しました","error")}}(e.dataset.userId,e.dataset.userName)})}),e.querySelectorAll(".btn-disconnect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e){if(!(await nt({title:"カレンダー連携の解除",message:"カレンダー連携を解除しますか？",confirmText:"解除する",cancelText:"キャンセル",danger:!0})))return;try{await mt(C,e),delete ta[e],Ca(),qe("カレンダー連携を解除しました")}catch(t){console.error("Failed to revoke calendar auth:",t),qe("連携解除に失敗しました","error")}}(e.dataset.userId)})})):e.innerHTML='<p class="no-data">担当者が登録されていません</p>')}function Ta(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname}async function Ma(){const e=document.getElementById("jm-interview-modal");if(!e)return;if(oa=ut(),!oa)return void qe("応募者を選択してください","error");if(console.log("[showJmInterviewModal] jmCurrentApplicant:",oa),Ta())sa=[{id:"local-user-1",name:"テスト担当者1",username:"test1"},{id:"local-user-2",name:"テスト担当者2",username:"test2"}],ta={};else if(0===sa.length)try{const e=firebase.firestore();if(C){const t=await e.collection("company_users").where("companyDomain","==",C).where("isActive","==",!0).get();sa=[],t.forEach(e=>{sa.push({id:e.id,...e.data()})})}else console.warn("[showJmInterviewModal] companyDomain is not set, skipping assignees load")}catch(n){console.error("Failed to load assignees:",n),sa=[]}const t=document.getElementById("jm-interview-staff");t&&(t.innerHTML='<option value="">担当者を選択...</option>'+sa.map(e=>{const t=ta[e.id],n=(null==t?void 0:t.isActive)?" (📅連携済)":"";return`<option value="${Me(e.id)}" data-has-calendar="${(null==t?void 0:t.isActive)?"true":"false"}">${Me(e.name||e.username)}${n}</option>`}).join("")),na=ot(new Date),aa=null,document.getElementById("jm-availability-section").style.display="none",document.getElementById("jm-selected-slot-section").style.display="none",document.getElementById("jm-manual-datetime-section").style.display="block",document.getElementById("jm-calendar-status-hint").textContent=Ta()?"ローカル環境: 手動入力のみ利用可能":"",document.getElementById("jm-interview-datetime").value="",e.style.display="flex"}function Ha(){const e=document.getElementById("jm-interview-modal");e&&(e.style.display="none")}function qa(){var e;const t=document.getElementById("jm-interview-staff"),n=t.options[t.selectedIndex],a="true"===(null==(e=null==n?void 0:n.dataset)?void 0:e.hasCalendar),o=document.getElementById("jm-availability-section"),s=document.getElementById("jm-manual-datetime-section"),i=document.getElementById("jm-selected-slot-section"),c=document.getElementById("jm-calendar-status-hint");aa=null,i.style.display="none",a?(c.textContent="カレンダー連携済み - 空き時間から選択できます",c.className="form-hint hint-success",o.style.display="block",s.style.display="none",Ra()):(c.textContent=t.value?"カレンダー未連携 - 日時を手動で入力してください":"",c.className="form-hint",o.style.display="none",s.style.display="block")}async function Ra(){const e=document.getElementById("jm-interview-staff").value;if(!e)return;const t=document.getElementById("jm-availability-grid");t.innerHTML='<div class="loading-message">空き時間を取得中...</div>';try{const t=new Date(na);t.setDate(t.getDate()+6);const n=lt(na),a=lt(t),o=await rt(C,e,n,a);!function(){const e=new Date(na);e.setDate(e.getDate()+6);const t=document.getElementById("jm-week-label");t&&(t.textContent=`${lt(na)} 〜 ${lt(e)}`)}(),function(e){const t=document.getElementById("jm-availability-grid");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<p class="no-data">この週に空き時間はありません</p>');const n={};for(const s of e){const e=lt(new Date(s.start));n[e]||(n[e]=[]),n[e].push(s)}let a='<div class="availability-week">';for(let s=0;s<7;s++){const e=new Date(na);e.setDate(e.getDate()+s);const t=lt(e),o=ct(e),i=n[t]||[];a+=`\n      <div class="availability-day">\n        <div class="day-header">${e.getMonth()+1}/${e.getDate()} (${o})</div>\n        <div class="day-slots">\n          ${0===i.length?'<span class="no-slots">-</span>':i.map((e,t)=>{console.log(`[renderSlot] Slot ${t}:`,e);const n=new Date(e.start),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`,o=`<button type="button" class="slot-btn" data-start="${e.start}" data-end="${e.end}">${a}</button>`;return 0===t&&console.log("[renderSlot] First button HTML:",o),o}).join("")}\n        </div>\n      </div>\n    `}a+="</div>",t.innerHTML=a;const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t),o.addEventListener("click",e=>{const t=e.target.closest(".slot-btn");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.dataset.start||t.dataset.slot,a=t.dataset.end;console.log("[slotClick] startValue:",n,"endValue:",a),o.querySelectorAll(".slot-btn").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),aa={start:n,end:a},console.log("[slotClick] jmSelectedSlot set to:",aa),function(){const e=document.getElementById("jm-selected-slot-section"),t=document.getElementById("jm-selected-slot");if(console.log("[showJmSelectedSlot] jmSelectedSlot:",aa),aa&&e&&t){console.log("[showJmSelectedSlot] start value:",aa.start,"type:",typeof aa.start);const n=new Date(aa.start);if(console.log("[showJmSelectedSlot] parsed slotDate:",n,"isValid:",!isNaN(n.getTime())),isNaN(n.getTime()))t.textContent=`選択: ${aa.start}`;else{const e=ct(n),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`;t.textContent=`${n.getFullYear()}/${n.getMonth()+1}/${n.getDate()} (${e}) ${a}〜`}e.style.display="block"}}()}),console.log("[renderAvailability] Grid setup complete, slots:",o.querySelectorAll(".slot-btn").length)}(o.availableSlots||[])}catch(n){console.error("Failed to load availability:",n),t.innerHTML='<p class="error-message">空き時間の取得に失敗しました</p>'}}function _a(e){na.setDate(na.getDate()+7*e),aa=null,document.getElementById("jm-selected-slot-section").style.display="none",Ra()}async function Pa(){var e,t,n,a;const o=document.getElementById("jm-interview-staff"),s=o.options[o.selectedIndex],i="true"===(null==(e=null==s?void 0:s.dataset)?void 0:e.hasCalendar);let c;if(console.log("[saveJmInterview] hasCalendar:",i),console.log("[saveJmInterview] jmSelectedSlot:",aa),i){if(!aa)return void qe("空き時間から日程を選択してください","error");c=new Date(aa.start),console.log("[saveJmInterview] Using calendar slot:",c)}else{const e=document.getElementById("jm-interview-datetime");if(console.log("[saveJmInterview] Manual datetime value:",null==e?void 0:e.value),!(null==e?void 0:e.value))return void qe("面談日時を入力してください","error");c=new Date(e.value)}if(isNaN(c.getTime()))return void qe("日時の形式が正しくありません","error");const l=document.getElementById("jm-interview-modal-save");l.disabled=!0,l.textContent="保存中...";try{const e=parseInt(document.getElementById("jm-interview-duration").value),i=document.querySelector('input[name="jm-meeting-type"]:checked');console.log("[saveJmInterview] checkedRadio:",i,"value:",null==i?void 0:i.value);const l=(null==i?void 0:i.value)||"in_person",r=document.getElementById("jm-interview-location").value;console.log("[saveJmInterview] meetingType:",l);const d=(null==(t=null==s?void 0:s.textContent)?void 0:t.replace(" (📅連携済)",""))||"";if(Ta())return console.log("[saveJmInterview] ローカル環境: APIスキップ"),qe("面談を登録しました（ローカルモード）"),Ha(),void Ua(c,d,l,r,null);const m=(null==oa?void 0:oa.applicantName)||(null==(n=null==oa?void 0:oa.applicant)?void 0:n.name)||"",u=(null==oa?void 0:oa.applicantEmail)||(null==(a=null==oa?void 0:oa.applicant)?void 0:a.email)||"",p=(null==oa?void 0:oa.jobTitle)||"",y={companyDomain:C,companyUserId:o.value,applicationId:(null==oa?void 0:oa.id)||"",applicantName:m,applicantEmail:u,staffName:d,jobTitle:p,scheduledAt:c.toISOString(),durationMinutes:e,meetingType:l,location:r,reminders:[{offsetMinutes:1440},{offsetMinutes:60}]};console.log("[saveJmInterview] Sending API params:",JSON.stringify(y));const g=await st(y);console.log("[saveJmInterview] API result:",g),console.log("[saveJmInterview] result.meetLink:",g.meetLink),qe("面談を登録しました"),Ha();Ua(c,d,l,g.meetLink||r,g.meetLink)}catch(r){console.error("Failed to save interview:",r),qe("面談の登録に失敗しました","error")}finally{l.disabled=!1,l.textContent="面談を登録"}}function Ua(e,t,n,a,o=null){console.log("[updateJmInterviewInfo] Called with:",{scheduledAt:e,staffName:t,meetingType:n,location:a,meetLink:o});const s=document.getElementById("jm-interview-info");if(!s)return;const i=ct(e),c={in_person:"対面",online:"オンライン",phone:"電話"}[n]||n;console.log("[updateJmInterviewInfo] meetingType:",n,"-> displayType:",c);const l=`${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`;let r="";o?r=`\n      <div class="interview-info-row interview-meet">\n        <span class="info-label">📹 Meet</span>\n        <a href="${Me(o)}" target="_blank" rel="noopener" class="meet-link">${Me(o)}</a>\n      </div>`:a&&(r=`\n      <div class="interview-info-row">\n        <span class="info-label">📍 場所</span>\n        <span class="info-value">${Me(a)}</span>\n      </div>`),s.innerHTML=`\n    <div class="interview-scheduled">\n      <div class="interview-datetime">\n        <span class="interview-date-text">${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()} (${i})</span>\n        <span class="interview-time-text">${l}〜</span>\n      </div>\n      <div class="interview-info-grid">\n        <div class="interview-info-row">\n          <span class="info-label">👤 担当</span>\n          <span class="info-value">${Me(t)}</span>\n        </div>\n        <div class="interview-info-row">\n          <span class="info-label">📋 形式</span>\n          <span class="info-value">${c}</span>\n        </div>\n        ${r}\n      </div>\n    </div>\n  `}function Fa(){const e=document.getElementById("jm-btn-sort-mode");e&&(e.style.display=C?"":"none")}let za=!1,Na=[];function Ja(){za=!0;const e=document.getElementById("jm-sort-mode-bar"),t=document.getElementById("jm-jobs-list"),n=document.getElementById("jm-btn-sort-mode");e&&(e.style.display="flex"),t&&t.classList.add("sort-mode"),n&&(n.style.display="none"),Na=Array.from(t.querySelectorAll(".job-listing-card")).map(e=>e.dataset.jobId),t.querySelectorAll(".job-listing-card").forEach(e=>{e.setAttribute("draggable","true")}),function(){const e=document.getElementById("jm-jobs-list");if(!e)return;let t=null;e.addEventListener("dragstart",e=>{const n=e.target.closest(".job-listing-card");n&&za&&(t=n,n.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",n.dataset.jobId))}),e.addEventListener("dragend",n=>{const a=n.target.closest(".job-listing-card");a&&a.classList.remove("dragging"),e.querySelectorAll(".job-listing-card").forEach(e=>e.classList.remove("drag-over")),t=null,function(){const e=document.getElementById("jm-jobs-list");if(!e)return;e.querySelectorAll(".job-listing-card").forEach((e,t)=>{const n=e.querySelector(".job-order-badge");n&&(n.textContent=t+1)})}()}),e.addEventListener("dragover",n=>{if(n.preventDefault(),!za||!t)return;const a=n.target.closest(".job-listing-card");if(!a||a===t)return;const o=a.getBoundingClientRect(),s=o.top+o.height/2;e.querySelectorAll(".job-listing-card").forEach(e=>e.classList.remove("drag-over")),n.clientY<s?(a.classList.add("drag-over"),e.insertBefore(t,a)):(a.classList.add("drag-over"),e.insertBefore(t,a.nextSibling))}),e.addEventListener("drop",t=>{t.preventDefault(),e.querySelectorAll(".job-listing-card").forEach(e=>e.classList.remove("drag-over"))})}()}function Va(e=!1){za=!1;const t=document.getElementById("jm-sort-mode-bar"),n=document.getElementById("jm-jobs-list");if(t&&(t.style.display="none"),n&&n.classList.remove("sort-mode"),Fa(),null==n||n.querySelectorAll(".job-listing-card").forEach(e=>{e.setAttribute("draggable","false")}),e&&Na.length>0){const e=Array.from(n.querySelectorAll(".job-listing-card"));Na.forEach(t=>{const a=e.find(e=>e.dataset.jobId===t);a&&n.appendChild(a)})}Na=[]}async function Oa(){const e=document.getElementById("jm-jobs-list");if(!e)return;const t=document.getElementById("jm-btn-save-sort");t&&(t.disabled=!0,t.textContent="保存中...");try{const t=e.querySelectorAll(".job-listing-card"),n=[];t.forEach((e,t)=>{const a=e.dataset.jobId,o=t+1,s=M.find(e=>String(e.id)===String(a));s&&(s.order=o,n.push({jobId:a,order:o}))});for(const e of n)await Wa(e.jobId,e.order);qe("並び順を保存しました"),Va()}catch(n){console.error("Failed to save sort order:",n),qe("並び順の保存に失敗しました","error")}finally{t&&(t.disabled=!1,t.textContent="順序を保存")}}async function Wa(e,t){const n=M.find(t=>String(t.id)===String(e)||String(t._docId)===String(e));if(!n)return;const a={...n,order:String(t)};delete a._rowIndex,delete a._docId,c();const o=n._docId||n.id,s=await l(C,a,o);if(!s.success)throw new Error(s.error||"Failed to save job order")}let Ga=!0,Ya=null,Ka=null,Xa=!1;async function Za(e){var t,n,a,o,s,i,l,r,d;Ya=e,Ga=!e,Ka=null,function(){const e=document.getElementById("ce-company-edit-form");e&&e.reset();["ce-description-editor","ce-job-content-editor","ce-working-hours-editor","ce-work-location-editor"].forEach(e=>{const t=document.getElementById(e);t&&(t.innerHTML="")}),["ce-description","ce-job-content","ce-working-hours","ce-work-location","ce-logo-url"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")}),ao("");const t=document.getElementById("ce-company-domain");t&&(t.readOnly=!1,t.classList.remove("readonly"))}(),function(){const e=document.getElementById("ce-page-title"),t=document.getElementById("ce-edit-badge"),n=document.getElementById("ce-delete-btn"),a=document.getElementById("ce-company-domain");Ga?(e&&(e.textContent="新規会社登録"),t&&(t.textContent="新規作成",t.classList.remove("edit")),n&&(n.style.display="none")):(e&&(e.textContent="会社情報の編集"),t&&(t.textContent="編集中",t.classList.add("edit")),n&&(n.style.display=""),a&&(a.readOnly=!0,a.classList.add("readonly")))}(),Xa||(null==(t=document.getElementById("ce-company-edit-form"))||t.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,t,n,a,o,s,i;!function(){const e=document.getElementById("section-company-edit");e&&e.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=null==t?void 0:t.querySelector('input[type="hidden"]');n&&(n.value=Qa(e.innerHTML))})}();const l=e=>{var t,n;return(null==(n=null==(t=document.getElementById(e))?void 0:t.value)?void 0:n.trim())||""},r=l("ce-logo-url"),d={company:l("ce-company-name"),companyDomain:l("ce-company-domain"),designPattern:(null==(e=document.getElementById("ce-design-pattern"))?void 0:e.value)||"modern",logoUrl:r,imageUrl:r,order:l("ce-order"),companyAddress:l("ce-company-address"),description:(null==(t=document.getElementById("ce-description"))?void 0:t.value)||"",jobDescription:(null==(n=document.getElementById("ce-job-content"))?void 0:n.value)||"",workingHours:(null==(a=document.getElementById("ce-working-hours"))?void 0:a.value)||"",workLocation:(null==(o=document.getElementById("ce-work-location"))?void 0:o.value)||"",showCompany:(null==(s=document.getElementById("ce-show-company"))?void 0:s.checked)?"○":"",visible:(null==(i=document.getElementById("ce-show-company"))?void 0:i.checked)||!1};if(!d.company||!d.companyDomain)return void qe("会社名と会社ドメインは必須です","error");if(!/^[a-z0-9-]+$/.test(d.companyDomain))return void qe("会社ドメインは半角英小文字・数字・ハイフンのみ使用できます","error");const m=document.getElementById("ce-save-btn");m&&(m.disabled=!0,m.innerHTML='<span class="loading-spinner-small"></span> 保存中...');try{c();const e=await y(d.companyDomain,d);if(!e.success)throw new Error(e.error||"保存に失敗しました");localStorage.setItem(`company_data_${d.companyDomain}`,JSON.stringify(d)),qe(Ga?"会社を登録しました":"会社情報を更新しました"),co()}catch(u){console.error("保存エラー:",u),qe("保存中にエラーが発生しました: "+u.message,"error")}finally{m&&(m.disabled=!1,m.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> 保存')}}()}),null==(n=document.getElementById("ce-back-btn"))||n.addEventListener("click",co),null==(a=document.getElementById("ce-cancel-btn"))||a.addEventListener("click",co),null==(o=document.getElementById("ce-delete-btn"))||o.addEventListener("click",oo),null==(s=document.getElementById("ce-delete-modal-close"))||s.addEventListener("click",so),null==(i=document.getElementById("ce-delete-cancel"))||i.addEventListener("click",so),null==(l=document.getElementById("ce-delete-confirm"))||l.addEventListener("click",io),null==(r=document.getElementById("ce-delete-confirm-modal"))||r.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&so()}),null==(d=document.getElementById("ce-company-domain"))||d.addEventListener("input",e=>{Ga&&(e.target.value=e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,""))}),function(){const e=document.getElementById("ce-logo-upload-btn"),t=document.getElementById("ce-logo-file-input"),n=document.getElementById("ce-logo-remove-btn"),a=document.getElementById("ce-logo-preview"),o=document.getElementById("ce-logo-url");e&&t&&(e.addEventListener("click",()=>{t.click()}),null==a||a.addEventListener("click",()=>{t.click()}),t.addEventListener("change",async e=>{var n,s;const i=e.target.files[0];if(!i)return;const c=null==(s=null==(n=document.getElementById("ce-company-domain"))?void 0:n.value)?void 0:s.trim();if(c)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">アップロード中...</span>';const e=await gt(i,c);o.value=e,ao(e)}catch(l){console.error("ロゴアップロードエラー:",l),qe("ロゴのアップロードに失敗しました: "+l.message,"error"),ao(o.value)}finally{a.classList.remove("uploading"),t.value=""}else qe("先に会社ドメインを入力してください","error")}),null==n||n.addEventListener("click",()=>{o.value="",ao("")}),null==a||a.addEventListener("dragover",e=>{e.preventDefault(),a.classList.add("drag-over")}),null==a||a.addEventListener("dragleave",e=>{e.preventDefault(),a.classList.remove("drag-over")}),null==a||a.addEventListener("drop",async e=>{var t,n;e.preventDefault(),a.classList.remove("drag-over");const s=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));if(0===s.length)return;const i=null==(n=null==(t=document.getElementById("ce-company-domain"))?void 0:t.value)?void 0:n.trim();if(i)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">アップロード中...</span>';const e=await gt(s[0],i);o.value=e,ao(e)}catch(c){console.error("ロゴアップロードエラー:",c),qe("ロゴのアップロードに失敗しました: "+c.message,"error"),ao(o.value)}finally{a.classList.remove("uploading")}else qe("先に会社ドメインを入力してください","error")}))}(),lo("ce-description-insert-image","ce-description-image-input","ce-description-editor"),lo("ce-job-content-insert-image","ce-job-content-image-input","ce-job-content-editor"),function(){const e=document.getElementById("section-company-edit");if(!e)return;e.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=t.querySelector(".rich-editor-toolbar"),a=t.querySelector('input[type="hidden"]');null==n||n.querySelectorAll(".toolbar-btn:not([id])").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const o=t.dataset.command;o&&(document.execCommand(o,!1,null),e.focus(),eo(e,a))})}),e.addEventListener("input",()=>{eo(e,a)}),e.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),e.addEventListener("keydown",t=>{if(t.ctrlKey||t.metaKey){switch(t.key.toLowerCase()){case"b":t.preventDefault(),document.execCommand("bold",!1,null);break;case"i":t.preventDefault(),document.execCommand("italic",!1,null);break;case"u":t.preventDefault(),document.execCommand("underline",!1,null)}eo(e,a)}})})}(),Xa=!0),Ga||await async function(){const e=sessionStorage.getItem("editing_company_data");if(e){try{const t=JSON.parse(e);if(t.companyDomain===Ya||t.company_domain===Ya)return Ka=t,no(t),void sessionStorage.removeItem("editing_company_data")}catch(n){console.error("sessionStorageデータのパースエラー:",n)}sessionStorage.removeItem("editing_company_data")}const t=localStorage.getItem(`company_data_${Ya}`);if(t)try{const e=JSON.parse(t);return Ka=e,void no(e)}catch(n){console.error("localStorageデータのパースエラー:",n)}try{c();const e=await p(Ya);if(!e.success||!e.company)return qe("会社データが見つかりません","error"),void co();Ka=e.company,no(e.company)}catch(a){console.error("Firestore読み込みエラー:",a),qe("データの読み込みに失敗しました: "+a.message,"error")}}()}function Qa(e){if(!e||"<br>"===e||"<div><br></div>"===e)return"";const t=["b","strong","i","em","u","ul","ol","li","br","div","p","img"],n=["src","alt","style"],a=document.createElement("div");a.innerHTML=e;return a.querySelectorAll("*").forEach(e=>{if(t.includes(e.tagName.toLowerCase())){Array.from(e.attributes).forEach(t=>{n.includes(t.name)||e.removeAttribute(t.name)}),"img"!==e.tagName.toLowerCase()||e.style.maxWidth||(e.style.maxWidth="100%")}else e.replaceWith(...e.childNodes)}),a.innerHTML}function eo(e,t){if(t){const n=Qa(e.innerHTML);t.value=n}}function to(e,t){const n=document.getElementById(e),a=null==n?void 0:n.closest(".rich-editor-container"),o=null==a?void 0:a.querySelector('input[type="hidden"]');n&&(n.innerHTML=t||"",o&&(o.value=t||""))}function no(e){const t=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t||"")};t("ce-company-name",e.company),t("ce-company-domain",e.companyDomain||e.company_domain),t("ce-design-pattern",e.designPattern||"modern"),t("ce-order",e.order),t("ce-company-address",e.companyAddress||e.location);const n=e.logoUrl||e.imageUrl||"";t("ce-logo-url",n),ao(n);const a=document.getElementById("ce-show-company");if(a&&(a.checked="○"===e.showCompany||!0===e.showCompany||"true"===e.showCompany||!0===e.visible),to("ce-description-editor",e.description||""),to("ce-job-content-editor",e.jobDescription||e.jobContent||""),to("ce-working-hours-editor",e.workingHours||""),to("ce-work-location-editor",e.workLocation||""),e.company){const t=document.getElementById("ce-page-title");t&&(t.textContent=`${e.company} の編集`)}}function ao(e){const t=document.getElementById("ce-logo-preview"),n=document.getElementById("ce-logo-remove-btn");t&&(e?(t.innerHTML=`<img src="${Me(e)}" alt="会社ロゴ">`,n&&(n.style.display="")):(t.innerHTML='<span class="upload-placeholder">ロゴをアップロード</span>',n&&(n.style.display="none")))}function oo(){var e;const t=document.getElementById("ce-delete-confirm-modal"),n=(null==(e=document.getElementById("ce-company-name"))?void 0:e.value)||"",a=document.getElementById("ce-delete-company-name");a&&(a.textContent=n),t&&(t.style.display="flex")}function so(){const e=document.getElementById("ce-delete-confirm-modal");e&&(e.style.display="none")}async function io(){const e=document.getElementById("ce-delete-confirm");e&&(e.disabled=!0,e.textContent="削除中...");try{c();const e=await g(Ya);if(!e.success)throw new Error(e.error||"削除に失敗しました");localStorage.removeItem(`company_data_${Ya}`),qe("会社を削除しました"),so(),co()}catch(t){console.error("削除エラー:",t),qe("削除中にエラーが発生しました: "+t.message,"error")}finally{e&&(e.disabled=!1,e.textContent="削除する")}}function co(){var e,t,n;(null==(e=window.AdminDashboard)?void 0:e.navigateBack)?window.AdminDashboard.navigateBack():null==(n=null==(t=window.AdminDashboard)?void 0:t.switchSection)||n.call(t,"company-manage")}function lo(e,t,n){const a=document.getElementById(e),o=document.getElementById(t),s=document.getElementById(n);a&&o&&s&&(a.addEventListener("click",()=>{o.click()}),o.addEventListener("change",async e=>{var t,n;const a=e.target.files[0];if(!a)return;const i=null==(n=null==(t=document.getElementById("ce-company-domain"))?void 0:t.value)?void 0:n.trim();if(i)try{const e=`img-placeholder-${Date.now()}`,t=document.createElement("img");t.id=e,t.src=URL.createObjectURL(a),t.alt="アップロード中...",t.className="uploading",t.style.maxWidth="100%",t.style.opacity="0.5",s.focus();const n=window.getSelection();if(n.rangeCount>0){const e=n.getRangeAt(0);e.insertNode(t),e.setStartAfter(t),e.collapse(!0),n.removeAllRanges(),n.addRange(e)}else s.appendChild(t);const o=await vt(a,i),c=document.getElementById(e);c&&(c.src=o,c.alt="",c.className="",c.style.opacity="1",c.removeAttribute("id"));const l=s.closest(".rich-editor-container"),r=null==l?void 0:l.querySelector('input[type="hidden"]');r&&(r.value=Qa(s.innerHTML))}catch(c){console.error("画像アップロードエラー:",c),qe("画像のアップロードに失敗しました: "+c.message,"error");const e=s.querySelector("img.uploading");e&&e.remove()}finally{o.value=""}else qe("先に会社ドメインを入力してください","error")}))}const ro=new Map,mo=new Map,uo="/dev/";async function po(e){if(ro.has(e))return ro.get(e);if(mo.has(e))return mo.get(e);const t=async function(e){const t=`${uo}admin/sections/${e}.html`;try{const n=await fetch(t);if(!n.ok)throw new Error(`Failed to load section: ${e} (${n.status})`);return await n.text()}catch(n){return console.error(`[SectionLoader] Error loading ${e}:`,n),`<div class="section-error">セクションの読み込みに失敗しました: ${e}</div>`}}(e);mo.set(e,t);try{const n=await t;return ro.set(e,n),n}finally{mo.delete(e)}}const yo="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec";let go={status:"idle",currentStep:"",companiesTotal:0,companiesDone:0,jobsTotal:0,jobsDone:0,errors:[]};function vo(){return{...go}}function bo(){go={status:"idle",currentStep:"",companiesTotal:0,companiesDone:0,jobsTotal:0,jobsDone:0,errors:[]}}function fo(e){go={...go,...e},console.log("[Migration]",go.currentStep,go)}async function ho(){const e=`${yo}?action=getCompanies`,t=await fetch(e),n=await t.json();if(!n.success)throw new Error(n.error||"会社一覧の取得に失敗");return n.companies||[]}async function Eo(e){const t=`${yo}?action=getJobs&domain=${encodeURIComponent(e)}`,n=await fetch(t),a=await n.json();if(!a.success)throw new Error(a.error||"求人の取得に失敗");return a.jobs||[]}async function wo(e){const t=`${yo}?action=getRecruitSettings&companyDomain=${encodeURIComponent(e)}`,n=await fetch(t),a=await n.json();return a.success&&a.settings||null}async function jo(e,t){const n=`${yo}?action=getLPSettings&companyDomain=${encodeURIComponent(e)}&jobId=${encodeURIComponent(t)}`,a=await fetch(n),o=await a.json();return o.success&&o.settings||null}async function Io(e,t,n){if(!n)return;const a=await u(e,t,n);if(!a.success)throw new Error(a.error)}async function Bo(e){const t=e.companyDomain||e.domain;if(!t)throw new Error("会社ドメインがありません");const n={company:e.company||e.name||"",description:e.description||"",jobDescription:e.jobDescription||"",workingHours:e.workingHours||"",companyAddress:e.companyAddress||e.address||"",workLocation:e.workLocation||"",designPattern:e.designPattern||"",imageUrl:e.imageUrl||"",order:parseInt(e.order)||0,showCompany:!0===e.showCompany||"○"===e.showCompany||"◯"===e.showCompany,manageSheetUrl:e.manageSheetUrl||e.jobsSheet||""},a=await y(t,n);if(!a.success)throw new Error(a.error);return t}async function Lo(e,t){const n={id:String(t.id||""),title:t.title||"",location:t.location||"",area:t.area||"",totalBonus:t.totalBonus||"",monthlySalary:t.monthlySalary||"",salaryType:t.salaryType||"",salaryOther:t.salaryOther||"",jobType:t.jobType||"",employmentType:t.employmentType||"",features:t.features||"",displayedFeatures:t.displayedFeatures||"",badges:t.badges||"",jobDescription:t.jobDescription||"",requirements:t.requirements||"",benefits:t.benefits||"",workingHours:t.workingHours||"",holidays:t.holidays||"",visible:!0===t.visible||"true"===t.visible||"TRUE"===t.visible,order:parseInt(t.order)||0,publishStartDate:t.publishStartDate||"",publishEndDate:t.publishEndDate||"",memo:t.memo||"",access:t.access||"",imageUrl:t.imageUrl||"",jobLogo:t.jobLogo||t.imageUrl||"",showVideoButton:!0===t.showVideoButton||"true"===t.showVideoButton,videoUrl:t.videoUrl||""},a=await l(e,n,t.id?String(t.id):null);if(!a.success)throw new Error(a.error)}async function $o(e,t){if(!t)return;const n=await v(e,t);if(!n.success)throw new Error(n.error)}function ko(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="flex"),t&&(t.style.display="none")}function xo(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="none"),t&&(t.style.display="flex"),function(){De();const e=h(),t=document.getElementById("nav-admin"),n=document.getElementById("nav-company"),a=window.location.hash.slice(1);let o=null;if(b())t&&(t.style.display="block"),n&&(n.style.display="none"),o=a||"overview";else{t&&(t.style.display="none"),n&&(n.style.display="block"),o=a||"job-listings";const s=document.querySelector(".sidebar-header p");s&&e&&(s.textContent=`${e} 管理画面`),function(){const e=document.getElementById("section-settings");if(!e)return;e.querySelectorAll(".admin-only-section").forEach(e=>{e.style.display="none"});e.querySelectorAll(".company-only-section").forEach(e=>{e.style.display="block"});const t=["スプレッドシート連携","API設定","レガシー管理者パスワード"];e.querySelectorAll(".settings-card").forEach(e=>{var n;const a=null==(n=e.querySelector("h3"))?void 0:n.textContent;t.includes(a)&&(e.style.display="none")})}()}history.replaceState({section:o,company:null},"",`#${o}`),So(o,{pushState:!1})}()}function Do(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.remove("open"),t&&t.classList.remove("active"),n&&n.classList.remove("active"),document.body.style.overflow=""}async function So(t,a={}){const{pushState:s=!0,company:i=null}=a;if(_n)return;if("job-manage-company"===t){const e=h();if(e)return void Ao(e,e,"overview",null,"jobs")}if(_n=!0,s){const e={section:t,company:i||("job-manage"===t?{domain:Mn.domain,name:Mn.name}:null)};history.pushState(e,"",`#${t}`)}Do(),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const c=document.querySelector(`[data-section="${t}"]`);c&&c.parentElement.classList.add("active"),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});let l=document.getElementById(`section-${t}`);if(!l){const e=document.getElementById("section-container");if(e)try{const n=await po(t),a=document.createElement("div");a.innerHTML=n,l=a.firstElementChild,l&&e.appendChild(l)}catch(u){return console.error(`[Admin] Failed to load section: ${t}`,u),void Fn()}}l&&l.classList.add("active");const r={overview:"概要","analytics-detail":"詳細分析","company-manage":"会社管理","job-listings":"求人一覧","job-manage":"求人管理","company-edit":"会社編集","lp-settings":"LP設定","recruit-settings":"採用ページ設定","applicant-select":"応募者管理","company-users":"会社ユーザー管理",settings:"設定"},d=document.getElementById("page-title");if(d&&("job-manage"===t&&Mn.name?d.textContent=`${Mn.name} の求人管理`:d.textContent=r[t]||t),"company-manage"===t){le();const e=document.getElementById("btn-add-company");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",()=>ie()),e.setAttribute("data-listener-attached","true"))}if("lp-settings"===t){Ce(),te(),Z();const e=document.getElementById("btn-save-lp-settings");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",()=>Q()),e.setAttribute("data-listener-attached","true"));const t=document.getElementById("btn-reset-lp-settings");t&&!t.hasAttribute("data-listener-attached")&&(t.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-job-select"))?void 0:e.value;t&&ee(t)}),t.setAttribute("data-listener-attached","true")),document.querySelectorAll("#section-lp-settings .collapsible-header").forEach(e=>{e.hasAttribute("data-listener-attached")||(e.addEventListener("click",()=>{const t=e.closest(".collapsible");t&&t.classList.toggle("collapsed")}),e.setAttribute("data-listener-attached","true"))}),document.querySelectorAll("#ad-tracking-section, #ogp-section").forEach(e=>{e.classList.contains("collapsed")||e.classList.add("collapsed")})}"recruit-settings"===t&&En(),"job-listings"===t&&xn(),"analytics-detail"===t&&(Nt(),Mt());const m=document.querySelector(".header-actions");if(m){const e=["overview","analytics-detail"];m.style.display=e.includes(t)?"":"none"}if(document.body.classList.toggle("lp-settings-active","lp-settings"===t),"applicant-select"===t&&async function(){const e=document.getElementById("applicant-company-grid");if(!e)return;e.innerHTML='<div class="loading-cell">会社一覧を読み込み中...</div>';try{const t=await n();if(!b()){const e=h();if(e){const n=t.find(t=>t.companyDomain===e),a=(null==n?void 0:n.company)||e;return void setTimeout(()=>{Ao(e,a,"applicant-select",null,"applicants")},50)}}if(!t||0===t.length)return void(e.innerHTML='<div class="loading-cell">会社データがありません</div>');let a=t.filter(e=>o(e));if(!b()){const e=h();a=a.filter(t=>t.companyDomain===e)}if(0===a.length)return void(e.innerHTML='<div class="loading-cell">表示可能な会社がありません</div>');e.innerHTML=a.map(e=>`\n      <div class="company-select-card" data-domain="${Me(e.companyDomain)}" data-name="${Me(e.company)}">\n        <div class="company-select-icon">🏢</div>\n        <div class="company-select-info">\n          <h4>${Me(e.company)}</h4>\n          <p>${Me(e.companyDomain)}</p>\n        </div>\n        <div class="company-select-arrow">→</div>\n      </div>\n    `).join(""),e.querySelectorAll(".company-select-card").forEach(e=>{e.addEventListener("click",()=>{Ao(e.dataset.domain,e.dataset.name,"applicant-select",null,"applicants")})})}catch(u){console.error("会社一覧取得エラー:",u),e.innerHTML='<div class="loading-cell">会社一覧の取得に失敗しました</div>'}}(),"company-users"===t){_o();const e=document.getElementById("btn-add-company-user");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",()=>Po(null,"")),e.setAttribute("data-listener-attached","true"));const t=document.getElementById("btn-bulk-generate");t&&!t.hasAttribute("data-listener-attached")&&(t.addEventListener("click",()=>No()),t.setAttribute("data-listener-attached","true")),function(){const e=document.getElementById("company-user-modal-close");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",Uo),e.setAttribute("data-listener-attached","true"));const t=document.getElementById("company-user-modal-cancel");t&&!t.hasAttribute("data-listener-attached")&&(t.addEventListener("click",Uo),t.setAttribute("data-listener-attached","true"));const n=document.getElementById("company-user-form");n&&!n.hasAttribute("data-listener-attached")&&(n.addEventListener("submit",e=>{e.preventDefault(),Fo()}),n.setAttribute("data-listener-attached","true"));const a=document.getElementById("company-user-delete");a&&!a.hasAttribute("data-listener-attached")&&(a.addEventListener("click",zo),a.setAttribute("data-listener-attached","true"));const o=document.getElementById("cu-generate-password");o&&!o.hasAttribute("data-listener-attached")&&(o.addEventListener("click",()=>{const e=document.getElementById("cu-password");e&&(e.value=pe())}),o.setAttribute("data-listener-attached","true"));const s=document.getElementById("cu-copy-credentials");s&&!s.hasAttribute("data-listener-attached")&&(s.addEventListener("click",Jo),s.setAttribute("data-listener-attached","true"));const i=document.getElementById("company-user-modal");i&&!i.hasAttribute("data-listener-attached")&&(i.addEventListener("click",e=>{e.target===i&&Uo()}),i.setAttribute("data-listener-attached","true"))}()}if("settings"===t){const{isAdmin:t}=await e(async()=>{const{isAdmin:e}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{isAdmin:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t()?(Oo(),Vo()):(Wo(),function(){const t=document.getElementById("add-company-staff");t&&!t.hasAttribute("data-listener-attached")&&(t.setAttribute("data-listener-attached","true"),t.addEventListener("click",async()=>{var n,a,o,s,i,c,l;const r=null==(a=null==(n=document.getElementById("staff-email"))?void 0:n.value)?void 0:a.trim(),d=null==(s=null==(o=document.getElementById("staff-name"))?void 0:o.value)?void 0:s.trim(),m=null==(c=null==(i=document.getElementById("staff-username"))?void 0:i.value)?void 0:c.trim(),p=null==(l=document.getElementById("staff-password"))?void 0:l.value;if(r)if(!p||p.length<6)qe("パスワードは6文字以上で入力してください","error");else{t.disabled=!0,t.textContent="追加中...";try{const{addCompanyStaff:t}=await e(async()=>{const{addCompanyStaff:e}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{addCompanyStaff:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),n=await t(r,p,d,m);n.success?(qe(`スタッフを追加しました: ${r}`,"success"),document.getElementById("staff-email").value="",document.getElementById("staff-name").value="",document.getElementById("staff-username").value="",document.getElementById("staff-password").value="",await Wo()):qe(n.error||"追加に失敗しました","error")}catch(u){qe("エラーが発生しました: "+u.message,"error")}finally{t.disabled=!1,t.textContent="スタッフを追加"}}else qe("メールアドレスを入力してください","error")}))}()),function(){const e=document.getElementById("feed-status"),t=()=>{e&&(e.style.display="block",e.textContent="フィード生成中...")},n=()=>{e&&(e.style.display="none")},a=document.getElementById("btn-download-indeed");a&&!a.hasAttribute("data-listener-attached")&&(a.addEventListener("click",async()=>{try{t(),await ve(),qe("Indeed XMLフィードをダウンロードしました","success")}catch(u){qe("フィード生成に失敗しました: "+u.message,"error")}finally{n()}}),a.setAttribute("data-listener-attached","true"));const o=document.getElementById("btn-download-google");o&&!o.hasAttribute("data-listener-attached")&&(o.addEventListener("click",async()=>{try{t(),await be(),qe("Google JSON-LDをダウンロードしました","success")}catch(u){qe("フィード生成に失敗しました: "+u.message,"error")}finally{n()}}),o.setAttribute("data-listener-attached","true"));const s=document.getElementById("btn-download-jobbox");s&&!s.hasAttribute("data-listener-attached")&&(s.addEventListener("click",async()=>{try{t(),await fe(),qe("求人ボックスXMLをダウンロードしました","success")}catch(u){qe("フィード生成に失敗しました: "+u.message,"error")}finally{n()}}),s.setAttribute("data-listener-attached","true"));const i=document.getElementById("btn-download-csv");i&&!i.hasAttribute("data-listener-attached")&&(i.addEventListener("click",async()=>{try{t(),await he(),qe("CSVをダウンロードしました","success")}catch(u){qe("フィード生成に失敗しました: "+u.message,"error")}finally{n()}}),i.setAttribute("data-listener-attached","true"))}()}if("job-manage"===t){const e=document.getElementById("jm-back-btn");if(e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",Co),e.setAttribute("data-listener-attached","true")),Mn.domain&&Mn.name){const e=qn;qn=null,ia(Mn.domain,Mn.name,e)}}"company-edit"===t&&Za(Hn),"company-detail"===t&&rn(),requestAnimationFrame(()=>{Fn()})}function Ao(e,t,n="job-listings",a=null,o=null){Un(e,t),a&&function(e){qn=e}(a),o&&(Rn=o),So("job-manage")}function Co(){history.back()}function To(){document.getElementById("company-select-modal");const e=document.getElementById("company-select-list");e&&e.addEventListener("click",async e=>{const t=e.target.closest(".company-select-item");if(!t)return;const n=t.dataset.domain,a=await Se(n);a.success?(!function(){const e=document.getElementById("company-select-modal");e&&(e.style.display="none")}(),xo(),Ao(a.companyDomain,a.companyName,"overview",null,"jobs")):qe(a.error||"会社の選択に失敗しました","error")})}function Mo(){console.log("bindEvents called"),window.addEventListener("popstate",e=>{e.state&&e.state.section&&(e.state.company?Un(e.state.company.domain,e.state.company.name):(Mn.domain=null,Mn.name=null),Hn=null,So(e.state.section,{pushState:!1}))});const t=document.getElementById("mobile-menu-btn");t&&t.addEventListener("click",()=>{const e=document.getElementById("admin-sidebar");e&&e.classList.contains("open")?Do():function(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.add("open"),t&&t.classList.add("active"),n&&n.classList.add("active"),document.body.style.overflow="hidden"}()});const n=document.getElementById("sidebar-close-btn");n&&n.addEventListener("click",Do);const a=document.getElementById("mobile-overlay");a&&a.addEventListener("click",Do),console.log("Setting up login tabs, found:",document.querySelectorAll(".login-tab").length),document.querySelectorAll(".login-tab").forEach(e=>{e.addEventListener("click",()=>{console.log("Tab clicked:",e.dataset.tab);const t=e.dataset.tab;document.querySelectorAll(".login-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active");const n=document.getElementById("company-login-form"),a=document.getElementById("login-form");"company"===t?(n&&(n.style.display="block"),a&&(a.style.display="none")):(n&&(n.style.display="none"),a&&(a.style.display="block"))})});const o=document.getElementById("company-login-form");o&&o.addEventListener("submit",async e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("company-email"))?void 0:t.value)||"",o=(null==(n=document.getElementById("company-password"))?void 0:n.value)||"",s=document.getElementById("company-login-error");s&&(s.style.display="none");const i=await Ee(a,o);i.success?i.requiresCompanySelection?function(e){const t=document.getElementById("company-select-modal"),n=document.getElementById("company-select-list");t&&n&&(n.innerHTML=e.map(e=>`\n    <div class="company-select-item" data-domain="${Me(e.companyDomain)}">\n      <div class="company-icon">🏢</div>\n      <div class="company-info">\n        <div class="company-name">${Me(e.companyName)}</div>\n        <div class="company-domain">${Me(e.companyDomain)}</div>\n      </div>\n      <div class="arrow-icon">→</div>\n    </div>\n  `).join(""),t.style.display="flex")}(i.companies):(xo(),Ao(i.companyDomain,i.companyName||i.companyDomain,"overview",null,"jobs")):s&&(s.textContent=i.error,s.style.display="block")}),To();const s=document.getElementById("company-password-reset-link");s&&s.addEventListener("click",async t=>{var n;t.preventDefault();const a=(null==(n=document.getElementById("company-email"))?void 0:n.value)||"";if(!a)return void qe("メールアドレスまたはユーザーIDを入力してください","error");if(!a.includes("@"))return void qe("パスワードリセットにはメールアドレスが必要です。ユーザーIDでログインしている場合は、管理者にお問い合わせください。","error");const{sendPasswordResetEmail:o}=await e(async()=>{const{sendPasswordResetEmail:e}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{sendPasswordResetEmail:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),s=await o(a);s.success?qe("パスワードリセットメールを送信しました","success"):qe(s.error||"パスワードリセットメールの送信に失敗しました","error")});const i=document.getElementById("login-form");i&&i.addEventListener("submit",e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("password"))?void 0:n.value)||"",s=document.getElementById("login-error"),i=we(a,o);i.success?(s&&(s.style.display="none"),xo(),Mt()):s&&(s.textContent=i.error,s.style.display="block")});const c=document.getElementById("logout-btn");c&&c.addEventListener("click",()=>{je(),ko()}),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();So(e.currentTarget.dataset.section)})});const l=document.getElementById("refresh-btn");l&&l.addEventListener("click",()=>Mt());const r=document.getElementById("company-search");r&&r.addEventListener("input",e=>Ft(e.target.value));const d=document.getElementById("sort-by");d&&d.addEventListener("change",()=>zt());const m=document.getElementById("google-login-btn");m&&m.addEventListener("click",async()=>{const e=document.getElementById("login-error"),t=await Ie();t.success?(e&&(e.style.display="none"),xo(),Mt()):e&&(e.textContent=t.error,e.style.display="block")});const u=document.getElementById("btn-add-company");u&&u.addEventListener("click",()=>ie());const p=document.getElementById("lp-job-select");p&&p.addEventListener("change",e=>ee(e.target.value));const y=document.getElementById("btn-save-lp-settings");y&&y.addEventListener("click",()=>{Q()});const g=document.getElementById("btn-reset-lp-settings");g&&g.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-job-select"))?void 0:e.value;t&&ee(t)});const v=document.getElementById("btn-toggle-preview");v&&v.addEventListener("click",()=>X());const b=document.getElementById("btn-close-preview");b&&b.addEventListener("click",()=>K()),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");document.querySelectorAll(".preview-device-btn").forEach(e=>{e.classList.toggle("active",e.dataset.device===t)}),n&&n.setAttribute("data-device",t)})});document.querySelectorAll("#lp-editor input, #lp-editor textarea").forEach(e=>{e.addEventListener("input",()=>Y())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>W())}),G(),Be(),Le(),$e();const f=document.getElementById("lp-editor");f&&function(e={}){const{onSave:t,onEscape:n,scope:a=document}=e,o=e=>{if((e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),t&&t(e)),"Escape"===e.key){const t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName))return void t.blur();n&&n(e)}};a.addEventListener("keydown",o)}({onSave:()=>{const e=document.getElementById("section-lp-settings");e&&!e.classList.contains("hidden")&&Q()},scope:f}),document.querySelectorAll('#lp-section-order input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>W())}),document.querySelectorAll(".collapsible-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".collapsible");t&&t.classList.toggle("collapsed")})}),document.querySelectorAll("#ad-tracking-section, #ogp-section").forEach(e=>{e.classList.add("collapsed")});const h=document.getElementById("save-password");h&&h.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("new-password"))?void 0:e.value;t&&t.length>=4?(localStorage.setItem("admin_password",t),qe("パスワードを変更しました","success")):qe("パスワードは4文字以上で入力してください","error")}),Vo();const E=document.getElementById("feed-status"),w=()=>{E&&(E.style.display="flex")},j=()=>{E&&(E.style.display="none")},I=document.getElementById("btn-download-indeed");I&&I.addEventListener("click",async()=>{try{w(),await ve(),qe("Indeed XMLフィードをダウンロードしました","success")}catch(e){qe("フィード生成に失敗しました: "+e.message,"error")}finally{j()}});const B=document.getElementById("btn-download-google");B&&B.addEventListener("click",async()=>{try{w(),await be(),qe("Google JSON-LDをダウンロードしました","success")}catch(e){qe("フィード生成に失敗しました: "+e.message,"error")}finally{j()}});const L=document.getElementById("btn-download-jobbox");L&&L.addEventListener("click",async()=>{try{w(),await fe(),qe("求人ボックスXMLをダウンロードしました","success")}catch(e){qe("フィード生成に失敗しました: "+e.message,"error")}finally{j()}});const $=document.getElementById("btn-download-csv");$&&$.addEventListener("click",async()=>{try{w(),await he(),qe("CSVをダウンロードしました","success")}catch(e){qe("フィード生成に失敗しました: "+e.message,"error")}finally{j()}});const k=document.getElementById("btn-add-company-user");k&&k.addEventListener("click",()=>{Po(null,"")});const x=document.getElementById("btn-bulk-generate");x&&x.addEventListener("click",()=>No());const D=document.getElementById("company-user-modal-close");D&&D.addEventListener("click",Uo);const S=document.getElementById("company-user-modal-cancel");S&&S.addEventListener("click",Uo);const A=document.getElementById("company-user-form");A&&A.addEventListener("submit",e=>{e.preventDefault(),Fo()});const C=document.getElementById("company-user-delete");C&&C.addEventListener("click",zo);const T=document.getElementById("cu-generate-password");T&&T.addEventListener("click",()=>{const e=document.getElementById("cu-password");e&&(e.value=pe())});const M=document.getElementById("cu-copy-credentials");M&&M.addEventListener("click",Jo);const H=document.getElementById("company-user-modal");H&&H.addEventListener("click",e=>{e.target===H&&Uo()}),document.addEventListener("navigateToSection",e=>{const{section:t,companyDomain:n,company:a}=e.detail;"job-listings"===t?(n&&function(e){if(kn=e,Bn.length>0){const t=document.getElementById("job-company-filter");t&&(t.value=e||"",Sn())}}(n),So("job-listings")):"recruit-settings"===t&&(n&&function(e){hn=e}(n),So("recruit-settings"))});const q=document.getElementById("jm-back-btn");q&&q.addEventListener("click",Co)}let Ho=[],qo=[],Ro=null;async function _o(){const e=document.getElementById("company-users-tbody");if(e){e.innerHTML='<tr><td colspan="8" class="loading-cell">データを読み込み中...</td></tr>';try{Ho=await n(),qo=await me();const t={};qo.forEach(e=>{t[e.companyDomain]||(t[e.companyDomain]=[]),t[e.companyDomain].push(e)});const a=Ho.filter(e=>o(e));if(0===a.length)return void(e.innerHTML='<tr><td colspan="8" class="loading-cell">会社データがありません</td></tr>');let s="";a.forEach(e=>{const n=t[e.companyDomain]||[];0===n.length?s+=`\n          <tr data-company-domain="${Me(e.companyDomain)}">\n            <td>${Me(e.company)}</td>\n            <td><span class="badge warning">未発行</span></td>\n            <td>-</td>\n            <td>-</td>\n            <td><span class="badge">-</span></td>\n            <td>-</td>\n            <td>-</td>\n            <td>\n              <button class="btn-small btn-primary btn-issue-user" data-domain="${Me(e.companyDomain)}" data-company="${Me(e.company)}">\n                ID発行\n              </button>\n            </td>\n          </tr>\n        `:n.forEach((t,a)=>{const o=!1!==t.isActive,i=t.createdAt?new Date(t.createdAt).toLocaleDateString("ja-JP"):"-",c=t.lastLogin?new Date(t.lastLogin).toLocaleString("ja-JP"):"未ログイン",l="admin"===t.role?'<span class="badge primary">管理者</span>':'<span class="badge">担当者</span>';s+=`\n            <tr data-user-id="${Me(t.id)}">\n              ${0===a?`<td rowspan="${n.length}">${Me(e.company)}</td>`:""}\n              <td><code>${Me(t.username)}</code></td>\n              <td>${Me(t.name||"-")}</td>\n              <td>${l}</td>\n              <td>${o?'<span class="badge success">有効</span>':'<span class="badge">無効</span>'}</td>\n              <td>${i}</td>\n              <td>${c}</td>\n              <td>\n                <div class="action-buttons">\n                  <button class="btn-small btn-secondary btn-reset-password" data-user-id="${Me(t.id)}" data-username="${Me(t.username)}">\n                    PW再発行\n                  </button>\n                  <button class="btn-small btn-edit-user" data-user-id="${Me(t.id)}">編集</button>\n                </div>\n              </td>\n            </tr>\n          `})}),e.innerHTML=s,document.querySelectorAll(".btn-issue-user").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.domain;e.dataset.company,Po(null,t)})}),document.querySelectorAll(".btn-edit-user").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.userId,n=qo.find(e=>e.id===t);if(n){const e=Ho.find(e=>e.companyDomain===n.companyDomain);Po(n,n.companyDomain,(null==e?void 0:e.company)||n.companyDomain)}})}),document.querySelectorAll(".btn-reset-password").forEach(e=>{e.addEventListener("click",async()=>{const t=e.dataset.userId,n=e.dataset.username;await async function(e,t){const n=await nt({title:"パスワードの再発行",message:`${t} のパスワードを再発行しますか？`,confirmText:"再発行する",cancelText:"キャンセル"});if(!n)return;const a=pe();try{const n=await Ae(e,a);if(!n.success)throw new Error(n.error);try{await navigator.clipboard.writeText(`ユーザーID: ${t}\nパスワード: ${a}`),qe("新しいパスワードをクリップボードにコピーしました","success")}catch{qe("パスワードを再発行しました","success")}}catch(o){console.error("パスワード再発行エラー:",o),qe("パスワードの再発行に失敗しました: "+o.message,"error")}}(t,n)})})}catch(t){console.error("会社ユーザー一覧取得エラー:",t),e.innerHTML='<tr><td colspan="8" class="loading-cell">データの取得に失敗しました</td></tr>'}}}function Po(e,t,n){const a=document.getElementById("company-user-modal"),s=document.getElementById("company-user-modal-title"),i=document.getElementById("cu-company-select"),c=document.getElementById("cu-username"),l=document.getElementById("cu-password"),r=document.getElementById("cu-name"),d=document.getElementById("cu-role"),m=document.getElementById("cu-is-active"),u=document.getElementById("company-user-delete"),p=document.getElementById("cu-credentials-display");if(!a)return;const y=Ho.filter(e=>o(e));i.innerHTML=y.map(e=>`\n    <option value="${Me(e.companyDomain)}" ${e.companyDomain===t?"selected":""}>\n      ${Me(e.company)}\n    </option>\n  `).join(""),e?(s.textContent="会社ユーザーの編集",c.value=e.username||"",l.value="",l.placeholder="変更する場合のみ入力",l.required=!1,r&&(r.value=e.name||""),d&&(d.value=e.role||"staff"),m.checked=!1!==e.isActive,u.style.display="",Ro=e.id):(s.textContent="会社ユーザーの追加",c.value=ue(t),l.value=pe(),l.placeholder="パスワード",l.required=!0,r&&(r.value=""),d&&(d.value="staff"),m.checked=!0,u.style.display="none",Ro=null),p.style.display="none",a.style.display="flex"}function Uo(){const e=document.getElementById("company-user-modal");e&&(e.style.display="none"),Ro=null}async function Fo(){var e,t,n,a,o,s,i,c,l,r;const d=null==(e=document.getElementById("cu-company-select"))?void 0:e.value,m=null==(n=null==(t=document.getElementById("cu-email"))?void 0:t.value)?void 0:n.trim(),u=null==(a=document.getElementById("cu-password"))?void 0:a.value,p=(null==(s=null==(o=document.getElementById("cu-name"))?void 0:o.value)?void 0:s.trim())||"",y=(null==(c=null==(i=document.getElementById("cu-username"))?void 0:i.value)?void 0:c.trim())||"",g=(null==(l=document.getElementById("cu-role"))?void 0:l.value)||"staff",v=null==(r=document.getElementById("cu-is-active"))?void 0:r.checked;if(!d||!m)return void qe("必須項目を入力してください","error");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m))return void qe("メールアドレスの形式が正しくありません","error");const b=document.getElementById("company-user-modal-save");b&&(b.disabled=!0,b.textContent="保存中...");try{if(Ro){const e={name:p,role:g,isActive:v};y&&(e.username=y);const t=await ke(Ro,e);if(!t.success)throw new Error(t.error);qe("ユーザー情報を更新しました","success"),Uo()}else{if(!u)return void qe("パスワードを入力してください","error");if(u.length<8)return void qe("パスワードは8文字以上で入力してください","error");const e=await ge(m,u,d,p,g,y);if(!e.success)throw new Error(e.error);const t=document.getElementById("cu-issued-email");t&&(t.textContent=m),document.getElementById("cu-issued-password").textContent=u,document.getElementById("cu-credentials-display").style.display="block",b&&(b.textContent="完了",b.onclick=()=>{Uo(),_o()}),e._isLegacy?qe("ユーザーを作成しました（レガシーモード）。Cloud Functionの設定を推奨します。","warning"):qe("ユーザーを作成しました","success")}await _o()}catch(f){console.error("ユーザー保存エラー:",f),qe("保存に失敗しました: "+f.message,"error")}finally{b&&!Ro||b&&(b.disabled=!1,b.textContent="保存")}}async function zo(){if(!Ro)return;if(await nt({title:"ユーザーの削除",message:"このユーザーを削除してもよろしいですか？",confirmText:"削除する",cancelText:"キャンセル",danger:!0}))try{const e=await xe(Ro);if(!e.success)throw new Error(e.error);qe("ユーザーを削除しました","success"),Uo(),await _o()}catch(e){console.error("ユーザー削除エラー:",e),qe("削除に失敗しました: "+e.message,"error")}}async function No(){if(!(await nt({title:"ユーザーIDの一括発行",message:"未発行の全会社にユーザーIDを発行しますか？",confirmText:"発行する",cancelText:"キャンセル"})))return;const e=Ho.filter(e=>o(e)),t=[];for(const o of e){if(await ye(o.companyDomain))continue;const e=ue(o.companyDomain),n=pe();(await ge(e,n,o.companyDomain,o.company)).success&&t.push({company:o.company,domain:o.companyDomain,username:e,password:n})}if(0===t.length)return void qe("発行対象の会社がありませんでした","info");let n=`${t.length}社にユーザーIDを発行しました。\n\n`;t.forEach(e=>{n+=`【${e.company}】\nID: ${e.username}\nPW: ${e.password}\n\n`});const a=new Blob([n],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`company-users-${(new Date).toISOString().split("T")[0]}.txt`,i.click(),URL.revokeObjectURL(s),qe(`${t.length}社にユーザーIDを発行しました`,"success"),await _o()}function Jo(){var e,t;const n=null==(e=document.getElementById("cu-issued-email"))?void 0:e.textContent,a=null==(t=document.getElementById("cu-issued-password"))?void 0:t.textContent;if(n&&a){const e=`メールアドレス: ${n}\nパスワード: ${a}`;navigator.clipboard.writeText(e).then(()=>{qe("クリップボードにコピーしました","success")}).catch(()=>{qe("コピーに失敗しました","error")})}}function Vo(){const t=document.getElementById("add-admin-user");t&&!t.hasAttribute("data-listener-attached")&&(t.setAttribute("data-listener-attached","true"),t.addEventListener("click",async()=>{var n,a;const o=null==(a=null==(n=document.getElementById("admin-email"))?void 0:n.value)?void 0:a.trim();if(o){t.disabled=!0,t.textContent="追加中...";try{const{addAdminUserByEmail:t}=await e(async()=>{const{addAdminUserByEmail:e}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{addAdminUserByEmail:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),n=await t(o);n.success?(qe(`管理者を追加しました: ${o}`,"success"),document.getElementById("admin-email").value="",await Oo()):qe(n.error||"追加に失敗しました","error")}catch(s){qe("エラーが発生しました: "+s.message,"error")}finally{t.disabled=!1,t.textContent="管理者を追加"}}else qe("メールアドレスを入力してください","error")}))}async function Oo(){const t=document.getElementById("admin-users-list");if(t){t.innerHTML='<div class="loading-spinner-small"></div><span>読み込み中...</span>';try{const{getAdminUsers:n,getCurrentUser:a}=await e(async()=>{const{getAdminUsers:e,getCurrentUser:t}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{getAdminUsers:e,getCurrentUser:t}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),o=a();if(!o)return void(t.innerHTML='\n        <div class="admin-users-notice">\n          <p>管理者ユーザー一覧を表示するには、<strong>Googleでログイン</strong>してください。</p>\n          <p style="font-size: 0.875rem; color: var(--text-muted);">レガシー認証（admin/password）ではこの機能は使用できません。</p>\n        </div>\n      ');const s=await n();if(0===s.length)return void(t.innerHTML='<p style="color: var(--text-muted);">登録されている管理者はいません</p>');t.innerHTML=s.map(e=>`\n      <div class="admin-user-item" data-id="${e.id}">\n        <div class="admin-user-info">\n          <span class="admin-user-email">${e.email||"(メールなし)"}</span>\n          ${e.id===o.uid?'<span class="admin-user-badge">あなた</span>':""}\n          <span class="admin-user-date">${e.createdAt?e.createdAt.toLocaleDateString("ja-JP"):""}</span>\n        </div>\n        ${e.id!==o.uid?`\n          <button class="btn-delete-admin" data-id="${e.id}" data-email="${e.email}">削除</button>\n        `:""}\n      </div>\n    `).join(""),t.querySelectorAll(".btn-delete-admin").forEach(t=>{t.addEventListener("click",async()=>{const n=t.dataset.id,a=t.dataset.email;if(confirm(`管理者 "${a}" を削除してよろしいですか？`)){t.disabled=!0,t.textContent="削除中...";try{const{deleteAdminUser:t}=await e(async()=>{const{deleteAdminUser:e}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{deleteAdminUser:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),a=await t(n);a.success?(qe("管理者を削除しました","success"),await Oo()):qe(a.error||"削除に失敗しました","error")}catch(o){qe("エラーが発生しました: "+o.message,"error")}finally{t.disabled=!1,t.textContent="削除"}}})})}catch(n){console.error("Failed to load admin users:",n),t.innerHTML='<p style="color: var(--error-color);">読み込みに失敗しました</p>'}}}async function Wo(){const t=document.getElementById("company-staff-list");if(t){t.innerHTML='<div class="loading-spinner-small"></div><span>読み込み中...</span>';try{const{getCompanyUsers:n,getUserCompanyDomain:a}=await e(async()=>{const{getCompanyUsers:e,getUserCompanyDomain:t}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{getCompanyUsers:e,getUserCompanyDomain:t}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),o=a();if(!o)return void(t.innerHTML='<p style="color: var(--text-muted);">会社情報が見つかりません</p>');const s=await n(o);if(0===s.length)return void(t.innerHTML='<p style="color: var(--text-muted);">登録されているスタッフはいません</p>');const i=sessionStorage.getItem("company_user_id");t.innerHTML=s.map(e=>`\n      <div class="admin-user-item" data-id="${e.id}">\n        <div class="admin-user-info">\n          <span class="admin-user-email">${Me(e.name||e.username||e.email)}</span>\n          <span class="admin-user-date" style="font-size: 0.75rem; color: var(--text-muted);">${Me(e.email)}</span>\n          ${e.username===i||e.email===i?'<span class="admin-user-badge">あなた</span>':""}\n        </div>\n        ${e.username!==i&&e.email!==i?`\n          <button class="btn-delete-admin" data-id="${e.id}" data-name="${Me(e.name||e.username||e.email)}">削除</button>\n        `:""}\n      </div>\n    `).join(""),t.querySelectorAll(".btn-delete-admin").forEach(t=>{t.addEventListener("click",async()=>{const n=t.dataset.id,a=t.dataset.name;if(confirm(`スタッフ "${a}" を削除してよろしいですか？`)){t.disabled=!0,t.textContent="削除中...";try{const{deleteCompanyStaff:t}=await e(async()=>{const{deleteCompanyStaff:e}=await import("./job-edit-utils-DcWUcJyi.js").then(e=>e.aT);return{deleteCompanyStaff:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),a=await t(n);a.success?(qe("スタッフを削除しました","success"),await Wo()):qe(a.error||"削除に失敗しました","error")}catch(o){qe("エラーが発生しました: "+o.message,"error")}finally{t.disabled=!1,t.textContent="削除"}}})})}catch(n){console.error("Failed to load company staff:",n),t.innerHTML='<p style="color: var(--error-color);">読み込みに失敗しました</p>'}}}function Go(){const e=localStorage.getItem("admin_password");e&&(s.credentials.password=e),re(),t().then(()=>{de()?(xo(),document.addEventListener("authReady",async()=>{Mt()},{once:!0}),setTimeout(async()=>{f()||Mt()},3e3)):ko()}),Mo(),jt(()=>{Mt();const e=document.getElementById("page-analytics-tab");e&&e.classList.contains("active")&&gn()}),Nt(),function(){const e=document.querySelectorAll(".page-type-btn");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.classList.add("active"),yn=t.dataset.type,gn()})})}();const n=document.getElementById("tab-page-analytics");n&&n.addEventListener("click",()=>{gn()}),rn()}"undefined"!=typeof window&&(window.AdminDashboard={config:s,init:Go,switchSection:So,getIdToken:f,navigateToJobManage:Ao,navigateBack:Co,navigateToCompanyEdit:function(e,t="company-manage"){!function(e){Hn=e}(e),So("company-edit")}},window.AdminAnalytics={loadDashboardData:Mt,filterCompanies:Ft,sortCompanies:zt},window.AdminCompany={loadCompanyManageData:le,editCompany:ce,showCompanyModal:ie,closeCompanyModal:se,saveCompanyData:oe,renderCompanyTable:ae,openJobsArea:ne,loadCompanyListForLP:te,loadLPSettings:ee,saveLPSettings:Q,renderHeroImagePresets:Z,toggleLPPreview:X,closeLPPreview:K,debouncedUpdatePreview:Y,initSectionSortable:G,updateLPPreview:W,getPatternLabel:e=>({standard:"スタンダード",modern:"モダン",classic:"クラシック",minimal:"ミニマル",colorful:"カラフル"}[e]||"スタンダード")},window.DataMigration={migrateAllData:async function(e){bo(),fo({status:"running",currentStep:"初期化中..."});try{c(),fo({currentStep:"会社一覧を取得中..."});const o=await ho();fo({companiesTotal:o.length}),e&&e(vo());for(let s=0;s<o.length;s++){const i=o[s],c=i.companyDomain||i.domain;if(c){try{fo({currentStep:`会社を移行中: ${c}`}),await Bo(i),fo({currentStep:`${c} の求人を取得中...`});const e=await Eo(c);fo({jobsTotal:go.jobsTotal+e.length});for(const n of e)try{await Lo(c,n),fo({jobsDone:go.jobsDone+1})}catch(t){go.errors.push(`${c}/job ${n.id}: ${t.message}`)}try{const e=await wo(c);e&&await $o(c,e)}catch(n){go.errors.push(`${c}/recruitSettings: ${n.message}`)}fo({companiesDone:s+1})}catch(a){go.errors.push(`${c}: ${a.message}`)}e&&e(vo()),await new Promise(e=>setTimeout(e,100))}else go.errors.push(`会社 ${s+1}: ドメインなし`)}return fo({status:"completed",currentStep:"完了"}),e&&e(vo()),{success:!0,companiesCount:go.companiesDone,jobsCount:go.jobsDone,errors:go.errors}}catch(o){return fo({status:"error",currentStep:`エラー: ${o.message}`}),e&&e(vo()),{success:!1,error:o.message,errors:go.errors}}},migrateTestCompany:async function(e,t){bo(),fo({status:"running",currentStep:"初期化中..."});try{c(),fo({currentStep:"会社情報を取得中..."});const o=(await ho()).find(t=>(t.companyDomain||t.domain)===e);if(!o)throw new Error(`会社が見つかりません: ${e}`);fo({companiesTotal:1,currentStep:"会社を移行中..."}),await Bo(o),fo({companiesDone:1}),t&&t(vo()),fo({currentStep:"求人を取得中..."});const s=await Eo(e);fo({jobsTotal:s.length});for(const a of s){try{await Lo(e,a),fo({jobsDone:go.jobsDone+1})}catch(n){go.errors.push(`job ${a.id}: ${n.message}`)}t&&t(vo())}try{const t=await wo(e);t&&await $o(e,t)}catch(a){go.errors.push(`recruitSettings: ${a.message}`)}return fo({status:"completed",currentStep:"完了"}),t&&t(vo()),{success:!0,companiesCount:1,jobsCount:go.jobsDone,errors:go.errors}}catch(o){return fo({status:"error",currentStep:`エラー: ${o.message}`}),t&&t(vo()),{success:!1,error:o.message}}},migrateAllLPSettings:async function(e){bo(),fo({status:"running",currentStep:"初期化中..."});let t=0;try{c(),fo({currentStep:"会社一覧を取得中..."});const o=await ho();fo({companiesTotal:o.length}),e&&e(vo());for(let s=0;s<o.length;s++){const i=o[s],c=i.companyDomain||i.domain;if(c){try{fo({currentStep:`${c} のLP設定を取得中...`});const e=await Eo(c);for(const a of e){try{const e=await jo(c,a.id);e&&Object.keys(e).length>0&&(await Io(c,a.id,e),t++,fo({currentStep:`${c}/job ${a.id} のLP設定を移行完了`}))}catch(n){go.errors.push(`${c}/lp ${a.id}: ${n.message}`)}await new Promise(e=>setTimeout(e,50))}fo({companiesDone:s+1})}catch(a){go.errors.push(`${c}: ${a.message}`)}e&&e(vo())}}return fo({status:"completed",currentStep:"完了"}),e&&e(vo()),{success:!0,lpSettingsCount:t,errors:go.errors}}catch(o){return fo({status:"error",currentStep:`エラー: ${o.message}`}),e&&e(vo()),{success:!1,error:o.message,errors:go.errors}}},getMigrationProgress:vo}),console.log("admin.js loaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded fired"),Go()});
