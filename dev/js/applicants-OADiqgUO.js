import"./modulepreload-polyfill-YP0FEG5d.js";import{e}from"./utils-BE8OECDH.js";const t={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"};let n=null,a=null,l=[],s=[],i=1;let o=null,d=[];const c={new:"新規",contacted:"連絡済み",interviewing:"面接調整中",interviewed:"面接済み",hired:"採用",rejected:"不採用",withdrawn:"辞退"},r={apply:"応募",line:"LINE相談",consult:"お問い合わせ"},u={immediate:"すぐにでも","within-week":"1週間以内","within-month":"1ヶ月以内","within-2months":"2ヶ月以内",undecided:"未定・相談したい"},m={first_contact:{subject:"初回連絡",body:"{applicantName}様\n\nこの度は「{jobTitle}」にご応募いただき、誠にありがとうございます。\n\nご応募内容を確認させていただきました。\nつきましては、一度お電話にてお話をさせていただければと思います。\n\nご都合の良い日時をいくつかお知らせいただけますでしょうか。\n（平日10:00〜18:00の間でお願いできますと幸いです）\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n何卒よろしくお願いいたします。"},schedule_interview:{subject:"面接日程調整",body:"{applicantName}様\n\nお世話になっております。\n\n面接の日程調整についてご連絡いたします。\n\n下記の日程でご都合の良い日時はございますでしょうか。\n\n【候補日】\n・◯月◯日（◯）◯◯:00〜\n・◯月◯日（◯）◯◯:00〜\n・◯月◯日（◯）◯◯:00〜\n\n上記以外でもご調整可能ですので、ご希望の日時がございましたらお知らせください。\n\n何卒よろしくお願いいたします。"},interview_reminder:{subject:"面接リマインダー",body:"{applicantName}様\n\nお世話になっております。\n\n面接日程のリマインドをお送りいたします。\n\n【面接日時】◯月◯日（◯）◯◯:00〜\n【場所】〒◯◯◯-◯◯◯◯ ◯◯県◯◯市◯◯\n【持ち物】履歴書、筆記用具\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n当日お会いできることを楽しみにしております。"},document_request:{subject:"書類提出依頼",body:"{applicantName}様\n\nお世話になっております。\n\n選考を進めるにあたり、下記の書類をご提出いただけますでしょうか。\n\n【提出書類】\n・履歴書（写真貼付）\n・職務経歴書\n\n【提出方法】\nマイページからアップロード、またはメールにてご送付ください。\n\n【提出期限】\n◯月◯日（◯）まで\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n何卒よろしくお願いいたします。"},result_pending:{subject:"選考結果待ち",body:"{applicantName}様\n\nお世話になっております。\n\n先日は面接にお越しいただき、誠にありがとうございました。\n\n現在、社内にて選考を進めております。\n結果につきましては、◯月◯日頃までにご連絡させていただく予定です。\n\n今しばらくお待ちいただけますようお願い申し上げます。"},offer:{subject:"内定通知",body:"{applicantName}様\n\nお世話になっております。\n\nこの度は「{jobTitle}」の選考にご参加いただき、誠にありがとうございました。\n\n慎重に検討させていただいた結果、{applicantName}様を採用させていただくことになりました。\n\nつきましては、入社に関する詳細についてご説明させていただきたく、\nお電話にてご連絡させていただきます。\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n{applicantName}様と一緒に働けることを楽しみにしております。"},rejection:{subject:"不採用通知",body:"{applicantName}様\n\nお世話になっております。\n\nこの度は「{jobTitle}」にご応募いただき、誠にありがとうございました。\n\n慎重に検討させていただきましたが、誠に残念ながら今回はご期待に沿えない結果となりました。\n\nご応募いただいたことに心より感謝申し上げますとともに、\n{applicantName}様の今後のご活躍をお祈り申し上げます。"}};function p(){return firebase.apps.length||firebase.initializeApp(t),firebase.firestore()}function g(){const t=document.getElementById("detail-assignee");if(t){const n=t.value;t.innerHTML='<option value="">未割当</option>'+d.map(t=>`<option value="${e(t)}">${e(t)}</option>`).join(""),t.value=n}const n=document.getElementById("filter-assignee");if(n){const t=n.value;n.innerHTML='<option value="">すべて</option><option value="unassigned">未割当</option>'+d.map(t=>`<option value="${e(t)}">${e(t)}</option>`).join(""),n.value=t}}async function y(){var e;const t=document.getElementById("new-assignee-name"),a=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(a)if(d.includes(a))alert("この担当者は既に登録されています");else try{const e=p().collection("settings").doc(n||"global");d.push(a),await e.set({assignees:d,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),g(),f();const t=document.getElementById("detail-assignee");t&&(t.value=a)}catch(l){console.error("Failed to add assignee:",l),alert("担当者の追加に失敗しました: "+l.message)}else alert("担当者名を入力してください")}function v(){const e=document.getElementById("assignee-modal"),t=document.getElementById("new-assignee-name");e&&(e.style.display="flex"),t&&(t.value="",t.focus())}function f(){const e=document.getElementById("assignee-modal");e&&(e.style.display="none")}async function E(){const t=document.getElementById("applicants-tbody");t&&(t.innerHTML='<tr><td colspan="6" class="loading-cell">データを読み込み中...</td></tr>');try{let e=p().collection("applications");n&&(e=e.where("companyDomain","==",n)),e=e.orderBy("createdAt","desc");const t=await e.get();l=[],t.forEach(e=>{l.push({id:e.id,...e.data()})}),h(),I()}catch(a){console.error("Failed to load applicants:",a),t&&(t.innerHTML=`<tr><td colspan="6" class="error-cell">データの読み込みに失敗しました: ${e(a.message)}</td></tr>`)}}function h(){var e,t,n,a,o,d,c;const r=(null==(e=document.getElementById("filter-status"))?void 0:e.value)||"",u=(null==(t=document.getElementById("filter-type"))?void 0:t.value)||"",m=(null==(n=document.getElementById("filter-assignee"))?void 0:n.value)||"",p=(null==(a=document.getElementById("filter-date-from"))?void 0:a.value)||"",g=(null==(o=document.getElementById("filter-date-to"))?void 0:o.value)||"",y=(null==(c=null==(d=document.getElementById("filter-search"))?void 0:d.value)?void 0:c.toLowerCase())||"";s=l.filter(e=>{var t,n;if(r&&(e.status||"new")!==r)return!1;if(u&&e.type!==u)return!1;if(m)if("unassigned"===m){if(e.assignee)return!1}else if(e.assignee!==m)return!1;const a=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt);if(p){const e=new Date(p);if(e.setHours(0,0,0,0),a<e)return!1}if(g){const e=new Date(g);if(e.setHours(23,59,59,999),a>e)return!1}if(y){const t=(e.jobTitle||"").toLowerCase(),a=((null==(n=e.applicant)?void 0:n.name)||"").toLowerCase();if(!t.includes(y)&&!a.includes(y))return!1}return!0}),i=1,b(),w()}function I(){const e=l.length,t=l.filter(e=>!e.status||"new"===e.status).length,n=l.filter(e=>["contacted","interviewing","interviewed"].includes(e.status)).length,a=l.filter(e=>["hired","rejected","withdrawn"].includes(e.status)).length,s=document.getElementById("stat-total"),i=document.getElementById("stat-new"),o=document.getElementById("stat-progress"),d=document.getElementById("stat-complete");s&&(s.textContent=e),i&&(i.textContent=t),o&&(o.textContent=n),d&&(d.textContent=a)}function b(){const t=document.getElementById("applicants-tbody");if(!t)return;if(0===s.length)return void(t.innerHTML='<tr><td colspan="6" class="empty-cell">応募データがありません</td></tr>');const n=20*(i-1),a=n+20,d=s.slice(n,a);t.innerHTML=d.map(t=>{var n,a;const l=k((null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.timestamp||t.createdAt)),s=t.status||"new",i=r[t.type]||t.type||"-",o=c[s]||s,d=(null==(a=t.applicant)?void 0:a.name)||"-",u=t.assignee||"-";return`\n      <tr data-id="${e(t.id)}">\n        <td>${e(l)}</td>\n        <td><span class="type-badge type-${e(t.type||"apply")}">${e(i)}</span></td>\n        <td class="applicant-name-cell">${e(d)}</td>\n        <td>${e(t.jobTitle||"-")}</td>\n        <td><span class="status-badge status-${e(s)}">${e(o)}</span></td>\n        <td class="assignee-cell">${e(u)}</td>\n        <td>\n          <button class="btn-small btn-view" data-id="${e(t.id)}">詳細</button>\n        </td>\n      </tr>\n    `}).join(""),t.querySelectorAll(".btn-view").forEach(e=>{e.addEventListener("click",()=>{!function(e){var t;const n=l.find(t=>t.id===e);if(!n)return;o=e;const a=document.getElementById("applicant-modal");if(!a)return;const s=n.applicant||{};document.getElementById("detail-name").textContent=s.name||"-",document.getElementById("detail-phone").textContent=s.phone||"-",document.getElementById("detail-email").textContent=s.email||"-",document.getElementById("detail-age").textContent=s.age||"-",document.getElementById("detail-address").textContent=s.address||"-",document.getElementById("detail-start-date").textContent=u[s.startDate]||s.startDate||"-";const i=(null==(t=n.createdAt)?void 0:t.toDate)?n.createdAt.toDate():new Date(n.timestamp||n.createdAt);document.getElementById("detail-datetime").textContent=k(i,!0),document.getElementById("detail-type").textContent=r[n.type]||n.type||"-",document.getElementById("detail-job-title").textContent=n.jobTitle||"-",document.getElementById("detail-source").textContent=A(n.source);const d=n.status||"new";document.querySelectorAll('input[name="status"]').forEach(e=>{e.checked=e.value===d});const c=document.getElementById("detail-assignee");c&&(c.value=n.assignee||"");document.getElementById("detail-notes").value=n.notes||"",$(n.history||[]),B(e),a.style.display="flex"}(e.dataset.id)})})}function w(){const e=document.getElementById("pagination");if(!e)return;const t=Math.ceil(s.length/20);if(t<=1)return void(e.innerHTML="");let n="";n+=`<button class="page-btn" ${1===i?"disabled":""} data-page="${i-1}">前へ</button>`;for(let a=1;a<=t;a++)1===a||a===t||a>=i-2&&a<=i+2?n+=`<button class="page-btn ${a===i?"active":""}" data-page="${a}">${a}</button>`:a!==i-3&&a!==i+3||(n+='<span class="page-ellipsis">...</span>');n+=`<button class="page-btn" ${i===t?"disabled":""} data-page="${i+1}">次へ</button>`,e.innerHTML=n,e.querySelectorAll(".page-btn").forEach(e=>{e.addEventListener("click",()=>{e.disabled||(i=parseInt(e.dataset.page),b(),w())})})}async function B(t){const n=document.getElementById("messages-container");if(n){n.innerHTML='<p class="loading-messages">メッセージを読み込み中...</p>';try{const n=p(),a=await n.collection("messages").where("applicationId","==",t).orderBy("createdAt","asc").get(),l=[];a.forEach(e=>{l.push({id:e.id,...e.data()})}),function(t){const n=document.getElementById("messages-container");if(!n)return;if(!t||0===t.length)return void(n.innerHTML='<p class="no-messages">メッセージはありません</p>');n.innerHTML=t.map(t=>{var n;const a=(null==(n=t.createdAt)?void 0:n.toDate)?t.createdAt.toDate():new Date(t.createdAt),l="company"===t.from;return`\n      <div class="message-item ${l?"message-company":"message-applicant"}">\n        <div class="message-header">\n          <span class="message-sender">${e(l?"会社":"応募者")}</span>\n          <span class="message-date">${k(a,!0)}</span>\n        </div>\n        <div class="message-content">${e(t.content).replace(/\n/g,"<br>")}</div>\n      </div>\n    `}).join(""),n.scrollTop=n.scrollHeight}(l)}catch(a){console.error("Failed to load messages:",a),n.innerHTML='<p class="error-messages">メッセージの読み込みに失敗しました</p>'}}}async function L(){var e;if(!o)return;const t=document.getElementById("new-message-text"),a=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(!a)return void alert("メッセージを入力してください");const s=document.getElementById("btn-send-message");s&&(s.disabled=!0,s.textContent="送信中...");try{const e=p(),s=l.find(e=>e.id===o);await e.collection("messages").add({applicationId:o,companyDomain:(null==s?void 0:s.companyDomain)||n,from:"company",content:a,read:!1,createdAt:firebase.firestore.FieldValue.serverTimestamp()}),t.value="",await B(o)}catch(i){console.error("Failed to send message:",i),alert("メッセージの送信に失敗しました: "+i.message)}finally{s&&(s.disabled=!1,s.textContent="送信")}}function $(t){const n=document.getElementById("detail-history");n&&(t&&0!==t.length?n.innerHTML=t.map(t=>{var n;return`\n      <div class="history-item">\n        <div class="history-date">${k((null==(n=t.date)?void 0:n.toDate)?t.date.toDate():new Date(t.date),!0)}</div>\n        <div class="history-text">${e(t.text)}</div>\n      </div>\n    `}).join(""):n.innerHTML='<p class="no-history">対応履歴はありません</p>')}function D(){const e=document.getElementById("applicant-modal");e&&(e.style.display="none"),o=null}async function x(){var e,t;if(!o)return;const n=document.getElementById("applicant-modal-save");n&&(n.disabled=!0,n.textContent="保存中...");try{const n=p(),a=document.querySelector('input[name="status"]:checked'),s=a?a.value:"new",i=(null==(e=document.getElementById("detail-assignee"))?void 0:e.value)||"",d={status:s,assignee:i,notes:(null==(t=document.getElementById("detail-notes"))?void 0:t.value)||"",updatedAt:firebase.firestore.FieldValue.serverTimestamp()};await n.collection("applications").doc(o).update(d);const c=l.findIndex(e=>e.id===o);-1!==c&&(l[c]={...l[c],...d}),h(),I(),alert("保存しました"),D()}catch(a){console.error("Failed to save applicant:",a),alert("保存に失敗しました: "+a.message)}finally{n&&(n.disabled=!1,n.textContent="保存")}}async function j(){var e;if(!o)return;const t=document.getElementById("new-history-text"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();if(n)try{const e=p(),a=l.find(e=>e.id===o),s=(null==a?void 0:a.history)||[];s.push({date:new Date,text:n}),await e.collection("applications").doc(o).update({history:s,updatedAt:firebase.firestore.FieldValue.serverTimestamp()});const i=l.findIndex(e=>e.id===o);-1!==i&&(l[i].history=s),$(s),t.value=""}catch(a){console.error("Failed to add history:",a),alert("履歴の追加に失敗しました: "+a.message)}else alert("対応内容を入力してください")}function T(){if(0===s.length)return void alert("エクスポートするデータがありません");const e=s.map(e=>{var t;const n=(null==(t=e.createdAt)?void 0:t.toDate)?e.createdAt.toDate():new Date(e.timestamp||e.createdAt),a=e.applicant||{};return[k(n,!0),r[e.type]||e.type||"",a.name||"",a.phone||"",a.email||"",a.age||"",a.address||"",u[a.startDate]||a.startDate||"",e.jobTitle||"",A(e.source),c[e.status||"new"],e.assignee||"",(e.notes||"").replace(/"/g,'""')]}),t=[["日時","種別","応募者名","電話番号","メール","年齢","現住所","希望勤務開始日","求人タイトル","流入元","ステータス","担当者","メモ"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n"),a=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8"}),l=URL.createObjectURL(a),i=document.createElement("a");i.href=l,i.download=`applicants-${n||"all"}-${function(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}${n}${a}`}(new Date)}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)}function k(e,t=!1){if(!e||isNaN(e.getTime()))return"-";const n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");if(!t)return`${n}/${a}/${l}`;return`${n}/${a}/${l} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function A(e){if(!e||"direct"===e)return"直接アクセス";try{const t=new URL(e).hostname;return t.includes("google")?"Google検索":t.includes("yahoo")?"Yahoo!検索":t.includes("tiktok")?"TikTok広告":t.includes("instagram")||t.includes("fb")||t.includes("facebook")?"Meta広告":t.includes("twitter")||t.includes("x.com")?"X(Twitter)":t.includes("line")?"LINE":t}catch{return e||"不明"}}function C(){var e,t,s,i,d,c,r,u,p,g,I,b,w,B,$,k,A,C,M,H,S,F,N,R;let U;null==(e=document.getElementById("btn-refresh"))||e.addEventListener("click",E),null==(t=document.getElementById("btn-export-csv"))||t.addEventListener("click",T),null==(s=document.getElementById("nav-jobs"))||s.addEventListener("click",e=>{e.preventDefault();const t=new URLSearchParams;n&&t.set("domain",n),a&&t.set("company",a),window.location.href=`job-manage.html?${t.toString()}`}),null==(i=document.getElementById("filter-status"))||i.addEventListener("change",h),null==(d=document.getElementById("filter-type"))||d.addEventListener("change",h),null==(c=document.getElementById("filter-assignee"))||c.addEventListener("change",h),null==(r=document.getElementById("filter-date-from"))||r.addEventListener("change",h),null==(u=document.getElementById("filter-date-to"))||u.addEventListener("change",h),null==(p=document.getElementById("filter-search"))||p.addEventListener("input",()=>{clearTimeout(U),U=setTimeout(h,300)}),null==(g=document.getElementById("applicant-modal-close"))||g.addEventListener("click",D),null==(I=document.getElementById("applicant-modal-cancel"))||I.addEventListener("click",D),null==(b=document.getElementById("applicant-modal-save"))||b.addEventListener("click",x),null==(w=document.getElementById("btn-add-history"))||w.addEventListener("click",j),null==(B=document.getElementById("applicant-modal"))||B.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&D()}),null==($=document.getElementById("new-history-text"))||$.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),j())}),null==(k=document.getElementById("btn-send-message"))||k.addEventListener("click",L),null==(A=document.getElementById("new-message-text"))||A.addEventListener("keydown",e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),L())}),null==(C=document.getElementById("message-template-select"))||C.addEventListener("change",e=>{!function(e){var t;if(!e)return;const n=m[e];if(!n)return;const a=l.find(e=>e.id===o);if(!a)return;const s=(null==(t=a.applicant)?void 0:t.name)||"お客様",i=a.jobTitle||"求人";let d=n.body.replace(/{applicantName}/g,s).replace(/{jobTitle}/g,i);const c=document.getElementById("new-message-text");c&&(c.value=d,c.focus());const r=document.getElementById("message-template-select");r&&(r.value="")}(e.target.value)}),null==(M=document.getElementById("btn-add-assignee"))||M.addEventListener("click",v),null==(H=document.getElementById("assignee-modal-close"))||H.addEventListener("click",f),null==(S=document.getElementById("assignee-modal-cancel"))||S.addEventListener("click",f),null==(F=document.getElementById("assignee-modal-save"))||F.addEventListener("click",y),null==(N=document.getElementById("assignee-modal"))||N.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&f()}),null==(R=document.getElementById("new-assignee-name"))||R.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),y())})}async function M(){const e=new URLSearchParams(window.location.search);n=e.get("domain"),a=e.get("company")?decodeURIComponent(e.get("company")):null;const t=document.getElementById("company-name");t&&(t.textContent=a||n||"全会社"),C(),await async function(){try{const e=p().collection("settings").doc(n||"global"),t=await e.get();d=t.exists&&t.data().assignees?t.data().assignees:[],g()}catch(e){console.error("Failed to load assignees:",e),d=[]}}(),await E(),"undefined"!=typeof window&&(window.ApplicantsManager={loadApplicantsData:E,applyFilters:h,exportCsv:T})}document.addEventListener("DOMContentLoaded",()=>{M()});
