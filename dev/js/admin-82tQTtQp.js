import"./modulepreload-polyfill-YP0FEG5d.js";import{f as e,e as t}from"./utils-BE8OECDH.js";import{d as n,a,b as o,c as s}from"./job-feed-generator-BbzggbON.js";import"./jobs-loader-CErzUEmq.js";const i={credentials:{username:"admin",password:"receco2025"},sessionKey:"rikueco_admin_session",gaPropertyId:"G-E1XC94EG05",gaApiKey:"AIzaSyAIC2WGg5dnvMh6TO4sivpbk4HtpYw4tbo",apiEndpoint:"https://asia-northeast1-generated-area-484613-e3.cloudfunctions.net/getAnalyticsData",firebaseConfig:{apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"}},c="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",l="会社一覧",d="LP設定",r="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec";function m(e){return{standard:"スタンダード",modern:"モダン",classic:"クラシック",minimal:"ミニマル",colorful:"カラフル"}[e]||"スタンダード"}const p=[{id:"teamwork-1",name:"チームミーティング",url:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=400&q=60"},{id:"teamwork-2",name:"オフィスワーク",url:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400&q=60"},{id:"teamwork-3",name:"コラボレーション",url:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=400&q=60"},{id:"teamwork-4",name:"ビジネス握手",url:"https://images.unsplash.com/photo-1521791136064-7986c2920216?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1521791136064-7986c2920216?w=400&q=60"},{id:"teamwork-5",name:"ワークショップ",url:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=400&q=60"},{id:"work-1",name:"製造ライン",url:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&q=60"},{id:"work-2",name:"倉庫作業",url:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1553413077-190dd305871c?w=400&q=60"},{id:"work-3",name:"建設現場",url:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=400&q=60"},{id:"work-4",name:"工場作業",url:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1573164713988-8665fc963095?w=400&q=60"},{id:"work-5",name:"チームワーク",url:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=1920&q=80",thumbnail:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=400&q=60"}];let u=null,g=null,y=null;function v(){return y}let h=[];async function f(){const n=document.getElementById("date-range"),a=(null==n?void 0:n.value)||7,o=i.apiEndpoint;if(o)try{await async function(n,a){try{b(!0),function(e){const t='<div class="section-loading"><div class="loading-spinner"></div><span>データを読み込み中...</span></div>';document.querySelectorAll(".stat-value").forEach(e=>{e.dataset.originalText=e.textContent,e.innerHTML='<span class="loading-dots">...</span>'});const n=document.getElementById("daily-chart");n&&e&&(n.innerHTML=t);const a=document.querySelector(".data-table tbody");a&&e&&(a.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;">${t}</td></tr>`);const o=document.getElementById("company-cards");o&&e&&(o.innerHTML=t);const s=document.querySelector("#applications-section .data-table tbody");s&&e&&(s.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:2rem;">${t}</td></tr>`)}(!0);const o={},s=v();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?days=${n}`,{headers:o});if(!i.ok)throw new Error(`API Error: ${i.status}`);const c=await i.json();if(!c.success)throw new Error(c.error||"Unknown error");const l=c.data;l.overview&&(w("total-pageviews",e(l.overview.pageViews)),w("total-users",e(l.overview.users)),w("company-views",e(l.overview.companyViews)),w("apply-clicks",e(l.overview.applyClicks))),l.daily&&function(e){const t=document.getElementById("daily-chart");if(!t)return;if(!e||0===e.length)return void(t.innerHTML="<p>データがありません</p>");const n=Math.max(...e.map(e=>e.views)),a=e.length>30?e.filter((e,t)=>t%3==0):e;t.innerHTML=`\n    <div class="simple-chart">\n      <div class="chart-bars">\n        ${a.map(e=>`\n            <div class="chart-bar-wrapper">\n              <div class="chart-bar" style="height: ${n>0?e.views/n*100:0}%">\n                <span class="bar-value">${e.views}</span>\n              </div>\n              <span class="bar-label">${e.date}</span>\n            </div>\n          `).join("")}\n      </div>\n    </div>\n  `}(l.daily),l.companies&&(h=l.companies.filter(e=>e.domain&&"(not set)"!==e.domain&&e.name&&"(not set)"!==e.name).map(e=>({name:e.name,domain:e.domain,views:e.views,clicks:e.clicks,pattern:"standard"})),$(),I()),l.applications&&function(e){const n=document.querySelector("#applications-table tbody");if(!n)return;const a={apply:"応募ボタン",line:"LINE相談",consult:"相談フォーム"};if(!e||0===e.length)return void(n.innerHTML='<tr><td colspan="4" class="loading-cell">応募データがありません</td></tr>');n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${t(e.date)}</td>\n      <td>${t(e.company)}</td>\n      <td><span class="type-badge ${t(e.type)}">${a[e.type]||t(e.type)}</span></td>\n      <td>${t(e.source)}</td>\n    </tr>\n  `).join("")}(l.applications),b(!1)}catch(o){console.error("[Admin] API fetch error:",o),b(!1),E(n)}}(a,o)}catch(s){console.error("[Admin] API fetch failed, loading mock data:",s),E(a)}else E(a)}function b(e){const t=document.getElementById("refresh-btn");t&&(t.textContent=e?"読み込み中...":"更新",t.disabled=e)}function w(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function E(n){const a=80*n,o=45*n,s=12*n;w("total-pageviews",e(150*n+Math.floor(500*Math.random()))),w("total-users",e(a+Math.floor(200*Math.random()))),w("company-views",e(o+Math.floor(100*Math.random()))),w("apply-clicks",e(s+Math.floor(30*Math.random()))),function(e){const t=document.getElementById("daily-chart");if(!t)return;const n=[],a=new Date;for(let i=e-1;i>=0;i--){const e=new Date(a);e.setDate(e.getDate()-i),n.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(100+200*Math.random()),clicks:Math.floor(5+20*Math.random())})}const o=Math.max(...n.map(e=>e.views)),s=e>30?n.filter((e,t)=>t%3==0):n;t.innerHTML=`\n    <div class="simple-chart">\n      <div class="chart-bars">\n        ${s.map(e=>`\n            <div class="chart-bar-wrapper">\n              <div class="chart-bar" style="height: ${e.views/o*100}%">\n                <span class="bar-value">${e.views}</span>\n              </div>\n              <span class="bar-label">${e.date}</span>\n            </div>\n          `).join("")}\n      </div>\n    </div>\n  `}(n),h=[{name:"トヨタ自動車",domain:"toyota",views:1250,clicks:89,pattern:"modern"},{name:"日産自動車",domain:"nissan",views:980,clicks:67,pattern:"classic"},{name:"本田技研工業",domain:"honda",views:856,clicks:54,pattern:"colorful"},{name:"スバル",domain:"subaru",views:654,clicks:43,pattern:"minimal"},{name:"マツダ",domain:"mazda",views:523,clicks:32,pattern:"standard"},{name:"スズキ",domain:"suzuki",views:412,clicks:28,pattern:"modern"},{name:"ダイハツ",domain:"daihatsu",views:387,clicks:24,pattern:"classic"},{name:"三菱自動車",domain:"mitsubishi",views:298,clicks:18,pattern:"standard"}],$(),I(),function(){const e=document.querySelector("#applications-table tbody");if(!e)return;const n=[{date:"2025/01/17 14:32",company:"トヨタ自動車",type:"apply",source:"Google検索"},{date:"2025/01/17 13:15",company:"日産自動車",type:"line",source:"直接アクセス"},{date:"2025/01/17 11:48",company:"トヨタ自動車",type:"apply",source:"Yahoo検索"},{date:"2025/01/17 10:22",company:"本田技研工業",type:"apply",source:"直接アクセス"},{date:"2025/01/16 18:45",company:"スバル",type:"line",source:"Google検索"},{date:"2025/01/16 16:30",company:"トヨタ自動車",type:"apply",source:"SNS"},{date:"2025/01/16 14:12",company:"マツダ",type:"apply",source:"Google検索"},{date:"2025/01/16 11:55",company:"日産自動車",type:"apply",source:"直接アクセス"}],a={apply:"応募ボタン",line:"LINE相談",consult:"相談フォーム"};e.innerHTML=n.map(e=>`\n    <tr>\n      <td>${t(e.date)}</td>\n      <td>${t(e.company)}</td>\n      <td><span class="type-badge ${t(e.type)}">${a[e.type]}</span></td>\n      <td>${t(e.source)}</td>\n    </tr>\n  `).join("")}()}function $(){const n=document.querySelector("#overview-company-table tbody");if(!n)return;const a=[...h].sort((e,t)=>t.views-e.views);n.innerHTML=a.slice(0,5).map((n,a)=>{const o=(n.clicks/n.views*100).toFixed(1);return`\n      <tr>\n        <td>${a+1}</td>\n        <td>${t(n.name)}</td>\n        <td>${e(n.views)}</td>\n        <td>${n.clicks}</td>\n        <td>${o}%</td>\n      </tr>\n    `}).join("")}function I(){const n=document.getElementById("company-cards");n&&(n.innerHTML=h.map(n=>{const a=(n.clicks/n.views*100).toFixed(1),o=m(n.pattern);return`\n      <div class="company-card" data-domain="${t(n.domain)}" data-name="${t(n.name)}" data-views="${n.views}" data-clicks="${n.clicks}">\n        <div class="company-card-header">\n          <h4>${t(n.name)}</h4>\n          <span class="pattern-badge ${t(n.pattern)}">${o}</span>\n        </div>\n        <div class="company-card-stats">\n          <div class="card-stat">\n            <span class="stat-value">${e(n.views)}</span>\n            <span class="stat-label">ページビュー</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${n.clicks}</span>\n            <span class="stat-label">応募クリック</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${a}%</span>\n            <span class="stat-label">CVR</span>\n          </div>\n        </div>\n        <button class="btn-view-status" data-domain="${t(n.domain)}" data-name="${t(n.name)}">会社の状況を確認</button>\n      </div>\n    `}).join(""),n.querySelectorAll(".btn-view-status").forEach(t=>{t.addEventListener("click",t=>{!async function(t,n){const a=document.getElementById("company-detail-title");a&&(a.textContent=`${n} の分析`);const o=document.getElementById("detail-view-page-btn");o&&(o.href=`company.html?c=${t}`);document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const s=document.getElementById("section-company-detail");s&&s.classList.add("active");const c=document.getElementById("page-title");c&&(c.textContent="企業詳細分析");document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")}),function(){const e='<div class="loading-placeholder">データを読み込み中...</div>';document.querySelectorAll(".detail-stat-value").forEach(e=>{e.textContent="-"}),document.querySelectorAll(".detail-chart").forEach(t=>{t.innerHTML=e}),document.querySelectorAll(".detail-table-container tbody").forEach(e=>{e.innerHTML='<tr><td colspan="4" class="loading-cell">データを読み込み中...</td></tr>'})}();const l=document.getElementById("date-range"),d=(null==l?void 0:l.value)||30;try{await async function(t,n){const a=i.apiEndpoint,o={},s=v();s&&(o.Authorization=`Bearer ${s}`);const c=await fetch(`${a}?type=company-detail&domain=${t}&days=${n}`,{headers:o}),l=await c.json();if(!l.success)throw new Error(l.error||"API Error");!async function(t,n){var a,o;const s=h.find(e=>e.domain===n)||{},i=(null==(a=t.summary)?void 0:a.totalViews)||s.views||0,c=s.clicks||0,l=i>0?(c/i*100).toFixed(1):0,d=(null==(o=t.summary)?void 0:o.avgDailyViews)||0;w("detail-total-views",e(i)),w("detail-total-clicks",e(c)),w("detail-cvr",`${l}%`),w("detail-avg-daily",e(Math.round(d))),x(t.daily||[]),D(t.traffic||[]);const r=t.gender||{};j({male:r.male||0,female:r.female||0,other:r.unknown||0});const m=t.age||{};H((p=m,{"20s":(p["18-24"]||0)+(p["25-34"]||0),"30s":p["35-44"]||0,"40s":p["45-54"]||0,"50s":(p["55-64"]||0)+(p["65+"]||0)})),C([]),P([]),await U(n);var p}(l.data,t)}(t,d)}catch(r){console.error("[Admin] Company detail error:",r),function(t){const n=h.find(e=>e.domain===t)||{views:1e3,clicks:50},a=n.views,o=n.clicks,s=(o/a*100).toFixed(1);w("detail-total-views",e(a)),w("detail-total-clicks",e(o)),w("detail-cvr",`${s}%`),w("detail-avg-daily",e(Math.round(a/30)));const i=[],c=new Date;for(let e=29;e>=0;e--){const t=new Date(c);t.setDate(t.getDate()-e),i.push({date:`${t.getMonth()+1}/${t.getDate()}`,views:Math.floor(20+60*Math.random())})}x(i);const l=[{title:"製造スタッフ",applications:23},{title:"組立作業員",applications:18},{title:"検査・検品",applications:12},{title:"機械オペレーター",applications:8},{title:"フォークリフト",applications:5}];C(l);D([{channel:"Organic Search",count:Math.floor(.45*a)},{channel:"Direct",count:Math.floor(.28*a)},{channel:"Social",count:Math.floor(.18*a)},{channel:"Referral",count:Math.floor(.09*a)}]);j({male:Math.floor(.72*o),female:Math.floor(.25*o),other:Math.floor(.03*o)});H({"20s":Math.floor(.35*o),"30s":Math.floor(.32*o),"40s":Math.floor(.23*o),"50s":Math.floor(.1*o)}),P(l.map(e=>({...e,views:Math.floor(a*(e.applications/o)),cvr:(e.applications/(a*(e.applications/o))*100).toFixed(1)}))),U(t)}(t)}}(t.target.dataset.domain,t.target.dataset.name)})}))}function L(e){const t=document.querySelectorAll(".company-card"),n=e.toLowerCase();t.forEach(e=>{const t=e.dataset.name.toLowerCase(),a=e.dataset.domain.toLowerCase();t.includes(n)||a.includes(n)?e.style.display="":e.style.display="none"})}function k(){const e=document.getElementById("sort-by"),t=(null==e?void 0:e.value)||"views",n=document.getElementById("company-cards");if(!n)return;const a=Array.from(n.querySelectorAll(".company-card"));a.sort((e,n)=>{switch(t){case"views":return parseInt(n.dataset.views)-parseInt(e.dataset.views);case"clicks":return parseInt(n.dataset.clicks)-parseInt(e.dataset.clicks);case"cvr":const t=parseInt(e.dataset.clicks)/parseInt(e.dataset.views);return parseInt(n.dataset.clicks)/parseInt(n.dataset.views)-t;case"name":return e.dataset.name.localeCompare(n.dataset.name,"ja");default:return 0}}),a.forEach(e=>n.appendChild(e))}function B(){const n=document.querySelectorAll(".analytics-tab"),a=document.querySelectorAll(".analytics-tab-content");n.forEach(o=>{o.addEventListener("click",()=>{const s=o.dataset.tab;n.forEach(e=>e.classList.remove("active")),o.classList.add("active"),a.forEach(e=>e.classList.remove("active"));const c=document.getElementById(s);c&&(c.classList.add("active"),async function(n){const a=document.getElementById("date-range"),o=(null==a?void 0:a.value)||30,s=i.apiEndpoint;switch(n){case"engagement-tab":await async function(n,a){try{const o={},s=v();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=engagement&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){const a=n.overall||{};w("avg-session-duration",`${a.avgSessionDuration||0}秒`),w("engagement-rate",`${a.engagementRate||0}%`),w("bounce-rate",`${a.bounceRate||0}%`);const o=document.querySelector("#engagement-company-table tbody");o&&n.byCompany&&n.byCompany.length>0?o.innerHTML=n.byCompany.map(n=>`\n      <tr>\n        <td>${t(n.name||n.domain)}</td>\n        <td>${e(n.views)}</td>\n        <td>${Math.round(n.engagementTime)}秒</td>\n        <td>${n.avgTimePerView}秒</td>\n      </tr>\n    `).join(""):o&&(o.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}(c.data):S()}catch(o){console.error("[Admin] Engagement data error:",o),S()}}(o,s);break;case"traffic-tab":await async function(n,a){try{const o={},s=v();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=traffic&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){const a=document.getElementById("channel-chart");if(a&&n.channels&&n.channels.length>0){const o=Math.max(...n.channels.map(e=>e.sessions));a.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.channels.map(n=>{const a=o>0?n.sessions/o*100:0;return`\n            <div class="bar-row">\n              <span class="bar-label">${t(n.channel)}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${a}%"></div>\n                <span class="bar-value">${e(n.sessions)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const o=document.querySelector("#source-table tbody");o&&n.sources&&n.sources.length>0?o.innerHTML=n.sources.map(n=>`\n      <tr>\n        <td>${t(n.source)}</td>\n        <td>${t(n.medium)}</td>\n        <td>${e(n.sessions)}</td>\n        <td>${e(n.users)}</td>\n      </tr>\n    `).join(""):o&&(o.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}(c.data):M()}catch(o){console.error("[Admin] Traffic data error:",o),M()}}(o,s);break;case"funnel-tab":await async function(n,a){try{const o={},s=v();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=funnel&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){const a=document.getElementById("funnel-chart");a&&n.funnel&&n.funnel.length>0&&(a.innerHTML=n.funnel.map(n=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${t(n.stage)}</span>\n        <span class="funnel-stage-count">${e(n.count)}</span>\n        <span class="funnel-stage-rate">${n.rate}%</span>\n      </div>\n    `).join(""));const o=document.getElementById("action-breakdown-chart");if(o&&n.actionBreakdown&&n.actionBreakdown.length>0){const a=Math.max(...n.actionBreakdown.map(e=>e.count));o.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.actionBreakdown.map(n=>{const o=a>0?n.count/a*100:0;return`\n            <div class="bar-row">\n              <span class="bar-label">${t(n.label)}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${o}%"></div>\n                <span class="bar-value">${e(n.count)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const s=document.querySelector("#company-funnel-table tbody");s&&n.byCompany&&n.byCompany.length>0?s.innerHTML=n.byCompany.map(n=>`\n      <tr>\n        <td>${t(n.domain)}</td>\n        <td>${e(n.views)}</td>\n        <td>${e(n.clicks)}</td>\n        <td>${n.cvr}%</td>\n      </tr>\n    `).join(""):s&&(s.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}(c.data):A()}catch(o){console.error("[Admin] Funnel data error:",o),A()}}(o,s);break;case"trends-tab":await async function(n,a){try{const o={},s=v();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=trends&days=${n}`,{headers:o}),c=await i.json();c.success&&c.data?function(n){n.insights&&(w("peak-day",n.insights.peakDay||"-"),w("peak-hour",n.insights.peakHour||"-"));const a=document.getElementById("day-of-week-chart");if(a&&n.byDayOfWeek&&n.byDayOfWeek.length>0){const o=Math.max(...n.byDayOfWeek.map(e=>e.sessions));a.innerHTML=`\n      <div class="day-chart">\n        ${n.byDayOfWeek.map(n=>`\n            <div class="day-bar" style="height: ${o>0?n.sessions/o*100:0}%" data-day="${t(n.day)}">\n              <span class="day-value">${e(n.sessions)}</span>\n            </div>\n          `).join("")}\n      </div>\n    `}const o=document.getElementById("hour-chart");if(o&&n.byHour&&n.byHour.length>0){const e=Math.max(...n.byHour.map(e=>e.sessions));o.innerHTML=`\n      <div class="hour-chart">\n        ${n.byHour.map(t=>`\n            <div class="hour-bar" style="height: ${e>0?t.sessions/e*100:0}%" data-hour="${t.hour}"></div>\n          `).join("")}\n      </div>\n    `}}(c.data):T()}catch(o){console.error("[Admin] Trend data error:",o),T()}}(o,s)}}(s))})})}function S(){w("avg-session-duration","45.2秒"),w("engagement-rate","68.5%"),w("bounce-rate","31.5%");const t=document.querySelector("#engagement-company-table tbody");if(t){const n=[{name:"トヨタ自動車",views:1250,time:4500,avg:"3.6"},{name:"日産自動車",views:980,time:3200,avg:"3.3"},{name:"本田技研工業",views:856,time:2800,avg:"3.3"}];t.innerHTML=n.map(t=>`\n      <tr>\n        <td>${t.name}</td>\n        <td>${e(t.views)}</td>\n        <td>${t.time}秒</td>\n        <td>${t.avg}秒</td>\n      </tr>\n    `).join("")}}function M(){const t=document.getElementById("channel-chart");if(t){const n=[{channel:"Organic Search",sessions:1250},{channel:"Direct",sessions:890},{channel:"Social",sessions:456},{channel:"Referral",sessions:234}],a=1250;t.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${n.map(t=>{const n=t.sessions/a*100;return`\n            <div class="bar-row">\n              <span class="bar-label">${t.channel}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${e(t.sessions)}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const n=document.querySelector("#source-table tbody");if(n){const t=[{source:"google",medium:"organic",sessions:890,users:756},{source:"(direct)",medium:"(none)",sessions:456,users:412},{source:"yahoo",medium:"organic",sessions:234,users:198}];n.innerHTML=t.map(t=>`\n      <tr>\n        <td>${t.source}</td>\n        <td>${t.medium}</td>\n        <td>${e(t.sessions)}</td>\n        <td>${e(t.users)}</td>\n      </tr>\n    `).join("")}}function A(){const t=document.getElementById("funnel-chart");if(t){const n=[{stage:"サイト訪問",count:5e3,rate:"100"},{stage:"企業ページ閲覧",count:2500,rate:"50.0"},{stage:"ページスクロール",count:1800,rate:"36.0"},{stage:"アクション",count:150,rate:"6.0"}];t.innerHTML=n.map(t=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${t.stage}</span>\n        <span class="funnel-stage-count">${e(t.count)}</span>\n        <span class="funnel-stage-rate">${t.rate}%</span>\n      </div>\n    `).join("")}const n=document.getElementById("action-breakdown-chart");if(n){const e=[{label:"応募ボタン",count:89},{label:"LINE相談",count:45},{label:"フォーム送信",count:16}],t=89;n.innerHTML=`\n      <div class="horizontal-bar-chart">\n        ${e.map(e=>{const n=e.count/t*100;return`\n            <div class="bar-row">\n              <span class="bar-label">${e.label}</span>\n              <div class="bar-track">\n                <div class="bar-fill" style="width: ${n}%"></div>\n                <span class="bar-value">${e.count}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}const a=document.querySelector("#company-funnel-table tbody");if(a){const t=[{domain:"toyota",views:1250,clicks:89,cvr:"7.1"},{domain:"nissan",views:980,clicks:67,cvr:"6.8"},{domain:"honda",views:856,clicks:54,cvr:"6.3"}];a.innerHTML=t.map(t=>`\n      <tr>\n        <td>${t.domain}</td>\n        <td>${e(t.views)}</td>\n        <td>${t.clicks}</td>\n        <td>${t.cvr}%</td>\n      </tr>\n    `).join("")}}function T(){w("peak-day","木"),w("peak-hour","14時");const e=document.getElementById("day-of-week-chart");if(e){const t=[{day:"日",sessions:120},{day:"月",sessions:180},{day:"火",sessions:220},{day:"水",sessions:250},{day:"木",sessions:280},{day:"金",sessions:240},{day:"土",sessions:150}],n=280;e.innerHTML=`\n      <div class="day-chart">\n        ${t.map(e=>`\n            <div class="day-bar" style="height: ${e.sessions/n*100}%" data-day="${e.day}">\n              <span class="day-value">${e.sessions}</span>\n            </div>\n          `).join("")}\n      </div>\n    `}const t=document.getElementById("hour-chart");if(t){const e=[];for(let t=0;t<24;t++){let n=10;t>=9&&t<=18&&(n=30+Math.floor(50*Math.random())),t>=12&&t<=15&&(n=50+Math.floor(40*Math.random())),e.push({hour:t,sessions:n})}const n=Math.max(...e.map(e=>e.sessions));t.innerHTML=`\n      <div class="hour-chart">\n        ${e.map(e=>`\n            <div class="hour-bar" style="height: ${e.sessions/n*100}%" data-hour="${e.hour}"></div>\n          `).join("")}\n      </div>\n    `}}function q(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-companies");e&&e.classList.add("active"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector('[data-section="companies"]');t&&t.parentElement.classList.add("active");const n=document.getElementById("page-title");n&&(n.textContent="企業別データ")}function x(e){const t=document.getElementById("detail-daily-chart");if(!t||!e.length)return void(t&&(t.innerHTML='<div class="loading-placeholder">データがありません</div>'));const n=Math.max(...e.map(e=>e.views));t.innerHTML=`\n    <div class="detail-line-chart">\n      ${e.map((e,t)=>{const a=n>0?e.views/n*100:0;return`\n          <div class="detail-line-bar" style="height: ${Math.max(a,2)}%" data-date="${e.date}">\n            <span class="bar-tooltip">${e.date}: ${e.views}件</span>\n          </div>\n        `}).join("")}\n    </div>\n  `}function C(e){const n=document.getElementById("detail-job-chart");if(!n)return;if(!e.length)return void(n.innerHTML='<div class="loading-placeholder">データがありません</div>');const a=Math.max(...e.map(e=>e.applications));n.innerHTML=`\n    <div class="detail-bar-chart">\n      ${e.slice(0,5).map((e,n)=>{const o=a>0?e.applications/a*100:0;return`\n          <div class="detail-bar-row">\n            <span class="detail-bar-label" title="${t(e.title)}">${t(e.title)}</span>\n            <div class="detail-bar-track">\n              <div class="detail-bar-fill job-${n+1}" style="width: ${o}%"></div>\n              <span class="detail-bar-value">${e.applications}件</span>\n            </div>\n          </div>\n        `}).join("")}\n    </div>\n  `}function D(e){const n=document.getElementById("detail-traffic-chart");if(!n)return;if(!e.length)return void(n.innerHTML='<div class="loading-placeholder">データがありません</div>');const a=e.reduce((e,t)=>e+t.count,0),o=["organic","direct","social","referral"];let s=[],i=0;e.forEach((e,t)=>{const n=e.count/a*100,c=o[t%o.length];s.push(`${{organic:"#10b981",direct:"#6366f1",social:"#f59e0b",referral:"#8b5cf6"}[c]} ${i}deg ${i+3.6*n}deg`),i+=3.6*n}),n.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${s.join(", ")});"></div>\n      <div class="pie-legend">\n        ${e.map((e,n)=>{const s=(e.count/a*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${o[n%o.length]}"></span>\n              <span class="pie-label">${t(e.channel)}</span>\n              <span class="pie-value">${s}%</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function j(e){const t=document.getElementById("detail-gender-chart");if(!t)return;const n=e.male+e.female+e.other;if(0===n)return void(t.innerHTML='<div class="loading-placeholder">データがありません</div>');const a=(e.male/n*100).toFixed(1),o=(e.female/n*100).toFixed(1),s=(e.other/n*100).toFixed(1),i=e.male/n*360,c=e.female/n*360;t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(#3b82f6 0deg ${i}deg, #ec4899 ${i}deg ${i+c}deg, #94a3b8 ${i+c}deg 360deg);"></div>\n      <div class="pie-legend">\n        <div class="pie-legend-item">\n          <span class="pie-color male"></span>\n          <span class="pie-label">男性</span>\n          <span class="pie-value">${e.male}人 (${a}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color female"></span>\n          <span class="pie-label">女性</span>\n          <span class="pie-value">${e.female}人 (${o}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color other"></span>\n          <span class="pie-label">その他</span>\n          <span class="pie-value">${e.other}人 (${s}%)</span>\n        </div>\n      </div>\n    </div>\n  `}function H(e){const t=document.getElementById("detail-age-chart");if(!t)return;const n=e["20s"]+e["30s"]+e["40s"]+e["50s"];if(0===n)return void(t.innerHTML='<div class="loading-placeholder">データがありません</div>');const a=[{key:"20s",label:"20代",color:"age-20s",colorCode:"#3b82f6"},{key:"30s",label:"30代",color:"age-30s",colorCode:"#10b981"},{key:"40s",label:"40代",color:"age-40s",colorCode:"#f59e0b"},{key:"50s",label:"50代以上",color:"age-50s",colorCode:"#ef4444"}];let o=[],s=0;a.forEach(t=>{const a=e[t.key]/n*100;o.push(`${t.colorCode} ${s}deg ${s+3.6*a}deg`),s+=3.6*a}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${a.map(t=>{const a=(e[t.key]/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${t.color}"></span>\n              <span class="pie-label">${t.label}</span>\n              <span class="pie-value">${e[t.key]}人 (${a}%)</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function P(n){const a=document.querySelector("#detail-job-table tbody");a&&(n.length?a.innerHTML=n.map(n=>`\n    <tr>\n      <td>${t(n.title)}</td>\n      <td>${e(n.views)}</td>\n      <td>${n.applications}</td>\n      <td>${n.cvr}%</td>\n    </tr>\n  `).join(""):a.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>')}async function U(e){const t=i.apiEndpoint,n={},a=v();a&&(n.Authorization=`Bearer ${a}`);try{const a=await fetch(`${t}?type=recent-applications&domain=${e}&limit=10`,{headers:n}),o=await a.json();if(o.success&&o.data&&o.data.applications){R(o.data.applications.map(e=>({date:e.date,job:e.jobTitle||"-",type:e.type||"apply",source:e.source||"Direct"})))}else R([])}catch(o){console.error("[Admin] Recent applications error:",o),R([])}}function R(e){const n=document.querySelector("#detail-recent-applications tbody");if(!n)return;const a={apply:"応募",line:"LINE",consult:"相談"};e.length?n.innerHTML=e.map(e=>`\n    <tr>\n      <td>${t(e.date)}</td>\n      <td>${t(e.job)}</td>\n      <td><span class="type-badge ${e.type}">${a[e.type]||e.type}</span></td>\n      <td>${t(e.source)}</td>\n    </tr>\n  `).join(""):n.innerHTML='<tr><td colspan="4" class="loading-cell">データがありません</td></tr>'}function G(e){const t=[];let n="",a=!1;for(let o=0;o<e.length;o++){const s=e[o];'"'===s?a&&'"'===e[o+1]?(n+='"',o++):a=!a:","!==s||a?n+=s:(t.push(n.trim()),n="")}return t.push(n.trim()),t}function O(e){const t=e.replace(/"/g,"").trim();return{"会社名":"company",company:"company","会社ドメイン":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","デザインパターン":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","表示する":"showCompany",showCompany:"showCompany",visible:"showCompany","画像URL":"imageUrl",imageUrl:"imageUrl",image_url:"imageUrl","説明":"description",description:"description","並び順":"order",order:"order","管理シート":"manageSheetUrl","管理シートURL":"manageSheetUrl",manageSheetUrl:"manageSheetUrl"}[t]||t}let N=[],_=!1;function z(){return N}async function F(){const e=document.getElementById("company-manage-tbody");if(e){e.innerHTML='<tr><td colspan="6" class="loading-cell">データを読み込み中...</td></tr>';try{const t=`https://docs.google.com/spreadsheets/d/${c}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(l)}`,n=await fetch(t);if(!n.ok)throw new Error("データの取得に失敗しました");let a=function(e){const t=e.split("\n"),n=G(t[0]||""),a=[];for(let o=1;o<t.length;o++){if(!t[o].trim())continue;const e=G(t[o]),s={};n.forEach((t,n)=>{const a=O(t);s[a]=e[n]||""}),a.push(s)}return a}(await n.text());if(a=a.map(e=>{if(e.companyDomain){const n=localStorage.getItem(`company_data_${e.companyDomain}`);if(n)try{const t=JSON.parse(n);return{...e,...t}}catch(t){console.error("ローカルストレージのパースエラー:",t)}}return e}),0===a.length)return void(e.innerHTML='<tr><td colspan="6" class="loading-cell">会社データがありません</td></tr>');N=a,J()}catch(t){console.error("会社データの読み込みエラー:",t),e.innerHTML='<tr><td colspan="6" class="loading-cell">データの読み込みに失敗しました</td></tr>'}}}function V(e){window.location.href=`company-edit.html?domain=${encodeURIComponent(e)}`}function K(){window.location.href="company-edit.html"}function W(){const e=document.getElementById("company-modal");e&&(e.style.display="none"),_=!1}function J(){const e=document.getElementById("company-manage-tbody");if(!e)return;const n=N||[];0!==n.length?(e.innerHTML=n.map(e=>`\n    <tr data-domain="${t(e.companyDomain||"")}">\n      <td>${t(e.company||"")}</td>\n      <td><code>${t(e.companyDomain||"")}</code></td>\n      <td><span class="badge ${e.designPattern||"standard"}">${m(e.designPattern||"standard")}</span></td>\n      <td>${"○"===e.showCompany||"◯"===e.showCompany?'<span class="badge success">表示</span>':'<span class="badge">非表示</span>'}</td>\n      <td>\n        <div class="action-buttons">\n          <button class="btn-small btn-edit" data-action="edit" data-domain="${t(e.companyDomain||"")}">編集</button>\n          <button class="btn-small btn-primary" data-action="jobs" data-domain="${t(e.companyDomain||"")}">求人管理</button>\n          <a href="lp.html?c=${t(e.companyDomain||"")}" target="_blank" class="btn-small btn-view">LP確認</a>\n        </div>\n      </td>\n    </tr>\n  `).join(""),e.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a=t.dataset.domain;"edit"===n?V(a):"jobs"===n&&X(a)})):e.innerHTML='<tr><td colspan="5" class="loading-cell">会社データがありません</td></tr>'}function X(e){const t=null==N?void 0:N.find(t=>t.companyDomain===e);if(!t)return void alert("会社情報が見つかりません");const n=new URLSearchParams;n.set("domain",e),n.set("company",t.company||e),t.manageSheetUrl&&n.set("sheetUrl",t.manageSheetUrl),window.location.href=`job-manage.html?${n.toString()}`}let Y=null;async function Q(){const e=document.getElementById("lp-company-select");if(!e)return;let n=z();n&&0!==n.length||(await F(),n=z());const a=n.filter(e=>e.companyDomain&&("○"===e.showCompany||"◯"===e.showCompany));e.innerHTML='<option value="">-- 会社を選択 --</option>'+a.map(e=>`<option value="${t(e.companyDomain)}">${t(e.company)}</option>`).join("")}async function Z(e){const t=document.getElementById("lp-editor"),n=document.getElementById("lp-preview-btn"),a=document.getElementById("lp-edit-mode-btn");if(!e)return void(t&&(t.style.display="none"));t&&(t.style.display="block"),n&&(n.href=`lp.html?c=${encodeURIComponent(e)}`),a&&(a.href=`lp.html?c=${encodeURIComponent(e)}&edit`),se();const o=z(),s=null==o?void 0:o.find(t=>t.companyDomain===e);if(s){const e=document.querySelector(`input[name="design-pattern"][value="${s.designPattern||"standard"}"]`);e&&(e.checked=!0)}try{const t=`https://docs.google.com/spreadsheets/d/${c}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(d)}`,n=await fetch(t);if(n.ok){const t=function(e,t){const n=e.split("\n"),a=G(n[0]||"");for(let o=1;o<n.length;o++){if(!n[o].trim())continue;const e=G(n[o]),s={};if(a.forEach((t,n)=>{const a=t.replace(/"/g,"").trim();s[a]=e[n]||""}),s.companyDomain===t||s["会社ドメイン"]===t){const e={heroTitle:s.heroTitle||s["ヒーロータイトル"]||"",heroSubtitle:s.heroSubtitle||s["ヒーローサブタイトル"]||"",heroImage:s.heroImage||s["ヒーロー画像"]||"",ctaText:s.ctaText||s["CTAテキスト"]||"",faq:s.faq||s.FAQ||"",designPattern:s.designPattern||s["デザインパターン"]||"",sectionOrder:s.sectionOrder||s["セクション順序"]||"",sectionVisibility:s.sectionVisibility||s["セクション表示"]||"",tiktokPixelId:s.tiktokPixelId||s["TikTok Pixel ID"]||"",googleAdsId:s.googleAdsId||s["Google Ads ID"]||"",googleAdsLabel:s.googleAdsLabel||s["Google Ads ラベル"]||"",ogpTitle:s.ogpTitle||s["OGPタイトル"]||"",ogpDescription:s.ogpDescription||s["OGP説明文"]||"",ogpImage:s.ogpImage||s["OGP画像"]||""};for(let t=1;t<=6;t++)e[`pointTitle${t}`]=s[`pointTitle${t}`]||s[`ポイント${t}タイトル`]||"",e[`pointDesc${t}`]=s[`pointDesc${t}`]||s[`ポイント${t}説明`]||"";return e}}return null}(await n.text(),e);if(t){ee("lp-hero-title",t.heroTitle),ee("lp-hero-subtitle",t.heroSubtitle),ee("lp-hero-image",t.heroImage);const e=[];for(let n=1;n<=6;n++){const a=t[`pointTitle${n}`]||"",o=t[`pointDesc${n}`]||"";(a||o)&&e.push({title:a,desc:o})}if(te(e.length>0?e:[{title:"",desc:""},{title:"",desc:""},{title:"",desc:""}]),ee("lp-cta-text",t.ctaText||"今すぐ応募する"),ee("lp-faq",t.faq),t.designPattern){const e=document.querySelector(`input[name="design-pattern"][value="${t.designPattern}"]`);e&&(e.checked=!0)}return t.sectionOrder&&function(e){const t=document.getElementById("lp-section-order");if(!t||!e)return;const n=e.split(",").map(e=>e.trim()).filter(e=>e);if(0===n.length)return;const a=Array.from(t.querySelectorAll(".section-order-item")),o={};a.forEach(e=>{o[e.dataset.section]=e}),n.forEach(e=>{const n=o[e];n&&t.appendChild(n)})}(t.sectionOrder),t.sectionVisibility&&function(e){if(!e)return;try{const t=JSON.parse(e);["points","jobs","details","faq"].forEach(e=>{if(void 0!==t[e]){const n=document.getElementById(`section-${e}-visible`);n&&(n.checked=t[e])}})}catch(t){console.error("セクション表示状態のパースエラー:",t)}}(t.sectionVisibility),ee("lp-tiktok-pixel",t.tiktokPixelId),ee("lp-google-ads-id",t.googleAdsId),ee("lp-google-ads-label",t.googleAdsLabel),ee("lp-ogp-title",t.ogpTitle),ee("lp-ogp-description",t.ogpDescription),ee("lp-ogp-image",t.ogpImage),void ie(t.heroImage||"")}}}catch(i){console.log("LP設定シートが見つかりません")}!function(){["lp-hero-title","lp-hero-subtitle","lp-hero-image","lp-faq","lp-tiktok-pixel","lp-google-ads-id","lp-google-ads-label","lp-ogp-title","lp-ogp-description","lp-ogp-image"].forEach(e=>ee(e,"")),ee("lp-cta-text","今すぐ応募する"),te();const e=document.querySelector('input[name="design-pattern"][value="standard"]');e&&(e.checked=!0);ie("")}()}function ee(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}function te(e=[{title:"",desc:""},{title:"",desc:""},{title:"",desc:""}]){const n=document.getElementById("point-inputs-container");n&&(n.innerHTML=e.map((e,n)=>`\n    <div class="point-input-group" data-point-index="${n}">\n      <label>ポイント${n+1}</label>\n      <input type="text" class="point-title" placeholder="タイトル" value="${t(e.title||"")}">\n      <input type="text" class="point-desc" placeholder="説明文" value="${t(e.desc||"")}">\n      <button type="button" class="btn-remove-point" title="削除">&times;</button>\n    </div>\n  `).join(""),n.querySelectorAll(".btn-remove-point").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".point-input-group");t&&n.children.length>1&&(t.remove(),ne(),ae(),re())})}),n.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>re())}),ae())}function ne(){const e=document.getElementById("point-inputs-container");e&&e.querySelectorAll(".point-input-group").forEach((e,t)=>{e.dataset.pointIndex=t;const n=e.querySelector("label");n&&(n.textContent=`ポイント${t+1}`)})}function ae(){const e=document.getElementById("point-inputs-container"),t=document.getElementById("btn-add-point");if(!e||!t)return;const n=e.children.length;t.disabled=n>=6}function oe(){const e=document.getElementById("point-inputs-container");if(!e)return;const t=e.children.length;if(t>=6)return;const n=t,a=document.createElement("div");a.className="point-input-group",a.dataset.pointIndex=n,a.innerHTML=`\n    <label>ポイント${n+1}</label>\n    <input type="text" class="point-title" placeholder="タイトル" value="">\n    <input type="text" class="point-desc" placeholder="説明文" value="">\n    <button type="button" class="btn-remove-point" title="削除">&times;</button>\n  `,a.querySelector(".btn-remove-point").addEventListener("click",()=>{e.children.length>1&&(a.remove(),ne(),ae(),re())}),a.querySelectorAll("input").forEach(e=>{e.addEventListener("input",()=>re())}),e.appendChild(a),ae(),a.querySelector(".point-title").focus()}function se(){const e=document.getElementById("hero-image-presets");e&&(e.innerHTML=p.map(e=>`\n    <div class="hero-image-preset" data-url="${t(e.url)}" title="${t(e.name)}">\n      <img src="${t(e.thumbnail)}" alt="${t(e.name)}" loading="lazy">\n      <span class="preset-name">${t(e.name)}</span>\n      <span class="preset-check">✓</span>\n    </div>\n  `).join(""),e.querySelectorAll(".hero-image-preset").forEach(e=>{e.addEventListener("click",()=>{!function(e){const t=document.getElementById("lp-hero-image");t&&(t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})));ie(e)}(e.dataset.url)})}))}function ie(e){const t=document.getElementById("hero-image-presets");t&&t.querySelectorAll(".hero-image-preset").forEach(t=>{const n=t.dataset.url,a=(null==e?void 0:e.split("?")[0])||"",o=(null==n?void 0:n.split("?")[0])||"";a&&o&&a===o?t.classList.add("selected"):t.classList.remove("selected")})}async function ce(){var e,t,n,a,o,s,i,c,l,d,m,p,u,g,y;const v=null==(e=document.getElementById("lp-company-select"))?void 0:e.value;if(!v)return void alert("会社を選択してください");const h=function(){const e=document.getElementById("point-inputs-container");if(!e)return[];const t=[];return e.querySelectorAll(".point-input-group").forEach(e=>{var n,a;const o=(null==(n=e.querySelector(".point-title"))?void 0:n.value)||"",s=(null==(a=e.querySelector(".point-desc"))?void 0:a.value)||"";t.push({title:o,desc:s})}),t}(),f={companyDomain:v,designPattern:(null==(t=document.querySelector('input[name="design-pattern"]:checked'))?void 0:t.value)||"standard",heroTitle:(null==(n=document.getElementById("lp-hero-title"))?void 0:n.value)||"",heroSubtitle:(null==(a=document.getElementById("lp-hero-subtitle"))?void 0:a.value)||"",heroImage:(null==(o=document.getElementById("lp-hero-image"))?void 0:o.value)||"",ctaText:(null==(s=document.getElementById("lp-cta-text"))?void 0:s.value)||"",faq:(null==(i=document.getElementById("lp-faq"))?void 0:i.value)||"",sectionOrder:le().join(","),sectionVisibility:JSON.stringify(de())};for(let r=0;r<6;r++)f[`pointTitle${r+1}`]=(null==(c=h[r])?void 0:c.title)||"",f[`pointDesc${r+1}`]=(null==(l=h[r])?void 0:l.desc)||"";f.tiktokPixelId=(null==(d=document.getElementById("lp-tiktok-pixel"))?void 0:d.value)||"",f.googleAdsId=(null==(m=document.getElementById("lp-google-ads-id"))?void 0:m.value)||"",f.googleAdsLabel=(null==(p=document.getElementById("lp-google-ads-label"))?void 0:p.value)||"",f.ogpTitle=(null==(u=document.getElementById("lp-ogp-title"))?void 0:u.value)||"",f.ogpDescription=(null==(g=document.getElementById("lp-ogp-description"))?void 0:g.value)||"",f.ogpImage=(null==(y=document.getElementById("lp-ogp-image"))?void 0:y.value)||"";const b=r;try{const e=document.getElementById("btn-save-lp-settings");e&&(e.disabled=!0,e.textContent="保存中...");const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveLPSettings",settings:f})))),n=`${b}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n,{method:"GET",redirect:"follow"}),o=await a.text();let s;try{s=JSON.parse(o)}catch(w){throw e&&(e.disabled=!1,e.textContent="LP設定を保存"),new Error(`GASからの応答が不正です: ${o.substring(0,200)}`)}if(e&&(e.disabled=!1,e.textContent="LP設定を保存"),!s.success)return void alert("スプレッドシートへの保存に失敗しました: "+(s.error||"不明なエラー"));localStorage.removeItem(`lp_settings_${v}`),alert(`LP設定をスプレッドシートに保存しました。\n\n会社: ${v}\nデザインパターン: ${f.designPattern}`)}catch(E){console.error("GAS API呼び出しエラー:",E),alert("スプレッドシートへの保存中にエラーが発生しました。ローカルに保存します。"),function(e,t){const n=`lp_settings_${t}`;localStorage.setItem(n,JSON.stringify(e)),alert(`LP設定をローカルに保存しました。\n\n注意: スプレッドシートに自動保存するには、設定画面でGAS API URLを設定してください。\n\n会社: ${t}\nデザインパターン: ${e.designPattern}`)}(f,v)}}function le(){const e=document.getElementById("lp-section-order");return e?Array.from(e.querySelectorAll("li")).map(e=>e.dataset.section):["hero","points","jobs","details","faq","apply"]}function de(){var e,t,n,a;return{points:(null==(e=document.getElementById("section-points-visible"))?void 0:e.checked)??!0,jobs:(null==(t=document.getElementById("section-jobs-visible"))?void 0:t.checked)??!0,details:(null==(n=document.getElementById("section-details-visible"))?void 0:n.checked)??!0,faq:(null==(a=document.getElementById("section-faq-visible"))?void 0:a.checked)??!0}}function re(){Y&&clearTimeout(Y),Y=setTimeout(()=>{ue()},300)}function me(){const e=document.getElementById("lp-preview-container"),t=document.getElementById("btn-toggle-preview");e&&("none"===e.style.display?(e.style.display="flex",t&&(t.textContent="プレビューを隠す"),ue()):(e.style.display="none",t&&(t.textContent="プレビュー表示")))}function pe(){const e=document.getElementById("lp-preview-container"),t=document.getElementById("btn-toggle-preview");e&&(e.style.display="none"),t&&(t.textContent="プレビュー表示")}function ue(){console.log("LP Preview update triggered")}function ge(){const e=document.getElementById("lp-section-order");if(!e)return;let t=null;e.querySelectorAll(".section-order-item").forEach(n=>{n.setAttribute("draggable","true"),n.addEventListener("dragstart",e=>{t=n,n.classList.add("dragging"),e.dataTransfer.effectAllowed="move"}),n.addEventListener("dragend",()=>{n.classList.remove("dragging"),t=null,ue()}),n.addEventListener("dragover",n=>{n.preventDefault(),n.dataTransfer.dropEffect="move";const a=(o=e,s=n.clientY,[...o.querySelectorAll(".section-order-item:not(.dragging)")].reduce((e,t)=>{const n=t.getBoundingClientRect(),a=s-n.top-n.height/2;return a<0&&a>e.offset?{offset:a,element:t}:e},{offset:Number.NEGATIVE_INFINITY}).element);var o,s;null==a?e.appendChild(t):e.insertBefore(t,a)})})}function ye(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="flex"),t&&(t.style.display="none")}function ve(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="none"),t&&(t.style.display="flex")}function he(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.remove("open"),t&&t.classList.remove("active"),n&&n.classList.remove("active"),document.body.style.overflow=""}function fe(e){he(),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector(`[data-section="${e}"]`);t&&t.parentElement.classList.add("active"),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`section-${e}`);n&&n.classList.add("active");const a={overview:"概要",companies:"企業別データ","company-manage":"会社管理","lp-settings":"LP設定",applications:"応募データ",settings:"設定"},o=document.getElementById("page-title");o&&(o.textContent=a[e]||e),"company-manage"===e&&F(),"lp-settings"===e&&(Q(),se())}function be(){const e=document.getElementById("mobile-menu-btn");e&&e.addEventListener("click",()=>{const e=document.getElementById("admin-sidebar");e&&e.classList.contains("open")?he():function(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.add("open"),t&&t.classList.add("active"),n&&n.classList.add("active"),document.body.style.overflow="hidden"}()});const t=document.getElementById("sidebar-close-btn");t&&t.addEventListener("click",he);const c=document.getElementById("mobile-overlay");c&&c.addEventListener("click",he);const l=document.getElementById("login-form");l&&l.addEventListener("submit",e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("password"))?void 0:n.value)||"",s=document.getElementById("login-error"),c=function(e,t){return e===i.credentials.username&&t===i.credentials.password?(sessionStorage.setItem(i.sessionKey,"authenticated"),{success:!0}):{success:!1,error:"ユーザー名またはパスワードが正しくありません"}}(a,o);c.success?(s&&(s.style.display="none"),ve(),f()):s&&(s.textContent=c.error,s.style.display="block")});const d=document.getElementById("logout-btn");d&&d.addEventListener("click",()=>{sessionStorage.removeItem(i.sessionKey),sessionStorage.removeItem("auth_method"),u&&u.signOut(),ye()}),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();fe(e.currentTarget.dataset.section)})});const r=document.getElementById("date-range");r&&r.addEventListener("change",()=>f());const m=document.getElementById("refresh-btn");m&&m.addEventListener("click",()=>f());const p=document.getElementById("company-search");p&&p.addEventListener("input",e=>L(e.target.value));const v=document.getElementById("sort-by");v&&v.addEventListener("change",()=>k());const h=document.getElementById("google-login-btn");h&&h.addEventListener("click",async()=>{const e=document.getElementById("login-error"),t=await async function(){if(!u)return{success:!1,error:"Firebase認証が初期化されていません"};try{const e=new firebase.auth.GoogleAuthProvider,t=await u.signInWithPopup(e);return g=t.user,y=await t.user.getIdToken(),sessionStorage.setItem(i.sessionKey,"authenticated"),sessionStorage.setItem("auth_method","google"),{success:!0,user:g,idToken:y}}catch(e){return console.error("Google login error:",e),{success:!1,error:"Googleログインに失敗しました: "+e.message}}}();t.success?(e&&(e.style.display="none"),ve(),f()):e&&(e.textContent=t.error,e.style.display="block")});const b=document.getElementById("btn-add-company");b&&b.addEventListener("click",()=>K());const w=document.getElementById("lp-company-select");w&&w.addEventListener("change",e=>Z(e.target.value));const E=document.getElementById("btn-save-lp-settings");E&&E.addEventListener("click",()=>ce());const $=document.getElementById("btn-reset-lp-settings");$&&$.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-company-select"))?void 0:e.value;t&&Z(t)});const I=document.getElementById("btn-toggle-preview");I&&I.addEventListener("click",()=>me());const B=document.getElementById("btn-close-preview");B&&B.addEventListener("click",()=>pe()),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");document.querySelectorAll(".preview-device-btn").forEach(e=>{e.classList.toggle("active",e.dataset.device===t)}),n&&n.setAttribute("data-device",t)})});document.querySelectorAll("#lp-editor input, #lp-editor textarea").forEach(e=>{e.addEventListener("input",()=>re())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>ue())}),ge(),function(){const e=document.getElementById("btn-add-point");e&&e.addEventListener("click",oe),te()}(),document.querySelectorAll('#lp-section-order input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>ue())});const S=document.getElementById("save-password");S&&S.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("new-password"))?void 0:e.value;t&&t.length>=4?(localStorage.setItem("admin_password",t),alert("パスワードを変更しました")):alert("パスワードは4文字以上で入力してください")});const M=document.getElementById("feed-status"),A=()=>{M&&(M.style.display="flex")},T=()=>{M&&(M.style.display="none")},q=document.getElementById("btn-download-indeed");q&&q.addEventListener("click",async()=>{try{A(),await n(),alert("Indeed XMLフィードをダウンロードしました")}catch(e){alert("フィード生成に失敗しました: "+e.message)}finally{T()}});const x=document.getElementById("btn-download-google");x&&x.addEventListener("click",async()=>{try{A(),await a(),alert("Google JSON-LDをダウンロードしました")}catch(e){alert("フィード生成に失敗しました: "+e.message)}finally{T()}});const C=document.getElementById("btn-download-jobbox");C&&C.addEventListener("click",async()=>{try{A(),await o(),alert("求人ボックスXMLをダウンロードしました")}catch(e){alert("フィード生成に失敗しました: "+e.message)}finally{T()}});const D=document.getElementById("btn-download-csv");D&&D.addEventListener("click",async()=>{try{A(),await s(),alert("CSVをダウンロードしました")}catch(e){alert("フィード生成に失敗しました: "+e.message)}finally{T()}})}function we(){const e=localStorage.getItem("admin_password");e&&(i.credentials.password=e),"undefined"!=typeof firebase&&(firebase.initializeApp(i.firebaseConfig),u=firebase.auth(),u.onAuthStateChanged(async e=>{if(e){g=e;try{if(y=await e.getIdToken(),console.log("[Admin] Firebase ID token obtained"),sessionStorage.getItem(i.sessionKey)){const t=new CustomEvent("authReady",{detail:{user:e,idToken:y}});document.dispatchEvent(t)}}catch(t){console.error("[Admin] Failed to get ID token:",t)}}else g=null,y=null})),sessionStorage.getItem(i.sessionKey)?(ve(),document.addEventListener("authReady",()=>{f()},{once:!0}),setTimeout(()=>{v()||(console.log("[Admin] Auth timeout, loading with mock data"),f())},3e3)):ye(),be(),B(),function(){const e=document.getElementById("btn-back-to-companies");e&&e.addEventListener("click",q)}()}"undefined"!=typeof window&&(window.AdminDashboard={config:i,spreadsheetConfig:{sheetId:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",companySheetName:"会社一覧",lpSettingsSheetName:"LP設定",gasApiUrl:"https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec"},init:we,switchSection:fe,getIdToken:v},window.AdminAnalytics={loadDashboardData:f,filterCompanies:L,sortCompanies:k},window.AdminCompany={loadCompanyManageData:F,editCompany:V,showCompanyModal:K,closeCompanyModal:W,saveCompanyData:async function(){var e,t,n,a,o,s,i;const c=document.getElementById("edit-company-domain"),l=(null==c?void 0:c.value.trim().toLowerCase())||"",d={company:(null==(e=document.getElementById("edit-company-name"))?void 0:e.value.trim())||"",company_domain:l,companyDomain:l,designPattern:(null==(t=document.getElementById("edit-design-pattern"))?void 0:t.value)||"standard",imageUrl:(null==(n=document.getElementById("edit-image-url"))?void 0:n.value.trim())||"",order:(null==(a=document.getElementById("edit-order"))?void 0:a.value)||"",description:(null==(o=document.getElementById("edit-description"))?void 0:o.value.trim())||"",showCompany:(null==(s=document.getElementById("edit-show-company"))?void 0:s.checked)?"○":"",visible:(null==(i=document.getElementById("edit-show-company"))?void 0:i.checked)?"○":""};if(!d.company||!d.companyDomain)return void alert("会社名と会社ドメインは必須です");if(!/^[a-z0-9-]+$/.test(d.companyDomain))return void alert("会社ドメインは半角英数字とハイフンのみ使用できます");if(_&&(null==N?void 0:N.find(e=>e.companyDomain===d.companyDomain)))return void alert("このドメインは既に使用されています");const m=r;try{const e=document.getElementById("company-modal-save");e&&(e.disabled=!0,e.textContent="保存中...");const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveCompany",company:d})))),n=`${m}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n,{method:"GET",redirect:"follow"}),o=await a.json();if(e&&(e.disabled=!1,e.textContent="保存"),!o.success)return void alert("スプレッドシートへの保存に失敗しました: "+(o.error||"不明なエラー"));if(localStorage.removeItem(`company_data_${d.companyDomain}`),_)N.push(d);else{const e=N.findIndex(e=>e.companyDomain===d.companyDomain);-1!==e&&(N[e]=d)}W(),J(),alert(`会社情報をスプレッドシートに保存しました。\n\n会社名: ${d.company}\nドメイン: ${d.companyDomain}`)}catch(p){console.error("GAS API呼び出しエラー:",p),alert("スプレッドシートへの保存中にエラーが発生しました。ローカルに保存します。"),function(e){const t=`company_data_${e.companyDomain}`;if(localStorage.setItem(t,JSON.stringify(e)),_)N.push(e);else{const t=N.findIndex(t=>t.companyDomain===e.companyDomain);-1!==t&&(N[t]=e)}W(),J(),alert(`会社情報をローカルに保存しました。\n\n注意: スプレッドシートに自動保存するには、設定画面でGAS API URLを設定してください。\n\n会社名: ${e.company}\nドメイン: ${e.companyDomain}`)}(d)}},renderCompanyTable:J,openJobsArea:X,loadCompanyListForLP:Q,loadLPSettings:Z,saveLPSettings:ce,renderHeroImagePresets:se,toggleLPPreview:me,closeLPPreview:pe,debouncedUpdatePreview:re,initSectionSortable:ge,updateLPPreview:ue,getPatternLabel:e=>({standard:"スタンダード",modern:"モダン",classic:"クラシック",minimal:"ミニマル",colorful:"カラフル"}[e]||"スタンダード")}),document.addEventListener("DOMContentLoaded",()=>{we()});
