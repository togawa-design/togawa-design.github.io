import"./modulepreload-polyfill-YP0FEG5d.js";import{c as e,b as t,u as n,i as a,a as o,d as s,s as i,e as c,f as l,h as r,j as d,k as m,l as u}from"./firestore-service-B8JADViu.js";import{i as p,g as y,a as g,r as v,b,s as f,c as h,d as E,j as w,e as j,f as I,h as B,k as L,l as k,p as $,m as S,n as x,o as D,q as C,t as T,u as A,v as M,w as q,x as H,y as P,z as U,A as R,B as _,C as N,D as J,E as z,F,G as O,H as V,I as W,J as G,K as Y,L as Z,M as X,N as K,O as Q,P as ee,Q as te,R as ne,S as ae,T as oe,U as se,V as ie,W as ce,X as le,Y as re,Z as de,_ as me,$ as ue,a0 as pe,a1 as ye,a2 as ge,a3 as ve,a4 as be,a5 as fe,a6 as he,a7 as Ee,a8 as we,a9 as je,aa as Ie}from"./job-edit-utils--2CnLwhj.js";import{formatNumber as Be,escapeHtml as Le,showConfirm as ke,showToast as $e}from"./utils-BB91om2o.js";import{l as Se,_ as xe}from"./api-Dn4wgfAa.js";import{r as De,i as Ce,a as Te,s as Ae,h as Me,b as qe,u as He,c as Pe,d as Ue,e as Re,f as _e,g as Ne,j as Je,p as ze,k as Fe,l as Oe,m as Ve}from"./core-BGjpr6Sj.js";import{f as We,a as Ge,i as Ye}from"./jobs-loader-Bze9ecER.js";import{s as Ze}from"./modal-gG-182nw.js";import{i as Xe,g as Ke,c as Qe,a as et,b as tt,f as nt,d as at,e as ot,r as st,h as it}from"./index-CVa_OPUj.js";import{s as ct,u as lt,a as rt,b as dt}from"./image-uploader-D-bYLO1j.js";import"./LPEditor-DP-zSR3r.js";let mt=null,ut=null,pt=null,yt=null,gt=null;function vt(e){if(gt=e,"undefined"==typeof flatpickr)return void console.warn("[DatePicker] flatpickr not loaded");flatpickr.localize(flatpickr.l10ns.ja);const t=new Date,n=new Date;n.setMonth(t.getMonth()-1),mt=n,ut=t,function(){const e=document.getElementById("date-range-start"),t=document.getElementById("date-range-end");if(!e||!t)return;const n={dateFormat:"Y/m/d",maxDate:"today",disableMobile:!0};pt=flatpickr(e,{...n,defaultDate:mt,onChange:e=>{e[0]&&(mt=e[0],ut&&e[0]>ut&&(ut=e[0],null==yt||yt.setDate(ut)),bt())}}),yt=flatpickr(t,{...n,defaultDate:ut,onChange:e=>{e[0]&&(ut=e[0],mt&&e[0]<mt&&(mt=e[0],null==pt||pt.setDate(mt)),bt())}})}(),function(){const e=document.getElementById("jm-analytics-start-date"),t=document.getElementById("jm-analytics-end-date");if(!e||!t)return;const n={dateFormat:"Y/m/d",maxDate:"today",disableMobile:!0};flatpickr(e,{...n,defaultDate:mt,onChange:e=>{e[0]&&(mt=e[0],null==pt||pt.setDate(e[0]),ut&&e[0]>ut&&(ut=e[0],null==yt||yt.setDate(ut)))}}),flatpickr(t,{...n,defaultDate:ut,onChange:e=>{e[0]&&(ut=e[0],null==yt||yt.setDate(e[0]),mt&&e[0]<mt&&(mt=e[0],null==pt||pt.setDate(mt)))}})}()}function bt(){gt&&gt(ft())}function ft(){const e=mt||new Date(Date.now()-2592e6),t=ut||new Date;return{startDate:e,endDate:t,days:Math.round((t-e)/864e5),startDateStr:ht(e),endDateStr:ht(t)}}function ht(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}let Et=[],wt=null,jt=null,It=null,Bt=null,Lt=null,kt=null;function $t(e,t={}){const n=new URL(e,window.location.origin);if(Object.entries(t).forEach(([e,t])=>{null!=t&&n.searchParams.set(e,t)}),!p()){const e=g();e&&n.searchParams.set("company_domain",e)}return n.toString()}async function St(){const{days:t}=ft(),n=e.apiEndpoint;if(function(){if(p())return;const e=document.getElementById("overview-company-ranking");e&&(e.style.display="none");const t=document.getElementById("tab-companies");t&&(t.style.display="none");const n=document.getElementById("companies-tab");n&&n.classList.remove("active");const a=document.getElementById("tab-conversion"),o=document.getElementById("conversion-tab");a&&o&&(a.classList.add("active"),o.classList.add("active"));const s=document.getElementById("engagement-company-section");s&&(s.style.display="none");const i=document.getElementById("company-cvr-section");i&&(i.style.display="none")}(),n)try{await async function(e,t){try{xt(!0),function(e){const t='<div class="section-loading"><div class="loading-spinner"></div><span>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span></div>';document.querySelectorAll(".stat-value").forEach(e=>{e.dataset.originalText=e.textContent,e.innerHTML='<span class="loading-dots">...</span>'});const n=document.getElementById("daily-chart");n&&e&&(n.innerHTML=t);const a=document.querySelector(".data-table tbody");a&&e&&(a.innerHTML=`<tr><td colspan="5" style="text-align:center;padding:2rem;">${t}</td></tr>`);const o=document.getElementById("company-cards");o&&e&&(o.innerHTML=t);const s=document.querySelector("#applications-section .data-table tbody");s&&e&&(s.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:2rem;">${t}</td></tr>`)}(!0);const o={},s=y();s&&(o.Authorization=`Bearer ${s}`);let i=`${t}?days=${e}`;if(!p()){const e=g();e&&(i+=`&company_domain=${encodeURIComponent(e)}`)}const c=await fetch(i,{headers:o});if(!c.ok)throw new Error(`API Error: ${c.status}`);const l=await c.json();if(!l.success)throw new Error(l.error||"Unknown error");const r=l.data;r.overview&&(Dt("total-pageviews",Be(r.overview.pageViews)),Dt("total-users",Be(r.overview.users)),Dt("company-views",Be(r.overview.companyViews)),Dt("apply-clicks",Be(r.overview.applyClicks)),n=r.overview.gender,a=r.overview.age,v(n,a,{maleBarId:"admin-gender-bar-male",femaleBarId:"admin-gender-bar-female",malePercentId:"admin-gender-male-percent",femalePercentId:"admin-gender-female-percent",ageContainerId:"admin-age-bars"})),r.daily&&Ct(r.daily),r.companies&&(Et=r.companies.filter(e=>e.domain&&"(not set)"!==e.domain&&e.name&&"(not set)"!==e.name).map(e=>({name:e.name,domain:e.domain,views:e.views,clicks:e.clicks,pattern:"standard"})),At(),Mt()),r.applications&&function(e){const t=document.querySelector("#applications-table tbody");if(!t)return;const n={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Le(e.date)}</td>\n      <td>${Le(e.company)}</td>\n      <td><span class="type-badge ${Le(e.type)}">${n[e.type]||Le(e.type)}</span></td>\n      <td>${Le(e.pageType||e.pagePath||"-")}</td>\n      <td>${Le(e.source)}</td>\n    </tr>\n  `).join("")}(r.applications),xt(!1)}catch(o){console.error("[Admin] API fetch error:",o),xt(!1),Tt(e)}var n,a}(t,n)}catch(a){console.error("[Admin] API fetch failed, loading mock data:",a),Tt(t)}else Tt(t)}function xt(e){const t=document.getElementById("refresh-btn");t&&(t.textContent=e?"èª­ã¿è¾¼ã¿ä¸­...":"æ›´æ–°",t.disabled=e)}function Dt(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}function Ct(e){const t=document.getElementById("daily-chart");if(!t)return;if(!e||0===e.length)return void(t.innerHTML="<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>");wt&&(wt.destroy(),wt=null);const n=e.length>30?e.filter((e,t)=>t%3==0):e;t.innerHTML='<canvas id="daily-chart-canvas"></canvas>';const a=document.getElementById("daily-chart-canvas").getContext("2d");wt=new Chart(a,{type:"line",data:{labels:n.map(e=>e.date),datasets:[{label:"PV",data:n.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:3,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:10},maxRotation:45}}}}})}function Tt(e){const t=80*e,n=45*e,a=12*e;Dt("total-pageviews",Be(150*e+Math.floor(500*Math.random()))),Dt("total-users",Be(t+Math.floor(200*Math.random()))),Dt("company-views",Be(n+Math.floor(100*Math.random()))),Dt("apply-clicks",Be(a+Math.floor(30*Math.random()))),function(e){const t=[],n=new Date;for(let a=e-1;a>=0;a--){const e=new Date(n);e.setDate(e.getDate()-a),t.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(100+200*Math.random())})}Ct(t)}(e),Et=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",domain:"toyota",views:1250,clicks:89,pattern:"modern"},{name:"æ—¥ç”£è‡ªå‹•è»Š",domain:"nissan",views:980,clicks:67,pattern:"classic"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",domain:"honda",views:856,clicks:54,pattern:"colorful"},{name:"ã‚¹ãƒãƒ«",domain:"subaru",views:654,clicks:43,pattern:"minimal"},{name:"ãƒãƒ„ãƒ€",domain:"mazda",views:523,clicks:32,pattern:"standard"},{name:"ã‚¹ã‚ºã‚­",domain:"suzuki",views:412,clicks:28,pattern:"modern"},{name:"ãƒ€ã‚¤ãƒãƒ„",domain:"daihatsu",views:387,clicks:24,pattern:"classic"},{name:"ä¸‰è±è‡ªå‹•è»Š",domain:"mitsubishi",views:298,clicks:18,pattern:"standard"}],At(),Mt(),function(){const e=document.querySelector("#applications-table tbody");if(!e)return;const t=[{date:"2025/01/17 14:32",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/17 13:15",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"line",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/17 11:48",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"Yahooæ¤œç´¢"},{date:"2025/01/17 10:22",company:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"},{date:"2025/01/16 18:45",company:"ã‚¹ãƒãƒ«",type:"line",source:"Googleæ¤œç´¢"},{date:"2025/01/16 16:30",company:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",type:"apply",source:"SNS"},{date:"2025/01/16 14:12",company:"ãƒãƒ„ãƒ€",type:"apply",source:"Googleæ¤œç´¢"},{date:"2025/01/16 11:55",company:"æ—¥ç”£è‡ªå‹•è»Š",type:"apply",source:"ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹"}],n={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};e.innerHTML=t.map(e=>`\n    <tr>\n      <td>${Le(e.date)}</td>\n      <td>${Le(e.company)}</td>\n      <td><span class="type-badge ${Le(e.type)}">${n[e.type]}</span></td>\n      <td>${Le(e.source)}</td>\n    </tr>\n  `).join("")}()}function At(){const e=document.querySelector("#overview-company-table tbody");if(!e)return;const t=[...Et].sort((e,t)=>t.views-e.views);e.innerHTML=t.slice(0,5).map((e,t)=>{const n=(e.clicks/e.views*100).toFixed(1);return`\n      <tr>\n        <td>${t+1}</td>\n        <td>${Le(e.name)}</td>\n        <td>${Be(e.views)}</td>\n        <td>${e.clicks}</td>\n        <td>${n}%</td>\n      </tr>\n    `}).join("")}function Mt(){const n=document.getElementById("company-cards");n&&(n.innerHTML=Et.map(e=>{const n=(e.clicks/e.views*100).toFixed(1),a=t(e.pattern);return`\n      <div class="company-card" data-domain="${Le(e.domain)}" data-name="${Le(e.name)}" data-views="${e.views}" data-clicks="${e.clicks}">\n        <div class="company-card-header">\n          <h4>${Le(e.name)}</h4>\n          <span class="pattern-badge ${Le(e.pattern)}">${a}</span>\n        </div>\n        <div class="company-card-stats">\n          <div class="card-stat">\n            <span class="stat-value">${Be(e.views)}</span>\n            <span class="stat-label">ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${e.clicks}</span>\n            <span class="stat-label">å¿œå‹Ÿã‚¯ãƒªãƒƒã‚¯</span>\n          </div>\n          <div class="card-stat">\n            <span class="stat-value">${n}%</span>\n            <span class="stat-label">CVR</span>\n          </div>\n        </div>\n        <button class="btn-view-status" data-domain="${Le(e.domain)}" data-name="${Le(e.name)}">ä¼šç¤¾ã®çŠ¶æ³ã‚’ç¢ºèª</button>\n      </div>\n    `}).join(""),n.querySelectorAll(".btn-view-status").forEach(t=>{t.addEventListener("click",t=>{!async function(t,n){const a=document.getElementById("company-detail-title");a&&(a.textContent=`${n} ã®åˆ†æ`);const o=document.getElementById("detail-view-page-btn");o&&(o.href=`company.html?c=${t}`);document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const s=document.getElementById("section-company-detail");s&&s.classList.add("active");const i=document.getElementById("page-title");i&&(i.textContent="ä¼æ¥­è©³ç´°åˆ†æ");document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")}),function(){const e='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';document.querySelectorAll(".detail-stat-value").forEach(e=>{e.textContent="-"}),document.querySelectorAll(".detail-chart").forEach(t=>{t.innerHTML=e}),document.querySelectorAll(".detail-table-container tbody").forEach(e=>{e.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>'})}();const{days:c}=ft();try{await async function(t,n){const a=e.apiEndpoint,o={},s=y();s&&(o.Authorization=`Bearer ${s}`);const i=await fetch(`${a}?type=company-detail&domain=${t}&days=${n}`,{headers:o}),c=await i.json();if(!c.success)throw new Error(c.error||"API Error");!async function(e,t){var n,a;const o=Et.find(e=>e.domain===t)||{},s=(null==(n=e.summary)?void 0:n.totalViews)||o.views||0,i=o.clicks||0,c=s>0?(i/s*100).toFixed(1):0,l=(null==(a=e.summary)?void 0:a.avgDailyViews)||0;Dt("detail-total-views",Be(s)),Dt("detail-total-clicks",Be(i)),Dt("detail-cvr",`${c}%`),Dt("detail-avg-daily",Be(Math.round(l))),Gt(e.daily||[]),Zt(e.traffic||[]);const r=e.gender||{};Xt({male:r.male||0,female:r.female||0,other:r.unknown||0});const d=e.age||{};Kt((m=d,{"20s":(m["18-24"]||0)+(m["25-34"]||0),"30s":m["35-44"]||0,"40s":m["45-54"]||0,"50s":(m["55-64"]||0)+(m["65+"]||0)}));var m;const u=e.jobs||[];if(u.length>0){Yt(u.slice(0,5).map(e=>({title:e.jobTitle||e.pagePath||"ä¸æ˜",applications:e.applications||0})));Qt(u.map(e=>({title:e.jobTitle||e.pagePath||"ä¸æ˜",views:e.views||0,applications:e.applications||0,cvr:e.views>0?((e.applications||0)/e.views*100).toFixed(1):"0.0"})))}else Yt([]),Qt([]);await en(t)}(c.data,t)}(t,c)}catch(l){console.error("[Admin] Company detail error:",l),function(e){const t=Et.find(t=>t.domain===e)||{views:1e3,clicks:50},n=t.views,a=t.clicks,o=(a/n*100).toFixed(1);Dt("detail-total-views",Be(n)),Dt("detail-total-clicks",Be(a)),Dt("detail-cvr",`${o}%`),Dt("detail-avg-daily",Be(Math.round(n/30)));const s=[],i=new Date;for(let l=29;l>=0;l--){const e=new Date(i);e.setDate(e.getDate()-l),s.push({date:`${e.getMonth()+1}/${e.getDate()}`,views:Math.floor(20+60*Math.random())})}Gt(s);const c=[{title:"è£½é€ ã‚¹ã‚¿ãƒƒãƒ•",applications:23},{title:"çµ„ç«‹ä½œæ¥­å“¡",applications:18},{title:"æ¤œæŸ»ãƒ»æ¤œå“",applications:12},{title:"æ©Ÿæ¢°ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼",applications:8},{title:"ãƒ•ã‚©ãƒ¼ã‚¯ãƒªãƒ•ãƒˆ",applications:5}];Yt(c);Zt([{channel:"Organic Search",count:Math.floor(.45*n)},{channel:"Direct",count:Math.floor(.28*n)},{channel:"Social",count:Math.floor(.18*n)},{channel:"Referral",count:Math.floor(.09*n)}]);Xt({male:Math.floor(.72*a),female:Math.floor(.25*a),other:Math.floor(.03*a)});Kt({"20s":Math.floor(.35*a),"30s":Math.floor(.32*a),"40s":Math.floor(.23*a),"50s":Math.floor(.1*a)}),Qt(c.map(e=>({...e,views:Math.floor(n*(e.applications/a)),cvr:(e.applications/(n*(e.applications/a))*100).toFixed(1)}))),en(e)}(t)}}(t.target.dataset.domain,t.target.dataset.name)})}))}function qt(e){const t=document.querySelectorAll(".company-card"),n=e.toLowerCase();t.forEach(e=>{const t=e.dataset.name.toLowerCase(),a=e.dataset.domain.toLowerCase();t.includes(n)||a.includes(n)?e.style.display="":e.style.display="none"})}function Ht(){const e=document.getElementById("sort-by"),t=(null==e?void 0:e.value)||"views",n=document.getElementById("company-cards");if(!n)return;const a=Array.from(n.querySelectorAll(".company-card"));a.sort((e,n)=>{switch(t){case"views":return parseInt(n.dataset.views)-parseInt(e.dataset.views);case"clicks":return parseInt(n.dataset.clicks)-parseInt(e.dataset.clicks);case"cvr":const t=parseInt(e.dataset.clicks)/parseInt(e.dataset.views);return parseInt(n.dataset.clicks)/parseInt(n.dataset.views)-t;case"name":return e.dataset.name.localeCompare(n.dataset.name,"ja");default:return 0}}),a.forEach(e=>n.appendChild(e))}function Pt(){const t=document.querySelectorAll(".analytics-tab"),n=document.querySelectorAll(".analytics-tab-content");t.forEach(a=>{a.addEventListener("click",()=>{const o=a.dataset.tab;t.forEach(e=>e.classList.remove("active")),a.classList.add("active"),n.forEach(e=>e.classList.remove("active"));const s=document.getElementById(o);s&&(s.classList.add("active"),async function(t){const{days:n}=ft(),a=e.apiEndpoint;switch(t){case"traffic-behavior-tab":await Promise.all([Ut(n,a),_t(n,a)]);break;case"conversion-tab":await async function(e,t){try{const n={},a=y();a&&(n.Authorization=`Bearer ${a}`);const o=$t(t,{type:"funnel",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?zt(i.data):Ft()}catch(n){console.error("[Admin] Funnel data error:",n),Ft()}}(n,a);break;case"trends-tab":await async function(e,t){try{const n={},a=y();a&&(n.Authorization=`Bearer ${a}`);const o=$t(t,{type:"trends",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?Ot(i.data):Vt()}catch(n){console.error("[Admin] Trend data error:",n),Vt()}}(n,a)}}(o))})})}async function Ut(e,t){try{const n={},a=y();a&&(n.Authorization=`Bearer ${a}`);const o=$t(t,{type:"engagement",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?function(e){const t=e.overall||{};Dt("avg-session-duration",`${t.avgSessionDuration||0}ç§’`),Dt("engagement-rate",`${t.engagementRate||0}%`),Dt("bounce-rate",`${t.bounceRate||0}%`);const n=document.querySelector("#engagement-company-table tbody");n&&e.byCompany&&e.byCompany.length>0?n.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${Le(e.name||e.domain)}</td>\n        <td>${Be(e.views)}</td>\n        <td>${Math.round(e.engagementTime)}ç§’</td>\n        <td>${e.avgTimePerView}ç§’</td>\n      </tr>\n    `).join(""):n&&(n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}(i.data):Rt()}catch(n){console.error("[Admin] Engagement data error:",n),Rt()}}function Rt(){Dt("avg-session-duration","45.2ç§’"),Dt("engagement-rate","68.5%"),Dt("bounce-rate","31.5%");const e=document.querySelector("#engagement-company-table tbody");if(e){const t=[{name:"ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š",views:1250,time:4500,avg:"3.6"},{name:"æ—¥ç”£è‡ªå‹•è»Š",views:980,time:3200,avg:"3.3"},{name:"æœ¬ç”°æŠ€ç ”å·¥æ¥­",views:856,time:2800,avg:"3.3"}];e.innerHTML=t.map(e=>`\n      <tr>\n        <td>${e.name}</td>\n        <td>${Be(e.views)}</td>\n        <td>${e.time}ç§’</td>\n        <td>${e.avg}ç§’</td>\n      </tr>\n    `).join("")}}async function _t(e,t){try{const n={},a=y();a&&(n.Authorization=`Bearer ${a}`);const o=$t(t,{type:"traffic",days:e}),s=await fetch(o,{headers:n}),i=await s.json();i.success&&i.data?Nt(i.data):Jt()}catch(n){console.error("[Admin] Traffic data error:",n),Jt()}}function Nt(e){const t=document.getElementById("channel-chart");if(t&&e.channels&&e.channels.length>0){Bt&&(Bt.destroy(),Bt=null),t.innerHTML='<canvas id="channel-chart-canvas"></canvas>';const n=document.getElementById("channel-chart-canvas").getContext("2d");Bt=new Chart(n,{type:"bar",data:{labels:e.channels.map(e=>e.channel),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:e.channels.map(e=>e.sessions),backgroundColor:["rgba(99, 102, 241, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},y:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const n=document.querySelector("#source-table tbody");n&&e.sources&&e.sources.length>0?n.innerHTML=e.sources.map(e=>`\n      <tr>\n        <td>${Le(e.source)}</td>\n        <td>${Le(e.medium)}</td>\n        <td>${Be(e.sessions)}</td>\n        <td>${Be(e.users)}</td>\n      </tr>\n    `).join(""):n&&(n.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}function Jt(){Nt({channels:[{channel:"Organic Search",sessions:1250},{channel:"Direct",sessions:890},{channel:"Social",sessions:456},{channel:"Referral",sessions:234}],sources:[{source:"google",medium:"organic",sessions:890,users:756},{source:"(direct)",medium:"(none)",sessions:456,users:412},{source:"yahoo",medium:"organic",sessions:234,users:198}]})}function zt(e){const t=document.getElementById("funnel-chart");t&&e.funnel&&e.funnel.length>0&&(t.innerHTML=e.funnel.map(e=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${Le(e.stage)}</span>\n        <span class="funnel-stage-count">${Be(e.count)}</span>\n        <span class="funnel-stage-rate">${e.rate}%</span>\n      </div>\n    `).join(""));const n=document.getElementById("action-breakdown-chart");if(n&&e.actionBreakdown&&e.actionBreakdown.length>0){Lt&&(Lt.destroy(),Lt=null),n.innerHTML='<canvas id="action-chart-canvas"></canvas>';const t=document.getElementById("action-chart-canvas").getContext("2d");Lt=new Chart(t,{type:"bar",data:{labels:e.actionBreakdown.map(e=>e.label),datasets:[{label:"ä»¶æ•°",data:e.actionBreakdown.map(e=>e.count),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(245, 158, 11, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},y:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const a=document.querySelector("#company-funnel-table tbody");a&&e.byCompany&&e.byCompany.length>0?a.innerHTML=e.byCompany.map(e=>`\n      <tr>\n        <td>${Le(e.domain)}</td>\n        <td>${Be(e.views)}</td>\n        <td>${Be(e.clicks)}</td>\n        <td>${e.cvr}%</td>\n      </tr>\n    `).join(""):a&&(a.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}function Ft(){zt({funnel:[{stage:"ã‚µã‚¤ãƒˆè¨ªå•",count:5e3,rate:"100"},{stage:"ä¼æ¥­ãƒšãƒ¼ã‚¸é–²è¦§",count:2500,rate:"50.0"},{stage:"ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«",count:1800,rate:"36.0"},{stage:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",count:150,rate:"6.0"}],actionBreakdown:[{label:"å¿œå‹Ÿãƒœã‚¿ãƒ³",count:89},{label:"LINEç›¸è«‡",count:45},{label:"ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡",count:16}],byCompany:[{domain:"toyota",views:1250,clicks:89,cvr:"7.1"},{domain:"nissan",views:980,clicks:67,cvr:"6.8"},{domain:"honda",views:856,clicks:54,cvr:"6.3"}]})}function Ot(e){e.insights&&(Dt("peak-day",e.insights.peakDay||"-"),Dt("peak-hour",e.insights.peakHour||"-"));const t=document.getElementById("day-of-week-chart");if(t&&e.byDayOfWeek&&e.byDayOfWeek.length>0){jt&&(jt.destroy(),jt=null),t.innerHTML='<canvas id="day-of-week-canvas"></canvas>';const n=document.getElementById("day-of-week-canvas").getContext("2d");jt=new Chart(n,{type:"bar",data:{labels:e.byDayOfWeek.map(e=>e.day),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:e.byDayOfWeek.map(e=>e.sessions),backgroundColor:"rgba(99, 102, 241, 0.8)",borderColor:"rgba(99, 102, 241, 1)",borderWidth:1,borderRadius:4,barPercentage:.7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6,titleFont:{size:12},bodyFont:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}const n=document.getElementById("hour-chart");if(n&&e.byHour&&e.byHour.length>0){It&&(It.destroy(),It=null);const t=[{label:"æ·±å¤œ",hours:[0,1,2,3,4,5]},{label:"æœ",hours:[6,7,8,9,10,11]},{label:"æ˜¼",hours:[12,13,14,15,16,17]},{label:"å¤œ",hours:[18,19,20,21,22,23]}].map(t=>{const n=t.hours.reduce((t,n)=>{const a=e.byHour.find(e=>e.hour===n);return t+(a?a.sessions:0)},0);return{label:t.label,sessions:n}});n.innerHTML='<canvas id="hour-chart-canvas"></canvas>';const a=document.getElementById("hour-chart-canvas").getContext("2d");It=new Chart(a,{type:"bar",data:{labels:t.map(e=>e.label),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:t.map(e=>e.sessions),backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1,borderRadius:4,barPercentage:.7}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:10,cornerRadius:6,titleFont:{size:12},bodyFont:{size:14,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:12}}}}}})}}function Vt(){Dt("peak-day","æœ¨"),Dt("peak-hour","14æ™‚");Ot({byDayOfWeek:[{day:"æ—¥",sessions:380},{day:"æœˆ",sessions:270},{day:"ç«",sessions:245},{day:"æ°´",sessions:244},{day:"æœ¨",sessions:250},{day:"é‡‘",sessions:278},{day:"åœŸ",sessions:358}],byHour:Array.from({length:24},(e,t)=>({hour:t,sessions:Math.floor(50*Math.random())+10}))})}function Wt(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-companies");e&&e.classList.add("active"),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const t=document.querySelector('[data-section="companies"]');t&&t.parentElement.classList.add("active");const n=document.getElementById("page-title");n&&(n.textContent="ä¼æ¥­åˆ¥ãƒ‡ãƒ¼ã‚¿")}function Gt(e){const t=document.getElementById("detail-daily-chart");if(!t||!e.length)return void(t&&(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'));kt&&(kt.destroy(),kt=null),t.innerHTML='<canvas id="detail-daily-canvas"></canvas>';const n=document.getElementById("detail-daily-canvas").getContext("2d");kt=new Chart(n,{type:"line",data:{labels:e.map(e=>e.date),datasets:[{label:"PV",data:e.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(30, 41, 59, 0.9)",padding:8,cornerRadius:4}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"},ticks:{color:"#64748b",font:{size:10}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:9},maxRotation:45}}}}})}function Yt(e){const t=document.getElementById("detail-job-chart");if(!t)return;if(!e.length)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=Math.max(...e.map(e=>e.applications));t.innerHTML=`\n    <div class="detail-bar-chart">\n      ${e.slice(0,5).map((e,t)=>{const a=n>0?e.applications/n*100:0;return`\n          <div class="detail-bar-row">\n            <span class="detail-bar-label" title="${Le(e.title)}">${Le(e.title)}</span>\n            <div class="detail-bar-track">\n              <div class="detail-bar-fill job-${t+1}" style="width: ${a}%"></div>\n              <span class="detail-bar-value">${e.applications}ä»¶</span>\n            </div>\n          </div>\n        `}).join("")}\n    </div>\n  `}function Zt(e){const t=document.getElementById("detail-traffic-chart");if(!t)return;if(!e.length)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=e.reduce((e,t)=>e+t.count,0),a=["organic","direct","social","referral"];let o=[],s=0;e.forEach((e,t)=>{const i=e.count/n*100,c=a[t%a.length];o.push(`${{organic:"#10b981",direct:"#6366f1",social:"#f59e0b",referral:"#8b5cf6"}[c]} ${s}deg ${s+3.6*i}deg`),s+=3.6*i}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${e.map((e,t)=>{const o=(e.count/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${a[t%a.length]}"></span>\n              <span class="pie-label">${Le(e.channel)}</span>\n              <span class="pie-value">${o}%</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function Xt(e){const t=document.getElementById("detail-gender-chart");if(!t)return;const n=e.male+e.female+e.other;if(0===n)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=(e.male/n*100).toFixed(1),o=(e.female/n*100).toFixed(1),s=(e.other/n*100).toFixed(1),i=e.male/n*360,c=e.female/n*360;t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(#3b82f6 0deg ${i}deg, #ec4899 ${i}deg ${i+c}deg, #94a3b8 ${i+c}deg 360deg);"></div>\n      <div class="pie-legend">\n        <div class="pie-legend-item">\n          <span class="pie-color male"></span>\n          <span class="pie-label">ç”·æ€§</span>\n          <span class="pie-value">${e.male}äºº (${a}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color female"></span>\n          <span class="pie-label">å¥³æ€§</span>\n          <span class="pie-value">${e.female}äºº (${o}%)</span>\n        </div>\n        <div class="pie-legend-item">\n          <span class="pie-color other"></span>\n          <span class="pie-label">ãã®ä»–</span>\n          <span class="pie-value">${e.other}äºº (${s}%)</span>\n        </div>\n      </div>\n    </div>\n  `}function Kt(e){const t=document.getElementById("detail-age-chart");if(!t)return;const n=e["20s"]+e["30s"]+e["40s"]+e["50s"];if(0===n)return void(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a=[{key:"20s",label:"20ä»£",color:"age-20s",colorCode:"#3b82f6"},{key:"30s",label:"30ä»£",color:"age-30s",colorCode:"#10b981"},{key:"40s",label:"40ä»£",color:"age-40s",colorCode:"#f59e0b"},{key:"50s",label:"50ä»£ä»¥ä¸Š",color:"age-50s",colorCode:"#ef4444"}];let o=[],s=0;a.forEach(t=>{const a=e[t.key]/n*100;o.push(`${t.colorCode} ${s}deg ${s+3.6*a}deg`),s+=3.6*a}),t.innerHTML=`\n    <div class="detail-pie-chart">\n      <div class="pie-visual" style="background: conic-gradient(${o.join(", ")});"></div>\n      <div class="pie-legend">\n        ${a.map(t=>{const a=(e[t.key]/n*100).toFixed(1);return`\n            <div class="pie-legend-item">\n              <span class="pie-color ${t.color}"></span>\n              <span class="pie-label">${t.label}</span>\n              <span class="pie-value">${e[t.key]}äºº (${a}%)</span>\n            </div>\n          `}).join("")}\n      </div>\n    </div>\n  `}function Qt(e){const t=document.querySelector("#detail-job-table tbody");t&&(e.length?t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Le(e.title)}</td>\n      <td>${Be(e.views)}</td>\n      <td>${e.applications}</td>\n      <td>${e.cvr}%</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}async function en(t){const n=e.apiEndpoint,a={},o=y();o&&(a.Authorization=`Bearer ${o}`);try{const e=await fetch(`${n}?type=recent-applications&domain=${t}&limit=10`,{headers:a}),o=await e.json();if(o.success&&o.data&&o.data.applications){tn(o.data.applications.map(e=>({date:e.date,job:e.jobTitle||"-",type:e.type||"apply",source:e.source||"Direct"})))}else tn([])}catch(s){console.error("[Admin] Recent applications error:",s),tn([])}}function tn(e){const t=document.querySelector("#detail-recent-applications tbody");if(!t)return;const n={apply:"å¿œå‹Ÿ",line:"LINE",consult:"ç›¸è«‡"};e.length?t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Le(e.date)}</td>\n      <td>${Le(e.job)}</td>\n      <td><span class="type-badge ${e.type}">${n[e.type]||e.type}</span></td>\n      <td>${Le(e.source)}</td>\n    </tr>\n  `).join(""):t.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}function nn(){const e=document.getElementById("btn-back-to-companies");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",Wt),e.setAttribute("data-listener-attached","true"))}const an="https://asia-northeast1-generated-area-484613-e3.cloudfunctions.net/getPageAnalytics";let on="all";async function sn(){try{const t=p()?null:g(),{days:n}=ft(),a=new URLSearchParams({type:"overview",days:n});t&&a.set("company_domain",t),"all"!==on&&a.set("page_type",on);const o=new URLSearchParams({type:"overview",days:n});t&&o.set("company_domain",t);const[s,i]=await Promise.all([fetch(`${an}?${a}`),fetch(`${an}?${o}`)]),c=await s.json(),l=await i.json();c.success&&(e=c.data,cn("pa-total-views",Be(e.totalPageViews||0)),cn("pa-unique-visitors",Be(e.totalUniqueVisitors||0)),cn("pa-cta-clicks",Be(e.totalCtaClicks||0)),cn("pa-avg-time",function(e){if(!e||e<=0)return"-";const t=Math.round(e);return t>=60?`${Math.floor(t/60)}åˆ†${t%60}ç§’`:`${t}ç§’`}(e.avgTimeOnPage||0)),function(e){const t=document.getElementById("pa-referrer-chart");if(!t)return;const n=Object.values(e).reduce((e,t)=>e+t,0);if(0===n)return void(t.innerHTML='<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a={google:"Googleæ¤œç´¢",yahoo:"Yahooæ¤œç´¢",direct:"ç›´æ¥æµå…¥",indeed:"Indeed",jobbox:"æ±‚äººãƒœãƒƒã‚¯ã‚¹",internal:"ã‚µã‚¤ãƒˆå†…",twitter:"Twitter/X",facebook:"Facebook",line:"LINE",other:"ãã®ä»–"},o=Object.entries(e).sort((e,t)=>t[1]-e[1]).slice(0,6).map(([e,t])=>{const o=(t/n*100).toFixed(1),s=a[e]||e;return`\n      <div class="referrer-bar-row">\n        <span class="referrer-label">${Le(s)}</span>\n        <div class="referrer-bar-container">\n          <div class="referrer-bar" style="width: ${o}%"></div>\n        </div>\n        <span class="referrer-value">${Be(t)} (${o}%)</span>\n      </div>\n    `}).join("");t.innerHTML=o}(e.byReferrer||{}),function(e){const t=document.getElementById("pa-device-chart");if(!t)return;const n=Object.values(e).reduce((e,t)=>e+t,0);if(0===n)return void(t.innerHTML='<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const a={mobile:"ãƒ¢ãƒã‚¤ãƒ«",desktop:"ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—",tablet:"ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ"},o={mobile:"#6366f1",desktop:"#22c55e",tablet:"#f59e0b"},s=`\n    <div class="device-pie-chart">\n      ${Object.entries(e).sort((e,t)=>t[1]-e[1]).map(([e,t])=>{const s=(t/n*100).toFixed(1),i=a[e]||e;return`\n          <div class="device-item">\n            <div class="device-color" style="background: ${o[e]||"#94a3b8"}"></div>\n            <span class="device-label">${Le(i)}</span>\n            <span class="device-value">${Be(t)} (${s}%)</span>\n          </div>\n        `}).join("")}\n    </div>\n  `;t.innerHTML=s}(e.byDevice||{})),l.success&&function(e){var t,n,a,o,s,i,c,l;const r=(null==(n=null==(t=e.byPageType)?void 0:t.lp)?void 0:n.views)||0,d=(null==(o=null==(a=e.byPageType)?void 0:a.lp)?void 0:o.clicks)||0,m=r>0?(d/r*100).toFixed(1):"0.0";cn("pa-lp-views",Be(r)),cn("pa-lp-clicks",Be(d)),cn("pa-lp-cvr",`${m}%`);const u=(null==(i=null==(s=e.byPageType)?void 0:s.recruit)?void 0:i.views)||0,p=(null==(l=null==(c=e.byPageType)?void 0:c.recruit)?void 0:l.clicks)||0,y=u>0?(p/u*100).toFixed(1):"0.0";cn("pa-recruit-views",Be(u)),cn("pa-recruit-clicks",Be(p)),cn("pa-recruit-cvr",`${y}%`)}(l.data);const r=new URLSearchParams({type:"lp",days:n});t&&r.set("company_domain",t);const d=await fetch(`${an}?${r}`),m=await d.json();m.success&&function(e){const t=document.querySelector("#pa-lp-table tbody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Le(e.companyName||e.companyDomain)}</td>\n      <td>${Le(e.jobTitle||"-")}</td>\n      <td>${Be(e.pageViews||0)}</td>\n      <td>${Be(e.uniqueVisitors||0)}</td>\n      <td>${Be(e.ctaClicks||0)}</td>\n      <td>${e.cvr||"0.0"}%</td>\n    </tr>\n  `).join("")}(m.data);const u=new URLSearchParams({type:"recruit",days:n});t&&u.set("company_domain",t);const y=await fetch(`${an}?${u}`),v=await y.json();v.success&&function(e){const t=document.querySelector("#pa-recruit-table tbody");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<tr><td colspan="5" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');t.innerHTML=e.map(e=>`\n    <tr>\n      <td>${Le(e.companyName||e.companyDomain)}</td>\n      <td>${Be(e.pageViews||0)}</td>\n      <td>${Be(e.uniqueVisitors||0)}</td>\n      <td>${Be(e.ctaClicks||0)}</td>\n      <td>${e.cvr||"0.0"}%</td>\n    </tr>\n  `).join("")}(v.data)}catch(t){console.error("[PageAnalytics] ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),function(){cn("pa-total-views","-"),cn("pa-unique-visitors","-"),cn("pa-cta-clicks","-"),cn("pa-avg-time","-"),cn("pa-lp-views","-"),cn("pa-lp-clicks","-"),cn("pa-lp-cvr","-"),cn("pa-recruit-views","-"),cn("pa-recruit-clicks","-"),cn("pa-recruit-cvr","-");const e=document.getElementById("pa-referrer-chart");e&&(e.innerHTML='<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const t=document.getElementById("pa-device-chart");t&&(t.innerHTML='<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=document.querySelector("#pa-lp-table tbody");n&&(n.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');const a=document.querySelector("#pa-recruit-table tbody");a&&(a.innerHTML='<tr><td colspan="5" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}()}var e}function cn(e,t){const n=document.getElementById(e);n&&(n.textContent=t)}let ln=null,rn={},dn=null;async function mn(e=null){e&&(dn=e),await async function(){const e=document.getElementById("recruit-company-grid");if(!e)return;try{const t=(await window.JobsLoader.fetchCompanies()).filter(e=>window.JobsLoader.isCompanyVisible(e));if(!p()){const e=g(),n=t.find(t=>t.companyDomain===e);if(n){document.getElementById("recruit-company-select-group").style.display="none";const e=document.getElementById("recruit-back-to-companies");return e&&(e.style.display="none"),void un(n)}}if(0===t.length)return void(e.innerHTML='<p class="no-data">è¡¨ç¤ºå¯èƒ½ãªä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“</p>');if(e.innerHTML=t.map(e=>`\n      <div class="lp-company-card" data-company-domain="${Le(e.companyDomain||"")}">\n        <div class="lp-company-card-image" style="${e.imageUrl?`background-image: url('${Le(e.imageUrl)}')`:""}">\n          ${e.imageUrl?"":'<span class="no-image-icon">ğŸ¢</span>'}\n        </div>\n        <div class="lp-company-card-content">\n          <h4 class="lp-company-card-title">${Le(e.company||"ä¼šç¤¾åæœªè¨­å®š")}</h4>\n          <p class="lp-company-card-domain">${Le(e.companyDomain||"")}</p>\n        </div>\n      </div>\n    `).join(""),e.querySelectorAll(".lp-company-card").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.companyDomain,a=t.find(e=>e.companyDomain===n);a&&un(a)})}),dn){const e=t.find(e=>e.companyDomain===dn);e&&un(e),dn=null}}catch(t){console.error("[RecruitSettings] ä¼šç¤¾ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<p class="error">ä¼šç¤¾ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}}(),function(){const e=document.getElementById("recruit-company-search");e&&e.addEventListener("input",()=>{const t=e.value.toLowerCase();document.querySelectorAll("#recruit-company-grid .lp-company-card").forEach(e=>{var n,a;const o=(null==(n=e.querySelector(".lp-company-card-title"))?void 0:n.textContent.toLowerCase())||"",s=(null==(a=e.dataset.companyDomain)?void 0:a.toLowerCase())||"";e.style.display=o.includes(t)||s.includes(t)?"":"none"})});const t=document.getElementById("recruit-back-to-companies");t&&!t.hasAttribute("data-listener-attached")&&(t.addEventListener("click",()=>{ln=null,rn={},document.getElementById("recruit-company-select-group").style.display="block",document.getElementById("recruit-editor").style.display="none";const e=document.getElementById("recruit-url-display");e&&(e.style.display="none")}),t.setAttribute("data-listener-attached","true"));const n=document.getElementById("btn-save-recruit-settings");n&&n.addEventListener("click",async()=>{ln&&await Me(ln.companyDomain,e=>{rn=e})});const a=document.getElementById("btn-reset-recruit-settings");a&&a.addEventListener("click",async()=>{await ke("è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ","æœªä¿å­˜ã®å¤‰æ›´ã¯å¤±ã‚ã‚Œã¾ã™ã€‚")&&ln&&(qe(rn,ln.company,ln.description,ln.imageUrl),He())});const o=document.getElementById("btn-add-custom-link");o&&o.addEventListener("click",()=>{Pe()});const s=document.getElementById("btn-open-template-selector");s&&s.addEventListener("click",()=>{Ue()});const i=document.getElementById("btn-copy-recruit-url");i&&i.addEventListener("click",()=>{const e=document.getElementById("recruit-embed-url");e&&e.value&&yn(e.value)});document.querySelectorAll("#recruit-embed-banners .btn-copy-banner").forEach(e=>{e.addEventListener("click",()=>{if(!ln)return;const t=function(e,t,n){const a=`${window.location.origin}/company-recruit.html?id=${encodeURIComponent(t)}`,o=Le(n||"");switch(e){case"button":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:12px 24px;background:#0ea5e9;color:#fff;text-decoration:none;border-radius:6px;font-weight:bold;font-size:14px;">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰</a>`;case"button-large":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:16px 32px;background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;text-decoration:none;border-radius:8px;font-weight:bold;font-size:16px;box-shadow:0 4px 14px rgba(14,165,233,0.4);">æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰ â†’</a>`;case"card":return`<a href="${a}" target="_blank" rel="noopener" style="display:block;max-width:300px;padding:20px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;text-decoration:none;box-shadow:0 2px 8px rgba(0,0,0,0.08);"><span style="display:block;font-size:12px;color:#6b7280;margin-bottom:4px;">æ¡ç”¨æƒ…å ±</span><span style="display:block;font-size:16px;font-weight:bold;color:#1f2937;">${o} æ¡ç”¨æƒ…å ±ã¯ã“ã¡ã‚‰</span><span style="display:block;margin-top:8px;color:#0ea5e9;font-size:14px;">è©³ã—ãè¦‹ã‚‹ â†’</span></a>`;case"recruiting":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:16px 28px;background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;text-decoration:none;border-radius:8px;text-align:center;box-shadow:0 4px 14px rgba(249,115,22,0.4);"><span style="display:block;font-size:12px;font-weight:500;">ãŸã ã„ã¾</span><span style="display:block;font-size:18px;font-weight:bold;">æ±‚äººå‹Ÿé›†ä¸­ï¼</span></a>`;case"special":return`<a href="${a}" target="_blank" rel="noopener" style="display:inline-block;padding:20px 32px;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;text-decoration:none;border-radius:12px;text-align:center;box-shadow:0 4px 20px rgba(99,102,241,0.4);"><span style="display:block;font-size:14px;font-weight:500;">æ¡ç”¨ç‰¹è¨­ãƒšãƒ¼ã‚¸</span><span style="display:block;font-size:20px;font-weight:bold;margin-top:4px;">å…¬é–‹ä¸­ï¼ï¼</span></a>`;default:return""}}(e.dataset.banner,ln.companyDomain,ln.company);yn(t)})})}(),function(){const e=document.getElementById("recruit-layout-style-grid");if(!e)return;e.innerHTML=Re.map((e,t)=>`\n    <label class="layout-option">\n      <input type="radio" name="recruit-layout-style" value="${Le(e.id)}" ${0===t?"checked":""}>\n      <div class="layout-preview" style="position: relative;">\n        <div class="template-color-preview" style="\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          width: 24px;\n          height: 24px;\n          border-radius: 4px;\n          background: ${e.color};\n          border: 2px solid rgba(255,255,255,0.8);\n          box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n        "></div>\n        <span class="layout-name">${Le(e.name)}</span>\n        <span class="layout-desc">${Le(e.description)}</span>\n        <span class="layout-industries" style="font-size: 11px; color: #6b7280; margin-top: 4px; display: block;">${e.industries.join(" / ")}</span>\n      </div>\n    </label>\n  `).join(""),e.querySelectorAll('input[name="recruit-layout-style"]').forEach(e=>{e.addEventListener("change",()=>{He()})})}(),De(),Ce(),Te(),Ae()}async function un(e){ln=e,document.getElementById("recruit-company-select-group").style.display="none",document.getElementById("recruit-editor").style.display="block",document.getElementById("recruit-selected-company-name").textContent=e.company,function(e){const t=document.getElementById("recruit-url-display"),n=document.getElementById("recruit-url-link");if(!t||!n)return;const a=`${window.location.origin}/company-recruit.html?id=${encodeURIComponent(e)}`;n.href=a,n.textContent=a,t.style.display="block";const o=document.getElementById("recruit-embed-url");o&&(o.value=a)}(e.companyDomain),_e(e.companyDomain),Ne(e.companyDomain),Je(e.companyDomain),pn(!0);try{rn=await Se(e.companyDomain)||{},Object.keys(rn).length>0?ze(rn,e.company):Fe(e.company,e.description,e.imageUrl),await async function(e){try{const t=e.manageSheetUrl||e.jobsSheet;if(!t)return void Ve([]);const n=await window.JobsLoader.fetchCompanyJobs(t);if(!(null==n?void 0:n.length))return void Ve([]);const a=n.filter(e=>"false"!==e.visible&&"FALSE"!==e.visible).filter(e=>window.JobsLoader.isJobInPublishPeriod(e)).sort((e,t)=>(parseInt(e.order)||999)-(parseInt(t.order)||999));Ve(a)}catch(t){console.error("[RecruitSettings] æ±‚äººãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),Ve([])}}(e),Oe()}finally{pn(!1)}}function pn(e){const t=document.getElementById("recruit-editor");if(!t)return;t.querySelectorAll("input, select, textarea, button").forEach(t=>{t.disabled=e});const n=document.getElementById("btn-save-recruit-settings"),a=document.getElementById("btn-reset-recruit-settings");n&&(n.disabled=e),a&&(a.disabled=e);const o=t.querySelector(".recruit-loading-overlay");if(e){if(!o){const e=document.createElement("div");e.className="recruit-loading-overlay",e.innerHTML='<div class="loading-spinner"></div><p>èª­ã¿è¾¼ã¿ä¸­...</p>',t.style.position="relative",t.appendChild(e)}}else null==o||o.remove()}async function yn(e){try{await navigator.clipboard.writeText(e);const{showToast:t}=await xe(async()=>{const{showToast:e}=await import("./utils-BB91om2o.js");return{showToast:e}},[]);t("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ","success")}catch(t){console.error("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—:",t);const{showToast:e}=await xe(async()=>{const{showToast:e}=await import("./utils-BB91om2o.js");return{showToast:e}},[]);e("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}}let gn=[],vn=[],bn=[],fn=null;async function hn(e=null){e&&(fn=e),await async function(){const e=document.getElementById("job-listings-container");if(!e)return;try{if(vn=await We(),gn=await Ge(),!p()){const e=g();e&&(gn=gn.filter(t=>t.companyDomain===e))}if(function(){const e=document.getElementById("job-company-filter");if(!e)return;if(!p()){const t=e.closest(".filter-group")||e.parentElement;return void(t&&(t.style.display="none"))}const t=vn.filter(e=>Ye(e));e.innerHTML='<option value="">ã™ã¹ã¦ã®ä¼šç¤¾</option>',t.forEach(t=>{const n=document.createElement("option");n.value=t.companyDomain||"",n.textContent=t.company||"ä¼šç¤¾åæœªè¨­å®š",e.appendChild(n)})}(),fn){const e=document.getElementById("job-company-filter");e&&(e.value=fn),fn=null}!function(){const e=document.getElementById("summary-total-jobs"),t=document.getElementById("summary-active-jobs"),n=document.getElementById("summary-draft-jobs"),a=document.getElementById("summary-companies");e&&(e.textContent=gn.length.toString());let o=0,s=0;gn.forEach(e=>{const t=b(e);"active"===t&&o++,"draft"===t&&s++}),t&&(t.textContent=o.toString());n&&(n.textContent=s.toString());const i=new Set(gn.map(e=>e.companyDomain));a&&(a.textContent=i.size.toString())}(),En()}catch(t){console.error("æ±‚äººä¸€è¦§ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<div class="error-message">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}(),function(){const e=document.getElementById("job-company-filter");e&&e.addEventListener("change",En);const t=document.getElementById("job-status-filter");t&&t.addEventListener("change",En);const n=document.getElementById("job-search-input");n&&n.addEventListener("input",function(e,t){let n;return function(...a){const o=()=>{clearTimeout(n),e(...a)};clearTimeout(n),n=setTimeout(o,t)}}(En,300));const a=document.getElementById("job-sort-select");a&&a.addEventListener("change",En)}()}function En(){var e,t,n,a,o;const s=(null==(e=document.getElementById("job-company-filter"))?void 0:e.value)||"",i=(null==(t=document.getElementById("job-status-filter"))?void 0:t.value)||"",c=(null==(a=null==(n=document.getElementById("job-search-input"))?void 0:n.value)?void 0:a.toLowerCase())||"",l=(null==(o=document.getElementById("job-sort-select"))?void 0:o.value)||"id";bn=gn.filter(e=>{if(s&&e.companyDomain!==s)return!1;if(i){if(b(e)!==i)return!1}if(c){if(![e.title||"",e.company||"",e.location||"",e.area||""].join(" ").toLowerCase().includes(c))return!1}return!0}),function(e,t){e.sort((e,n)=>{switch(t){case"id":const t=parseInt(e.id,10),a=parseInt(n.id,10);return isNaN(t)||isNaN(a)?(e.id||"").localeCompare(n.id||""):t-a;case"company":return(e.company||"").localeCompare(n.company||"");case"title":return(e.title||"").localeCompare(n.title||"");case"updated":return new Date(n.updatedAt||0)-new Date(e.updatedAt||0);case"applications":return(n.applicationCount||0)-(e.applicationCount||0);default:return 0}})}(bn,l),function(e){const t=document.getElementById("job-listings-container");if(!t)return;if(0===e.length)return void(t.innerHTML='<div class="no-data">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“</div>');const n={};e.forEach(e=>{const t=e.companyDomain||"unknown";n[t]||(n[t]={company:e.company||"ä¼šç¤¾åæœªè¨­å®š",companyDomain:t,jobs:[]}),n[t].jobs.push(e)});let a="";Object.values(n).forEach(e=>{a+=function(e){const t=vn.find(t=>t.companyDomain===e.companyDomain),n=(null==t?void 0:t.logoUrl)||(null==t?void 0:t.imageUrl)||"";return`\n    <div class="job-listings-company-group">\n      <div class="job-listings-company-header">\n        <div class="company-logo-small">\n          ${n?`<img src="${Le(n)}" alt="${Le(e.company)}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><span class="logo-fallback" style="display:none">ğŸ¢</span>`:'<span class="logo-fallback">ğŸ¢</span>'}\n        </div>\n        <div class="company-info">\n          <h4 class="company-name">${Le(e.company)}</h4>\n          <span class="company-job-count">${e.jobs.length}ä»¶ã®æ±‚äºº</span>\n        </div>\n        <button class="btn-view-company" data-domain="${Le(e.companyDomain)}" title="ä¼šç¤¾è©³ç´°ã‚’è¦‹ã‚‹">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>\n        </button>\n      </div>\n      <div class="job-listings-cards">\n        ${e.jobs.map(e=>function(e){const t=b(e),n={active:"æ²è¼‰ä¸­",draft:"ä¸‹æ›¸ã",expired:"æœŸé™åˆ‡ã‚Œ"}[t],a={active:"status-active",draft:"status-draft",expired:"status-expired"}[t],o=e.jobLogo||e.imageUrl||"";return`\n    <div class="job-listing-card" data-job-id="${Le(e.id||"")}" data-company-domain="${Le(e.companyDomain||"")}">\n      <div class="job-card-image">\n        ${o?`<img src="${Le(o)}" alt="${Le(e.title||"")}" onerror="this.style.display='none';this.parentElement.classList.add('no-image')">`:'<span class="no-image-icon">ğŸ“„</span>'}\n      </div>\n      <div class="job-card-content">\n        <div class="job-card-header">\n          <h5 class="job-card-title">${Le(e.title||"æ±‚äººã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š")}</h5>\n          <span class="job-card-status ${a}">${n}</span>\n        </div>\n        <div class="job-card-meta">\n          ${e.location?`<span class="job-meta-item"><span class="meta-icon">ğŸ“</span>${Le(e.location)}</span>`:""}\n          ${e.monthlySalary?`<span class="job-meta-item"><span class="meta-icon">ğŸ’°</span>${Le(e.monthlySalary)}</span>`:""}\n        </div>\n        <div class="job-card-stats">\n          <span class="stat-item" title="å¿œå‹Ÿæ•°">ğŸ“ ${e.applicationCount||0}</span>\n          <span class="stat-item" title="é–²è¦§æ•°">ğŸ‘ ${e.viewCount||0}</span>\n        </div>\n      </div>\n      <div class="job-card-actions">\n        <button class="btn-job-action btn-edit-job" title="ç·¨é›†">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n        </button>\n        <button class="btn-job-action btn-preview-job" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>\n        </button>\n      </div>\n    </div>\n  `}(e)).join("")}\n      </div>\n    </div>\n  `}(e)}),t.innerHTML=a,document.querySelectorAll(".job-listing-card").forEach(e=>{e.addEventListener("click",t=>{if(t.target.closest(".btn-job-action")||t.target.closest(".btn-view-company"))return;const n=e.dataset.jobId,a=e.dataset.companyDomain;n&&a&&wn(a,n)})}),document.querySelectorAll(".btn-edit-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;a&&o&&wn(o,a)})}),document.querySelectorAll(".btn-preview-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId,o=null==n?void 0:n.dataset.companyDomain;if(a&&o){const e=`lp.html?j=${o}_${a}`;window.open(e,"_blank")}})}),document.querySelectorAll(".btn-view-company").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.domain;n&&function(e){var t;const n=vn.find(t=>t.companyDomain===e);if(null==(t=window.AdminDashboard)?void 0:t.navigateToJobManage)window.AdminDashboard.navigateToJobManage(e,(null==n?void 0:n.company)||e,"job-listings");else{const t=document.querySelector('[data-section="company-manage"]');t&&t.click(),setTimeout(()=>{const t=new CustomEvent("openCompanyJobs",{detail:{companyDomain:e}});document.dispatchEvent(t)},100)}}(n)})})}(bn);const r=document.getElementById("job-listings-total");r&&(r.textContent=bn.length.toString())}function wn(e,t){var n;const a=vn.find(t=>t.companyDomain===e);(null==(n=window.AdminDashboard)?void 0:n.navigateToJobManage)?window.AdminDashboard.navigateToJobManage(e,(null==a?void 0:a.company)||e,"job-listings",t):window.location.href=`job-manage.html?domain=${encodeURIComponent(e)}&job=${encodeURIComponent(t)}`}let jn={domain:null,name:null},In=null,Bn=null,Ln=null,kn=!1,$n=null;function Sn(e,t){jn.domain=e,jn.name=t}function xn(){kn=!1}let Dn=!1,Cn=null,Tn=!1,An=!1,Mn=null,qn=!1,Hn={},Pn=null,Un=null,Rn=null,_n=[];async function Nn(e,t,o=null){if(An)console.log("[JobManageEmbedded] åˆæœŸåŒ–ä¸­ã®ãŸã‚ç„¡è¦–:",e);else{An=!0;try{Cn!==e&&(Dn=!1,Cn=e,f(!1),h()),E(e,t,null);const s=document.getElementById("jm-company-name"),c=document.getElementById("jm-company-domain");s&&(s.textContent=t),c&&(c.textContent=e),Tn||(!function(){var e,t,o,s,c,l,r,d,m,u,p,y,g,v,b,f,E,j,L,k,$,S,x,D,C,T,A,H;document.querySelectorAll("#jm-tabs .jm-tab").forEach(e=>{e.addEventListener("click",()=>{Yn(e.dataset.tab)})}),null==(e=document.getElementById("jm-btn-add-job"))||e.addEventListener("click",Fn),null==(t=document.getElementById("jm-btn-refresh"))||t.addEventListener("click",Jn),null==(o=document.getElementById("jm-job-edit-back-btn"))||o.addEventListener("click",Wn),null==(s=document.getElementById("jm-job-edit-cancel-btn"))||s.addEventListener("click",Wn),null==(c=document.getElementById("jm-job-edit-delete-btn"))||c.addEventListener("click",Gn),null==(l=document.getElementById("jm-job-edit-form"))||l.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,t;const o=e=>{var t,n;return(null==(n=null==(t=document.getElementById(`jm-edit-job-${e}`))?void 0:t.value)?void 0:n.trim())||""},s=o("salary-type"),c=o("salary"),l=o("salary-other"),r=o("daily-salary"),d=o("monthly-salary"),m=o("yearly-salary"),u=document.querySelectorAll("#jm-working-hours-list .jm-working-hours-input"),p=Array.from(u).map(e=>e.value.trim()).filter(e=>e).join(" | "),y=document.querySelectorAll('#jm-features-checkbox-grid input[type="checkbox"]:checked'),g=Array.from(y).map(e=>e.value).join(","),v=document.querySelectorAll('#jm-displayed-features-container input[type="checkbox"]:checked'),b=Array.from(v).map(e=>e.value).join(","),f=o("logo"),h=(null==(e=document.getElementById("jm-edit-job-show-video"))?void 0:e.checked)?"true":"false",E=o("video-url"),w={id:qn?"":(null==Mn?void 0:Mn.id)||"",memo:o("memo"),title:o("title"),employmentType:o("employment-type"),location:o("location"),access:o("access"),salaryType:s,monthlySalary:c,salaryOther:l,dailySalaryExample:r,monthlySalaryExample:d,yearlySalaryExample:m,totalBonus:o("bonus"),order:o("order"),jobType:o("type"),features:g,displayedFeatures:b,badges:"",jobDescription:o("description"),requirements:o("requirements"),benefits:o("benefits"),workingHours:p,holidays:o("holidays"),publishStartDate:o("start-date"),publishEndDate:o("end-date"),visible:(null==(t=document.getElementById("jm-edit-job-visible"))?void 0:t.checked)?"true":"false",jobLogo:f,showVideoButton:h,videoUrl:E};if(!w.title||!w.location)return void $e("å‹Ÿé›†ã‚¿ã‚¤ãƒˆãƒ«ã¨å‹¤å‹™åœ°ã¯å¿…é ˆã§ã™","error");const j=document.getElementById("jm-job-edit-save-btn");try{let e;if(j&&(j.disabled=!0,j.textContent="ä¿å­˜ä¸­..."),n){a();const t=qn?null:(null==Mn?void 0:Mn._docId)||(null==Mn?void 0:Mn.id);e=await i(I,w,t),console.log("[JobManageEmbedded] Firestoreä¿å­˜çµæœ:",e)}if(!e.success)throw new Error(e.error||"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");if("true"===h&&E){const t=qn?e.jobId:(null==Mn?void 0:Mn.id)||"";t&&await async function(e,t,n,a){const o=B.gasApiUrl;try{const s={version:2,sections:[{id:"hero-cta-1",type:"heroCta",data:{title:`${t.title||""}ã§ä¸€ç·’ã«åƒãã¾ã›ã‚“ã‹ï¼Ÿ`,subtitle:"",backgroundImage:"",showVideoButton:"true"===n,videoUrl:a||""}},{id:"job-info-1",type:"jobInfo",data:{}},{id:"cta-1",type:"cta",data:{title:"ä»Šã™ãå¿œå‹Ÿã™ã‚‹"}}]},i={jobId:e,companyDomain:I,company:q,jobTitle:t.title||"",showVideoButton:n,videoUrl:a,lpContent:JSON.stringify(s),syncVideoOnly:!0},c=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveLPSettings",settings:i})))),l=`${o}?action=post&data=${encodeURIComponent(c)}`,r=await fetch(l,{method:"GET",redirect:"follow"}),d=await r.text();let m;try{m=JSON.parse(d)}catch{return void console.warn("[JobManageEmbedded] LPåŒæœŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼")}m.success?console.log("[JobManageEmbedded] å‹•ç”»è¨­å®šã‚’LPã«åŒæœŸã—ã¾ã—ãŸ"):console.warn("[JobManageEmbedded] LPåŒæœŸã‚¨ãƒ©ãƒ¼:",m.error)}catch(s){console.warn("[JobManageEmbedded] LPåŒæœŸä¸­ã«ã‚¨ãƒ©ãƒ¼:",s.message)}}(t,w,h,E)}$e(qn?"æ±‚äººã‚’ä½œæˆã—ã¾ã—ãŸ":"æ±‚äººæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ","success"),Wn(),await Jn()}catch(L){console.error("[JobManageEmbedded] æ±‚äººä¿å­˜ã‚¨ãƒ©ãƒ¼:",L),$e("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+L.message,"error")}finally{j&&(j.disabled=!1,j.textContent="ä¿å­˜")}}()});const P=document.getElementById("jm-job-search"),U=document.getElementById("jm-job-filter-status"),R=document.getElementById("jm-job-filter-area"),_=document.getElementById("jm-btn-clear-filters");if(P){let e;P.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{w.search=P.value.trim(),zn()},300)})}U&&U.addEventListener("change",()=>{w.status=U.value,zn()});R&&R.addEventListener("change",()=>{w.area=R.value,zn()});_&&_.addEventListener("click",()=>{h(),P&&(P.value=""),U&&(U.value=""),R&&(R.value=""),zn()});null==(r=document.getElementById("jm-btn-download-indeed"))||r.addEventListener("click",()=>oa("indeed")),null==(d=document.getElementById("jm-btn-download-google"))||d.addEventListener("click",()=>oa("google")),null==(m=document.getElementById("jm-btn-download-jobbox"))||m.addEventListener("click",()=>oa("jobbox")),null==(u=document.getElementById("jm-btn-download-csv"))||u.addEventListener("click",()=>oa("csv")),null==(p=document.getElementById("jm-edit-job-salary-type"))||p.addEventListener("change",ta),null==(y=document.getElementById("jm-btn-add-working-hours"))||y.addEventListener("click",aa),na(),M({featuresGridId:Vn.featuresGridId,displayedContainerId:Vn.containerId,checkboxName:Vn.checkboxName,onWarning:Vn.onWarning}),null==(g=document.getElementById("jm-edit-job-logo"))||g.addEventListener("input",Xn),null==(v=document.getElementById("jm-btn-clear-logo"))||v.addEventListener("click",Kn),null==(b=document.getElementById("jm-btn-upload-logo"))||b.addEventListener("click",Qn),null==(f=document.getElementById("jm-edit-job-show-video"))||f.addEventListener("change",ea),function(){const e=document.getElementById("jm-analytics-start-date"),t=document.getElementById("jm-analytics-end-date"),n=document.querySelectorAll("#jm-analytics .date-preset-btn");if(!e||!t)return;const a=new Date,o=new Date(a);o.setDate(a.getDate()-29),t.value=Zn(a),e.value=Zn(o),t.max=Zn(a),e.max=Zn(a),n.forEach(a=>{a.addEventListener("click",()=>{const o=a.dataset.preset,{start:s,end:i}=function(e){const t=new Date;let n,a;switch(e){case"7days":a=new Date(t),n=new Date(t),n.setDate(t.getDate()-6);break;case"30days":default:a=new Date(t),n=new Date(t),n.setDate(t.getDate()-29);break;case"90days":a=new Date(t),n=new Date(t),n.setDate(t.getDate()-89)}return{start:n,end:a}}(o);e.value=Zn(s),t.value=Zn(i),n.forEach(e=>e.classList.remove("active")),a.classList.add("active")})}),e.addEventListener("change",()=>{n.forEach(e=>e.classList.remove("active"))}),t.addEventListener("change",()=>{n.forEach(e=>e.classList.remove("active"))})}(),null==(E=document.getElementById("jm-btn-calendar-settings"))||E.addEventListener("click",sa),null==(j=document.getElementById("jm-calendar-settings-close"))||j.addEventListener("click",ia),null==(L=document.getElementById("jm-calendar-settings-close-btn"))||L.addEventListener("click",ia),null==(k=document.getElementById("jm-calendar-settings-modal"))||k.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&ia()}),null==($=document.getElementById("jm-btn-schedule-interview"))||$.addEventListener("click",ra),null==(S=document.getElementById("jm-interview-modal-close"))||S.addEventListener("click",da),null==(x=document.getElementById("jm-interview-modal-cancel"))||x.addEventListener("click",da),null==(D=document.getElementById("jm-interview-modal-save"))||D.addEventListener("click",ya),null==(C=document.getElementById("jm-interview-modal"))||C.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&da()}),null==(T=document.getElementById("jm-interview-staff"))||T.addEventListener("change",ma),null==(A=document.getElementById("jm-btn-prev-week"))||A.addEventListener("click",()=>pa(-1)),null==(H=document.getElementById("jm-btn-next-week"))||H.addEventListener("click",()=>pa(1)),function(){const e=document.getElementById("jm-btn-sort-mode"),t=document.getElementById("jm-btn-save-sort"),n=document.getElementById("jm-btn-cancel-sort");e&&e.addEventListener("click",ha);t&&t.addEventListener("click",wa);n&&n.addEventListener("click",()=>Ea(!0))}()}(),Tn=!0);const l=Ln;Ln=null,o?(!function(){Mn=null,qn=!1,j("jm-edit-job");const e=document.getElementById("jm-job-edit-title"),t=document.getElementById("jm-job-edit-badge");e&&(e.textContent="èª­ã¿è¾¼ã¿ä¸­...");t&&(t.textContent="ç·¨é›†",t.classList.add("edit"));const n=document.getElementById("jm-job-edit-delete-btn");n&&(n.style.display="none");const a=document.getElementById("jm-job-edit-save-btn");a&&(a.disabled=!0);Yn("job-edit")}(),await Jn(),On(o)):l?(Yn(l),["jobs","analytics","reports"].includes(l)&&await Jn()):(Yn("jobs"),await Jn()),Dn=!0}finally{An=!1}}}async function Jn(){const e=document.getElementById("jm-jobs-list");e&&(e.innerHTML='<div class="job-cards-loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>');$n&&$n.abort(),$n=new AbortController;try{let e;if(n&&(a(),e=await o(I)),!e.success)throw new Error(e.error||"æ±‚äººãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");L(e.jobs||[]),function(e){const t=document.getElementById("jm-job-filter-area");if(!t)return;const n=[...new Set(e.map(e=>e.area).filter(Boolean))];t.innerHTML='<option value="">å…¨ã‚¨ãƒªã‚¢</option>',n.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})}(k),zn(),va(),$n=null}catch(t){if("AbortError"===t.name)return void console.log("[JobManageEmbedded] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");console.error("[JobManageEmbedded] æ±‚äººãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),e&&(e.innerHTML=`<div class="error-message">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${Le(t.message)}</div>`)}}function zn(){const e=document.getElementById("jm-jobs-list"),t=document.getElementById("jm-jobs-count");if(!e)return;let n=k.filter(e=>{var t;if(w.search&&!(null==(t=e.title)?void 0:t.toLowerCase().includes(w.search.toLowerCase())))return!1;if(w.status){const t=b(e);if("published"===w.status&&"active"!==t)return!1;if("draft"===w.status&&"draft"!==t)return!1;if("expired"===w.status&&"expired"!==t)return!1}return!w.area||e.area===w.area});n.sort((e,t)=>(parseInt(e.order)||999)-(parseInt(t.order)||999)),t&&(t.textContent=n.length.toString()),0!==n.length?(e.innerHTML=n.map(e=>function(e){const t=b(e),n=U(t),a=P(t),o=parseInt(e.order)||999,s=e.jobLogo||e.imageUrl||"";return`\n    <div class="job-listing-card" data-job-id="${Le(e.id||"")}" data-order="${o}" draggable="false">\n      <span class="job-card-drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã³æ›¿ãˆ">â˜°</span>\n      <span class="job-order-badge">${o<999?o:"-"}</span>\n      <div class="job-card-image">\n        ${s?`<img src="${Le(s)}" alt="${Le(e.title||"")}" onerror="this.style.display='none';this.parentElement.classList.add('no-image')">`:'<span class="no-image-icon">ğŸ“„</span>'}\n      </div>\n      <div class="job-card-content">\n        <div class="job-card-header">\n          <h5 class="job-card-title">${Le(e.title||"æ±‚äººã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š")}</h5>\n          <span class="job-card-status ${a}">${n}</span>\n        </div>\n        <div class="job-card-meta">\n          ${e.location||e.area?`<span class="job-meta-item"><span class="meta-icon">ğŸ“</span>${Le(e.area||e.location)}</span>`:""}\n          ${e.monthlySalary?`<span class="job-meta-item"><span class="meta-icon">ğŸ’°</span>${Le(e.monthlySalary)}</span>`:""}\n          ${e.jobType?`<span class="job-meta-item"><span class="meta-icon">ğŸ’¼</span>${Le(e.jobType)}</span>`:""}\n          ${e.employmentType?`<span class="job-meta-item"><span class="meta-icon">ğŸ‘¤</span>${Le(e.employmentType)}</span>`:""}\n        </div>\n        <div class="job-card-stats">\n          <span class="stat-item" title="å¿œå‹Ÿæ•°">ğŸ“ ${e.applicationCount||0}</span>\n          <span class="stat-item" title="é–²è¦§æ•°">ğŸ‘ ${e.viewCount||0}</span>\n        </div>\n      </div>\n      <div class="job-card-actions">\n        <button class="btn-job-action btn-edit-job" title="ç·¨é›†">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n        </button>\n        <button class="btn-job-action btn-preview-job" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>\n        </button>\n      </div>\n    </div>\n  `}(e)).join(""),document.querySelectorAll("#jm-jobs-list .btn-edit-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId;a&&On(a)})}),document.querySelectorAll("#jm-jobs-list .btn-preview-job").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.closest(".job-listing-card"),a=null==n?void 0:n.dataset.jobId;a&&window.open(`lp.html?j=${I}_${a}`,"_blank")})}),document.querySelectorAll("#jm-jobs-list .job-listing-card").forEach(e=>{e.addEventListener("click",t=>{if(t.target.closest(".btn-job-action"))return;const n=e.dataset.jobId;n&&On(n)})})):e.innerHTML='<div class="no-data">è©²å½“ã™ã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“</div>'}function Fn(){Mn=null,qn=!0,j("jm-edit-job");const e=document.getElementById("jm-edit-job-memo");e&&(e.value="");const t=document.getElementById("jm-edit-job-salary-type");t&&(t.value="");const n=document.getElementById("jm-edit-job-salary-other");n&&(n.value="");const a=document.getElementById("jm-salary-other-group");a&&(a.style.display="none");const o=document.getElementById("jm-edit-job-daily-salary");o&&(o.value="");const s=document.getElementById("jm-daily-salary-group");s&&(s.style.display="none");const i=document.getElementById("jm-edit-job-monthly-salary");i&&(i.value="");const c=document.getElementById("jm-monthly-salary-group");c&&(c.style.display="none");const l=document.getElementById("jm-edit-job-yearly-salary");l&&(l.value="");const r=document.getElementById("jm-yearly-salary-group");r&&(r.style.display="none");const d=document.getElementById("jm-working-hours-list");d&&(d.innerHTML='\n      <div class="multi-input-item">\n        <input type="text" class="jm-working-hours-input" placeholder="ä¾‹: 8:00ã€œ17:00">\n        <button type="button" class="btn-remove-item" title="å‰Šé™¤">Ã—</button>\n      </div>\n    ',na()),document.querySelectorAll('#jm-features-checkbox-grid input[type="checkbox"]').forEach(e=>{e.checked=!1});const m=document.getElementById("jm-displayed-features-container");m&&(m.innerHTML='<div class="displayed-features-empty">ä¸Šè¨˜ã‹ã‚‰ç‰¹å¾´ã‚’é¸æŠã™ã‚‹ã¨ã€ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>');const u=document.getElementById("jm-edit-job-logo");u&&(u.value="");const p=document.getElementById("jm-job-logo-preview");p&&(p.style.display="none");const y=document.getElementById("jm-job-logo-preview-img");y&&(y.src="");const g=document.getElementById("jm-edit-job-show-video");g&&(g.checked=!1);const v=document.getElementById("jm-edit-job-video-url");v&&(v.value="");const b=document.getElementById("jm-video-url-group");b&&(b.style.display="none");const f=document.getElementById("jm-job-edit-title"),h=document.getElementById("jm-job-edit-badge");f&&(f.textContent="æ–°è¦æ±‚äººä½œæˆ"),h&&(h.textContent="æ–°è¦",h.classList.remove("edit"));const E=document.getElementById("jm-job-edit-delete-btn");E&&(E.style.display="none");const w=document.getElementById("jm-job-edit-save-btn");w&&(w.disabled=!1),Yn("job-edit")}function On(e){var t;const n=null==(t=k)?void 0:t.find(t=>t.id===e||t.id===String(e)||String(t.id)===String(e));if(!n)return void $e("æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","error");Mn=n,qn=!1,$(n,"jm-edit-job");const a=document.getElementById("jm-edit-job-memo");a&&(a.value=n.memo||""),function(e){const t=document.getElementById("jm-edit-job-salary-type"),n=document.getElementById("jm-edit-job-salary-other"),a=document.getElementById("jm-salary-other-group");t&&(e.salaryType?t.value=e.salaryType:e.monthlySalary?t.value="æœˆçµ¦":t.value="");n&&a&&("ãã®ä»–"===e.salaryType||e.salaryOther?(n.value=e.salaryOther||"",a.style.display="block"):(n.value="",a.style.display="none"));const o=document.getElementById("jm-edit-job-daily-salary"),s=document.getElementById("jm-daily-salary-group");o&&(o.value=e.dailySalaryExample||"");s&&(s.style.display="æ—¥çµ¦"===e.salaryType?"block":"none");const i=document.getElementById("jm-edit-job-monthly-salary"),c=document.getElementById("jm-monthly-salary-group");i&&(i.value=e.monthlySalaryExample||"");c&&(c.style.display="æœˆçµ¦"===e.salaryType?"block":"none");const l=document.getElementById("jm-edit-job-yearly-salary"),r=document.getElementById("jm-yearly-salary-group");l&&(l.value=e.yearlySalaryExample||"");r&&(r.style.display="æœˆçµ¦"===e.salaryType?"block":"none")}(n),function(e){const t=document.getElementById("jm-working-hours-list");if(!t)return;const n=e.workingHours||"",a=("string"==typeof n?n:String(n)).split(/[|\n]/).map(e=>e.trim()).filter(e=>e);0===a.length&&a.push("");t.innerHTML=a.map(e=>`\n    <div class="multi-input-item">\n      <input type="text" class="jm-working-hours-input" placeholder="ä¾‹: 8:00ã€œ17:00" value="${Le(e)}">\n      <button type="button" class="btn-remove-item" title="å‰Šé™¤">Ã—</button>\n    </div>\n  `).join(""),na()}(n),function(e){const t=e.features||"",n=t.split(",").map(e=>e.trim()).filter(e=>e);document.querySelectorAll('#jm-features-checkbox-grid input[type="checkbox"]').forEach(e=>{e.checked=!1}),n.forEach(e=>{const t=document.querySelector(`#jm-features-checkbox-grid input[value="${e}"]`);t&&(t.checked=!0)});const a=e.displayedFeatures||"",o=a.split(",").map(e=>e.trim()).filter(e=>e);!function(e,t=[]){H({containerId:Vn.containerId,checkboxName:Vn.checkboxName,checkedFeatures:e,selectedDisplayed:t,onWarning:Vn.onWarning})}(n,o)}(n),function(e){const t=document.getElementById("jm-edit-job-logo"),n=document.getElementById("jm-job-logo-preview"),a=document.getElementById("jm-job-logo-preview-img"),o=e.jobLogo||e.imageUrl||"";t&&(t.value=o);n&&a&&(o?(a.src=o,n.style.display="block"):(a.src="",n.style.display="none"))}(n),function(e){const t=document.getElementById("jm-edit-job-show-video"),n=document.getElementById("jm-edit-job-video-url"),a=document.getElementById("jm-video-url-group");t&&(t.checked="true"===String(e.showVideoButton).toLowerCase());n&&(n.value=e.videoUrl||"");a&&(a.style.display=(null==t?void 0:t.checked)?"block":"none")}(n);const o=document.getElementById("jm-job-edit-title"),s=document.getElementById("jm-job-edit-badge");o&&(o.textContent=n.title||"æ±‚äººç·¨é›†"),s&&(s.textContent="ç·¨é›†",s.classList.add("edit"));const i=document.getElementById("jm-job-edit-delete-btn");i&&(i.style.display="");const c=document.getElementById("jm-job-edit-save-btn");c&&(c.disabled=!1),Yn("job-edit")}const Vn={containerId:"jm-displayed-features-container",featuresGridId:"jm-features-checkbox-grid",checkboxName:"jm-displayed-features",onWarning:e=>$e(e,"warning")};function Wn(){Mn=null,qn=!1,Yn("jobs")}async function Gn(){if(!Mn)return void $e("å‰Šé™¤å¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“","error");if(!(await Ze({title:"æ±‚äººã®å‰Šé™¤",message:"ã“ã®æ±‚äººã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",confirmText:"å‰Šé™¤ã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",danger:!0})))return;const e=document.getElementById("jm-job-edit-delete-btn");try{let t;if(e&&(e.disabled=!0,e.textContent="å‰Šé™¤ä¸­..."),n){a();const e=Mn._docId||Mn.id;t=await s(I,e)}if(!t.success)throw new Error(t.error||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");$e("æ±‚äººã‚’å‰Šé™¤ã—ã¾ã—ãŸ","success"),Wn(),await Jn()}catch(t){console.error("[JobManageEmbedded] æ±‚äººå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",t),$e("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+t.message,"error")}finally{e&&(e.disabled=!1,e.textContent="å‰Šé™¤")}}function Yn(e){document.querySelectorAll("#jm-tabs .jm-tab").forEach(t=>{t.classList.toggle("active","job-edit"!==e&&t.dataset.tab===e)});const t=document.getElementById("jm-tabs");t&&(t.style.display="job-edit"===e?"none":""),document.querySelectorAll(".jm-subsection").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`jm-${e}`);n&&n.classList.add("active"),"applicants"===e?Xe(I,q,"jm-"):"recruit"===e&&S(I)}function Zn(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function Xn(){const e=document.getElementById("jm-edit-job-logo"),t=document.getElementById("jm-job-logo-preview"),n=document.getElementById("jm-job-logo-preview-img");if(!e||!t||!n)return;const a=e.value.trim();a?(n.src=a,n.onerror=()=>{t.style.display="none"},n.onload=()=>{t.style.display="block"}):(t.style.display="none",n.src="")}function Kn(){const e=document.getElementById("jm-edit-job-logo"),t=document.getElementById("jm-job-logo-preview"),n=document.getElementById("jm-job-logo-preview-img");e&&(e.value=""),t&&(t.style.display="none"),n&&(n.src="")}async function Qn(){const e=document.getElementById("jm-edit-job-logo"),t=document.getElementById("jm-job-logo-preview"),n=document.getElementById("jm-job-logo-preview-img"),a=document.getElementById("jm-logo-upload-progress"),o=document.getElementById("jm-btn-upload-logo");try{const s=await ct({accept:"image/*"});a&&(a.style.display="flex"),o&&(o.disabled=!0);const i=await lt(s,I);e&&(e.value=i),n&&(n.src=i,n.onload=()=>{t&&(t.style.display="block")}),$e("ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(s){"ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"!==s.message&&(console.error("[JobManageEmbedded] ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",s),$e("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+s.message,"error"))}finally{a&&(a.style.display="none"),o&&(o.disabled=!1)}}function ea(){const e=document.getElementById("jm-edit-job-show-video"),t=document.getElementById("jm-video-url-group");e&&t&&(e.checked?t.style.display="block":t.style.display="none")}function ta(){const e=document.getElementById("jm-edit-job-salary-type"),t=document.getElementById("jm-salary-other-group"),n=document.getElementById("jm-daily-salary-group"),a=document.getElementById("jm-monthly-salary-group"),o=document.getElementById("jm-yearly-salary-group");if(!e)return;const s=e.value;t&&(t.style.display="ãã®ä»–"===s?"block":"none"),n&&(n.style.display="æ—¥çµ¦"===s?"block":"none"),a&&(a.style.display="æœˆçµ¦"===s?"block":"none"),o&&(o.style.display="æœˆçµ¦"===s?"block":"none")}function na(){const e=document.getElementById("jm-working-hours-list");e&&e.querySelectorAll(".btn-remove-item").forEach(t=>{t.addEventListener("click",()=>{e.querySelectorAll(".multi-input-item").length>1&&t.closest(".multi-input-item").remove()})})}function aa(){const e=document.getElementById("jm-working-hours-list");if(!e)return;const t=document.createElement("div");t.className="multi-input-item",t.innerHTML='\n    <input type="text" class="jm-working-hours-input" placeholder="ä¾‹: 8:00ã€œ17:00">\n    <button type="button" class="btn-remove-item" title="å‰Šé™¤">Ã—</button>\n  ',e.appendChild(t);t.querySelector(".btn-remove-item").addEventListener("click",()=>{e.querySelectorAll(".multi-input-item").length>1&&t.remove()}),t.querySelector("input").focus()}async function oa(e){const t=document.getElementById("jm-feed-status");t&&(t.style.display="flex");try{const t=k.filter(e=>!0===e.visible||"true"===e.visible||"TRUE"===e.visible);let n,a,o;switch(e){case"indeed":n=T(t),a=`${I}_indeed_feed.xml`,o="application/xml";break;case"google":n=C(t),a=`${I}_google_jobs.json`,o="application/ld+json";break;case"jobbox":n=D(t),a=`${I}_jobbox_feed.xml`,o="application/xml";break;case"csv":n=x(t),a=`${I}_jobs.csv`,o="text/csv";break;default:throw new Error("Unknown feed type")}A(n,a,o),$e(`${a} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`)}catch(n){console.error("[JobManageEmbedded] ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",n),$e("ãƒ•ã‚£ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ","error")}finally{t&&(t.style.display="none")}}async function sa(){const e=document.getElementById("jm-calendar-settings-modal");e&&(e.style.display="flex",await async function(){Hn={};try{const t=firebase.firestore(),n=await t.collection("company_users").where("companyDomain","==",I).where("isActive","==",!0).get();_n=[],n.forEach(e=>{_n.push({id:e.id,...e.data()})});for(const a of _n)try{const e=await et(I,a.id);e.integration&&(Hn[a.id]=e.integration)}catch(e){console.log(`No calendar integration for user ${a.id}`)}ca()}catch(t){console.error("Failed to load calendar integrations:",t),$e("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}}())}function ia(){const e=document.getElementById("jm-calendar-settings-modal");e&&(e.style.display="none")}function ca(){const e=document.getElementById("jm-calendar-integrations-list");e&&(0!==_n.length?(e.innerHTML=_n.map(e=>{const t=Hn[e.id],n=null==t?void 0:t.isActive;return`\n      <div class="calendar-integration-item" data-user-id="${Le(e.id)}">\n        <div class="calendar-integration-info">\n          <div class="calendar-integration-icon">ğŸ‘¤</div>\n          <div class="calendar-integration-details">\n            <strong>${Le(e.name||e.username)}</strong>\n            ${n?`<small>${Le(t.email||"")}</small>`:""}\n          </div>\n        </div>\n        <div class="calendar-integration-actions">\n          ${n?`<span class="calendar-status connected">é€£æºä¸­</span>\n               <button class="btn-disconnect-calendar" data-user-id="${Le(e.id)}">è§£é™¤</button>`:`<button class="btn-connect-calendar" data-user-id="${Le(e.id)}" data-user-name="${Le(e.name||e.username)}">\n                 Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨é€£æº\n               </button>`}\n        </div>\n      </div>\n    `}).join(""),e.querySelectorAll(".btn-connect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e,t){try{const n=await ot(I,e,t);window.open(n.authUrl,"calendar-auth","width=600,height=700");const a=setInterval(async()=>{var t;try{const n=await et(I,e);(null==(t=n.integration)?void 0:t.isActive)&&(clearInterval(a),Hn[e]=n.integration,ca(),$e("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºãŒå®Œäº†ã—ã¾ã—ãŸ"))}catch(n){}},2e3);setTimeout(()=>clearInterval(a),6e4)}catch(n){console.error("Failed to initiate calendar auth:",n),$e("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}}(e.dataset.userId,e.dataset.userName)})}),e.querySelectorAll(".btn-disconnect-calendar").forEach(e=>{e.addEventListener("click",()=>{!async function(e){if(!(await Ze({title:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã®è§£é™¤",message:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ",confirmText:"è§£é™¤ã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",danger:!0})))return;try{await st(I,e),delete Hn[e],ca(),$e("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºã‚’è§£é™¤ã—ã¾ã—ãŸ")}catch(t){console.error("Failed to revoke calendar auth:",t),$e("é€£æºè§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}}(e.dataset.userId)})})):e.innerHTML='<p class="no-data">æ‹…å½“è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>')}function la(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname}async function ra(){const e=document.getElementById("jm-interview-modal");if(!e)return;if(Rn=it(),!Rn)return void $e("å¿œå‹Ÿè€…ã‚’é¸æŠã—ã¦ãã ã•ã„","error");if(console.log("[showJmInterviewModal] jmCurrentApplicant:",Rn),la())_n=[{id:"local-user-1",name:"ãƒ†ã‚¹ãƒˆæ‹…å½“è€…1",username:"test1"},{id:"local-user-2",name:"ãƒ†ã‚¹ãƒˆæ‹…å½“è€…2",username:"test2"}],Hn={};else if(0===_n.length)try{const e=firebase.firestore(),t=await e.collection("company_users").where("companyDomain","==",I).where("isActive","==",!0).get();_n=[],t.forEach(e=>{_n.push({id:e.id,...e.data()})})}catch(n){console.error("Failed to load assignees:",n)}const t=document.getElementById("jm-interview-staff");t&&(t.innerHTML='<option value="">æ‹…å½“è€…ã‚’é¸æŠ...</option>'+_n.map(e=>{const t=Hn[e.id],n=(null==t?void 0:t.isActive)?" (ğŸ“…é€£æºæ¸ˆ)":"";return`<option value="${Le(e.id)}" data-has-calendar="${(null==t?void 0:t.isActive)?"true":"false"}">${Le(e.name||e.username)}${n}</option>`}).join("")),Pn=Ke(new Date),Un=null,document.getElementById("jm-availability-section").style.display="none",document.getElementById("jm-selected-slot-section").style.display="none",document.getElementById("jm-manual-datetime-section").style.display="block",document.getElementById("jm-calendar-status-hint").textContent=la()?"ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ: æ‰‹å‹•å…¥åŠ›ã®ã¿åˆ©ç”¨å¯èƒ½":"",document.getElementById("jm-interview-datetime").value="",e.style.display="flex"}function da(){const e=document.getElementById("jm-interview-modal");e&&(e.style.display="none")}function ma(){var e;const t=document.getElementById("jm-interview-staff"),n=t.options[t.selectedIndex],a="true"===(null==(e=null==n?void 0:n.dataset)?void 0:e.hasCalendar),o=document.getElementById("jm-availability-section"),s=document.getElementById("jm-manual-datetime-section"),i=document.getElementById("jm-selected-slot-section"),c=document.getElementById("jm-calendar-status-hint");Un=null,i.style.display="none",a?(c.textContent="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æºæ¸ˆã¿ - ç©ºãæ™‚é–“ã‹ã‚‰é¸æŠã§ãã¾ã™",c.className="form-hint hint-success",o.style.display="block",s.style.display="none",ua()):(c.textContent=t.value?"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœªé€£æº - æ—¥æ™‚ã‚’æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„":"",c.className="form-hint",o.style.display="none",s.style.display="block")}async function ua(){const e=document.getElementById("jm-interview-staff").value;if(!e)return;const t=document.getElementById("jm-availability-grid");t.innerHTML='<div class="loading-message">ç©ºãæ™‚é–“ã‚’å–å¾—ä¸­...</div>';try{const t=new Date(Pn);t.setDate(t.getDate()+6);const n=nt(Pn),a=nt(t),o=await at(I,e,n,a);!function(){const e=new Date(Pn);e.setDate(e.getDate()+6);const t=document.getElementById("jm-week-label");t&&(t.textContent=`${nt(Pn)} ã€œ ${nt(e)}`)}(),function(e){const t=document.getElementById("jm-availability-grid");if(!t)return;if(!e||0===e.length)return void(t.innerHTML='<p class="no-data">ã“ã®é€±ã«ç©ºãæ™‚é–“ã¯ã‚ã‚Šã¾ã›ã‚“</p>');const n={};for(const s of e){const e=nt(new Date(s.start));n[e]||(n[e]=[]),n[e].push(s)}let a='<div class="availability-week">';for(let s=0;s<7;s++){const e=new Date(Pn);e.setDate(e.getDate()+s);const t=nt(e),o=tt(e),i=n[t]||[];a+=`\n      <div class="availability-day">\n        <div class="day-header">${e.getMonth()+1}/${e.getDate()} (${o})</div>\n        <div class="day-slots">\n          ${0===i.length?'<span class="no-slots">-</span>':i.map((e,t)=>{console.log(`[renderSlot] Slot ${t}:`,e);const n=new Date(e.start),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`,o=`<button type="button" class="slot-btn" data-start="${e.start}" data-end="${e.end}">${a}</button>`;return 0===t&&console.log("[renderSlot] First button HTML:",o),o}).join("")}\n        </div>\n      </div>\n    `}a+="</div>",t.innerHTML=a;const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t),o.addEventListener("click",e=>{const t=e.target.closest(".slot-btn");if(!t)return;e.preventDefault(),e.stopPropagation();const n=t.dataset.start||t.dataset.slot,a=t.dataset.end;console.log("[slotClick] startValue:",n,"endValue:",a),o.querySelectorAll(".slot-btn").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),Un={start:n,end:a},console.log("[slotClick] jmSelectedSlot set to:",Un),function(){const e=document.getElementById("jm-selected-slot-section"),t=document.getElementById("jm-selected-slot");if(console.log("[showJmSelectedSlot] jmSelectedSlot:",Un),Un&&e&&t){console.log("[showJmSelectedSlot] start value:",Un.start,"type:",typeof Un.start);const n=new Date(Un.start);if(console.log("[showJmSelectedSlot] parsed slotDate:",n,"isValid:",!isNaN(n.getTime())),isNaN(n.getTime()))t.textContent=`é¸æŠ: ${Un.start}`;else{const e=tt(n),a=`${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`;t.textContent=`${n.getFullYear()}/${n.getMonth()+1}/${n.getDate()} (${e}) ${a}ã€œ`}e.style.display="block"}}()}),console.log("[renderAvailability] Grid setup complete, slots:",o.querySelectorAll(".slot-btn").length)}(o.availableSlots||[])}catch(n){console.error("Failed to load availability:",n),t.innerHTML='<p class="error-message">ç©ºãæ™‚é–“ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>'}}function pa(e){Pn.setDate(Pn.getDate()+7*e),Un=null,document.getElementById("jm-selected-slot-section").style.display="none",ua()}async function ya(){var e,t,n,a;const o=document.getElementById("jm-interview-staff"),s=o.options[o.selectedIndex],i="true"===(null==(e=null==s?void 0:s.dataset)?void 0:e.hasCalendar);let c;if(console.log("[saveJmInterview] hasCalendar:",i),console.log("[saveJmInterview] jmSelectedSlot:",Un),i){if(!Un)return void $e("ç©ºãæ™‚é–“ã‹ã‚‰æ—¥ç¨‹ã‚’é¸æŠã—ã¦ãã ã•ã„","error");c=new Date(Un.start),console.log("[saveJmInterview] Using calendar slot:",c)}else{const e=document.getElementById("jm-interview-datetime");if(console.log("[saveJmInterview] Manual datetime value:",null==e?void 0:e.value),!(null==e?void 0:e.value))return void $e("é¢è«‡æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error");c=new Date(e.value)}if(isNaN(c.getTime()))return void $e("æ—¥æ™‚ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“","error");const l=document.getElementById("jm-interview-modal-save");l.disabled=!0,l.textContent="ä¿å­˜ä¸­...";try{const e=parseInt(document.getElementById("jm-interview-duration").value),i=document.querySelector('input[name="jm-meeting-type"]:checked');console.log("[saveJmInterview] checkedRadio:",i,"value:",null==i?void 0:i.value);const l=(null==i?void 0:i.value)||"in_person",r=document.getElementById("jm-interview-location").value;console.log("[saveJmInterview] meetingType:",l);const d=(null==(t=null==s?void 0:s.textContent)?void 0:t.replace(" (ğŸ“…é€£æºæ¸ˆ)",""))||"";if(la())return console.log("[saveJmInterview] ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ: APIã‚¹ã‚­ãƒƒãƒ—"),$e("é¢è«‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ï¼‰"),da(),void ga(c,d,l,r,null);const m=(null==Rn?void 0:Rn.applicantName)||(null==(n=null==Rn?void 0:Rn.applicant)?void 0:n.name)||"",u=(null==Rn?void 0:Rn.applicantEmail)||(null==(a=null==Rn?void 0:Rn.applicant)?void 0:a.email)||"",p=(null==Rn?void 0:Rn.jobTitle)||"",y={companyDomain:I,companyUserId:o.value,applicationId:(null==Rn?void 0:Rn.id)||"",applicantName:m,applicantEmail:u,staffName:d,jobTitle:p,scheduledAt:c.toISOString(),durationMinutes:e,meetingType:l,location:r,reminders:[{offsetMinutes:1440},{offsetMinutes:60}]};console.log("[saveJmInterview] Sending API params:",JSON.stringify(y));const g=await Qe(y);console.log("[saveJmInterview] API result:",g),console.log("[saveJmInterview] result.meetLink:",g.meetLink),$e("é¢è«‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸ"),da();ga(c,d,l,g.meetLink||r,g.meetLink)}catch(r){console.error("Failed to save interview:",r),$e("é¢è«‡ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}finally{l.disabled=!1,l.textContent="é¢è«‡ã‚’ç™»éŒ²"}}function ga(e,t,n,a,o=null){console.log("[updateJmInterviewInfo] Called with:",{scheduledAt:e,staffName:t,meetingType:n,location:a,meetLink:o});const s=document.getElementById("jm-interview-info");if(!s)return;const i=tt(e),c={in_person:"å¯¾é¢",online:"ã‚ªãƒ³ãƒ©ã‚¤ãƒ³",phone:"é›»è©±"}[n]||n;console.log("[updateJmInterviewInfo] meetingType:",n,"-> displayType:",c);const l=`${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`;let r="";o?r=`\n      <div class="interview-info-row interview-meet">\n        <span class="info-label">ğŸ“¹ Meet</span>\n        <a href="${Le(o)}" target="_blank" rel="noopener" class="meet-link">${Le(o)}</a>\n      </div>`:a&&(r=`\n      <div class="interview-info-row">\n        <span class="info-label">ğŸ“ å ´æ‰€</span>\n        <span class="info-value">${Le(a)}</span>\n      </div>`),s.innerHTML=`\n    <div class="interview-scheduled">\n      <div class="interview-datetime">\n        <span class="interview-date-text">${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()} (${i})</span>\n        <span class="interview-time-text">${l}ã€œ</span>\n      </div>\n      <div class="interview-info-grid">\n        <div class="interview-info-row">\n          <span class="info-label">ğŸ‘¤ æ‹…å½“</span>\n          <span class="info-value">${Le(t)}</span>\n        </div>\n        <div class="interview-info-row">\n          <span class="info-label">ğŸ“‹ å½¢å¼</span>\n          <span class="info-value">${c}</span>\n        </div>\n        ${r}\n      </div>\n    </div>\n  `}function va(){const e=document.getElementById("jm-btn-sort-mode");e&&(e.style.display=I?"":"none")}let ba=!1,fa=[];function ha(){ba=!0;const e=document.getElementById("jm-sort-mode-bar"),t=document.getElementById("jm-jobs-list"),n=document.getElementById("jm-btn-sort-mode");e&&(e.style.display="flex"),t&&t.classList.add("sort-mode"),n&&(n.style.display="none"),fa=Array.from(t.querySelectorAll(".job-listing-card")).map(e=>e.dataset.jobId),t.querySelectorAll(".job-listing-card").forEach(e=>{e.setAttribute("draggable","true")}),function(){const e=document.getElementById("jm-jobs-list");if(!e)return;let t=null;e.addEventListener("dragstart",e=>{const n=e.target.closest(".job-listing-card");n&&ba&&(t=n,n.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",n.dataset.jobId))}),e.addEventListener("dragend",n=>{const a=n.target.closest(".job-listing-card");a&&a.classList.remove("dragging"),e.querySelectorAll(".job-listing-card").forEach(e=>e.classList.remove("drag-over")),t=null,function(){const e=document.getElementById("jm-jobs-list");if(!e)return;e.querySelectorAll(".job-listing-card").forEach((e,t)=>{const n=e.querySelector(".job-order-badge");n&&(n.textContent=t+1)})}()}),e.addEventListener("dragover",n=>{if(n.preventDefault(),!ba||!t)return;const a=n.target.closest(".job-listing-card");if(!a||a===t)return;const o=a.getBoundingClientRect(),s=o.top+o.height/2;e.querySelectorAll(".job-listing-card").forEach(e=>e.classList.remove("drag-over")),n.clientY<s?(a.classList.add("drag-over"),e.insertBefore(t,a)):(a.classList.add("drag-over"),e.insertBefore(t,a.nextSibling))}),e.addEventListener("drop",t=>{t.preventDefault(),e.querySelectorAll(".job-listing-card").forEach(e=>e.classList.remove("drag-over"))})}()}function Ea(e=!1){ba=!1;const t=document.getElementById("jm-sort-mode-bar"),n=document.getElementById("jm-jobs-list");if(t&&(t.style.display="none"),n&&n.classList.remove("sort-mode"),va(),null==n||n.querySelectorAll(".job-listing-card").forEach(e=>{e.setAttribute("draggable","false")}),e&&fa.length>0){const e=Array.from(n.querySelectorAll(".job-listing-card"));fa.forEach(t=>{const a=e.find(e=>e.dataset.jobId===t);a&&n.appendChild(a)})}fa=[]}async function wa(){const e=document.getElementById("jm-jobs-list");if(!e)return;const t=document.getElementById("jm-btn-save-sort");t&&(t.disabled=!0,t.textContent="ä¿å­˜ä¸­...");try{const t=e.querySelectorAll(".job-listing-card"),n=[];t.forEach((e,t)=>{const a=e.dataset.jobId,o=t+1,s=k.find(e=>String(e.id)===String(a));s&&(s.order=o,n.push({jobId:a,order:o}))});for(const e of n)await ja(e.jobId,e.order);$e("ä¸¦ã³é †ã‚’ä¿å­˜ã—ã¾ã—ãŸ"),Ea()}catch(n){console.error("Failed to save sort order:",n),$e("ä¸¦ã³é †ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ","error")}finally{t&&(t.disabled=!1,t.textContent="é †åºã‚’ä¿å­˜")}}async function ja(e,t){const n=k.find(t=>String(t.id)===String(e));if(!n)return;const a={...n,order:String(t)},o=n._rowIndex;delete a._rowIndex;const s=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveJob",companyDomain:I,job:a,rowIndex:o})))),i=`${B.gasApiUrl}?action=post&data=${encodeURIComponent(s)}`,c=await fetch(i,{method:"GET",redirect:"follow"}),l=await c.text();let r;try{r=JSON.parse(l)}catch{throw new Error("Invalid response from server")}if(!r.success)throw new Error(r.error||"Failed to save job order")}const Ia={gasApiUrl:r.gasApiUrl};let Ba=!0,La=null,ka=null,$a=!1;async function Sa(e){var t,o,s,i,r,d,m,u,p;La=e,Ba=!e,ka=null,function(){const e=document.getElementById("ce-company-edit-form");e&&e.reset();["ce-description-editor","ce-job-content-editor","ce-working-hours-editor","ce-work-location-editor"].forEach(e=>{const t=document.getElementById(e);t&&(t.innerHTML="")}),["ce-description","ce-job-content","ce-working-hours","ce-work-location","ce-logo-url"].forEach(e=>{const t=document.getElementById(e);t&&(t.value="")}),Aa("");const t=document.getElementById("ce-company-domain");t&&(t.readOnly=!1,t.classList.remove("readonly"))}(),function(){const e=document.getElementById("ce-page-title"),t=document.getElementById("ce-edit-badge"),n=document.getElementById("ce-delete-btn"),a=document.getElementById("ce-company-domain");Ba?(e&&(e.textContent="æ–°è¦ä¼šç¤¾ç™»éŒ²"),t&&(t.textContent="æ–°è¦ä½œæˆ",t.classList.remove("edit")),n&&(n.style.display="none")):(e&&(e.textContent="ä¼šç¤¾æƒ…å ±ã®ç·¨é›†"),t&&(t.textContent="ç·¨é›†ä¸­",t.classList.add("edit")),n&&(n.style.display=""),a&&(a.readOnly=!0,a.classList.add("readonly")))}(),$a||(null==(t=document.getElementById("ce-company-edit-form"))||t.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,t,o,s,i,c,r;!function(){const e=document.getElementById("section-company-edit");e&&e.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=null==t?void 0:t.querySelector('input[type="hidden"]');n&&(n.value=xa(e.innerHTML))})}();const d=e=>{var t,n;return(null==(n=null==(t=document.getElementById(e))?void 0:t.value)?void 0:n.trim())||""},m=d("ce-logo-url"),u={company:d("ce-company-name"),companyDomain:d("ce-company-domain"),designPattern:(null==(e=document.getElementById("ce-design-pattern"))?void 0:e.value)||"modern",logoUrl:m,imageUrl:m,order:d("ce-order"),companyAddress:d("ce-company-address"),description:(null==(t=document.getElementById("ce-description"))?void 0:t.value)||"",jobDescription:(null==(o=document.getElementById("ce-job-content"))?void 0:o.value)||"",workingHours:(null==(s=document.getElementById("ce-working-hours"))?void 0:s.value)||"",workLocation:(null==(i=document.getElementById("ce-work-location"))?void 0:i.value)||"",showCompany:(null==(c=document.getElementById("ce-show-company"))?void 0:c.checked)?"â—‹":"",visible:(null==(r=document.getElementById("ce-show-company"))?void 0:r.checked)||!1};if(!u.company||!u.companyDomain)return void $e("ä¼šç¤¾åã¨ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å¿…é ˆã§ã™","error");if(!/^[a-z0-9-]+$/.test(u.companyDomain))return void $e("ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯åŠè§’è‹±å°æ–‡å­—ãƒ»æ•°å­—ãƒ»ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨ã§ãã¾ã™","error");const p=document.getElementById("ce-save-btn");p&&(p.disabled=!0,p.innerHTML='<span class="loading-spinner-small"></span> ä¿å­˜ä¸­...');try{if(n){a();const e=await l(u.companyDomain,u);if(!e.success)throw new Error(e.error||"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");return localStorage.setItem(`company_data_${u.companyDomain}`,JSON.stringify(u)),$e(Ba?"ä¼šç¤¾ã‚’ç™»éŒ²ã—ã¾ã—ãŸ":"ä¼šç¤¾æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),void Pa()}const e=Ia.gasApiUrl;if(e){const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveCompany",company:u})))),n=`${e}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n),o=await a.json();if(!o.success)throw new Error(o.error||"ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}localStorage.setItem(`company_data_${u.companyDomain}`,JSON.stringify(u)),$e(Ba?"ä¼šç¤¾ã‚’ç™»éŒ²ã—ã¾ã—ãŸ":"ä¼šç¤¾æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),Pa()}catch(y){console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:",y),$e("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+y.message,"error")}finally{p&&(p.disabled=!1,p.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> ä¿å­˜')}}()}),null==(o=document.getElementById("ce-back-btn"))||o.addEventListener("click",Pa),null==(s=document.getElementById("ce-cancel-btn"))||s.addEventListener("click",Pa),null==(i=document.getElementById("ce-delete-btn"))||i.addEventListener("click",Ma),null==(r=document.getElementById("ce-delete-modal-close"))||r.addEventListener("click",qa),null==(d=document.getElementById("ce-delete-cancel"))||d.addEventListener("click",qa),null==(m=document.getElementById("ce-delete-confirm"))||m.addEventListener("click",Ha),null==(u=document.getElementById("ce-delete-confirm-modal"))||u.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&qa()}),null==(p=document.getElementById("ce-company-domain"))||p.addEventListener("input",e=>{Ba&&(e.target.value=e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,""))}),function(){const e=document.getElementById("ce-logo-upload-btn"),t=document.getElementById("ce-logo-file-input"),n=document.getElementById("ce-logo-remove-btn"),a=document.getElementById("ce-logo-preview"),o=document.getElementById("ce-logo-url");e&&t&&(e.addEventListener("click",()=>{t.click()}),null==a||a.addEventListener("click",()=>{t.click()}),t.addEventListener("change",async e=>{var n,s;const i=e.target.files[0];if(!i)return;const c=null==(s=null==(n=document.getElementById("ce-company-domain"))?void 0:n.value)?void 0:s.trim();if(c)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</span>';const e=await rt(i,c);o.value=e,Aa(e)}catch(l){console.error("ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",l),$e("ãƒ­ã‚´ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+l.message,"error"),Aa(o.value)}finally{a.classList.remove("uploading"),t.value=""}else $e("å…ˆã«ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error")}),null==n||n.addEventListener("click",()=>{o.value="",Aa("")}),null==a||a.addEventListener("dragover",e=>{e.preventDefault(),a.classList.add("drag-over")}),null==a||a.addEventListener("dragleave",e=>{e.preventDefault(),a.classList.remove("drag-over")}),null==a||a.addEventListener("drop",async e=>{var t,n;e.preventDefault(),a.classList.remove("drag-over");const s=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));if(0===s.length)return;const i=null==(n=null==(t=document.getElementById("ce-company-domain"))?void 0:t.value)?void 0:n.trim();if(i)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</span>';const e=await rt(s[0],i);o.value=e,Aa(e)}catch(c){console.error("ãƒ­ã‚´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",c),$e("ãƒ­ã‚´ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+c.message,"error"),Aa(o.value)}finally{a.classList.remove("uploading")}else $e("å…ˆã«ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error")}))}(),Ua("ce-description-insert-image","ce-description-image-input","ce-description-editor"),Ua("ce-job-content-insert-image","ce-job-content-image-input","ce-job-content-editor"),function(){const e=document.getElementById("section-company-edit");if(!e)return;e.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=t.querySelector(".rich-editor-toolbar"),a=t.querySelector('input[type="hidden"]');null==n||n.querySelectorAll(".toolbar-btn:not([id])").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const o=t.dataset.command;o&&(document.execCommand(o,!1,null),e.focus(),Da(e,a))})}),e.addEventListener("input",()=>{Da(e,a)}),e.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),e.addEventListener("keydown",t=>{if(t.ctrlKey||t.metaKey){switch(t.key.toLowerCase()){case"b":t.preventDefault(),document.execCommand("bold",!1,null);break;case"i":t.preventDefault(),document.execCommand("italic",!1,null);break;case"u":t.preventDefault(),document.execCommand("underline",!1,null)}Da(e,a)}})})}(),$a=!0),Ba||await async function(){const e=sessionStorage.getItem("editing_company_data");if(e){try{const t=JSON.parse(e);if(t.companyDomain===La||t.company_domain===La)return ka=t,Ta(t),void sessionStorage.removeItem("editing_company_data")}catch(n){console.error("sessionStorageãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:",n)}sessionStorage.removeItem("editing_company_data")}const t=localStorage.getItem(`company_data_${La}`);if(t)try{const e=JSON.parse(t);return ka=e,void Ta(e)}catch(n){console.error("localStorageãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:",n)}try{a();const e=await c(La);if(!e.success||!e.company)return $e("ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","error"),void Pa();ka=e.company,Ta(e.company)}catch(o){console.error("Firestoreèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",o),$e("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: "+o.message,"error")}return}()}function xa(e){if(!e||"<br>"===e||"<div><br></div>"===e)return"";const t=["b","strong","i","em","u","ul","ol","li","br","div","p","img"],n=["src","alt","style"],a=document.createElement("div");a.innerHTML=e;return a.querySelectorAll("*").forEach(e=>{if(t.includes(e.tagName.toLowerCase())){Array.from(e.attributes).forEach(t=>{n.includes(t.name)||e.removeAttribute(t.name)}),"img"!==e.tagName.toLowerCase()||e.style.maxWidth||(e.style.maxWidth="100%")}else e.replaceWith(...e.childNodes)}),a.innerHTML}function Da(e,t){if(t){const n=xa(e.innerHTML);t.value=n}}function Ca(e,t){const n=document.getElementById(e),a=null==n?void 0:n.closest(".rich-editor-container"),o=null==a?void 0:a.querySelector('input[type="hidden"]');n&&(n.innerHTML=t||"",o&&(o.value=t||""))}function Ta(e){const t=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t||"")};t("ce-company-name",e.company),t("ce-company-domain",e.companyDomain||e.company_domain),t("ce-design-pattern",e.designPattern||"modern"),t("ce-order",e.order),t("ce-company-address",e.companyAddress||e.location);const n=e.logoUrl||e.imageUrl||"";t("ce-logo-url",n),Aa(n);const a=document.getElementById("ce-show-company");if(a&&(a.checked="â—‹"===e.showCompany||!0===e.showCompany||"true"===e.showCompany||!0===e.visible),Ca("ce-description-editor",e.description||""),Ca("ce-job-content-editor",e.jobDescription||e.jobContent||""),Ca("ce-working-hours-editor",e.workingHours||""),Ca("ce-work-location-editor",e.workLocation||""),e.company){const t=document.getElementById("ce-page-title");t&&(t.textContent=`${e.company} ã®ç·¨é›†`)}}function Aa(e){const t=document.getElementById("ce-logo-preview"),n=document.getElementById("ce-logo-remove-btn");t&&(e?(t.innerHTML=`<img src="${Le(e)}" alt="ä¼šç¤¾ãƒ­ã‚´">`,n&&(n.style.display="")):(t.innerHTML='<span class="upload-placeholder">ãƒ­ã‚´ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>',n&&(n.style.display="none")))}function Ma(){var e;const t=document.getElementById("ce-delete-confirm-modal"),n=(null==(e=document.getElementById("ce-company-name"))?void 0:e.value)||"",a=document.getElementById("ce-delete-company-name");a&&(a.textContent=n),t&&(t.style.display="flex")}function qa(){const e=document.getElementById("ce-delete-confirm-modal");e&&(e.style.display="none")}async function Ha(){const e=document.getElementById("ce-delete-confirm");e&&(e.disabled=!0,e.textContent="å‰Šé™¤ä¸­...");try{if(n){a();const e=await d(La);if(!e.success)throw new Error(e.error||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");return localStorage.removeItem(`company_data_${La}`),$e("ä¼šç¤¾ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),qa(),void Pa()}const e=Ia.gasApiUrl;if(e){const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteCompany",domain:La})))),n=`${e}?action=post&data=${encodeURIComponent(t)}`,a=await fetch(n),o=await a.json();if(!o.success)throw new Error(o.error||"å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}localStorage.removeItem(`company_data_${La}`),$e("ä¼šç¤¾ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),qa(),Pa()}catch(t){console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",t),$e("å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+t.message,"error")}finally{e&&(e.disabled=!1,e.textContent="å‰Šé™¤ã™ã‚‹")}}function Pa(){var e,t,n;(null==(e=window.AdminDashboard)?void 0:e.navigateBack)?window.AdminDashboard.navigateBack():null==(n=null==(t=window.AdminDashboard)?void 0:t.switchSection)||n.call(t,"company-manage")}function Ua(e,t,n){const a=document.getElementById(e),o=document.getElementById(t),s=document.getElementById(n);a&&o&&s&&(a.addEventListener("click",()=>{o.click()}),o.addEventListener("change",async e=>{var t,n;const a=e.target.files[0];if(!a)return;const i=null==(n=null==(t=document.getElementById("ce-company-domain"))?void 0:t.value)?void 0:n.trim();if(i)try{const e=`img-placeholder-${Date.now()}`,t=document.createElement("img");t.id=e,t.src=URL.createObjectURL(a),t.alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...",t.className="uploading",t.style.maxWidth="100%",t.style.opacity="0.5",s.focus();const n=window.getSelection();if(n.rangeCount>0){const e=n.getRangeAt(0);e.insertNode(t),e.setStartAfter(t),e.collapse(!0),n.removeAllRanges(),n.addRange(e)}else s.appendChild(t);const o=await dt(a,i),c=document.getElementById(e);c&&(c.src=o,c.alt="",c.className="",c.style.opacity="1",c.removeAttribute("id"));const l=s.closest(".rich-editor-container"),r=null==l?void 0:l.querySelector('input[type="hidden"]');r&&(r.value=xa(s.innerHTML))}catch(c){console.error("ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",c),$e("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: "+c.message,"error");const e=s.querySelector("img.uploading");e&&e.remove()}finally{o.value=""}else $e("å…ˆã«ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„","error")}))}const Ra=new Map,_a=new Map,Na="/dev/";async function Ja(e){if(Ra.has(e))return Ra.get(e);if(_a.has(e))return _a.get(e);const t=async function(e){const t=`${Na}admin/sections/${e}.html`;try{const n=await fetch(t);if(!n.ok)throw new Error(`Failed to load section: ${e} (${n.status})`);return await n.text()}catch(n){return console.error(`[SectionLoader] Error loading ${e}:`,n),`<div class="section-error">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e}</div>`}}(e);_a.set(e,t);try{const n=await t;return Ra.set(e,n),n}finally{_a.delete(e)}}let za={status:"idle",currentStep:"",companiesTotal:0,companiesDone:0,jobsTotal:0,jobsDone:0,errors:[]};function Fa(){return{...za}}function Oa(){za={status:"idle",currentStep:"",companiesTotal:0,companiesDone:0,jobsTotal:0,jobsDone:0,errors:[]}}function Va(e){za={...za,...e},console.log("[Migration]",za.currentStep,za)}async function Wa(){const e=`${r.gasApiUrl}?action=getCompanies`,t=await fetch(e),n=await t.json();if(!n.success)throw new Error(n.error||"ä¼šç¤¾ä¸€è¦§ã®å–å¾—ã«å¤±æ•—");return n.companies||[]}async function Ga(e){const t=`${r.gasApiUrl}?action=getJobs&domain=${encodeURIComponent(e)}`,n=await fetch(t),a=await n.json();if(!a.success)throw new Error(a.error||"æ±‚äººã®å–å¾—ã«å¤±æ•—");return a.jobs||[]}async function Ya(e){const t=`${r.gasApiUrl}?action=getRecruitSettings&companyDomain=${encodeURIComponent(e)}`,n=await fetch(t),a=await n.json();return a.success&&a.settings||null}async function Za(e,t){const n=`${r.gasApiUrl}?action=getLPSettings&companyDomain=${encodeURIComponent(e)}&jobId=${encodeURIComponent(t)}`,a=await fetch(n),o=await a.json();return o.success&&o.settings||null}async function Xa(e,t,n){if(!n)return;const a=await m(e,t,n);if(!a.success)throw new Error(a.error)}async function Ka(e){const t=e.companyDomain||e.domain;if(!t)throw new Error("ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“");const n={company:e.company||e.name||"",description:e.description||"",jobDescription:e.jobDescription||"",workingHours:e.workingHours||"",companyAddress:e.companyAddress||e.address||"",workLocation:e.workLocation||"",designPattern:e.designPattern||"",imageUrl:e.imageUrl||"",order:parseInt(e.order)||0,showCompany:!0===e.showCompany||"â—‹"===e.showCompany||"â—¯"===e.showCompany,manageSheetUrl:e.manageSheetUrl||e.jobsSheet||""},a=await l(t,n);if(!a.success)throw new Error(a.error);return t}async function Qa(e,t){const n={id:String(t.id||""),title:t.title||"",location:t.location||"",area:t.area||"",totalBonus:t.totalBonus||"",monthlySalary:t.monthlySalary||"",salaryType:t.salaryType||"",salaryOther:t.salaryOther||"",jobType:t.jobType||"",employmentType:t.employmentType||"",features:t.features||"",displayedFeatures:t.displayedFeatures||"",badges:t.badges||"",jobDescription:t.jobDescription||"",requirements:t.requirements||"",benefits:t.benefits||"",workingHours:t.workingHours||"",holidays:t.holidays||"",visible:!0===t.visible||"true"===t.visible||"TRUE"===t.visible,order:parseInt(t.order)||0,publishStartDate:t.publishStartDate||"",publishEndDate:t.publishEndDate||"",memo:t.memo||"",access:t.access||"",imageUrl:t.imageUrl||"",jobLogo:t.jobLogo||t.imageUrl||"",showVideoButton:!0===t.showVideoButton||"true"===t.showVideoButton,videoUrl:t.videoUrl||""},a=await i(e,n,t.id?String(t.id):null);if(!a.success)throw new Error(a.error)}async function eo(e,t){if(!t)return;const n=await u(e,t);if(!n.success)throw new Error(n.error)}function to(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="flex"),t&&(t.style.display="none")}function no(){const e=document.getElementById("login-screen"),t=document.getElementById("admin-dashboard");e&&(e.style.display="none"),t&&(t.style.display="flex"),function(){ve();const e=g(),t=document.getElementById("nav-admin"),n=document.getElementById("nav-company"),a=window.location.hash.slice(1);let o=null;if(p())t&&(t.style.display="block"),n&&(n.style.display="none"),o=a||"overview";else{t&&(t.style.display="none"),n&&(n.style.display="block"),o=a||"job-listings";const s=document.querySelector(".sidebar-header p");s&&e&&(s.textContent=`${e} ç®¡ç†ç”»é¢`),function(){const e=document.getElementById("section-settings");if(!e)return;e.querySelectorAll(".settings-card").forEach(e=>{var t;if("ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ"!==(null==(t=e.querySelector("h3"))?void 0:t.textContent))e.style.display="none";else{const t=e.querySelector("h3");t&&(t.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´")}})}()}history.replaceState({section:o,company:null},"",`#${o}`),oo(o,{pushState:!1})}()}function ao(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.remove("open"),t&&t.classList.remove("active"),n&&n.classList.remove("active"),document.body.style.overflow=""}async function oo(e,t={}){const{pushState:n=!0,company:a=null}=t;if(kn)return;if("job-manage-company"===e){const e=g();if(e)return void so(e,e,"overview",null,"jobs")}if(kn=!0,n){const t={section:e,company:a||("job-manage"===e?{domain:jn.domain,name:jn.name}:null)};history.pushState(t,"",`#${e}`)}ao(),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const o=document.querySelector(`[data-section="${e}"]`);o&&o.parentElement.classList.add("active"),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});let s=document.getElementById(`section-${e}`);if(!s){const t=document.getElementById("section-container");if(t)try{const n=await Ja(e),a=document.createElement("div");a.innerHTML=n,s=a.firstElementChild,s&&t.appendChild(s)}catch(r){return console.error(`[Admin] Failed to load section: ${e}`,r),void xn()}}s&&s.classList.add("active");const i={overview:"æ¦‚è¦","analytics-detail":"è©³ç´°åˆ†æ","company-manage":"ä¼šç¤¾ç®¡ç†","job-listings":"æ±‚äººä¸€è¦§","job-manage":"æ±‚äººç®¡ç†","company-edit":"ä¼šç¤¾ç·¨é›†","lp-settings":"LPè¨­å®š","recruit-settings":"æ¡ç”¨ãƒšãƒ¼ã‚¸è¨­å®š","applicant-select":"å¿œå‹Ÿè€…ç®¡ç†","company-users":"ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",settings:"è¨­å®š"},c=document.getElementById("page-title");if(c&&("job-manage"===e&&jn.name?c.textContent=`${jn.name} ã®æ±‚äººç®¡ç†`:c.textContent=i[e]||e),"company-manage"===e&&ee(),"lp-settings"===e){Ie(),W(),F();const e=document.getElementById("btn-save-lp-settings");e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",()=>O()),e.setAttribute("data-listener-attached","true"));const t=document.getElementById("btn-reset-lp-settings");t&&!t.hasAttribute("data-listener-attached")&&(t.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-job-select"))?void 0:e.value;t&&V(t)}),t.setAttribute("data-listener-attached","true"))}"recruit-settings"===e&&mn(),"job-listings"===e&&hn();const l=document.querySelector(".header-actions");if(l){const t=["overview","analytics-detail"];l.style.display=t.includes(e)?"":"none"}if(document.body.classList.toggle("lp-settings-active","lp-settings"===e),"applicant-select"===e&&async function(){const e=document.getElementById("applicant-company-grid");if(!e)return;e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';try{const t=await We();if(!p()){const e=g();if(e){const n=t.find(t=>t.companyDomain===e),a=(null==n?void 0:n.company)||e;return void setTimeout(()=>{so(e,a,"applicant-select",null,"applicants")},50)}}if(!t||0===t.length)return void(e.innerHTML='<div class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');let n=t.filter(e=>Ye(e));if(!p()){const e=g();n=n.filter(t=>t.companyDomain===e)}if(0===n.length)return void(e.innerHTML='<div class="loading-cell">è¡¨ç¤ºå¯èƒ½ãªä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“</div>');e.innerHTML=n.map(e=>`\n      <div class="company-select-card" data-domain="${Le(e.companyDomain)}" data-name="${Le(e.company)}">\n        <div class="company-select-icon">ğŸ¢</div>\n        <div class="company-select-info">\n          <h4>${Le(e.company)}</h4>\n          <p>${Le(e.companyDomain)}</p>\n        </div>\n        <div class="company-select-arrow">â†’</div>\n      </div>\n    `).join(""),e.querySelectorAll(".company-select-card").forEach(e=>{e.addEventListener("click",()=>{so(e.dataset.domain,e.dataset.name,"applicant-select",null,"applicants")})})}catch(r){console.error("ä¼šç¤¾ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",r),e.innerHTML='<div class="loading-cell">ä¼šç¤¾ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>'}}(),"company-users"===e&&uo(),"job-manage"===e){const e=document.getElementById("jm-back-btn");if(e&&!e.hasAttribute("data-listener-attached")&&(e.addEventListener("click",io),e.setAttribute("data-listener-attached","true")),jn.domain&&jn.name){const e=Bn;Bn=null,Nn(jn.domain,jn.name,e)}}"company-edit"===e&&Sa(In),"company-detail"===e&&nn(),requestAnimationFrame(()=>{xn()})}function so(e,t,n="job-listings",a=null,o=null){Sn(e,t),a&&function(e){Bn=e}(a),o&&(Ln=o),oo("job-manage")}function io(){history.back()}function co(){console.log("bindEvents called"),window.addEventListener("popstate",e=>{e.state&&e.state.section&&(e.state.company?Sn(e.state.company.domain,e.state.company.name):(jn.domain=null,jn.name=null),In=null,oo(e.state.section,{pushState:!1}))});const e=document.getElementById("mobile-menu-btn");e&&e.addEventListener("click",()=>{const e=document.getElementById("admin-sidebar");e&&e.classList.contains("open")?ao():function(){const e=document.getElementById("admin-sidebar"),t=document.getElementById("mobile-overlay"),n=document.getElementById("mobile-menu-btn");e&&e.classList.add("open"),t&&t.classList.add("active"),n&&n.classList.add("active"),document.body.style.overflow="hidden"}()});const t=document.getElementById("sidebar-close-btn");t&&t.addEventListener("click",ao);const n=document.getElementById("mobile-overlay");n&&n.addEventListener("click",ao),console.log("Setting up login tabs, found:",document.querySelectorAll(".login-tab").length),document.querySelectorAll(".login-tab").forEach(e=>{e.addEventListener("click",()=>{console.log("Tab clicked:",e.dataset.tab);const t=e.dataset.tab;document.querySelectorAll(".login-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active");const n=document.getElementById("company-login-form"),a=document.getElementById("login-form");"company"===t?(n&&(n.style.display="block"),a&&(a.style.display="none")):(n&&(n.style.display="none"),a&&(a.style.display="block"))})});const a=document.getElementById("company-login-form");a&&a.addEventListener("submit",async e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("company-username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("company-password"))?void 0:n.value)||"",s=document.getElementById("company-login-error");s&&(s.style.display="none");const i=await oe(a,o);i.success?(no(),so(i.companyDomain,i.companyName||i.companyDomain,"overview",null,"jobs")):s&&(s.textContent=i.error,s.style.display="block")});const o=document.getElementById("login-form");o&&o.addEventListener("submit",e=>{var t,n;e.preventDefault();const a=(null==(t=document.getElementById("username"))?void 0:t.value)||"",o=(null==(n=document.getElementById("password"))?void 0:n.value)||"",s=document.getElementById("login-error"),i=se(a,o);i.success?(s&&(s.style.display="none"),no(),St()):s&&(s.textContent=i.error,s.style.display="block")});const s=document.getElementById("logout-btn");s&&s.addEventListener("click",()=>{ie(),to()}),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();oo(e.currentTarget.dataset.section)})});const i=document.getElementById("refresh-btn");i&&i.addEventListener("click",()=>St());const c=document.getElementById("company-search");c&&c.addEventListener("input",e=>qt(e.target.value));const l=document.getElementById("sort-by");l&&l.addEventListener("change",()=>Ht());const r=document.getElementById("google-login-btn");r&&r.addEventListener("click",async()=>{const e=document.getElementById("login-error"),t=await ce();t.success?(e&&(e.style.display="none"),no(),St()):e&&(e.textContent=t.error,e.style.display="block")});const d=document.getElementById("btn-add-company");d&&d.addEventListener("click",()=>K());const m=document.getElementById("lp-job-select");m&&m.addEventListener("change",e=>V(e.target.value));const u=document.getElementById("btn-save-lp-settings");u&&u.addEventListener("click",()=>{O()});const p=document.getElementById("btn-reset-lp-settings");p&&p.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("lp-job-select"))?void 0:e.value;t&&V(t)});const y=document.getElementById("btn-toggle-preview");y&&y.addEventListener("click",()=>z());const g=document.getElementById("btn-close-preview");g&&g.addEventListener("click",()=>J()),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");document.querySelectorAll(".preview-device-btn").forEach(e=>{e.classList.toggle("active",e.dataset.device===t)}),n&&n.setAttribute("data-device",t)})});document.querySelectorAll("#lp-editor input, #lp-editor textarea").forEach(e=>{e.addEventListener("input",()=>N())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>R())}),_(),le(),re(),de(),document.querySelectorAll('#lp-section-order input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>R())}),document.querySelectorAll(".collapsible-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".collapsible");t&&t.classList.toggle("collapsed")})}),document.querySelectorAll("#ad-tracking-section, #ogp-section").forEach(e=>{e.classList.add("collapsed")});const v=document.getElementById("save-password");v&&v.addEventListener("click",()=>{var e;const t=null==(e=document.getElementById("new-password"))?void 0:e.value;t&&t.length>=4?(localStorage.setItem("admin_password",t),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ")):alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")});const b=document.getElementById("feed-status"),f=()=>{b&&(b.style.display="flex")},h=()=>{b&&(b.style.display="none")},E=document.getElementById("btn-download-indeed");E&&E.addEventListener("click",async()=>{try{f(),await me(),alert("Indeed XMLãƒ•ã‚£ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{h()}});const w=document.getElementById("btn-download-google");w&&w.addEventListener("click",async()=>{try{f(),await ue(),alert("Google JSON-LDã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{h()}});const j=document.getElementById("btn-download-jobbox");j&&j.addEventListener("click",async()=>{try{f(),await pe(),alert("æ±‚äººãƒœãƒƒã‚¯ã‚¹XMLã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{h()}});const I=document.getElementById("btn-download-csv");I&&I.addEventListener("click",async()=>{try{f(),await ye(),alert("CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ")}catch(e){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}finally{h()}});const B=document.getElementById("btn-add-company-user");B&&B.addEventListener("click",()=>{po(null,"")});const L=document.getElementById("btn-bulk-generate");L&&L.addEventListener("click",()=>async function(){if(!(await Ze({title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ä¸€æ‹¬ç™ºè¡Œ",message:"æœªç™ºè¡Œã®å…¨ä¼šç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ",confirmText:"ç™ºè¡Œã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})))return;const e=lo.filter(e=>Ye(e)),t=[];for(const i of e){if(await fe(i.companyDomain))continue;const e=be(i.companyDomain),n=ge();(await he(e,n,i.companyDomain,i.company)).success&&t.push({company:i.company,domain:i.companyDomain,username:e,password:n})}if(0===t.length)return void alert("ç™ºè¡Œå¯¾è±¡ã®ä¼šç¤¾ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");let n=`${t.length}ç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\n\n`;t.forEach(e=>{n+=`ã€${e.company}ã€‘\nID: ${e.username}\nPW: ${e.password}\n\n`});const a=new Blob([n],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(a),s=document.createElement("a");s.href=o,s.download=`company-users-${(new Date).toISOString().split("T")[0]}.txt`,s.click(),URL.revokeObjectURL(o),alert(`${t.length}ç¤¾ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\nãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`),await uo()}());const k=document.getElementById("company-user-modal-close");k&&k.addEventListener("click",yo);const $=document.getElementById("company-user-modal-cancel");$&&$.addEventListener("click",yo);const S=document.getElementById("company-user-form");S&&S.addEventListener("submit",e=>{e.preventDefault(),async function(){var e,t,n,a,o,s,i,c;const l=null==(e=document.getElementById("cu-company-select"))?void 0:e.value,r=null==(n=null==(t=document.getElementById("cu-username"))?void 0:t.value)?void 0:n.trim(),d=null==(a=document.getElementById("cu-password"))?void 0:a.value,m=(null==(s=null==(o=document.getElementById("cu-name"))?void 0:o.value)?void 0:s.trim())||"",u=(null==(i=document.getElementById("cu-role"))?void 0:i.value)||"staff",p=null==(c=document.getElementById("cu-is-active"))?void 0:c.checked;if(!l||!r)return void alert("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const y=document.getElementById("company-user-modal-save");y&&(y.disabled=!0,y.textContent="ä¿å­˜ä¸­...");try{if(mo){const e={username:r,name:m,role:u,isActive:p};d&&(e.password=d);const t=await Ee(mo,e);if(!t.success)throw new Error(t.error);alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),yo()}else{if(!d)return void alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");const e=await he(r,d,l,m,u);if(!e.success)throw new Error(e.error);document.getElementById("cu-issued-username").textContent=r,document.getElementById("cu-issued-password").textContent=d,document.getElementById("cu-credentials-display").style.display="block",y&&(y.textContent="å®Œäº†",y.onclick=()=>{yo(),uo()}),alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’æ§ãˆã¦ãã ã•ã„ã€‚")}await uo()}catch(g){console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿å­˜ã‚¨ãƒ©ãƒ¼:",g),alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+g.message)}finally{y&&!mo||y&&(y.disabled=!1,y.textContent="ä¿å­˜")}}()});const x=document.getElementById("company-user-delete");x&&x.addEventListener("click",go);const D=document.getElementById("cu-generate-password");D&&D.addEventListener("click",()=>{const e=document.getElementById("cu-password");e&&(e.value=ge())});const C=document.getElementById("cu-copy-credentials");C&&C.addEventListener("click",vo);const T=document.getElementById("company-user-modal");T&&T.addEventListener("click",e=>{e.target===T&&yo()}),document.addEventListener("navigateToSection",e=>{const{section:t,companyDomain:n,company:a}=e.detail;"job-listings"===t?(n&&function(e){if(fn=e,gn.length>0){const t=document.getElementById("job-company-filter");t&&(t.value=e||"",En())}}(n),oo("job-listings")):"recruit-settings"===t&&(n&&function(e){dn=e}(n),oo("recruit-settings"))});const A=document.getElementById("jm-back-btn");A&&A.addEventListener("click",io)}let lo=[],ro=[],mo=null;async function uo(){const e=document.getElementById("company-users-tbody");if(e){e.innerHTML='<tr><td colspan="8" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>';try{lo=await We(),ro=await ae();const t={};ro.forEach(e=>{t[e.companyDomain]||(t[e.companyDomain]=[]),t[e.companyDomain].push(e)});const n=lo.filter(e=>Ye(e));if(0===n.length)return void(e.innerHTML='<tr><td colspan="8" class="loading-cell">ä¼šç¤¾ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');let a="";n.forEach(e=>{const n=t[e.companyDomain]||[];0===n.length?a+=`\n          <tr data-company-domain="${Le(e.companyDomain)}">\n            <td>${Le(e.company)}</td>\n            <td><span class="badge warning">æœªç™ºè¡Œ</span></td>\n            <td>-</td>\n            <td>-</td>\n            <td><span class="badge">-</span></td>\n            <td>-</td>\n            <td>-</td>\n            <td>\n              <button class="btn-small btn-primary btn-issue-user" data-domain="${Le(e.companyDomain)}" data-company="${Le(e.company)}">\n                IDç™ºè¡Œ\n              </button>\n            </td>\n          </tr>\n        `:n.forEach((t,o)=>{const s=!1!==t.isActive,i=t.createdAt?new Date(t.createdAt).toLocaleDateString("ja-JP"):"-",c=t.lastLogin?new Date(t.lastLogin).toLocaleString("ja-JP"):"æœªãƒ­ã‚°ã‚¤ãƒ³",l="admin"===t.role?'<span class="badge primary">ç®¡ç†è€…</span>':'<span class="badge">æ‹…å½“è€…</span>';a+=`\n            <tr data-user-id="${Le(t.id)}">\n              ${0===o?`<td rowspan="${n.length}">${Le(e.company)}</td>`:""}\n              <td><code>${Le(t.username)}</code></td>\n              <td>${Le(t.name||"-")}</td>\n              <td>${l}</td>\n              <td>${s?'<span class="badge success">æœ‰åŠ¹</span>':'<span class="badge">ç„¡åŠ¹</span>'}</td>\n              <td>${i}</td>\n              <td>${c}</td>\n              <td>\n                <div class="action-buttons">\n                  <button class="btn-small btn-secondary btn-reset-password" data-user-id="${Le(t.id)}" data-username="${Le(t.username)}">\n                    PWå†ç™ºè¡Œ\n                  </button>\n                  <button class="btn-small btn-edit-user" data-user-id="${Le(t.id)}">ç·¨é›†</button>\n                </div>\n              </td>\n            </tr>\n          `})}),e.innerHTML=a,document.querySelectorAll(".btn-issue-user").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.domain;e.dataset.company,po(null,t)})}),document.querySelectorAll(".btn-edit-user").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.userId,n=ro.find(e=>e.id===t);if(n){const e=lo.find(e=>e.companyDomain===n.companyDomain);po(n,n.companyDomain,(null==e?void 0:e.company)||n.companyDomain)}})}),document.querySelectorAll(".btn-reset-password").forEach(e=>{e.addEventListener("click",async()=>{const t=e.dataset.userId,n=e.dataset.username;await async function(e,t){const n=await Ze({title:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†ç™ºè¡Œ",message:`${t} ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ`,confirmText:"å†ç™ºè¡Œã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"});if(!n)return;const a=ge();try{const n=await je(e,a);if(!n.success)throw new Error(n.error);const o=`æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚\n\nãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${t}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${a}\n\nâ€»ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å†è¡¨ç¤ºã§ãã¾ã›ã‚“ã€‚å¿…ãšæ§ãˆã¦ãã ã•ã„ã€‚`;try{await navigator.clipboard.writeText(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${t}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${a}`),alert(o+"\n\nï¼ˆã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼‰")}catch{alert(o)}}catch(o){console.error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†ç™ºè¡Œã‚¨ãƒ©ãƒ¼:",o),alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ: "+o.message)}}(t,n)})})}catch(t){console.error("ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t),e.innerHTML='<tr><td colspan="8" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>'}}}function po(e,t,n){const a=document.getElementById("company-user-modal"),o=document.getElementById("company-user-modal-title"),s=document.getElementById("cu-company-select"),i=document.getElementById("cu-username"),c=document.getElementById("cu-password"),l=document.getElementById("cu-name"),r=document.getElementById("cu-role"),d=document.getElementById("cu-is-active"),m=document.getElementById("company-user-delete"),u=document.getElementById("cu-credentials-display");if(!a)return;const p=lo.filter(e=>Ye(e));s.innerHTML=p.map(e=>`\n    <option value="${Le(e.companyDomain)}" ${e.companyDomain===t?"selected":""}>\n      ${Le(e.company)}\n    </option>\n  `).join(""),e?(o.textContent="ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·¨é›†",i.value=e.username||"",c.value="",c.placeholder="å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›",c.required=!1,l&&(l.value=e.name||""),r&&(r.value=e.role||"staff"),d.checked=!1!==e.isActive,m.style.display="",mo=e.id):(o.textContent="ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ",i.value=be(t),c.value=ge(),c.placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",c.required=!0,l&&(l.value=""),r&&(r.value="staff"),d.checked=!0,m.style.display="none",mo=null),u.style.display="none",a.style.display="flex"}function yo(){const e=document.getElementById("company-user-modal");e&&(e.style.display="none"),mo=null}async function go(){if(!mo)return;if(await Ze({title:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤",message:"ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",confirmText:"å‰Šé™¤ã™ã‚‹",cancelText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",danger:!0}))try{const e=await we(mo);if(!e.success)throw new Error(e.error);alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),yo(),await uo()}catch(e){console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",e),alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e.message)}}function vo(){var e,t;const n=null==(e=document.getElementById("cu-issued-username"))?void 0:e.textContent,a=null==(t=document.getElementById("cu-issued-password"))?void 0:t.textContent;if(n&&a){const e=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${n}\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${a}`;navigator.clipboard.writeText(e).then(()=>{alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ")}).catch(()=>{alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ")})}}function bo(){const t=localStorage.getItem("admin_password");t&&(e.credentials.password=t),te(),ne()?(no(),document.addEventListener("authReady",()=>{St()},{once:!0}),setTimeout(()=>{y()||St()},3e3)):to(),co(),vt(()=>{St();const e=document.getElementById("page-analytics-tab");e&&e.classList.contains("active")&&sn()}),Pt(),function(){const e=document.querySelectorAll(".page-type-btn");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.classList.add("active"),on=t.dataset.type,sn()})})}();const n=document.getElementById("tab-page-analytics");n&&n.addEventListener("click",()=>{sn()}),nn()}"undefined"!=typeof window&&(window.AdminDashboard={config:e,spreadsheetConfig:{sheetId:"1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",companySheetName:"ä¼šç¤¾ä¸€è¦§",lpSettingsSheetName:"LPè¨­å®š",gasApiUrl:"https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec"},init:bo,switchSection:oo,getIdToken:y,navigateToJobManage:so,navigateBack:io,navigateToCompanyEdit:function(e,t="company-manage"){!function(e){In=e}(e),oo("company-edit")}},window.AdminAnalytics={loadDashboardData:St,filterCompanies:qt,sortCompanies:Ht},window.AdminCompany={loadCompanyManageData:ee,editCompany:Q,showCompanyModal:K,closeCompanyModal:X,saveCompanyData:Z,renderCompanyTable:Y,openJobsArea:G,loadCompanyListForLP:W,loadLPSettings:V,saveLPSettings:O,renderHeroImagePresets:F,toggleLPPreview:z,closeLPPreview:J,debouncedUpdatePreview:N,initSectionSortable:_,updateLPPreview:R,getPatternLabel:e=>({standard:"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰",modern:"ãƒ¢ãƒ€ãƒ³",classic:"ã‚¯ãƒ©ã‚·ãƒƒã‚¯",minimal:"ãƒŸãƒ‹ãƒãƒ«",colorful:"ã‚«ãƒ©ãƒ•ãƒ«"}[e]||"ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰")},window.DataMigration={migrateAllData:async function(e){Oa(),Va({status:"running",currentStep:"åˆæœŸåŒ–ä¸­..."});try{a(),Va({currentStep:"ä¼šç¤¾ä¸€è¦§ã‚’å–å¾—ä¸­..."});const s=await Wa();Va({companiesTotal:s.length}),e&&e(Fa());for(let a=0;a<s.length;a++){const i=s[a],c=i.companyDomain||i.domain;if(c){try{Va({currentStep:`ä¼šç¤¾ã‚’ç§»è¡Œä¸­: ${c}`}),await Ka(i),Va({currentStep:`${c} ã®æ±‚äººã‚’å–å¾—ä¸­...`});const e=await Ga(c);Va({jobsTotal:za.jobsTotal+e.length});for(const n of e)try{await Qa(c,n),Va({jobsDone:za.jobsDone+1})}catch(t){za.errors.push(`${c}/job ${n.id}: ${t.message}`)}try{const e=await Ya(c);e&&await eo(c,e)}catch(n){za.errors.push(`${c}/recruitSettings: ${n.message}`)}Va({companiesDone:a+1})}catch(o){za.errors.push(`${c}: ${o.message}`)}e&&e(Fa()),await new Promise(e=>setTimeout(e,100))}else za.errors.push(`ä¼šç¤¾ ${a+1}: ãƒ‰ãƒ¡ã‚¤ãƒ³ãªã—`)}return Va({status:"completed",currentStep:"å®Œäº†"}),e&&e(Fa()),{success:!0,companiesCount:za.companiesDone,jobsCount:za.jobsDone,errors:za.errors}}catch(s){return Va({status:"error",currentStep:`ã‚¨ãƒ©ãƒ¼: ${s.message}`}),e&&e(Fa()),{success:!1,error:s.message,errors:za.errors}}},migrateTestCompany:async function(e,t){Oa(),Va({status:"running",currentStep:"åˆæœŸåŒ–ä¸­..."});try{a(),Va({currentStep:"ä¼šç¤¾æƒ…å ±ã‚’å–å¾—ä¸­..."});const s=(await Wa()).find(t=>(t.companyDomain||t.domain)===e);if(!s)throw new Error(`ä¼šç¤¾ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${e}`);Va({companiesTotal:1,currentStep:"ä¼šç¤¾ã‚’ç§»è¡Œä¸­..."}),await Ka(s),Va({companiesDone:1}),t&&t(Fa()),Va({currentStep:"æ±‚äººã‚’å–å¾—ä¸­..."});const i=await Ga(e);Va({jobsTotal:i.length});for(const a of i){try{await Qa(e,a),Va({jobsDone:za.jobsDone+1})}catch(n){za.errors.push(`job ${a.id}: ${n.message}`)}t&&t(Fa())}try{const t=await Ya(e);t&&await eo(e,t)}catch(o){za.errors.push(`recruitSettings: ${o.message}`)}return Va({status:"completed",currentStep:"å®Œäº†"}),t&&t(Fa()),{success:!0,companiesCount:1,jobsCount:za.jobsDone,errors:za.errors}}catch(s){return Va({status:"error",currentStep:`ã‚¨ãƒ©ãƒ¼: ${s.message}`}),t&&t(Fa()),{success:!1,error:s.message}}},migrateAllLPSettings:async function(e){Oa(),Va({status:"running",currentStep:"åˆæœŸåŒ–ä¸­..."});let t=0;try{a(),Va({currentStep:"ä¼šç¤¾ä¸€è¦§ã‚’å–å¾—ä¸­..."});const s=await Wa();Va({companiesTotal:s.length}),e&&e(Fa());for(let a=0;a<s.length;a++){const i=s[a],c=i.companyDomain||i.domain;if(c){try{Va({currentStep:`${c} ã®LPè¨­å®šã‚’å–å¾—ä¸­...`});const e=await Ga(c);for(const a of e){try{const e=await Za(c,a.id);e&&Object.keys(e).length>0&&(await Xa(c,a.id,e),t++,Va({currentStep:`${c}/job ${a.id} ã®LPè¨­å®šã‚’ç§»è¡Œå®Œäº†`}))}catch(n){za.errors.push(`${c}/lp ${a.id}: ${n.message}`)}await new Promise(e=>setTimeout(e,50))}Va({companiesDone:a+1})}catch(o){za.errors.push(`${c}: ${o.message}`)}e&&e(Fa())}}return Va({status:"completed",currentStep:"å®Œäº†"}),e&&e(Fa()),{success:!0,lpSettingsCount:t,errors:za.errors}}catch(s){return Va({status:"error",currentStep:`ã‚¨ãƒ©ãƒ¼: ${s.message}`}),e&&e(Fa()),{success:!1,error:s.message,errors:za.errors}}},getMigrationProgress:Fa}),console.log("admin.js loaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded fired"),bo()});
