const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/RecruitEditor-DSTwGkwm.js","js/utils-DCR9QUau.js","js/image-uploader-gAKnoYUY.js","js/core-Zr8q1Ckh.js","js/api-Dk4Kctww.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-YP0FEG5d.js";import{l as t,_ as e}from"./api-Dk4Kctww.js";import{h as n,g as r,e as o}from"./utils-DCR9QUau.js";import{r as i,a as s,b as a}from"./LayoutComponents-BuXt54tn.js";import"./jobs-loader-vTfia0vR.js";class c{constructor(){this.companyDomain=null,this.company=null,this.jobs=[],this.recruitSettings=null,this.isEditMode=n("edit"),this.editor=null,this.selectedJobType="all"}async init(){if(this.companyDomain=r("id")||r("c"),this.companyDomain)try{await this.waitForJobsLoader();const[e,n]=await Promise.all([window.JobsLoader.fetchCompanies(),t(this.companyDomain)]);if(this.recruitSettings=n||{},this.company=null==e?void 0:e.find(t=>{var e;return(null==(e=t.companyDomain)?void 0:e.trim())===this.companyDomain&&window.JobsLoader.isCompanyVisible(t)}),!this.company)return void this.showError("指定された会社は見つかりませんでした。");this.jobs=await this.fetchJobs(this.company),this.hideLoading(),this.render(),this.renderLayoutComponents(),this.updateSEO(),this.isEditMode&&this.enableEditMode()}catch(e){console.error("[RecruitPage] 初期化エラー:",e),this.showError("ページの読み込みに失敗しました。")}else this.showError("会社が指定されていません。")}async enableEditMode(){try{const{RecruitEditor:t}=await e(async()=>{const{RecruitEditor:t}=await import("./RecruitEditor-DSTwGkwm.js");return{RecruitEditor:t}},__vite__mapDeps([0,1,2,3,4]));this.editor=new t,this.editor.enable(this.companyDomain,this.company,this.recruitSettings,t=>this.onSettingsChange(t)),console.log("[RecruitPage] 編集モード有効化")}catch(t){console.error("[RecruitPage] 編集モードの読み込みエラー:",t)}}onSettingsChange(t){this.recruitSettings=t,this.removeLayoutComponents(),this.render(),this.renderLayoutComponents()}removeLayoutComponents(){var t,e,n;null==(t=document.querySelector(".site-header"))||t.remove(),null==(e=document.querySelector(".fixed-cta-bar"))||e.remove(),null==(n=document.querySelector(".site-footer"))||n.remove(),document.body.classList.remove("has-fixed-header","has-fixed-cta-bar"),document.body.className=document.body.className.replace(/lp-pattern-\S+/g,"").trim(),document.body.removeAttribute("data-layout-style")}waitForJobsLoader(){return new Promise((t,e)=>{const n=Date.now(),r=()=>{window.JobsLoader&&"function"==typeof window.JobsLoader.fetchCompanies?t():Date.now()-n>1e4?e(new Error("JobsLoaderのロードがタイムアウトしました")):setTimeout(r,100)};r()})}async fetchJobs(t){var e;try{const n=null==(e=t.jobsSheet)?void 0:e.trim();if(!n)return console.log("[RecruitPage] jobsSheetが設定されていません"),[];const r=await window.JobsLoader.fetchCompanyJobs(n);if(console.log("[RecruitPage] 取得した全求人:",null==r?void 0:r.length),!(null==r?void 0:r.length))return[];const o=r.filter(t=>"false"!==t.visible&&"FALSE"!==t.visible).filter(t=>window.JobsLoader.isJobInPublishPeriod(t)).sort((t,e)=>(parseInt(t.order)||999)-(parseInt(e.order)||999)).map(e=>({...e,company:t.company,companyDomain:t.companyDomain}));return console.log("[RecruitPage] フィルタ後の求人:",o.length),o}catch(n){return console.error("[RecruitPage] 求人取得エラー:",n),[]}}render(){var t;const e=document.getElementById("recruit-content");if(!e)return;const n=this.getSectionOrder(),r=this.getSectionVisibility(),i=n.map(t=>{if(!1===r[t])return"";switch(t){case"hero":return this.renderHeroSection();case"company-intro":return this.renderCompanyIntroSection();case"jobs":return this.renderJobsSection();case"cta":return this.renderCTASection();default:return""}}).join("");e.innerHTML=i;const s=document.getElementById("header-logo");s&&(null==(t=this.company)?void 0:t.company)&&(s.innerHTML=`<span class="logo-text">${o(this.company.company)}</span>`),this.setupJobTypeTabs(),this.setupVideoButton()}getSectionOrder(){const t=this.recruitSettings||{};return t.sectionOrder?t.sectionOrder.split(",").map(t=>t.trim()).filter(t=>t):["hero","company-intro","jobs","cta"]}getSectionVisibility(){const t=this.recruitSettings||{};if(t.sectionVisibility)try{return JSON.parse(t.sectionVisibility)}catch(e){console.error("[RecruitPage] セクション表示設定のパースエラー:",e)}return{"company-intro":!0}}renderHeroSection(){const t=this.company,e=this.recruitSettings||{},n=e.heroImage||t.imageUrl||"",r=e.heroTitle||`${o(t.company)}で働こう`,i=e.heroSubtitle||(t.description?this.truncateText(t.description,100):"私たちと一緒に働きませんか？"),s="true"===String(e.showVideoButton).toLowerCase(),a=e.videoUrl||"";return`\n      <section class="recruit-hero" id="recruit-hero">\n        <div class="recruit-hero-bg" style="${n?`background-image: url('${o(n)}')`:""}"></div>\n        <div class="recruit-hero-overlay"></div>\n        <div class="recruit-hero-content">\n          <h1 class="recruit-hero-title">${o(r)}</h1>\n          <p class="recruit-hero-subtitle">${o(i)}</p>\n          <div class="recruit-hero-stats">\n            <div class="recruit-stat">\n              <span class="recruit-stat-number">${this.jobs.length}</span>\n              <span class="recruit-stat-label">募集中の求人</span>\n            </div>\n          </div>\n          <div class="recruit-hero-buttons">\n            <a href="#recruit-jobs" class="recruit-hero-cta">求人を見る</a>\n            ${s&&a?`\n              <button type="button" class="recruit-video-button" data-video-url="${o(a)}">\n                <span class="recruit-video-button-icon">▶</span>\n                <span class="recruit-video-button-text">動画を見る</span>\n              </button>\n            `:""}\n          </div>\n        </div>\n      </section>\n    `}renderCompanyIntroSection(){const t=this.company;return t.description||t.jobContent?`\n      <section class="recruit-section recruit-about" id="recruit-about">\n        <div class="recruit-section-inner">\n          <h2 class="recruit-section-title">私たちについて</h2>\n          <div class="recruit-about-content">\n            ${t.imageUrl?`\n              <div class="recruit-about-image">\n                <img src="${o(t.imageUrl)}" alt="${o(t.company)}">\n              </div>\n            `:""}\n            <div class="recruit-about-text">\n              ${t.description?`<p>${this.formatText(t.description)}</p>`:""}\n              ${t.jobContent?`\n                <h3>お仕事内容</h3>\n                <p>${this.formatText(t.jobContent)}</p>\n              `:""}\n            </div>\n          </div>\n        </div>\n      </section>\n    `:""}renderJobsSection(){const t=(this.recruitSettings||{}).jobsTitle||"募集中の求人";if(0===this.jobs.length)return`\n        <section class="recruit-section recruit-jobs" id="recruit-jobs">\n          <div class="recruit-section-inner">\n            <h2 class="recruit-section-title">${o(t)}</h2>\n            <p class="recruit-no-jobs">現在募集中の求人はありません。</p>\n          </div>\n        </section>\n      `;const e=this.renderJobTypeTabs();return`\n      <section class="recruit-section recruit-jobs" id="recruit-jobs">\n        <div class="recruit-section-inner">\n          <h2 class="recruit-section-title">${o(t)}</h2>\n          ${e}\n          <div class="recruit-jobs-grid" id="recruit-jobs-grid">\n            ${this.jobs.map(t=>this.renderJobCard(t)).join("")}\n          </div>\n        </div>\n      </section>\n    `}renderJobTypeTabs(){const t=[...new Set(this.jobs.map(t=>t.jobType).filter(Boolean))];if(t.length<=1)return"";const e={};return this.jobs.forEach(t=>{const n=t.jobType||"その他";e[n]=(e[n]||0)+1}),`\n      <div class="recruit-job-tabs" id="recruit-job-tabs">\n        <button class="recruit-job-tab active" data-type="all">\n          すべて<span class="tab-count">${this.jobs.length}</span>\n        </button>\n        ${t.map(t=>`\n          <button class="recruit-job-tab" data-type="${o(t)}">\n            ${o(t)}<span class="tab-count">${e[t]||0}</span>\n          </button>\n        `).join("")}\n      </div>\n    `}setupJobTypeTabs(){const t=document.getElementById("recruit-job-tabs");t&&t.addEventListener("click",e=>{const n=e.target.closest(".recruit-job-tab");if(!n)return;const r=n.dataset.type;this.filterJobsByType(r),t.querySelectorAll(".recruit-job-tab").forEach(t=>t.classList.remove("active")),n.classList.add("active")})}filterJobsByType(t){this.selectedJobType=t;document.querySelectorAll(".recruit-job-card").forEach(e=>{const n=e.dataset.jobType||"";"all"===t||n===t?(e.style.display="",e.classList.remove("hidden")):(e.style.display="none",e.classList.add("hidden"))})}renderJobCard(t){var e;const n=t.jobId||t["求人ID"]||t.id||"",r=`lp.html?j=${this.companyDomain}_${n}`,i=t.imageUrl||(null==(e=this.company)?void 0:e.imageUrl)||"",s=t.jobType||"";return`\n      <a href="${r}" class="recruit-job-card" data-job-type="${o(s)}">\n        <div class="recruit-job-card-image" style="${i?`background-image: url('${o(i)}')`:""}">\n          ${i?"":'<div class="recruit-job-card-placeholder"></div>'}\n        </div>\n        <div class="recruit-job-card-content">\n          ${s?`<span class="recruit-job-card-type">${o(s)}</span>`:""}\n          <h3 class="recruit-job-card-title">${o(t.title||"求人情報")}</h3>\n          ${t.location?`<p class="recruit-job-card-location">${o(t.location)}</p>`:""}\n          <div class="recruit-job-card-highlights">\n            ${t.monthlySalary?`<span class="recruit-highlight salary">${o(t.monthlySalary)}</span>`:""}\n            ${t.totalBonus?`<span class="recruit-highlight bonus">${o(t.totalBonus)}</span>`:""}\n          </div>\n          ${t.features?`\n            <div class="recruit-job-card-features">\n              ${this.renderFeatures(t.features)}\n            </div>\n          `:""}\n          <span class="recruit-job-card-link">詳細を見る →</span>\n        </div>\n      </a>\n    `}renderFeatures(t){if(!t)return"";if("string"!=typeof t)return"";return t.split(/[,、]/).map(t=>t.trim()).filter(t=>t).slice(0,3).map(t=>`<span class="recruit-feature-tag">${o(t)}</span>`).join("")}renderCTASection(){const t=this.recruitSettings||{},e=t.ctaTitle||"あなたの応募をお待ちしています",n=t.ctaText||"気になる求人があれば、ぜひお気軽にご応募ください。";return`\n      <section class="recruit-section recruit-cta">\n        <div class="recruit-section-inner">\n          <h2 class="recruit-cta-title">${o(e)}</h2>\n          <p class="recruit-cta-text">${o(n)}</p>\n          <a href="#recruit-jobs" class="recruit-cta-button">求人一覧へ戻る</a>\n        </div>\n      </section>\n    `}updateSEO(){const t=this.company,e=this.recruitSettings||{},n=e.ogpTitle||"",r=e.ogpDescription||"",o=e.ogpImage||e.heroImage||t.imageUrl||"",i=n?`${n} | ${t.company}`:`${t.company} 採用情報 | リクエコ求人ナビ`,s=r||(t.description?this.truncateText(t.description,150):`${t.company}の採用情報ページ。募集中の求人をご覧ください。`);document.title=i,this.updateMetaTag("description",s),this.updateMetaTag("og:title",i,"property"),this.updateMetaTag("og:description",s,"property"),o&&this.updateMetaTag("og:image",o,"property")}updateMetaTag(t,e,n="name"){let r=document.querySelector(`meta[${n}="${t}"]`);r||(r=document.createElement("meta"),r.setAttribute(n,t),document.head.appendChild(r)),r.setAttribute("content",e)}truncateText(t,e){if(!t)return"";const n=t.replace(/<[^>]*>/g,"").replace(/\n/g," ");return n.length<=e?n:n.substring(0,e)+"..."}formatText(t){return t?/<[a-z][\s\S]*>/i.test(t)?t:o(t).replace(/\n/g,"<br>"):""}renderLayoutComponents(){var t,e;const n=this.recruitSettings||{},r=n.designPattern||"standard",o=n.layoutStyle||"default",c=document.getElementById("recruit-content"),d=!(!n.logoUrl&&!n.companyNameDisplay),l=!(!n.phoneNumber&&!n.ctaButtonText);if(d&&document.body.classList.add("has-fixed-header"),l&&document.body.classList.add("has-fixed-cta-bar"),document.body.setAttribute("data-layout-style",o),document.body.classList.add(`lp-pattern-${r}`),d){const e=i({logoUrl:n.logoUrl||"",companyName:n.companyNameDisplay||(null==(t=this.company)?void 0:t.company)||"",recruitPageUrl:"",showBackLink:!1,designPattern:r});document.body.insertAdjacentHTML("afterbegin",e)}if(c){const t=s({companyName:n.companyNameDisplay||(null==(e=this.company)?void 0:e.company)||"",designPattern:r});c.insertAdjacentHTML("afterend",t)}if(l){const t=a({phoneNumber:n.phoneNumber||"",ctaButtonText:n.ctaButtonText||"今すぐ応募する",ctaUrl:"#recruit-jobs",designPattern:r});document.body.insertAdjacentHTML("beforeend",t)}}showError(t){this.hideLoading();const e=document.getElementById("recruit-content");e&&(e.innerHTML=`\n        <div class="recruit-error">\n          <h2>エラー</h2>\n          <p>${o(t)}</p>\n          <a href="./" class="recruit-error-link">トップページへ戻る</a>\n        </div>\n      `)}hideLoading(){const t=document.getElementById("recruit-loading");t&&(t.style.display="none")}setupVideoButton(){const t=document.querySelector(".recruit-video-button");t&&t.addEventListener("click",e=>{e.preventDefault();const n=t.dataset.videoUrl;n&&this.showVideoModal(n)})}showVideoModal(t){const e=this.getYouTubeEmbedUrl(t);if(!e)return void console.error("[RecruitPage] YouTube URLの解析に失敗:",t);const n=`\n      <div class="recruit-video-modal" id="recruit-video-modal">\n        <div class="recruit-video-modal-backdrop"></div>\n        <div class="recruit-video-modal-content">\n          <button type="button" class="recruit-video-modal-close" aria-label="閉じる">&times;</button>\n          <div class="recruit-video-modal-wrapper">\n            <iframe\n              src="${e}?autoplay=1&rel=0"\n              frameborder="0"\n              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n              allowfullscreen\n            ></iframe>\n          </div>\n        </div>\n      </div>\n    `;document.body.insertAdjacentHTML("beforeend",n);const r=document.getElementById("recruit-video-modal"),o=r.querySelector(".recruit-video-modal-close"),i=r.querySelector(".recruit-video-modal-backdrop");o.addEventListener("click",()=>this.closeVideoModal()),i.addEventListener("click",()=>this.closeVideoModal());const s=t=>{"Escape"===t.key&&(this.closeVideoModal(),document.removeEventListener("keydown",s))};document.addEventListener("keydown",s),document.body.style.overflow="hidden"}closeVideoModal(){const t=document.getElementById("recruit-video-modal");t&&t.remove(),document.body.style.overflow=""}getYouTubeEmbedUrl(t){if(!t)return null;const e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/];for(const n of e){const e=t.match(n);if(e&&e[1])return`https://www.youtube.com/embed/${e[1]}`}return null}}document.addEventListener("DOMContentLoaded",()=>{(new c).init()});
