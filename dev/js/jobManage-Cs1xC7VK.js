import"./modulepreload-polyfill-YP0FEG5d.js";import{l as e,ac as t,ad as n,k as o,ae as a,af as s,n as l,ag as i,m as c,ah as d,ai as r,aj as u,ak as m,j as g,al as p,am as y,an as b,d as v,w as h,x as f,v as E,u as I,t as w,B as j,ao as L,ap as B,aq as k,ar as x,as as $,r as S,at as T,au as D,av as C,aw as M,ax as A,C as H,Z as q,_ as P,$ as _,I as R,G as U,F as O,ay as J,E as V,az as X,aA as F,aB as G,aC as N,aD as z,aE as W,aF as Z,H as Y,aG as Q,aH as K,aI as ee,aJ as te,R as ne,aK as oe,aL as ae,aM as se,aN as le,f as ie,aO as ce,aP as de,e as re,aQ as ue,aR as me,s as ge,o as pe,q as ye,aS as be,aT as ve}from"./auth-CexLxmz5.js";import{e as he}from"./utils-DCR9QUau.js";import{p as fe}from"./jobs-loader-CbBJAmIK.js";import"./image-uploader-gAKnoYUY.js";import"./LPEditor-I7hCT4B6.js";import"./api-Dk4Kctww.js";import"./core-BSAtEJY5.js";function Ee(e){return e.filter(e=>{if(g.search){const t=g.search.toLowerCase(),n=(e.title||"").toLowerCase(),o=(e.location||"").toLowerCase();if(!n.includes(t)&&!o.includes(t))return!1}if(g.status){const t=function(e){const t=v(e);return"active"===t?"published":t}(e);if(t!==g.status)return!1}if(g.area){if(!(e.location||"").includes(g.area))return!1}return!0})}function Ie(){const e=document.getElementById("jobs-list"),t=document.getElementById("jobs-count"),n=document.getElementById("jobs-filtered-count");if(document.getElementById("jobs-tbody")&&!e)return void function(){const e=document.getElementById("jobs-tbody");if(!e)return;const t=l||[];if(0===t.length)return void(e.innerHTML='<tr><td colspan="6" class="loading-cell">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');e.innerHTML=t.map(e=>{const t=e.monthlySalary?`Â¥${Number(e.monthlySalary).toLocaleString()}`:"-",n="true"===e.visible||"TRUE"===e.visible||!0===e.visible;return`\n      <tr data-row="${e._rowIndex}">\n        <td>${he(e.id||"-")}</td>\n        <td>${he(e.title||"-")}</td>\n        <td>${he(e.location||"-")}</td>\n        <td>${t}</td>\n        <td>${n?'<span class="badge success">å…¬é–‹</span>':'<span class="badge">éå…¬é–‹</span>'}</td>\n        <td>\n          <div class="action-buttons">\n            <button class="btn-small btn-edit" data-row="${e._rowIndex}">ç·¨é›†</button>\n          </div>\n        </td>\n      </tr>\n    `}).join(""),e.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",()=>{ke(parseInt(e.dataset.row,10))})})}();if(!e)return;const o=l||[],i=Ee(o);if(t&&(t.textContent=o.length),n&&(i.length!==o.length?n.textContent=`ï¼ˆ${i.length}ä»¶è¡¨ç¤ºä¸­ï¼‰`:n.textContent=""),function(){const e=document.getElementById("job-filter-area");if(!e)return;const t=new Set;(l||[]).forEach(e=>{if(e.location){const n=e.location.match(/^(.+?[éƒ½é“åºœçœŒ])/);n?t.add(n[1]):t.add(e.location.split(/[å¸‚åŒºç”ºæ‘]/)[0])}});const n=e.value;e.innerHTML='<option value="">å…¨ã‚¨ãƒªã‚¢</option>',Array.from(t).sort().forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}),e.value=n}(),0===i.length){const t=g.search||g.status||g.area;return void(e.innerHTML=`<div class="job-cards-loading">${t?"æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“":"æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}</div>`)}e.innerHTML=i.map(e=>{var t;const n="true"===e.visible||"TRUE"===e.visible||!0===e.visible,o=(null==(t=e.imageUrl)?void 0:t.trim())||"",a=(e.badges?e.badges.split(",").map(e=>e.trim()).filter(e=>e):[]).map(e=>`<span class="job-card-tag${"æ€¥å‹Ÿ"===e?" urgent":""}">${he(e)}</span>`).join("");let s="-",l="";if(e.publishEndDate){const t=new Date(e.publishEndDate),n=new Date;n.setHours(0,0,0,0);const o=Math.ceil((t-n)/864e5);s=`${String(t.getFullYear()).slice(2)}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`,o<0?l=" expired":o<=7&&(l=" soon")}let i="";i=n?" expired"===l?'<span class="badge expired">æ²è¼‰çµ‚äº†</span>':'<span class="badge published">å…¬é–‹ä¸­</span>':'<span class="badge draft">éå…¬é–‹</span>';const c=p[e.id]||{},d=c.applications||0,r=c.pv||0;return`\n      <div class="job-card-row" data-row="${e._rowIndex}">\n        <div class="job-card-image">\n          ${o?`<img src="${he(o)}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'job-card-image-placeholder\\'>ğŸ“‹</div>'">`:'<div class="job-card-image-placeholder">ğŸ“‹</div>'}\n        </div>\n        <div class="job-card-info">\n          <div class="job-card-title">${he(e.title||"-")}</div>\n          <div class="job-card-tags">${a}</div>\n        </div>\n        <div class="job-card-type">${he(e.jobType||"-")}</div>\n        <div class="job-card-area">${he(e.location||"-")}</div>\n        <div class="job-card-deadline${l}">${s}</div>\n        <div class="job-card-stats">${d}</div>\n        <div class="job-card-stats">${r}</div>\n        <div class="job-card-status">${i}</div>\n        <div class="job-card-actions">\n          <button class="btn-icon btn-edit" data-row="${e._rowIndex}" title="ç·¨é›†">\n            <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\n          </button>\n          <button class="btn-icon btn-duplicate" data-row="${e._rowIndex}" title="è¤‡è£½">\n            <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>\n          </button>\n        </div>\n      </div>\n    `}).join(""),e.querySelectorAll(".btn-edit").forEach(e=>{e.addEventListener("click",()=>{ke(parseInt(e.dataset.row,10))})}),e.querySelectorAll(".btn-duplicate").forEach(e=>{e.addEventListener("click",()=>{!function(e){var t;const n=null==(t=l)?void 0:t.find(t=>t._rowIndex===e);if(!n)return void alert("æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");a(null),s(!0);Le({...n,title:`${n.title||""} (ã‚³ãƒ”ãƒ¼)`});const o=document.getElementById("edit-job-start-date-section"),i=document.getElementById("edit-job-end-date-section");o&&(o.value="");i&&(i.value="");const c=document.getElementById("edit-job-visible-section");c&&(c.checked=!1);const d=document.getElementById("job-edit-title"),r=document.getElementById("job-edit-badge");d&&(d.textContent="æ±‚äººã®è¤‡è£½");r&&(r.textContent="è¤‡è£½",r.classList.remove("edit"));const u=document.getElementById("job-edit-delete-btn");u&&(u.style.display="none");Be()}(parseInt(e.dataset.row,10))})})}async function we(){const t=document.getElementById("jobs-list"),n=document.getElementById("jobs-tbody");if(!t&&!n)return;t&&(t.innerHTML='<div class="job-cards-loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>'),n&&(n.innerHTML='<tr><td colspan="6" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>');const a=o.gasApiUrl,s=i();try{const o=`${a}?action=getJobs&domain=${encodeURIComponent(e)}`,i=await fetch(o,{signal:s.signal});if(!i.ok)throw new Error("ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");const m=await i.json();if(!m.success)throw new Error(m.error||"æ±‚äººãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");if(c(m.jobs||[]),m.sheetUrl&&!d&&r(m.sheetUrl),m.manageSheetUrl&&!d&&r(m.manageSheetUrl),0===l.length){t&&(t.innerHTML='<div class="job-cards-loading">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'),n&&(n.innerHTML='<tr><td colspan="6" class="loading-cell">æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');const e=document.getElementById("jobs-count");return void(e&&(e.textContent="0"))}Ie(),async function(){if(!e)return;try{const n=firebase.firestore(),o=await n.collection("applications").where("companyDomain","==",e).get(),a={};o.docs.forEach(e=>{const t=e.data(),n=t.jobId||t.job_id||"";n&&(a[n]=(a[n]||0)+1)});let s={};try{const t=await y(e,30);(null==t?void 0:t.jobs)?t.jobs.forEach(e=>{const t=(e.pagePath||"").match(/job=([^&]+)/);if(t){const n=decodeURIComponent(t[1]);s[n]=(s[n]||0)+(e.views||0)}e.jobId&&(s[e.jobId]=(s[e.jobId]||0)+(e.views||0))}):(null==t?void 0:t.jobStats)?t.jobStats.forEach(e=>{const t=e.jobId||e.id||"";t&&(s[t]=e.pageViews||e.views||0)}):(null==t?void 0:t.pages)&&t.pages.forEach(e=>{var t;const n=null==(t=e.pagePath)?void 0:t.match(/job=([^&]+)/);if(n){const t=decodeURIComponent(n[1]);s[t]=(s[t]||0)+(e.views||e.pageViews||0)}})}catch(t){console.warn("Analytics APIã‹ã‚‰ã®PVå–å¾—ã«å¤±æ•—:",t)}const l={};new Set([...Object.keys(a),...Object.keys(s)]).forEach(e=>{l[e]={applications:a[e]||0,pv:s[e]||0}}),b(l),Ie()}catch(n){console.error("æ±‚äººçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚¨ãƒ©ãƒ¼:",n)}}(),u()}catch(m){if("AbortError"===m.name)return void console.log("[JobManage] ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");console.error("æ±‚äººãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",m);const e=`ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${he(m.message)}`;t&&(t.innerHTML=`<div class="job-cards-loading">${e}</div>`),n&&(n.innerHTML=`<tr><td colspan="6" class="loading-cell">${e}</td></tr>`)}}function je(){a(null),s(!0),function(){["memo","title","employment-type","location","salary","bonus","order","type","features","description","requirements","benefits","holidays","start-date","end-date"].forEach(e=>{const t=document.getElementById(`edit-job-${e}-section`);t&&(t.value="")});const e=document.getElementById("edit-job-visible-section");e&&(e.checked=!0);const t=document.getElementById("edit-job-salary-type-section");t&&(t.value="");const n=document.getElementById("edit-job-salary-other-section");n&&(n.value="");const o=document.getElementById("salary-other-group");o&&(o.style.display="none");const a=document.getElementById("working-hours-list");a&&(a.innerHTML='\n      <div class="multi-input-item">\n        <input type="text" class="working-hours-input" placeholder="ä¾‹: 8:00ã€œ17:00">\n        <button type="button" class="btn-remove-item" title="å‰Šé™¤">Ã—</button>\n      </div>\n    ',Te());document.querySelectorAll('#features-checkbox-grid input[type="checkbox"]').forEach(e=>{e.checked=!1})}();const e=document.getElementById("job-edit-title"),t=document.getElementById("job-edit-badge");e&&(e.textContent="æ–°è¦æ±‚äººä½œæˆ"),t&&(t.textContent="æ–°è¦",t.classList.remove("edit"));const n=document.getElementById("job-edit-delete-btn");n&&(n.style.display="none"),Be()}function Le(e){const t=(e,t)=>{const n=document.getElementById(`edit-job-${e}-section`);n&&(n.value=t||"")};t("memo",e.memo),t("title",e.title),t("employment-type",e.employmentType),t("location",e.location),t("bonus",e.totalBonus),t("order",e.order),t("type",e.jobType),t("description",e.jobDescription),t("requirements",e.requirements),t("benefits",e.benefits),t("holidays",e.holidays),t("start-date",m(e.publishStartDate)),t("end-date",m(e.publishEndDate));const n=document.getElementById("edit-job-salary-type-section"),o=document.getElementById("edit-job-salary-section"),a=document.getElementById("edit-job-salary-other-section"),s=document.getElementById("salary-other-group");n&&(e.salaryType?n.value=e.salaryType:e.monthlySalary?n.value="æœˆçµ¦":n.value=""),o&&(o.value=e.monthlySalary||""),a&&s&&("ãã®ä»–"===e.salaryType||e.salaryOther?(a.value=e.salaryOther||"",s.style.display="block"):(a.value="",s.style.display="none"));const l=document.getElementById("working-hours-list");if(l){const t=(e.workingHours||"").split(/[|\n]/).map(e=>e.trim()).filter(e=>e);0===t.length&&t.push(""),l.innerHTML=t.map(e=>`\n      <div class="multi-input-item">\n        <input type="text" class="working-hours-input" placeholder="ä¾‹: 8:00ã€œ17:00" value="${he(e)}">\n        <button type="button" class="btn-remove-item" title="å‰Šé™¤">Ã—</button>\n      </div>\n    `).join(""),Te()}const i=(e.features||"").split(",").map(e=>e.trim()).filter(e=>e);document.querySelectorAll('#features-checkbox-grid input[type="checkbox"]').forEach(e=>{e.checked=!1}),i.forEach(e=>{const t=document.querySelector(`#features-checkbox-grid input[value="${e}"]`);t&&(t.checked=!0)}),t("features",e.features);const c=document.getElementById("edit-job-visible-section");c&&(c.checked="true"===e.visible||"TRUE"===e.visible||!0===e.visible)}function Be(){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-job-edit");e&&e.classList.add("active");const t=document.getElementById("page-title"),n=document.querySelector(".header-actions");t&&(t.textContent="æ±‚äººç·¨é›†"),n&&(n.style.display="none")}function ke(e){var t;const n=null==(t=l)?void 0:t.find(t=>t._rowIndex===e);if(!n)return void alert("æ±‚äººãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");a(n),s(!1),Le(n);const o=document.getElementById("job-edit-title"),i=document.getElementById("job-edit-badge");o&&(o.textContent=n.title||"æ±‚äººç·¨é›†"),i&&(i.textContent="ç·¨é›†",i.classList.add("edit"));const c=document.getElementById("job-edit-delete-btn");c&&(c.style.display=""),Be()}function xe(){if(a(null),s(!1),window.switchToJobsSection)window.switchToJobsSection();else{document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const e=document.getElementById("section-jobs");e&&e.classList.add("active");const t=document.getElementById("page-title"),n=document.querySelector(".header-actions");t&&(t.textContent="æ±‚äººä¸€è¦§"),n&&(n.style.display="flex")}}async function $e(){var a,s;if(!e)return void alert("ä¼šç¤¾ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“");const l=e=>{var t,n;return(null==(n=null==(t=document.getElementById(`edit-job-${e}-section`))?void 0:t.value)?void 0:n.trim())||""},i=l("salary-type"),c=l("salary"),d=l("salary-other"),r=document.querySelectorAll("#working-hours-list .working-hours-input"),u=Array.from(r).map(e=>e.value.trim()).filter(e=>e).join(" | "),m=document.querySelectorAll('#features-checkbox-grid input[type="checkbox"]:checked'),g=Array.from(m).map(e=>e.value).join(","),p={id:t?"":(null==(a=n)?void 0:a.id)||"",memo:l("memo"),title:l("title"),employmentType:l("employment-type"),location:l("location"),salaryType:i,monthlySalary:c,salaryOther:d,totalBonus:l("bonus"),order:l("order"),jobType:l("type"),features:g,badges:"",jobDescription:l("description"),requirements:l("requirements"),benefits:l("benefits"),workingHours:u,holidays:l("holidays"),publishStartDate:l("start-date"),publishEndDate:l("end-date"),visible:(null==(s=document.getElementById("edit-job-visible-section"))?void 0:s.checked)?"true":"false"};if(!p.title||!p.location)return void alert("å‹Ÿé›†ã‚¿ã‚¤ãƒˆãƒ«ã¨å‹¤å‹™åœ°ã¯å¿…é ˆã§ã™");const y=o.gasApiUrl,b=document.getElementById("job-edit-save-btn");try{b&&(b.disabled=!0,b.textContent="ä¿å­˜ä¸­...");const o=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveJob",companyDomain:e,job:p,rowIndex:t?null:n._rowIndex})))),a=`${y}?action=post&data=${encodeURIComponent(o)}`,s=await fetch(a,{method:"GET",redirect:"follow"}),l=await s.text();let i;try{i=JSON.parse(l)}catch(v){throw console.error("JSON parse error:",v),new Error(`GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™: ${l.substring(0,200)}`)}if(!i.success)return void alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(i.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));xe(),await we(),alert(t?"æ±‚äººã‚’ä½œæˆã—ã¾ã—ãŸ":"æ±‚äººæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ")}catch(h){console.error("æ±‚äººä¿å­˜ã‚¨ãƒ©ãƒ¼:",h),alert("ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+h.message)}finally{b&&(b.disabled=!1,b.textContent="ä¿å­˜")}}async function Se(){if(!n||!e)return void alert("å‰Šé™¤å¯¾è±¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“");if(!confirm("ã“ã®æ±‚äººã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))return;const t=o.gasApiUrl,a=document.getElementById("job-edit-delete-btn");try{a&&(a.disabled=!0,a.textContent="å‰Šé™¤ä¸­...");const o=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteJob",companyDomain:e,rowIndex:n._rowIndex})))),l=`${t}?action=post&data=${encodeURIComponent(o)}`,i=await fetch(l,{method:"GET",redirect:"follow"}),c=await i.text();let d;try{d=JSON.parse(c)}catch(s){throw console.error("JSON parse error:",s),new Error("GASã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™")}if(!d.success)return void alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: "+(d.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"));xe(),await we(),alert("æ±‚äººã‚’å‰Šé™¤ã—ã¾ã—ãŸ")}catch(l){console.error("æ±‚äººå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",l),alert("å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "+l.message)}finally{a&&(a.disabled=!1,a.textContent="å‰Šé™¤")}}function Te(){const e=document.getElementById("working-hours-list");e&&e.querySelectorAll(".btn-remove-item").forEach(t=>{t.addEventListener("click",()=>{e.querySelectorAll(".multi-input-item").length>1&&t.closest(".multi-input-item").remove()})})}function De(){const e=document.getElementById("working-hours-list");if(!e)return;const t=document.createElement("div");t.className="multi-input-item",t.innerHTML='\n    <input type="text" class="working-hours-input" placeholder="ä¾‹: 8:00ã€œ17:00">\n    <button type="button" class="btn-remove-item" title="å‰Šé™¤">Ã—</button>\n  ',e.appendChild(t);t.querySelector(".btn-remove-item").addEventListener("click",()=>{e.querySelectorAll(".multi-input-item").length>1&&t.remove()}),t.querySelector("input").focus()}function Ce(){const e=document.getElementById("edit-job-salary-type-section"),t=document.getElementById("salary-other-group");e&&t&&("ãã®ä»–"===e.value?t.style.display="block":t.style.display="none")}function Me(){return l.filter(e=>("true"===e.visible||"TRUE"===e.visible||!0===e.visible)&&e.title).map(t=>({...t,company:j,companyDomain:e,companyAddress:t.location||""}))}function Ae(){const e=document.getElementById("feed-status");e&&(e.style.display="flex")}function He(){const e=document.getElementById("feed-status");e&&(e.style.display="none")}async function qe(){const t=Me();if(0!==t.length)try{Ae();const n=h(t);f(n,`indeed-${e}.xml`,"application/xml")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{He()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function Pe(){const t=Me();if(0!==t.length)try{Ae();const n=E(t);f(n,`google-jobs-${e}.json`,"application/json")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{He()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function _e(){const t=Me();if(0!==t.length)try{Ae();const n=I(t);f(n,`jobbox-${e}.xml`,"application/xml")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{He()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}async function Re(){const t=Me();if(0!==t.length)try{Ae();const n=w(t);f(n,`jobs-${e}.csv`,"text/csv;charset=utf-8")}catch(n){alert("ãƒ•ã‚£ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+n.message)}finally{He()}else alert("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“")}function Ue(){const e=document.getElementById("analytics-start-date"),t=document.getElementById("analytics-end-date"),n=document.querySelectorAll(".date-preset-btn");if(!e||!t)return;const o=new Date,a=new Date(o);a.setDate(o.getDate()-29),t.value=Oe(o),e.value=Oe(a),t.max=Oe(o),e.max=Oe(o),n.forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.preset,{start:s,end:l}=function(e){const t=new Date;let n,o;switch(e){case"7days":o=new Date(t),n=new Date(t),n.setDate(t.getDate()-6);break;case"30days":default:o=new Date(t),n=new Date(t),n.setDate(t.getDate()-29);break;case"90days":o=new Date(t),n=new Date(t),n.setDate(t.getDate()-89)}return{start:n,end:o}}(a);e.value=Oe(s),t.value=Oe(l),n.forEach(e=>e.classList.remove("active")),o.classList.add("active")})}),e.addEventListener("change",()=>{n.forEach(e=>e.classList.remove("active"))}),t.addEventListener("change",()=>{n.forEach(e=>e.classList.remove("active"))})}function Oe(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function Je(){const e=document.getElementById("analytics-start-date"),t=document.getElementById("analytics-end-date");if(!(null==e?void 0:e.value)||!(null==t?void 0:t.value))return 30;const n=new Date(e.value),o=new Date(t.value),a=Math.abs(o-n);return Math.ceil(a/864e5)+1}async function Ve(){const t=Je(),n=document.getElementById("job-analytics-tbody"),o=document.getElementById("source-analytics-tbody"),a=document.getElementById("device-analytics-tbody");n&&(n.innerHTML='<tr><td colspan="5" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</td></tr>'),o&&(o.innerHTML='<tr><td colspan="3" class="loading-cell">èª­ã¿è¾¼ã¿ä¸­...</td></tr>'),a&&(a.innerHTML='<tr><td colspan="3" class="loading-cell">èª­ã¿è¾¼ã¿ä¸­...</td></tr>');try{const[n,o]=await Promise.all([L(t),B(t)]);let a=null;e&&(a=await y(e,t));const s={overview:n,traffic:o,companyDetail:a};k(s),function(t){const{overview:n,traffic:o,companyDetail:a}=t;if(e&&a){const e=a.summary||{};document.getElementById("analytics-pv").textContent=(e.totalViews||0).toLocaleString(),document.getElementById("analytics-users").textContent=(e.totalUsers||0).toLocaleString(),document.getElementById("analytics-pages-per-session").textContent=e.avgJobsViewed||"-",document.getElementById("analytics-avg-time").textContent=x(e.avgSessionDuration||0)}else{document.getElementById("analytics-pv").textContent=((null==n?void 0:n.pageViews)||0).toLocaleString(),document.getElementById("analytics-users").textContent=((null==n?void 0:n.users)||0).toLocaleString();const e=(null==n?void 0:n.sessions)||0,t=(null==n?void 0:n.pageViews)||0,o=e>0?(t/e).toFixed(1):"-";document.getElementById("analytics-pages-per-session").textContent=o,document.getElementById("analytics-avg-time").textContent="-"}const s=document.getElementById("job-analytics-tbody");s&&((null==a?void 0:a.jobs)&&a.jobs.length>0?s.innerHTML=a.jobs.map(e=>`\n        <tr>\n          <td>${he(e.jobTitle||e.pagePath||"ä¸æ˜")}</td>\n          <td>${e.views||0}</td>\n          <td>${e.users||"-"}</td>\n          <td>-</td>\n          <td>-</td>\n        </tr>\n      `).join(""):s.innerHTML='\n        <tr>\n          <td colspan="5" class="loading-cell">\n            ã“ã®ä¼šç¤¾ã®æ±‚äººåˆ¥ãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚<br>\n            <small>â€» GA4ã§ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆview_job_detailï¼‰ã®è¨­å®šãŒå¿…è¦ã§ã™</small>\n          </td>\n        </tr>\n      ');const l=document.getElementById("source-analytics-tbody");if(l)if(e&&(null==a?void 0:a.traffic)&&a.traffic.length>0){const e=a.traffic,t=e.reduce((e,t)=>e+(t.count||0),0);l.innerHTML=e.slice(0,10).map(e=>{const n=t>0?Math.round(e.count/t*100):0;return`\n          <tr>\n            <td>${he(e.channel||"ä¸æ˜")}</td>\n            <td>${e.count||0}</td>\n            <td>${n}%</td>\n          </tr>\n        `}).join("")}else{const e=(null==o?void 0:o.sources)||[];if(e.length>0){const t=e.reduce((e,t)=>e+(t.sessions||0),0);l.innerHTML=e.slice(0,10).map(e=>{const n=t>0?Math.round(e.sessions/t*100):0;return`\n            <tr>\n              <td>${he(e.source||"(direct)")}</td>\n              <td>${e.sessions||0}</td>\n              <td>${n}%</td>\n            </tr>\n          `}).join("")}else if((null==o?void 0:o.channels)&&o.channels.length>0){const e=o.channels.reduce((e,t)=>e+(t.sessions||0),0);l.innerHTML=o.channels.map(t=>{const n=e>0?Math.round(t.sessions/e*100):0;return`\n            <tr>\n              <td>${he(t.channel||"ä¸æ˜")}</td>\n              <td>${t.sessions||0}</td>\n              <td>${n}%</td>\n            </tr>\n          `}).join("")}else l.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}const i=document.getElementById("device-analytics-tbody");if(i){const t=e&&(null==a?void 0:a.devices)?a.devices:(null==o?void 0:o.devices)||[];if(t.length>0){const e=t.reduce((e,t)=>e+(t.sessions||0),0);i.innerHTML=t.map(t=>{const n=e>0?Math.round(t.sessions/e*100):0;return`\n          <tr>\n            <td>${he($(t.device))}</td>\n            <td>${t.sessions||0}</td>\n            <td>${n}%</td>\n          </tr>\n        `}).join("")}else i.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>'}const c=document.getElementById("analytics-demographics");c&&(e&&a?(c.style.display="block",S(a.gender,a.age,{maleBarId:"gender-bar-male",femaleBarId:"gender-bar-female",malePercentId:"gender-male-percent",femalePercentId:"gender-female-percent",ageContainerId:"age-bars"})):c.style.display="none")}(s)}catch(s){console.error("ã‚¢ã‚¯ã‚»ã‚¹è§£æãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",s),function(){document.getElementById("analytics-pv").textContent="- (æœªé€£æº)",document.getElementById("analytics-users").textContent="-",document.getElementById("analytics-pages-per-session").textContent="-",document.getElementById("analytics-avg-time").textContent="-";const e=document.getElementById("job-analytics-tbody");e&&(e.innerHTML='\n      <tr>\n        <td colspan="5" class="loading-cell">\n          ã‚¢ã‚¯ã‚»ã‚¹è§£æãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>\n          Google Analyticsã¨ã®é€£æºã‚’è¨­å®šã™ã‚‹ã¨ã€è©³ç´°ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚\n        </td>\n      </tr>\n    ');const t=document.getElementById("source-analytics-tbody");t&&(t.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>');const n=document.getElementById("device-analytics-tbody");n&&(n.innerHTML='<tr><td colspan="3" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>')}()}}let Xe=null,Fe=null,Ge=null,Ne=null,ze=null;function We(){const t=document.querySelectorAll("#jm-analytics-tabs .analytics-tab"),n=document.querySelectorAll("#section-analytics .analytics-tab-content");t.forEach(o=>{o.addEventListener("click",()=>{const a=o.dataset.tab;t.forEach(e=>e.classList.remove("active")),o.classList.add("active"),n.forEach(e=>e.classList.remove("active"));const s=document.getElementById(a);s&&(s.classList.add("active"),async function(t){const n=Je();switch(t){case"jm-conversion-tab":await async function(t){if(!e)return;try{Ze(await T("funnel",{domain:e,days:t}))}catch(n){console.error("å¿œå‹Ÿãƒ»CVRãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",n),Ze({funnel:[{stage:"ãƒšãƒ¼ã‚¸é–²è¦§",count:500,rate:"100"},{stage:"ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«",count:350,rate:"70.0"},{stage:"ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯",count:25,rate:"5.0"}],actionBreakdown:[{label:"å¿œå‹Ÿãƒœã‚¿ãƒ³",count:15},{label:"LINEç›¸è«‡",count:8},{label:"ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡",count:2}],byJob:[{title:"è£½é€ ã‚¹ã‚¿ãƒƒãƒ•",views:200,clicks:12,cvr:"6.0"},{title:"çµ„ç«‹ä½œæ¥­å“¡",views:150,clicks:8,cvr:"5.3"},{title:"æ¤œæŸ»ãƒ»æ¤œå“",views:100,clicks:5,cvr:"5.0"}],applications:[]})}}(n);break;case"jm-traffic-tab":await async function(t){if(!e)return;try{const[n,o]=await Promise.all([T("engagement",{domain:e,days:t}),T("traffic",{domain:e,days:t})]);Ye({engagement:n,traffic:o})}catch(n){console.error("æµå…¥ãƒ»è¡Œå‹•ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",n),Ye({engagement:{overall:{avgSessionDuration:45,engagementRate:68,bounceRate:32},byJob:[{title:"è£½é€ ã‚¹ã‚¿ãƒƒãƒ•",views:200,engagementTime:900,avgTimePerView:"4.5"},{title:"çµ„ç«‹ä½œæ¥­å“¡",views:150,engagementTime:600,avgTimePerView:"4.0"}]},traffic:{channels:[{channel:"Organic Search",sessions:250},{channel:"Direct",sessions:180},{channel:"Social",sessions:50},{channel:"Referral",sessions:20}],sources:[{source:"google",medium:"organic",sessions:180,users:150},{source:"(direct)",medium:"(none)",sessions:120,users:100},{source:"yahoo",medium:"organic",sessions:50,users:45}]}})}}(n);break;case"jm-trends-tab":await async function(t){if(!e)return;try{Qe(await T("trends",{domain:e,days:t}))}catch(n){console.error("æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",n),Qe({insights:{peakDay:"æœ¨",peakHour:"14æ™‚"},byDayOfWeek:[{day:"æ—¥",sessions:38},{day:"æœˆ",sessions:52},{day:"ç«",sessions:48},{day:"æ°´",sessions:55},{day:"æœ¨",sessions:60},{day:"é‡‘",sessions:50},{day:"åœŸ",sessions:42}],byHour:Array.from({length:24},(e,t)=>({hour:t,sessions:Math.floor(20*Math.random())+5})),daily:Array.from({length:30},(e,t)=>{const n=new Date;return n.setDate(n.getDate()-(29-t)),{date:`${n.getMonth()+1}/${n.getDate()}`,views:Math.floor(30*Math.random())+10}})})}}(n)}}(a))})})}function Ze(e){const t=document.getElementById("jm-funnel-chart");t&&e.funnel&&e.funnel.length>0?t.innerHTML=e.funnel.map(e=>`\n      <div class="funnel-stage">\n        <span class="funnel-stage-name">${he(e.stage)}</span>\n        <span class="funnel-stage-count">${e.count.toLocaleString()}</span>\n        <span class="funnel-stage-rate">${e.rate}%</span>\n      </div>\n    `).join(""):t&&(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=document.getElementById("jm-action-breakdown-chart");if(n&&e.actionBreakdown&&e.actionBreakdown.length>0){ze&&(ze.destroy(),ze=null),n.innerHTML='<canvas id="jm-action-canvas"></canvas>';const t=document.getElementById("jm-action-canvas").getContext("2d");ze=new Chart(t,{type:"bar",data:{labels:e.actionBreakdown.map(e=>e.label),datasets:[{label:"ä»¶æ•°",data:e.actionBreakdown.map(e=>e.count),backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(245, 158, 11, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"}},y:{grid:{display:!1}}}}})}else n&&(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const o=document.getElementById("jm-job-cvr-tbody");o&&e.byJob&&e.byJob.length>0?o.innerHTML=e.byJob.map(e=>`\n      <tr>\n        <td>${he(e.title||e.jobId||"-")}</td>\n        <td>${e.views.toLocaleString()}</td>\n        <td>${e.clicks}</td>\n        <td>${e.cvr}%</td>\n      </tr>\n    `).join(""):o&&(o.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');const a=document.getElementById("jm-applications-tbody"),s={apply:"å¿œå‹Ÿãƒœã‚¿ãƒ³",line:"LINEç›¸è«‡",consult:"ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ "};a&&e.applications&&e.applications.length>0?a.innerHTML=e.applications.map(e=>`\n      <tr>\n        <td>${he(e.date)}</td>\n        <td>${he(e.jobTitle||"-")}</td>\n        <td><span class="type-badge ${he(e.type)}">${s[e.type]||he(e.type)}</span></td>\n        <td>${he(e.source)}</td>\n      </tr>\n    `).join(""):a&&(a.innerHTML='<tr><td colspan="4" class="loading-cell">å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}function Ye(e){const{engagement:t,traffic:n}=e,o=(null==t?void 0:t.overall)||{};document.getElementById("jm-avg-session-duration").textContent=`${o.avgSessionDuration||0}ç§’`,document.getElementById("jm-engagement-rate").textContent=`${o.engagementRate||0}%`,document.getElementById("jm-bounce-rate").textContent=`${o.bounceRate||0}%`;const a=document.getElementById("jm-channel-chart");if(a&&(null==n?void 0:n.channels)&&n.channels.length>0){Ne&&(Ne.destroy(),Ne=null),a.innerHTML='<canvas id="jm-channel-canvas"></canvas>';const e=document.getElementById("jm-channel-canvas").getContext("2d");Ne=new Chart(e,{type:"bar",data:{labels:n.channels.map(e=>e.channel),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:n.channels.map(e=>e.sessions),backgroundColor:["rgba(99, 102, 241, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(139, 92, 246, 0.8)"],borderWidth:0,borderRadius:4}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"}},y:{grid:{display:!1}}}}})}else a&&(a.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const s=document.getElementById("jm-source-tbody");s&&(null==n?void 0:n.sources)&&n.sources.length>0?s.innerHTML=n.sources.slice(0,10).map(e=>`\n      <tr>\n        <td>${he(e.source||"(direct)")}</td>\n        <td>${he(e.medium||"(none)")}</td>\n        <td>${e.sessions.toLocaleString()}</td>\n        <td>${e.users.toLocaleString()}</td>\n      </tr>\n    `).join(""):s&&(s.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>');const l=document.getElementById("jm-engagement-tbody");l&&(null==t?void 0:t.byJob)&&t.byJob.length>0?l.innerHTML=t.byJob.map(e=>`\n      <tr>\n        <td>${he(e.title||e.jobId||"-")}</td>\n        <td>${e.views.toLocaleString()}</td>\n        <td>${Math.round(e.engagementTime)}ç§’</td>\n        <td>${e.avgTimePerView}ç§’</td>\n      </tr>\n    `).join(""):l&&(l.innerHTML='<tr><td colspan="4" class="loading-cell">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>')}function Qe(e){e.insights&&(document.getElementById("jm-peak-day").textContent=e.insights.peakDay||"-",document.getElementById("jm-peak-hour").textContent=e.insights.peakHour||"-");const t=document.getElementById("jm-day-of-week-chart");if(t&&e.byDayOfWeek&&e.byDayOfWeek.length>0){Fe&&(Fe.destroy(),Fe=null),t.innerHTML='<canvas id="jm-day-of-week-canvas"></canvas>';const n=document.getElementById("jm-day-of-week-canvas").getContext("2d");Fe=new Chart(n,{type:"bar",data:{labels:e.byDayOfWeek.map(e=>e.day),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:e.byDayOfWeek.map(e=>e.sessions),backgroundColor:"rgba(99, 102, 241, 0.8)",borderColor:"rgba(99, 102, 241, 1)",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"}},x:{grid:{display:!1}}}}})}else t&&(t.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const n=document.getElementById("jm-hour-chart");if(n&&e.byHour&&e.byHour.length>0){Ge&&(Ge.destroy(),Ge=null);const t=[{label:"æ·±å¤œ",hours:[0,1,2,3,4,5]},{label:"æœ",hours:[6,7,8,9,10,11]},{label:"æ˜¼",hours:[12,13,14,15,16,17]},{label:"å¤œ",hours:[18,19,20,21,22,23]}].map(t=>{const n=t.hours.reduce((t,n)=>{const o=e.byHour.find(e=>e.hour===n);return t+(o?o.sessions:0)},0);return{label:t.label,sessions:n}});n.innerHTML='<canvas id="jm-hour-canvas"></canvas>';const o=document.getElementById("jm-hour-canvas").getContext("2d");Ge=new Chart(o,{type:"bar",data:{labels:t.map(e=>e.label),datasets:[{label:"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°",data:t.map(e=>e.sessions),backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"}},x:{grid:{display:!1}}}}})}else n&&(n.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>');const o=document.getElementById("jm-daily-chart");if(o&&e.daily&&e.daily.length>0){Xe&&(Xe.destroy(),Xe=null),o.innerHTML='<canvas id="jm-daily-canvas"></canvas>';const t=document.getElementById("jm-daily-canvas").getContext("2d");Xe=new Chart(t,{type:"line",data:{labels:e.daily.map(e=>e.date),datasets:[{label:"PV",data:e.daily.map(e=>e.views),borderColor:"rgba(99, 102, 241, 1)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.3,pointRadius:2,pointBackgroundColor:"rgba(99, 102, 241, 1)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(226, 232, 240, 0.8)"}},x:{grid:{display:!1},ticks:{maxRotation:45}}}}})}else o&&(o.innerHTML='<div class="loading-placeholder">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>')}async function Ke(t,n){if(!e)return[];try{const o=firebase.firestore();return(await o.collection("applications").where("companyDomain","==",e).where("createdAt",">=",t).where("createdAt","<=",n).orderBy("createdAt","desc").get()).docs.map(e=>{var t,n;return{id:e.id,...e.data(),createdAt:(null==(n=null==(t=e.data().createdAt)?void 0:t.toDate)?void 0:n.call(t))||new Date(e.data().createdAt)}})}catch(o){return console.error("å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",o),[]}}async function et(e,t){const n=t.getTime()-e.getTime(),o=new Date(e.getTime()-1),a=new Date(o.getTime()-n);return await Ke(a,o)}function tt(e){const t={new:"æ–°è¦",contacted:"é€£çµ¡æ¸ˆ",interviewing:"é¢æ¥ä¸­",hired:"æ¡ç”¨",rejected:"ä¸æ¡ç”¨",withdrawn:"è¾é€€"},n={};Object.values(t).forEach(e=>{n[e]=0}),e.forEach(e=>{const o=e.status||"new",a=t[o]||"æ–°è¦";n[a]=(n[a]||0)+1});const o=e.length;return Object.entries(n).map(([e,t])=>({status:e,count:t,percentage:o>0?Math.round(t/o*100):0}))}function nt(e){const t={google:"Googleæ¤œç´¢",indeed:"Indeed",jobbox:"æ±‚äººãƒœãƒƒã‚¯ã‚¹",direct:"ç›´æ¥æµå…¥",line:"LINE",other:"ãã®ä»–"},n={};e.forEach(e=>{let o=e.source||e.utmSource||"other";o=o.includes("google")?"google":o.includes("indeed")?"indeed":o.includes("jobbox")||o.includes("stanby")?"jobbox":o.includes("line")?"line":"direct"===o||"(direct)"===o?"direct":"other";const a=t[o]||"ãã®ä»–";n[a]=(n[a]||0)+1});const o=e.length;return Object.entries(n).map(([e,t])=>({source:e,count:t,percentage:o>0?Math.round(t/o*100):0})).sort((e,t)=>t.count-e.count)}function ot(e){const t={};return e.forEach(e=>{const n=e.assignee||"æœªå‰²å½“";t[n]||(t[n]={assignee:n,handled:0,pending:0});"new"===(e.status||"new")?t[n].pending++:t[n].handled++}),Object.values(t).sort((e,t)=>t.handled-e.handled)}function at(e){const{applications:t,comparison:n,period:o}=e,a=t.length,s=n.length,i=s>0?Math.round((a-s)/s*100):0,c=i>=0?`+${i}%`:`${i}%`,d=t.filter(e=>"hired"===e.status).length,r=t.filter(e=>"new"===e.status||"contacted"===e.status).length;document.getElementById("summary-total").textContent=a,document.getElementById("summary-change").textContent=c,document.getElementById("summary-change").className="summary-value "+(i>=0?"positive":"negative"),document.getElementById("summary-hired").textContent=d,document.getElementById("summary-pending").textContent=r;const u=tt(t);document.getElementById("status-breakdown").innerHTML=u.map(e=>`\n    <tr>\n      <td>${he(e.status)}</td>\n      <td>${e.count}</td>\n      <td>${e.percentage}%</td>\n    </tr>\n  `).join("");const m=function(e){const t={};return e.forEach(e=>{const n=e.jobId||"unknown",o=e.jobTitle||"ä¸æ˜ãªæ±‚äºº";t[n]||(t[n]={jobId:n,jobTitle:o,count:0}),t[n].count++}),Object.values(t).sort((e,t)=>t.count-e.count).slice(0,5)}(t),g=document.getElementById("job-performance");0===m.length?g.innerHTML='<tr><td colspan="4">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>':g.innerHTML=m.map(e=>{const t=l.find(t=>t.id===e.jobId),n=(null==t?void 0:t.pageViews)||"-",o="-"!==n&&n>0?(e.count/n*100).toFixed(1)+"%":"-";return`\n        <tr>\n          <td>${he(e.jobTitle)}</td>\n          <td>${e.count}</td>\n          <td>${n}</td>\n          <td>${o}</td>\n        </tr>\n      `}).join("");const p=nt(t),y=document.getElementById("source-breakdown");0===p.length?y.innerHTML='<tr><td colspan="3">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>':y.innerHTML=p.map(e=>`\n      <tr>\n        <td>${he(e.source)}</td>\n        <td>${e.count}</td>\n        <td>${e.percentage}%</td>\n      </tr>\n    `).join("");const b=ot(t),v=document.getElementById("assignee-breakdown");0===b.length?v.innerHTML='<tr><td colspan="3">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>':v.innerHTML=b.map(e=>`\n      <tr>\n        <td>${he(e.assignee)}</td>\n        <td>${e.handled}</td>\n        <td>${e.pending}</td>\n      </tr>\n    `).join(""),document.getElementById("report-empty").style.display="none",document.getElementById("report-content").style.display="block",document.getElementById("report-actions").style.display="flex"}async function st(){const e=document.getElementById("report-period").value;let t,n;if("custom"===e){const e=document.getElementById("report-from"),o=document.getElementById("report-to");if(!e.value||!o.value)return void alert("é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’æŒ‡å®šã—ã¦ãã ã•ã„");t=new Date(e.value),t.setHours(0,0,0,0),n=new Date(o.value),n.setHours(23,59,59,999)}else{const o=function(e){const t=new Date;let n,o;switch(e){case"week":{const e=t.getDay();n=new Date(t),n.setDate(t.getDate()-e),n.setHours(0,0,0,0),o=new Date(t),o.setHours(23,59,59,999);break}case"last-week":{const e=t.getDay();o=new Date(t),o.setDate(t.getDate()-e-1),o.setHours(23,59,59,999),n=new Date(o),n.setDate(o.getDate()-6),n.setHours(0,0,0,0);break}case"month":n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t),o.setHours(23,59,59,999);break;case"last-month":n=new Date(t.getFullYear(),t.getMonth()-1,1),o=new Date(t.getFullYear(),t.getMonth(),0,23,59,59,999);break;default:n=new Date(t.getFullYear(),t.getMonth(),1),o=new Date(t)}return{start:n,end:o}}(e);t=o.start,n=o.end}document.getElementById("report-loading").style.display="flex",document.getElementById("report-empty").style.display="none",document.getElementById("report-content").style.display="none",document.getElementById("report-actions").style.display="none";try{const[e,o]=await Promise.all([Ke(t,n),et(t,n)]);D(e),C({applications:e,comparison:o,period:{start:t,end:n}}),at(M)}catch(o){console.error("ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:",o),alert("ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: "+o.message)}finally{document.getElementById("report-loading").style.display="none"}}function lt(){if(!M||!M.applications.length)return void alert("ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");const{applications:t,period:n}=M,o=[["å¿œå‹Ÿæ—¥æ™‚","æ±‚äººã‚¿ã‚¤ãƒˆãƒ«","æ°å","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","æµå…¥å…ƒ","æ‹…å½“è€…"],...t.map(e=>[e.createdAt?new Date(e.createdAt).toLocaleString("ja-JP"):"",e.jobTitle||"",e.name||"",e.status||"new",e.source||e.utmSource||"",e.assignee||""])].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),a=new Blob(["\ufeff"+o],{type:"text/csv;charset=utf-8"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s;const i=n.start.toISOString().split("T")[0],c=n.end.toISOString().split("T")[0];l.download=`report-${e}-${i}-${c}.csv`,l.click(),URL.revokeObjectURL(s)}function it(){if(!M||!M.applications.length)return void alert("ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");if("undefined"==typeof XLSX)return void alert("Excelãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“");const{applications:t,period:n}=M,o=XLSX.utils.book_new(),a=[["ãƒ¬ãƒãƒ¼ãƒˆæœŸé–“",`${n.start.toLocaleDateString("ja-JP")} ã€œ ${n.end.toLocaleDateString("ja-JP")}`],["ä¼šç¤¾",j],[""],["ç·å¿œå‹Ÿæ•°",t.length],["æ¡ç”¨æ•°",t.filter(e=>"hired"===e.status).length],["å¯¾å¿œä¸­",t.filter(e=>"new"===e.status||"contacted"===e.status).length]],s=XLSX.utils.aoa_to_sheet(a);XLSX.utils.book_append_sheet(o,s,"ã‚µãƒãƒªãƒ¼");const l=t.map(e=>[e.createdAt?new Date(e.createdAt).toLocaleString("ja-JP"):"",e.jobTitle||"",e.name||"",e.phone||"",e.email||"",e.status||"new",e.source||e.utmSource||"",e.assignee||""]),i=XLSX.utils.aoa_to_sheet([["å¿œå‹Ÿæ—¥æ™‚","æ±‚äººã‚¿ã‚¤ãƒˆãƒ«","æ°å","é›»è©±ç•ªå·","ãƒ¡ãƒ¼ãƒ«","ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","æµå…¥å…ƒ","æ‹…å½“è€…"],...l]);XLSX.utils.book_append_sheet(o,i,"å¿œå‹Ÿä¸€è¦§");const c=tt(t).map(e=>[e.status,e.count,`${e.percentage}%`]),d=XLSX.utils.aoa_to_sheet([["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹","ä»¶æ•°","å‰²åˆ"],...c]);XLSX.utils.book_append_sheet(o,d,"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥");const r=nt(t).map(e=>[e.source,e.count,`${e.percentage}%`]),u=XLSX.utils.aoa_to_sheet([["æµå…¥å…ƒ","ä»¶æ•°","å‰²åˆ"],...r]);XLSX.utils.book_append_sheet(o,u,"æµå…¥å…ƒåˆ¥");const m=ot(t).map(e=>[e.assignee,e.handled,e.pending]),g=XLSX.utils.aoa_to_sheet([["æ‹…å½“è€…","å¯¾å¿œæ¸ˆ","æœªå¯¾å¿œ"],...m]);XLSX.utils.book_append_sheet(o,g,"æ‹…å½“è€…åˆ¥");const p=n.start.toISOString().split("T")[0],y=n.end.toISOString().split("T")[0];XLSX.writeFile(o,`report-${e}-${p}-${y}.xlsx`)}function ct(){console.log("[LPè¨­å®š] initCompanyLPSettings é–‹å§‹"),A(H,{getCompanyDomain:()=>e}),q(),P(),_();const t=document.getElementById("btn-save-lp-settings");t&&t.addEventListener("click",()=>{R()});const n=document.getElementById("btn-reset-lp-settings");n&&n.addEventListener("click",()=>{confirm("LPè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")&&gt()});const o=document.getElementById("btn-toggle-preview");o&&o.addEventListener("click",U);const a=document.getElementById("btn-close-preview");a&&a.addEventListener("click",O);const s=document.getElementById("lp-back-to-jobs");s&&s.addEventListener("click",()=>{const e=document.getElementById("lp-job-select-group"),t=document.getElementById("lp-editor");e&&(e.style.display="block"),t&&(t.style.display="none"),dt("job")}),document.querySelectorAll(".preview-device-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".preview-device-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active");const t=e.dataset.device,n=document.querySelector(".lp-preview-frame-wrapper");n&&n.setAttribute("data-device",t)})}),["lp-hero-title","lp-hero-subtitle","lp-hero-image","lp-cta-text","lp-faq","lp-tiktok-pixel","lp-google-ads-id","lp-google-ads-label","lp-ogp-title","lp-ogp-description","lp-ogp-image","lp-video-url"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",()=>V())}),document.querySelectorAll('input[name="design-pattern"]').forEach(e=>{e.addEventListener("change",()=>V())}),document.querySelectorAll(".collapsible-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t),o=e.querySelector(".collapse-icon");if(n){const e="none"!==n.style.display;n.style.display=e?"none":"block",o&&(o.textContent=e?"â–¶":"â–¼")}})}),J(),oe(!0)}function dt(e){const t=document.querySelectorAll(".lp-step"),n=["job","edit"],o=n.indexOf(e);t.forEach(e=>{const t=e.dataset.step,a=n.indexOf(t);e.classList.remove("active","completed"),a<o?e.classList.add("completed"):a===o&&e.classList.add("active")})}async function rt(){N||ct(),console.log("[LPè¨­å®š] loadCompanyLPSettings é–‹å§‹, companyDomain:",e),await async function(){const t=document.getElementById("lp-job-grid"),n=document.getElementById("lp-job-select");t&&(t.innerHTML='<div class="lp-loading-placeholder">æ±‚äººã‚’èª­ã¿è¾¼ã¿ä¸­...</div>');try{if(l.length>0){const t=l.map(t=>({id:`${e}_${t.jobId||t.id}`,jobId:t.jobId||t.id,title:t.title||t.å‹Ÿé›†ã‚¿ã‚¤ãƒˆãƒ«||"(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)",company:j,companyDomain:e,sheetUrl:d,rawData:t}));if(z(t),function(t){const n=document.getElementById("lp-job-grid");if(!n)return;if(0===t.length)return void(n.innerHTML='<div class="lp-no-results"><p>æ±‚äººãŒã‚ã‚Šã¾ã›ã‚“</p></div>');n.innerHTML=t.map(e=>`\n    <div class="lp-job-card" data-job-id="${he(e.id)}">\n      <div class="lp-job-title">${he(e.title)}</div>\n      <div class="lp-job-id">ID: ${he(e.jobId)}</div>\n      <div class="lp-job-actions">\n        <button type="button" class="lp-job-action-btn primary lp-select-job-btn">LPè¨­å®šã‚’ç·¨é›†</button>\n        <a href="lp.html?j=${encodeURIComponent(e.id)}" target="_blank" class="lp-job-action-btn secondary">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</a>\n      </div>\n    </div>\n  `).join(""),n.querySelectorAll(".lp-select-job-btn").forEach(t=>{t.addEventListener("click",async o=>{o.stopPropagation();const a=t.closest(".lp-job-card"),s=a.dataset.jobId;n.querySelectorAll(".lp-job-card").forEach(e=>e.classList.remove("selected")),a.classList.add("selected");const l=document.getElementById("lp-job-select");l&&(l.value=s),W(Z.find(e=>e.id===s)),await async function(t){console.log("[LPè¨­å®š] loadLPSettingsForJob:",t);const n=document.getElementById("lp-preview-btn"),a=document.getElementById("lp-edit-mode-btn");if(!t)return;ut(!0),n&&(n.href=`lp.html?j=${encodeURIComponent(t)}`);a&&(a.href=`lp.html?j=${encodeURIComponent(t)}&edit`);Y(),Q(e);const s=document.querySelector('input[name="design-pattern"][value="standard"]');s&&(s.checked=!0);try{if(await async function(){if(d)return d;try{let t=te();t&&0!==t.length||(await ne(),t=te());const n=t.find(t=>t.companyDomain===e);if(n){const e=n.manageSheetUrl||n.jobsSheet||null;r(e),console.log("[LPè¨­å®š] company-managerã‹ã‚‰å–å¾—ã—ãŸsheetUrl:",e)}else console.warn("[LPè¨­å®š] ä¼šç¤¾ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:",e)}catch(o){console.warn("[LPè¨­å®š] ä¼šç¤¾æƒ…å ±ã®å–å¾—ã«å¤±æ•—:",o)}return d}(),!d)return console.log("[LPè¨­å®š] ç®¡ç†ã‚·ãƒ¼ãƒˆURLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),void gt();let n=null;const a=d.match(/\/d\/([a-zA-Z0-9_-]+)/);if(a?n=a[1]:/^[a-zA-Z0-9_-]+$/.test(d)&&(n=d),!n)return console.log("[LPè¨­å®š] ç®¡ç†ã‚·ãƒ¼ãƒˆIDã‚’æŠ½å‡ºã§ãã¾ã›ã‚“"),void gt();const s=Date.now(),l=`https://docs.google.com/spreadsheets/d/${n}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent("LPè¨­å®š")}&_t=${s}`,i=await fetch(l,{cache:"no-store"});if(i.ok){const e=function(e,t){const n=function(e){const t=[];let n="",o=!1;for(let a=0;a<e.length;a++){const s=e[a];if('"'===s)'"'===e[a+1]?(n+='""',a++):(o=!o,n+=s);else if("\n"!==s||o){if("\r"===s)continue;n+=s}else n.trim()&&t.push(n),n=""}n.trim()&&t.push(n);return t}(e),o=fe(n[0]||"");for(let a=1;a<n.length;a++){if(!n[a].trim())continue;const e=fe(n[a]),s={};o.forEach((t,n)=>{const o=t.replace(/"/g,"").trim();s[o]=e[n]||""});if((s.jobId||s["æ±‚äººID"]||"")===t){const e={heroTitle:s.heroTitle||s["ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«"]||"",heroSubtitle:s.heroSubtitle||s["ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«"]||"",heroImage:s.heroImage||s["ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒ"]||"",ctaText:s.ctaText||s["CTAãƒ†ã‚­ã‚¹ãƒˆ"]||"",faq:s.faq||s.FAQ||"",designPattern:s.designPattern||s["ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³"]||"",layoutStyle:s.layoutStyle||s["ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¹ã‚¿ã‚¤ãƒ«"]||"default",sectionOrder:s.sectionOrder||s["ã‚»ã‚¯ã‚·ãƒ§ãƒ³é †åº"]||"",sectionVisibility:s.sectionVisibility||s["ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º"]||"",tiktokPixelId:s.tiktokPixelId||s["TikTok Pixel ID"]||"",googleAdsId:s.googleAdsId||s["Google Ads ID"]||"",googleAdsLabel:s.googleAdsLabel||s["Google Ads ãƒ©ãƒ™ãƒ«"]||"",ogpTitle:s.ogpTitle||s["OGPã‚¿ã‚¤ãƒˆãƒ«"]||"",ogpDescription:s.ogpDescription||s["OGPèª¬æ˜æ–‡"]||"",ogpImage:s.ogpImage||s["OGPç”»åƒ"]||"",showVideoButton:s.showVideoButton||s["å‹•ç”»ãƒœã‚¿ãƒ³è¡¨ç¤º"]||"",videoUrl:s.videoUrl||s["å‹•ç”»URL"]||"",lpContent:s.lpContent||s["LPæ§‹æˆ"]||"",customPrimary:s.customPrimary||s["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰"]||"",customAccent:s.customAccent||s["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼‰"]||"",customBg:s.customBg||s["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆèƒŒæ™¯ï¼‰"]||"",customText:s.customText||s["ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰"]||""};for(let t=1;t<=6;t++)e[`pointTitle${t}`]=s[`pointTitle${t}`]||s[`ãƒã‚¤ãƒ³ãƒˆ${t}ã‚¿ã‚¤ãƒˆãƒ«`]||"",e[`pointDesc${t}`]=s[`pointDesc${t}`]||s[`ãƒã‚¤ãƒ³ãƒˆ${t}èª¬æ˜`]||"";return e}}return null}(await i.text(),t);if(e){mt("lp-hero-title",e.heroTitle),mt("lp-hero-subtitle",e.heroSubtitle),mt("lp-hero-image",e.heroImage),mt("lp-cta-text",e.ctaText||"ä»Šã™ãå¿œå‹Ÿã™ã‚‹"),mt("lp-faq",e.faq),mt("lp-tiktok-pixel",e.tiktokPixelId),mt("lp-google-ads-id",e.googleAdsId),mt("lp-google-ads-label",e.googleAdsLabel),mt("lp-ogp-title",e.ogpTitle),mt("lp-ogp-description",e.ogpDescription),mt("lp-ogp-image",e.ogpImage);const t=document.getElementById("lp-show-video-button"),n=document.getElementById("video-url-group");if(t&&(t.checked="true"===String(e.showVideoButton).toLowerCase()||!0===e.showVideoButton,n&&(n.style.display=t.checked?"block":"none")),mt("lp-video-url",e.videoUrl),e.designPattern){const t=document.querySelector(`input[name="design-pattern"][value="${e.designPattern}"]`);t&&(t.checked=!0)}return K({primary:e.customPrimary||"",accent:e.customAccent||"",bg:e.customBg||"",text:e.customText||""}),F(e.heroImage||""),ee(e.heroImage||""),G(e),void V()}}}catch(o){console.log("[LPè¨­å®š] LPè¨­å®šã‚·ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:",o)}finally{ut(!1)}gt(),V()}(s);const i=document.getElementById("lp-job-select-group"),c=document.getElementById("lp-editor");i&&(i.style.display="none"),c&&(c.style.display="block"),dt("edit")})})}(t),n){let e='<option value="">-- æ±‚äººã‚’é¸æŠ --</option>';for(const n of t)e+=`<option value="${he(n.id)}">${he(n.title)}</option>`;n.innerHTML=e}}else t&&(t.innerHTML='<div class="lp-no-results"><p>æ±‚äººãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã¾ãšæ±‚äººã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p></div>')}catch(o){console.error("[LPè¨­å®š] æ±‚äººèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",o),t&&(t.innerHTML='<div class="lp-no-results"><p>æ±‚äººãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p></div>')}}()}function ut(e){const t=document.getElementById("lp-editor");if(!t)return;t.querySelectorAll("input, select, textarea, button").forEach(t=>{t.disabled=e});const n=document.getElementById("btn-save-lp-settings"),o=document.getElementById("btn-reset-lp-settings");n&&(n.disabled=e),o&&(o.disabled=e);const a=t.querySelector(".lp-loading-overlay");if(e){if(!a){const e=document.createElement("div");e.className="lp-loading-overlay",e.innerHTML='<div class="loading-spinner"></div><p>èª­ã¿è¾¼ã¿ä¸­...</p>',t.style.position="relative",t.appendChild(e)}}else null==a||a.remove()}function mt(e,t){const n=document.getElementById(e);n&&(n.value=t||"")}function gt(){["lp-hero-title","lp-hero-subtitle","lp-hero-image","lp-faq","lp-tiktok-pixel","lp-google-ads-id","lp-google-ads-label","lp-ogp-title","lp-ogp-description","lp-ogp-image","lp-video-url"].forEach(e=>mt(e,"")),mt("lp-cta-text","ä»Šã™ãå¿œå‹Ÿã™ã‚‹");const e=document.getElementById("lp-show-video-button"),t=document.getElementById("video-url-group");e&&(e.checked=!1),t&&(t.style.display="none");const n=document.querySelector('input[name="design-pattern"][value="standard"]');n&&(n.checked=!0),X(),F(""),G({})}function pt(){const t=document.getElementById("password-change-form");t&&t.addEventListener("submit",async n=>{n.preventDefault();const o=document.getElementById("current-password").value,a=document.getElementById("new-password").value,s=document.getElementById("confirm-password").value,l=document.getElementById("password-change-error"),i=document.getElementById("password-change-success");if(l.style.display="none",i.style.display="none",a!==s)return l.textContent="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“",void(l.style.display="block");if(a.length<8)return l.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„",void(l.style.display="block");try{const n=await async function(t,n){if("undefined"==typeof firebase||!firebase.firestore)return{success:!1,error:"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“"};const o=firebase.firestore(),a=sessionStorage.getItem("company_user_id");if(!a)try{const a=await o.collection("company_users").where("companyDomain","==",e).limit(1).get();if(a.empty)return{success:!1,error:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"};const s=a.docs[0];return s.data().password!==t?{success:!1,error:"ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"}:(await o.collection("company_users").doc(s.id).update({password:n,passwordChangedAt:firebase.firestore.FieldValue.serverTimestamp()}),{success:!0})}catch(s){return console.error("Password change error:",s),{success:!1,error:s.message}}try{const e=await o.collection("company_users").where("username","==",a).limit(1).get();if(e.empty)return{success:!1,error:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"};const s=e.docs[0];return s.data().password!==t?{success:!1,error:"ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"}:(await o.collection("company_users").doc(s.id).update({password:n,passwordChangedAt:firebase.firestore.FieldValue.serverTimestamp()}),{success:!0})}catch(s){return console.error("Password change error:",s),{success:!1,error:s.message}}}(o,a);n.success?(i.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸ",i.style.display="block",t.reset()):(l.textContent=n.error,l.style.display="block")}catch(c){console.error("Password change error:",c),l.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ",l.style.display="block"}})}function yt(t){if(ue())return void console.log("[JobManage] ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆä¸­ã®ãŸã‚ç„¡è¦–:",t);be(),document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".sidebar-nav li").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`section-${t}`);n&&n.classList.add("active"),document.querySelectorAll(".sidebar-nav a").forEach(e=>{e.dataset.section===t&&e.closest("li").classList.add("active")});const o=document.getElementById("page-title"),a=document.querySelector(".header-actions");"jobs"===t?(o&&(o.textContent=`${j} ã®æ±‚äººä¸€è¦§`),a&&(a.style.display="flex")):"analytics"===t?(o&&(o.textContent="ã‚¢ã‚¯ã‚»ã‚¹è§£æ"),a&&(a.style.display="none")):"reports"===t?(o&&(o.textContent="å¿œå‹Ÿãƒ¬ãƒãƒ¼ãƒˆ"),a&&(a.style.display="none")):"applicants"===t?(o&&(o.textContent="å¿œå‹Ÿè€…ç®¡ç†"),a&&(a.style.display="none"),me||(ge(!0),pe(e))):"lp-settings"===t?(o&&(o.textContent="LPè¨­å®š"),a&&(a.style.display="none"),rt()):"recruit-settings"===t?(o&&(o.textContent="æ¡ç”¨ãƒšãƒ¼ã‚¸è¨­å®š"),a&&(a.style.display="none"),ye(e)):"settings"===t?(o&&(o.textContent="ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š"),a&&(a.style.display="none")):"job-edit"===t&&(o&&(o.textContent="æ±‚äººç·¨é›†"),a&&(a.style.display="none")),requestAnimationFrame(()=>{ve()})}function bt(){var e,t,n,o,a,s,l,i,c,d,r,u,m,p,y;null==(e=document.getElementById("btn-add-job"))||e.addEventListener("click",je),null==(t=document.getElementById("btn-refresh"))||t.addEventListener("click",we),null==(n=document.getElementById("job-edit-back-btn"))||n.addEventListener("click",xe),null==(o=document.getElementById("job-edit-cancel-btn"))||o.addEventListener("click",xe),null==(a=document.getElementById("job-edit-delete-btn"))||a.addEventListener("click",Se),null==(s=document.getElementById("job-edit-form-section"))||s.addEventListener("submit",e=>{e.preventDefault(),$e()}),null==(l=document.getElementById("btn-download-indeed"))||l.addEventListener("click",qe),null==(i=document.getElementById("btn-download-google"))||i.addEventListener("click",Pe),null==(c=document.getElementById("btn-download-jobbox"))||c.addEventListener("click",_e),null==(d=document.getElementById("btn-download-csv"))||d.addEventListener("click",Re);const b=document.getElementById("job-search"),v=document.getElementById("job-filter-status"),h=document.getElementById("job-filter-area"),f=document.getElementById("btn-clear-filters");if(b){let e;b.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{g.search=b.value.trim(),Ie()},300)})}v&&v.addEventListener("change",()=>{g.status=v.value,Ie()}),h&&h.addEventListener("change",()=>{g.area=h.value,Ie()}),f&&f.addEventListener("click",()=>{re(),b&&(b.value=""),v&&(v.value=""),h&&(h.value=""),Ie()}),document.querySelectorAll(".sidebar-nav a[data-section]").forEach(e=>{e.addEventListener("click",t=>{const n=e.dataset.section;n&&"back"!==n&&(t.preventDefault(),yt(n))})}),null==(r=document.getElementById("report-period"))||r.addEventListener("change",e=>{const t=document.getElementById("report-custom-dates");t&&(t.style.display="custom"===e.target.value?"flex":"none")}),null==(u=document.getElementById("btn-generate-report"))||u.addEventListener("click",st),null==(m=document.getElementById("btn-report-csv"))||m.addEventListener("click",lt),null==(p=document.getElementById("btn-report-excel"))||p.addEventListener("click",it),Ue(),We(),null==(y=document.getElementById("btn-load-analytics"))||y.addEventListener("click",Ve),function(){const e=document.getElementById("edit-job-salary-type-section");e&&e.addEventListener("change",Ce);const t=document.getElementById("btn-add-working-hours");t&&t.addEventListener("click",De),Te()}()}async function vt(){if(se(),!le())return void(window.location.href="admin.html");const t=new URLSearchParams(window.location.search),n=t.get("domain"),o=t.get("company")||n,a=t.get("sheetUrl");ie(n,o,a);const s=t.get("section");if(s&&["analytics","reports","applicants"].includes(s)&&yt(s),!e)return alert("ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"),void(window.location.href="admin.html");if(!ce(e))return alert("ã“ã®ä¼šç¤¾ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"),void(window.location.href="admin.html");de()?function(){const e=document.getElementById("company-sidebar"),t=document.getElementById("admin-sidebar");e&&(e.style.display="none"),t&&(t.style.display="");const n=document.getElementById("btn-logout-admin");n&&n.addEventListener("click",()=>{ae(),window.location.href="admin.html"}),null==t||t.querySelectorAll(".sidebar-nav a[data-section]").forEach(e=>{e.addEventListener("click",n=>{var o;const a=e.dataset.section;["jobs","analytics","reports","applicants","recruit-settings"].includes(a)&&(n.preventDefault(),yt(a),t.querySelectorAll(".sidebar-nav li").forEach(e=>e.classList.remove("active")),null==(o=e.closest("li"))||o.classList.add("active"))})})}():function(){const e=document.querySelector(".feed-section");e&&(e.style.display="none");const t=document.querySelector('.sidebar-nav a[data-section="back"]');t&&(t.style.display="none");const n=document.getElementById("btn-back-admin");n&&(n.style.display="none");const o=document.getElementById("btn-logout");o&&(o.style.display="block",o.addEventListener("click",()=>{ae(),window.location.href="admin.html"}));const a=document.getElementById("nav-settings-item");a&&(a.style.display="block");const s=document.getElementById("nav-lp-settings-item");s&&(s.style.display="block"),ct(),pt();const l=document.getElementById("company-name");l&&(l.innerHTML=`${he(j)} <span class="badge info">ä¼šç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>`)}();const l=document.getElementById("page-title");l&&!s&&(l.textContent=`${j} ã®æ±‚äººä¸€è¦§`);const i=document.getElementById("company-name");i&&(i.textContent=j);const c=document.getElementById("btn-open-sheet");d&&c?(c.href=d,c.style.display=""):c&&(c.style.display="none"),bt(),await we()}window.switchToJobsSection=()=>yt("jobs"),"undefined"!=typeof window&&(window.JobManager={init:vt,loadJobsData:we,showJobModal:je,editJob:ke,closeJobModal:xe,saveJobData:$e,deleteJob:Se}),document.addEventListener("DOMContentLoaded",()=>{vt()});
