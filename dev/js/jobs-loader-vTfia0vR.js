const t="1NVIDV3OiXbNrVI7EFdRrU2Ggn8dx7Q0rSnvJ6uaWvX0",e="会社一覧",n="Stats",o="images/default-job.svg",s="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec",a=3e5,r={companies:{data:null,timestamp:0},jobs:new Map},i=()=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${e}`,c=()=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${n}`;function l(t){const e=[];let n="",o=!1;for(let s=0;s<t.length;s++){const a=t[s];'"'===a?o&&'"'===t[s+1]?(n+='"',s++):o=!o:","!==a||o?n+=a:(e.push(n.trim()),n="")}return e.push(n.trim()),e}function u(t){const e={id:"id",ID:"id","求人ID":"jobId",jobId:"jobId",job_id:"jobId","会社名":"company",company:"company","タイトル":"title",title:"title","勤務地":"location",location:"location","特典総額":"totalBonus",totalBonus:"totalBonus","月収例":"monthlySalary",monthlySalary:"monthlySalary","特徴":"features",features:"features","バッジ":"badges",badges:"badges","画像URL":"imageUrl",imageUrl:"imageUrl","詳細URL":"detailUrl",detailUrl:"detailUrl","表示":"visible",visible:"visible","表示する":"showCompany","並び順":"order",order:"order","会社ドメイン":"companyDomain",companyDomain:"companyDomain",company_domain:"companyDomain","会社住所":"companyAddress",companyAddress:"companyAddress","説明":"description",description:"description","お仕事内容":"jobContent",jobContent:"jobContent","仕事内容":"jobDescription",jobDescription:"jobDescription","応募資格":"requirements",requirements:"requirements","待遇":"benefits",benefits:"benefits","勤務時間":"workingHours",workingHours:"workingHours","休日":"holidays",holidays:"holidays","デザインパターン":"designPattern",designPattern:"designPattern",design_pattern:"designPattern","パターン":"designPattern",pattern:"designPattern","管理シート":"jobsSheet",jobsSheet:"jobsSheet",jobs_sheet:"jobsSheet","管理シートURL":"manageSheetUrl",manageSheetUrl:"manageSheetUrl","求人管理シートURL":"manageSheetUrl","掲載開始日":"publishStartDate",publishStartDate:"publishStartDate",publish_start_date:"publishStartDate","掲載終了日":"publishEndDate",publishEndDate:"publishEndDate",publish_end_date:"publishEndDate","職種名":"jobType","職種":"jobType",jobType:"jobType",job_type:"jobType","給与":"salary",salary:"salary","雇用形態":"employmentType",employmentType:"employmentType",employment_type:"employmentType","資格・スキル":"skills",skills:"skills","資格":"skills","スキル":"skills","検索タグ":"tags",tags:"tags"},n=t.replace(/"/g,"").trim();if(e[n])return e[n];const o=n.split(/\s+/);return o.length>1&&e[o[0]]?e[o[0]]:o[0]||n}function p(t,e=0,n=1){const o=t.split("\n"),s=l(o[e]||""),a=[];for(let r=n;r<o.length;r++){if(!o[r].trim())continue;const t=l(o[r]),e={};s.forEach((n,o)=>{const s=u(n);e[s]=t[o]||""}),e.features?e.features=e.features.split(",").map(t=>t.trim()).filter(t=>t):e.features=[],e.tags?(e.tags=e.tags.split(",").map(t=>t.trim()).filter(t=>t),e.features=[...new Set([...e.features,...e.tags])]):e.tags=[],a.push(e)}return a}function m(t){const e=t.match(/\/spreadsheets\/d\/([a-zA-Z0-9_-]+)/);return e?e[1]:/^[a-zA-Z0-9_-]+$/.test(t)?t:null}async function d(){const t=Date.now();if(r.companies.data&&t-r.companies.timestamp<a)return r.companies.data;try{const e=await fetch(i());if(!e.ok)throw new Error("会社一覧の取得に失敗しました");const n=p(await e.text());return r.companies.data=n,r.companies.timestamp=t,n}catch(e){return console.error("会社一覧の取得エラー:",e),r.companies.data||null}}async function h(t){var e;if(!t)return null;const n=m(t.trim());if(!n)return null;const o=Date.now(),s=r.jobs.get(n);if(s&&o-s.timestamp<a)return s.data;try{const t=`https://docs.google.com/spreadsheets/d/${n}/gviz/tq?tqx=out:csv`,s=await fetch(t);if(!s.ok)throw new Error("求人データの取得に失敗しました");const a=await s.text(),i=(null==(e=a.split("\n")[0])?void 0:e.split(",")[0])||"",c=i.includes(" ")&&!i.startsWith('"管理'),l=p(a,0,c?1:2);return r.jobs.set(n,{data:l,timestamp:o}),l}catch(i){return console.error("求人データの取得エラー:",i),(null==s?void 0:s.data)||null}}function f(t){return!(!t.jobsSheet||!t.jobsSheet.trim())&&("○"===t.showCompany||"◯"===t.showCompany)}function b(t){if(!t)return null;const e=t.trim().replace(/\//g,"-"),n=new Date(e);return isNaN(n.getTime())?null:(n.setHours(0,0,0,0),n)}function y(t){const e=new Date;if(e.setHours(0,0,0,0),t.publishStartDate&&t.publishStartDate.trim()){const n=b(t.publishStartDate);if(n&&e<n)return!1}if(t.publishEndDate&&t.publishEndDate.trim()){const n=b(t.publishEndDate);if(n&&e>n)return!1}return!0}function g(t){let e=0,n="";return t.forEach(t=>{if(!t.monthlySalary)return;const o=t.monthlySalary;let s=0;const a=o.match(/(\d+(?:\.\d+)?)\s*万/);if(a)s=1e4*parseFloat(a[1]);else{const t=o.match(/(\d{1,3}(?:,\d{3})*)\s*円/);if(t)s=parseInt(t[1].replace(/,/g,""));else{const t=o.match(/[¥￥]\s*(\d{1,3}(?:,\d{3})*|\d+)/);if(t)s=parseInt(t[1].replace(/,/g,""));else{const t=o.match(/(\d{1,3}(?:,\d{3})*|\d+)/);t&&(s=parseInt(t[1].replace(/,/g,"")))}}}s>e&&(e=s,n=o)}),n}async function w(){var t;const e=await d();if(!e)return[];const n=[];for(const o of e){if(!f(o))continue;const e=null==(t=o.jobsSheet)?void 0:t.trim();if(!e)continue;const s=await h(e);s&&s.forEach(t=>{t.company=o.company,t.companyDomain=o.companyDomain,n.push(t)})}return n}async function S(){const t=await w(),e={};return t.forEach(t=>{const n=t.companyAddress||t.location;if(!n)return;const o=n.match(/^(.+?[都道府県])/),s=o?o[1]:n;e[s]||(e[s]={prefecture:s,jobs:[],count:0}),e[s].jobs.push(t),e[s].count++}),Object.values(e).sort((t,e)=>e.count-t.count)}async function D(t){return(await w()).filter(e=>{const n=e.companyAddress||e.location;return n&&n.includes(t)})}async function j(t){const e=await w(),n=t.toLowerCase();return e.filter(t=>[t.title,t.company,t.jobContent,t.jobDescription,t.description,t.benefits,t.requirements,t.companyAddress,t.location,t.jobType,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(n)))}async function E(t){const e=await w(),n=t.toLowerCase();return e.filter(t=>[t.title,t.jobType,t.jobContent,t.jobDescription,...t.features||[],...t.tags||[]].some(t=>t&&t.toLowerCase().includes(n)))}async function v(){const t="jobStats";try{const e=localStorage.getItem(t);if(e){const{data:t,timestamp:n}=JSON.parse(e);if(Date.now()-n<18e5)return t}const n=await fetch(`${s}?action=getJobStats`);if(!n.ok)throw new Error("求人統計の取得に失敗しました");const o=await n.json();if(!o.success)throw new Error(o.error||"求人統計の取得に失敗しました");return localStorage.setItem(t,JSON.stringify({data:o.stats,timestamp:Date.now()})),o.stats}catch(e){return console.error("求人統計の取得エラー:",e),null}}function U(t){const e=t?t.toLowerCase().trim():"";return["modern","classic","minimal","colorful"].includes(e)?`pattern-${e}`:""}const C={SHEET_ID:t,SHEET_NAME:e,STATS_SHEET_NAME:n,DEFAULT_IMAGE:o,GAS_API_URL:s,get csvUrl(){return i()},get statsUrl(){return c()},getSheetUrl:e=>`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(e)}`,parseCSVLine:l,normalizeHeader:u,parseCSV:p,extractSpreadsheetId:m,fetchCompanies:d,fetchCompanyJobs:h,fetchJobs:d,isCompanyVisible:f,parseDate:b,isJobInPublishPeriod:y,getDetailUrl:function(t){return t.companyDomain&&t.companyDomain.trim()?`company.html?id=${encodeURIComponent(t.companyDomain.trim())}`:t.detailUrl||"#"},getMaxMonthlySalary:g,fetchAllJobs:w,getLocationList:S,getJobsByLocation:D,getJobsByKeyword:j,getJobsByOccupation:E,fetchStats:async function(){try{const t=await fetch(c());if(!t.ok)throw new Error("実績データの取得に失敗しました");return function(t){const e=t.split("\n"),n={};for(let o=1;o<e.length;o++){if(!e[o].trim())continue;const t=l(e[o]),s=t[0]?t[0].replace(/"/g,"").trim():"",a=t[1]?t[1].replace(/"/g,"").trim():"",r=t[2]?t[2].replace(/"/g,"").trim():"";s&&(n[s]={value:a,label:r})}return n}(await t.text())}catch(t){return console.error("実績データの取得エラー:",t),null}},fetchJobStats:v,getDesignPatternClass:U,escapeHtml(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeHtml(t){if(!t||"<br>"===t||"<div><br></div>"===t)return"";const e=["b","strong","i","em","u","ul","ol","li","br","div","p"],n=document.createElement("div");n.innerHTML=t;return n.querySelectorAll("*").forEach(t=>{if(e.includes(t.tagName.toLowerCase()))for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);else t.replaceWith(...t.childNodes)}),n.innerHTML}};"undefined"!=typeof window&&(window.JobsLoader=C);export{o as D,C as J,w as a,E as b,y as c,h as d,g as e,d as f,j as g,S as h,f as i,U as j,D as k,v as l,l as p};
