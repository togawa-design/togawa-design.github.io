import"./modulepreload-polyfill-YP0FEG5d.js";import{e}from"./utils-BbQaLTsI.js";import{u as t,a as n}from"./image-uploader-gAKnoYUY.js";const o="https://script.google.com/macros/s/AKfycbxj6CqSfY7jq04uDXURhewD_BAKx3csLKBpl1hdRBdNg-R-E6IuoaZGje22Gr9WYWY2/exec";let a=!0,l=null,c=null;function d(e){if(!e||"<br>"===e||"<div><br></div>"===e)return"";const t=["b","strong","i","em","u","ul","ol","li","br","div","p","img"],n=["src","alt","style"],o=document.createElement("div");o.innerHTML=e;return o.querySelectorAll("*").forEach(e=>{if(t.includes(e.tagName.toLowerCase())){Array.from(e.attributes).forEach(t=>{n.includes(t.name)||e.removeAttribute(t.name)}),"img"!==e.tagName.toLowerCase()||e.style.maxWidth||(e.style.maxWidth="100%")}else e.replaceWith(...e.childNodes)}),o.innerHTML}function i(e,t){if(t){const n=d(e.innerHTML);t.value=n}}function r(e,t){const n=document.getElementById(e),o=null==n?void 0:n.closest(".rich-editor-container"),a=null==o?void 0:o.querySelector('input[type="hidden"]');n&&(n.innerHTML=t||"",a&&(a.value=t||""))}function s(e){const t=(e,t)=>{const n=document.getElementById(e);n&&(n.value=t||"")};t("company-name",e.company),t("company-domain",e.companyDomain||e.company_domain),t("design-pattern",e.designPattern||"standard"),t("order",e.order),t("company-address",e.companyAddress||e.location);const n=e.logoUrl||e.imageUrl||"";t("logo-url",n),m(n);const o=document.getElementById("show-company");if(o&&(o.checked="○"===e.showCompany||!0===e.showCompany||"true"===e.showCompany||!0===e.visible),r("description-editor",e.description||""),r("job-content-editor",e.jobDescription||e.jobContent||""),r("working-hours-editor",e.workingHours||""),r("work-location-editor",e.workLocation||""),e.company){const t=document.getElementById("page-title");t&&(t.textContent=`${e.company} の編集`)}}function m(t){const n=document.getElementById("logo-preview"),o=document.getElementById("logo-remove-btn");n&&(t?(n.innerHTML=`<img src="${e(t)}" alt="会社ロゴ">`,o&&(o.style.display="")):(n.innerHTML='<span class="upload-placeholder">ロゴをアップロード</span>',o&&(o.style.display="none")))}async function u(){var e,t,n,l,c,i,r;document.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=null==t?void 0:t.querySelector('input[type="hidden"]');n&&(n.value=d(e.innerHTML))});const s=e=>{var t,n;return(null==(n=null==(t=document.getElementById(e))?void 0:t.value)?void 0:n.trim())||""},m=s("logo-url"),u={company:s("company-name"),companyDomain:s("company-domain"),designPattern:(null==(e=document.getElementById("design-pattern"))?void 0:e.value)||"standard",logoUrl:m,imageUrl:m,order:s("order"),companyAddress:s("company-address"),description:(null==(t=document.getElementById("description"))?void 0:t.value)||"",jobDescription:(null==(n=document.getElementById("job-content"))?void 0:n.value)||"",workingHours:(null==(l=document.getElementById("working-hours"))?void 0:l.value)||"",workLocation:(null==(c=document.getElementById("work-location"))?void 0:c.value)||"",showCompany:(null==(i=document.getElementById("show-company"))?void 0:i.checked)?"○":"",visible:(null==(r=document.getElementById("show-company"))?void 0:r.checked)||!1};if(!u.company||!u.companyDomain)return void alert("会社名と会社ドメインは必須です");if(!/^[a-z0-9-]+$/.test(u.companyDomain))return void alert("会社ドメインは半角英小文字・数字・ハイフンのみ使用できます");const y=document.getElementById("btn-save");y&&(y.disabled=!0,y.innerHTML='<span class="loading-spinner-small"></span> 保存中...');const p=o;try{if(p){const e=btoa(unescape(encodeURIComponent(JSON.stringify({action:"saveCompany",company:u})))),t=`${p}?action=post&data=${encodeURIComponent(e)}`,n=await fetch(t),o=await n.json();if(!o.success)throw new Error(o.error||"保存に失敗しました")}localStorage.setItem(`company_data_${u.companyDomain}`,JSON.stringify(u)),alert(a?"会社を登録しました":"会社情報を更新しました"),window.location.href="admin.html"}catch(g){console.error("保存エラー:",g),alert("保存中にエラーが発生しました: "+g.message)}finally{y&&(y.disabled=!1,y.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> 保存')}}function y(){var e;const t=document.getElementById("delete-confirm-modal"),n=(null==(e=document.getElementById("company-name"))?void 0:e.value)||"",o=document.getElementById("delete-company-name");o&&(o.textContent=n),t&&(t.style.display="flex")}function p(){const e=document.getElementById("delete-confirm-modal");e&&(e.style.display="none")}async function g(){const e=o,t=document.getElementById("delete-confirm");t&&(t.disabled=!0,t.textContent="削除中...");try{if(e){const t=btoa(unescape(encodeURIComponent(JSON.stringify({action:"deleteCompany",domain:l})))),n=`${e}?action=post&data=${encodeURIComponent(t)}`,o=await fetch(n),a=await o.json();if(!a.success)throw new Error(a.error||"削除に失敗しました")}localStorage.removeItem(`company_data_${l}`),alert("会社を削除しました"),window.location.href="admin.html"}catch(n){console.error("削除エラー:",n),alert("削除中にエラーが発生しました: "+n.message)}finally{t&&(t.disabled=!1,t.textContent="削除する")}}function v(){var e,n,o,l,c,d,i;null==(e=document.getElementById("company-edit-form"))||e.addEventListener("submit",e=>{e.preventDefault(),u()}),null==(n=document.getElementById("btn-delete"))||n.addEventListener("click",()=>{y()}),null==(o=document.getElementById("delete-modal-close"))||o.addEventListener("click",p),null==(l=document.getElementById("delete-cancel"))||l.addEventListener("click",p),null==(c=document.getElementById("delete-confirm"))||c.addEventListener("click",g),null==(d=document.getElementById("delete-confirm-modal"))||d.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&p()}),null==(i=document.getElementById("company-domain"))||i.addEventListener("input",e=>{a&&(e.target.value=e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,""))}),function(){const e=document.getElementById("logo-upload-btn"),n=document.getElementById("logo-file-input"),o=document.getElementById("logo-remove-btn"),a=document.getElementById("logo-preview"),l=document.getElementById("logo-url");if(!e||!n)return;e.addEventListener("click",()=>{n.click()}),null==a||a.addEventListener("click",()=>{n.click()}),n.addEventListener("change",async e=>{var o,c;const d=e.target.files[0];if(!d)return;const i=null==(c=null==(o=document.getElementById("company-domain"))?void 0:o.value)?void 0:c.trim();if(i)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">アップロード中...</span>';const e=await t(d,i);l.value=e,m(e)}catch(r){console.error("ロゴアップロードエラー:",r),alert("ロゴのアップロードに失敗しました: "+r.message),m(l.value)}finally{a.classList.remove("uploading"),n.value=""}else alert("先に会社ドメインを入力してください")}),null==o||o.addEventListener("click",()=>{l.value="",m("")}),null==a||a.addEventListener("dragover",e=>{e.preventDefault(),a.classList.add("drag-over")}),null==a||a.addEventListener("dragleave",e=>{e.preventDefault(),a.classList.remove("drag-over")}),null==a||a.addEventListener("drop",async e=>{var n,o;e.preventDefault(),a.classList.remove("drag-over");const c=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));if(0===c.length)return;const d=null==(o=null==(n=document.getElementById("company-domain"))?void 0:n.value)?void 0:o.trim();if(d)try{a.classList.add("uploading"),a.innerHTML='<span class="upload-placeholder">アップロード中...</span>';const e=await t(c[0],d);l.value=e,m(e)}catch(i){console.error("ロゴアップロードエラー:",i),alert("ロゴのアップロードに失敗しました: "+i.message),m(l.value)}finally{a.classList.remove("uploading")}else alert("先に会社ドメインを入力してください")})}(),f("description-insert-image","description-image-input","description-editor"),f("job-content-insert-image","job-content-image-input","job-content-editor")}function f(e,t,o){const a=document.getElementById(e),l=document.getElementById(t),c=document.getElementById(o);a&&l&&c&&(a.addEventListener("click",()=>{l.click()}),l.addEventListener("change",async e=>{var t,o;const a=e.target.files[0];if(!a)return;const i=null==(o=null==(t=document.getElementById("company-domain"))?void 0:t.value)?void 0:o.trim();if(i)try{const e=`img-placeholder-${Date.now()}`,t=document.createElement("img");t.id=e,t.src=URL.createObjectURL(a),t.alt="アップロード中...",t.className="uploading",t.style.maxWidth="100%",t.style.opacity="0.5",c.focus();const o=window.getSelection();if(o.rangeCount>0){const e=o.getRangeAt(0);e.insertNode(t),e.setStartAfter(t),e.collapse(!0),o.removeAllRanges(),o.addRange(e)}else c.appendChild(t);const l=await n(a,i),r=document.getElementById(e);r&&(r.src=l,r.alt="",r.className="",r.style.opacity="1",r.removeAttribute("id"));const s=c.closest(".rich-editor-container"),m=null==s?void 0:s.querySelector('input[type="hidden"]');m&&(m.value=d(c.innerHTML))}catch(r){console.error("画像アップロードエラー:",r),alert("画像のアップロードに失敗しました: "+r.message);const e=c.querySelector("img.uploading");e&&e.remove()}finally{l.value=""}else alert("先に会社ドメインを入力してください")}))}async function E(){const e=new URLSearchParams(window.location.search);l=e.get("domain"),a=!l,function(){const e=document.getElementById("page-title"),t=document.getElementById("edit-mode-badge"),n=document.getElementById("btn-delete"),o=document.getElementById("company-domain");a?(e&&(e.textContent="新規会社登録"),t&&(t.textContent="新規作成",t.classList.remove("edit")),n&&(n.style.display="none")):(e&&(e.textContent="会社情報の編集"),t&&(t.textContent="編集中",t.classList.add("edit")),n&&(n.style.display=""),o&&(o.readOnly=!0,o.classList.add("readonly")))}(),v(),document.querySelectorAll(".rich-editor").forEach(e=>{const t=e.closest(".rich-editor-container"),n=t.querySelector(".rich-editor-toolbar"),o=t.querySelector('input[type="hidden"]');null==n||n.querySelectorAll(".toolbar-btn").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const a=t.dataset.command;document.execCommand(a,!1,null),e.focus(),i(e,o)})}),e.addEventListener("input",()=>{i(e,o)}),e.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),e.addEventListener("keydown",t=>{if(t.ctrlKey||t.metaKey){switch(t.key.toLowerCase()){case"b":t.preventDefault(),document.execCommand("bold",!1,null);break;case"i":t.preventDefault(),document.execCommand("italic",!1,null);break;case"u":t.preventDefault(),document.execCommand("underline",!1,null)}i(e,o)}})}),a||await async function(){var e;const t=o;try{const n=`${t}?action=getCompanies`,o=await fetch(n),a=await o.json();if(!a.success)throw new Error(a.error||"会社データの取得に失敗しました");const d=null==(e=a.companies)?void 0:e.find(e=>e.companyDomain===l||e.company_domain===l);if(!d){const e=localStorage.getItem(`company_data_${l}`);return void(e?s(JSON.parse(e)):(alert("会社データが見つかりません"),window.location.href="admin.html"))}c=d,s(d)}catch(n){console.error("会社データ読み込みエラー:",n);const e=localStorage.getItem(`company_data_${l}`);e?s(JSON.parse(e)):alert("データの読み込みに失敗しました: "+n.message)}}()}"undefined"!=typeof window&&(window.CompanyEditor={init:E,saveCompany:u,deleteCompany:g,showDeleteConfirm:y,hideDeleteConfirm:p}),document.addEventListener("DOMContentLoaded",()=>{E()});
