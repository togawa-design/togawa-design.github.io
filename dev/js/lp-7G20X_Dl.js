var t=Object.defineProperty,e=(e,n,i)=>((e,n,i)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i)(e,"symbol"!=typeof n?n+"":n,i);import{e as n,s as i,h as a,g as s,t as o}from"./utils-C4oNoj7k.js";import"./jobs-loader-CErzUEmq.js";function l(t,e,i){const a=i.heroTitle||e.title||`${t.company}で働こう`,s=i.heroSubtitle||"",o=i.heroImage||t.imageUrl||"",l=[];return e.totalBonus&&l.push({label:"特典総額",value:e.totalBonus,icon:"bonus"}),e.monthlySalary&&l.push({label:"月収例",value:e.monthlySalary,icon:"salary"}),`\n    <section class="lp-hero">\n      <div class="lp-hero-bg lp-editable-image" data-field="heroImage" data-label="ヒーロー画像" style="${o?`background-image: url('${n(o)}')`:""}"></div>\n      <div class="lp-hero-overlay"></div>\n      <div class="lp-hero-content">\n        <p class="lp-hero-company">${n(t.company)}</p>\n        <h1 class="lp-hero-title lp-editable" data-field="heroTitle" data-label="メインタイトル">${n(a)}</h1>\n        ${s?`<p class="lp-hero-subtitle lp-editable" data-field="heroSubtitle" data-label="サブタイトル">${n(s)}</p>`:'<p class="lp-hero-subtitle lp-editable lp-placeholder" data-field="heroSubtitle" data-label="サブタイトル">サブタイトルを追加</p>'}\n\n        ${l.length>0?`\n        <div class="lp-hero-highlights">\n          ${l.map(t=>`\n            <div class="lp-highlight-item ${t.icon}">\n              <span class="lp-highlight-label">${n(t.label)}</span>\n              <span class="lp-highlight-value">${n(t.value)}</span>\n            </div>\n          `).join("")}\n        </div>\n        `:""}\n\n        <div class="lp-hero-cta">\n          <a href="#lp-apply" class="lp-btn-apply-hero">今すぐ応募する</a>\n        </div>\n      </div>\n    </section>\n  `}function c(t,e,i){const a=[];return i.pointTitle1&&a.push({title:i.pointTitle1,desc:i.pointDesc1||"",idx:1}),i.pointTitle2&&a.push({title:i.pointTitle2,desc:i.pointDesc2||"",idx:2}),i.pointTitle3&&a.push({title:i.pointTitle3,desc:i.pointDesc3||"",idx:3}),0===a.length&&(e.totalBonus&&a.push({title:"入社特典",desc:`特典総額${e.totalBonus}！入社祝い金やその他特典が充実。`,idx:1}),e.monthlySalary&&a.push({title:"高収入",desc:`月収例${e.monthlySalary}可能！安定した収入を実現。`,idx:2}),e.benefits&&a.push({title:"充実の待遇",desc:"社会保険完備、寮完備など福利厚生が充実。",idx:3})),0===a.length?"":`\n    <section class="lp-points">\n      <div class="lp-section-inner">\n        <h2 class="lp-section-title">この求人のポイント</h2>\n        <div class="lp-points-grid">\n          ${a.map((t,e)=>`\n            <div class="lp-point-card">\n              <div class="lp-point-number">${e+1}</div>\n              <h3 class="lp-point-title lp-editable" data-field="pointTitle${t.idx}" data-label="ポイント${t.idx}タイトル">${n(t.title)}</h3>\n              <p class="lp-point-desc lp-editable" data-field="pointDesc${t.idx}" data-label="ポイント${t.idx}説明">${n(t.desc)}</p>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    </section>\n  `}function r(t,e){return 0===e.length?"":`\n    <section class="lp-jobs">\n      <div class="lp-section-inner">\n        <h2 class="lp-section-title">募集中の求人</h2>\n        <div class="lp-jobs-list">\n          ${e.map(e=>function(t,e){const i=t.features?Array.isArray(t.features)?t.features:t.features.split(","):[];return`\n    <div class="lp-job-card">\n      <div class="lp-job-card-header">\n        <h3 class="lp-job-title">${n(t.title)}</h3>\n        ${t.employmentType?`<span class="lp-job-type">${n(t.employmentType)}</span>`:""}\n      </div>\n      <div class="lp-job-card-body">\n        <ul class="lp-job-info">\n          <li>\n            <span class="lp-info-icon">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>\n            </span>\n            ${n(t.location)}\n          </li>\n          ${t.monthlySalary?`\n          <li>\n            <span class="lp-info-icon">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>\n            </span>\n            ${n(t.monthlySalary)}\n          </li>\n          `:""}\n          ${t.totalBonus?`\n          <li class="highlight">\n            <span class="lp-info-icon">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>\n            </span>\n            特典総額 ${n(t.totalBonus)}\n          </li>\n          `:""}\n        </ul>\n        ${i.length>0?`\n        <div class="lp-job-tags">\n          ${i.slice(0,5).map(t=>`<span class="lp-job-tag">${n(t.trim())}</span>`).join("")}\n        </div>\n        `:""}\n      </div>\n      <div class="lp-job-card-footer">\n        <a href="job-detail.html?company=${n(t.companyDomain||e.companyDomain)}&job=${n(t.id||"")}" class="lp-btn-detail">詳細を見る</a>\n      </div>\n    </div>\n  `}(e,t)).join("")}\n        </div>\n      </div>\n    </section>\n  `}function d(t,e){const a=[];return t.description&&a.push({label:"会社概要",value:t.description,isHtml:!0}),t.jobDescription&&a.push({label:"お仕事内容",value:t.jobDescription,isHtml:!0}),t.workingHours&&a.push({label:"勤務時間",value:t.workingHours,isHtml:!0}),t.workLocation&&a.push({label:"勤務地",value:t.workLocation,isHtml:!0}),e.benefits&&e.benefits!==t.benefits?a.push({label:"待遇・福利厚生",value:e.benefits,isHtml:!0}):t.benefits&&a.push({label:"待遇・福利厚生",value:t.benefits,isHtml:!0}),e.requirements&&a.push({label:"応募資格",value:e.requirements,isHtml:!0}),0===a.length?"":`\n    <section class="lp-details">\n      <div class="lp-section-inner">\n        <h2 class="lp-section-title">募集要項</h2>\n        <div class="lp-details-table">\n          ${a.map(t=>`\n            <div class="lp-detail-row">\n              <dt class="lp-detail-label">${n(t.label)}</dt>\n              <dd class="lp-detail-value">${t.isHtml?i(t.value):n(t.value)}</dd>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    </section>\n  `}function p(t){if(!t)return"";const e=function(t){const e=[];if("string"==typeof t){const n=t.split("\n").filter(t=>t.trim());for(const t of n){const n=t.match(/Q[:：](.+?)\|A[:：](.+)/i);n&&e.push({question:n[1].trim(),answer:n[2].trim()})}}else Array.isArray(t)&&t.forEach(t=>{t.question&&t.answer&&e.push(t)});return e}(t);return 0===e.length?"":`\n    <section class="lp-faq">\n      <div class="lp-section-inner">\n        <h2 class="lp-section-title">よくある質問</h2>\n        <div class="lp-faq-list">\n          ${e.map((t,e)=>`\n            <div class="lp-faq-item">\n              <button class="lp-faq-question" aria-expanded="false" aria-controls="faq-answer-${e}">\n                <span class="lp-faq-q">Q</span>\n                <span class="lp-faq-q-text">${n(t.question)}</span>\n                <span class="lp-faq-toggle">\n                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>\n                </span>\n              </button>\n              <div class="lp-faq-answer" id="faq-answer-${e}">\n                <span class="lp-faq-a">A</span>\n                <span class="lp-faq-a-text">${n(t.answer)}</span>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    </section>\n  `}function h(t,e){const i=e.ctaText||"この求人に応募する",a=t.phoneNumber||"0120-000-000";return`\n    <section class="lp-apply" id="lp-apply">\n      <div class="lp-section-inner">\n        <h2 class="lp-section-title">応募する</h2>\n        <div class="lp-apply-content">\n          <p class="lp-apply-lead">ご応募・お問い合わせはお気軽にどうぞ</p>\n\n          <div class="lp-apply-methods">\n            <div class="lp-apply-method lp-apply-web">\n              <h3>WEBで応募</h3>\n              <p>24時間受付中</p>\n              <a href="#" class="lp-btn-apply-main lp-editable" data-field="ctaText" data-label="CTAテキスト">${n(i)}</a>\n            </div>\n\n            <div class="lp-apply-divider">\n              <span>または</span>\n            </div>\n\n            <div class="lp-apply-method lp-apply-tel">\n              <h3>電話で応募</h3>\n              <p>受付時間 9:00〜18:00（土日祝除く）</p>\n              <a href="tel:${n(a.replace(/-/g,""))}" class="lp-btn-tel-main">\n                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>\n                ${n(a)}\n              </a>\n            </div>\n          </div>\n\n          <p class="lp-apply-note">※ 面接は随時実施しております。お気軽にお問い合わせください。</p>\n        </div>\n      </div>\n    </section>\n  `}class u{constructor(){this.sections={hero:l,points:c,jobs:r,details:d,faq:p,apply:h},this.defaultOrder=["hero","points","jobs","details","faq","apply"]}render(t,e,n,i){const a=`lp-pattern-${n.designPattern||t.designPattern||"standard"}`;document.body.classList.add(a);const s=e.length>0?e[0]:t,o=this.parseSectionVisibility(n.sectionVisibility),l=this.parseSectionOrder(n.sectionOrder);i.innerHTML=l.map(i=>this.renderSection(i,t,s,e,n,o)).join("")}renderSection(t,e,n,i,a,s){switch(t){case"hero":return this.sections.hero(e,n,a);case"points":return s.points?this.sections.points(e,n,a):"";case"jobs":return s.jobs?this.sections.jobs(e,i):"";case"details":return s.details?this.sections.details(e,n):"";case"faq":return s.faq&&a.faq?this.sections.faq(a.faq):"";case"apply":return this.sections.apply(e,a);default:return""}}parseSectionVisibility(t){const e={points:!0,jobs:!0,details:!0,faq:!0};if(!t)return e;try{return{...e,...JSON.parse(t)}}catch(n){return console.error("セクション表示設定のパースエラー:",n),e}}parseSectionOrder(t){if(!t)return this.defaultOrder;const e=t.split(",").map(t=>t.trim()).filter(t=>t);if(0===e.length)return this.defaultOrder;const n=this.defaultOrder.filter(t=>!e.includes(t));return[...e,...n]}}const m=[{url:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=1200&q=80",label:"工場・製造ライン"},{url:"https://images.unsplash.com/photo-1565043666747-69f6646db940?w=1200&q=80",label:"自動車工場"},{url:"https://images.unsplash.com/photo-1504917595217-d4dc5ebe6122?w=1200&q=80",label:"溶接作業"},{url:"https://images.unsplash.com/photo-1581092160607-ee22621dd758?w=1200&q=80",label:"産業ロボット"},{url:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1200&q=80",label:"倉庫・物流"},{url:"https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=1200&q=80",label:"製造業チーム"},{url:"https://images.unsplash.com/photo-1567789884554-0b844b597180?w=1200&q=80",label:"電子部品組立"},{url:"https://images.unsplash.com/photo-1503387762-592deb58ef4e?w=1200&q=80",label:"建設・インフラ"}];class g{constructor(){e(this,"handleOutsideClick",t=>{const e=document.getElementById("lp-active-editor");!e||e.contains(t.target)||t.target.closest(".lp-editable")||this.closeInlineEditor()}),this.editedData={},this.currentCompanyDomain=null,this.draggedSection=null,this.isActive=!1,this.presetImages=m}enable(t,e){this.isActive=!0,this.currentCompanyDomain=e,this.editedData={...t},document.body.classList.add("lp-edit-mode"),this.renderToolbar(),this.setupEditableElements(),this.setupSectionSortable()}renderToolbar(){const t=document.createElement("div");t.className="lp-edit-toolbar",t.innerHTML='\n      <div class="lp-edit-toolbar-inner">\n        <span class="lp-edit-toolbar-title">編集モード</span>\n        <div class="lp-edit-toolbar-actions">\n          <button type="button" class="lp-edit-btn-preview" id="btn-preview-changes">プレビュー</button>\n          <button type="button" class="lp-edit-btn-save" id="btn-save-changes">保存</button>\n          <button type="button" class="lp-edit-btn-cancel" id="btn-cancel-edit">キャンセル</button>\n        </div>\n      </div>\n    ',document.body.insertBefore(t,document.body.firstChild),t.querySelector("#btn-save-changes").addEventListener("click",()=>this.saveChanges()),t.querySelector("#btn-cancel-edit").addEventListener("click",()=>this.cancelEdit()),t.querySelector("#btn-preview-changes").addEventListener("click",()=>this.previewChanges())}setupEditableElements(){document.querySelectorAll(".lp-editable").forEach(t=>{const e=t.dataset.field,n=t.dataset.label||e;t.addEventListener("mouseenter",()=>this.showEditLabel(t,n)),t.addEventListener("mouseleave",()=>this.hideEditLabel()),t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.startTextEditing(t,e,n)})}),document.querySelectorAll(".lp-editable-image").forEach(t=>{const e=t.dataset.field,n=t.dataset.label||e;t.addEventListener("mouseenter",()=>this.showEditLabel(t,n)),t.addEventListener("mouseleave",()=>this.hideEditLabel()),t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.startImageEditing(t,e,n)})})}setupSectionSortable(){const t=document.getElementById("lp-content");if(!t)return;const e=t.querySelectorAll("section");0!==e.length&&e.forEach(e=>{const n=this.detectSectionType(e);e.dataset.section=n,e.classList.add("lp-sortable-section");const i=document.createElement("div");i.className="lp-section-drag-handle",i.innerHTML=`\n        <span class="lp-section-label">${this.getSectionLabel(n)}</span>\n        <span class="lp-section-drag-icon">⋮⋮</span>\n      `,e.insertBefore(i,e.firstChild),e.setAttribute("draggable","true"),e.addEventListener("dragstart",t=>{this.draggedSection=e,e.classList.add("lp-section-dragging"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(e,50,30)}),e.addEventListener("dragend",()=>{e.classList.remove("lp-section-dragging"),this.draggedSection=null,this.saveSectionOrder()}),e.addEventListener("dragover",n=>{if(n.preventDefault(),n.dataTransfer.dropEffect="move",this.draggedSection&&this.draggedSection!==e){const n=[...t.querySelectorAll("section")];n.indexOf(this.draggedSection)<n.indexOf(e)?e.parentNode.insertBefore(this.draggedSection,e.nextSibling):e.parentNode.insertBefore(this.draggedSection,e)}})})}detectSectionType(t){return t.classList.contains("lp-hero")?"hero":t.classList.contains("lp-points")?"points":t.classList.contains("lp-jobs")?"jobs":t.classList.contains("lp-details")?"details":t.classList.contains("lp-faq")?"faq":t.classList.contains("lp-apply")?"apply":"unknown"}getSectionLabel(t){return{hero:"ヒーロー",points:"ポイント",jobs:"求人一覧",details:"募集要項",faq:"FAQ",apply:"応募"}[t]||"セクション"}saveSectionOrder(){const t=document.getElementById("lp-content");if(!t)return;const e=t.querySelectorAll("section"),n=Array.from(e).map(t=>t.dataset.section);this.editedData.sectionOrder=n.join(",")}showEditLabel(t,e){this.hideEditLabel();const n=document.createElement("div");n.className="lp-edit-label",n.textContent=`${e}を編集`,n.id="lp-edit-label-tooltip";const i=t.getBoundingClientRect();n.style.position="fixed",n.style.top=i.top-30+"px",n.style.left=`${i.left}px`,document.body.appendChild(n)}hideEditLabel(){const t=document.getElementById("lp-edit-label-tooltip");t&&t.remove()}startTextEditing(t,e,i){this.closeInlineEditor();const a=this.editedData[e]||t.textContent.trim(),s=document.createElement("div");s.className="lp-inline-editor",s.id="lp-active-editor",s.innerHTML=`\n      <label class="lp-inline-editor-label">${n(i)}</label>\n      <textarea class="lp-inline-editor-textarea" rows="3">${n(a)}</textarea>\n      <div class="lp-inline-editor-actions">\n        <button type="button" class="lp-inline-editor-cancel">キャンセル</button>\n        <button type="button" class="lp-inline-editor-apply">適用</button>\n      </div>\n    `;const o=t.getBoundingClientRect();s.style.position="fixed",s.style.top=`${Math.min(o.bottom+10,window.innerHeight-250)}px`,s.style.left=`${Math.max(10,Math.min(o.left,window.innerWidth-320))}px`,document.body.appendChild(s);const l=s.querySelector("textarea");l.focus(),l.select();const c=()=>this.closeInlineEditor();s.querySelector(".lp-inline-editor-cancel").addEventListener("click",c),s.querySelector(".lp-inline-editor-apply").addEventListener("click",()=>{const n=l.value.trim();this.editedData[e]=n,t.textContent=n||`${i}を追加`,t.classList.toggle("lp-placeholder",!n),c()}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},100)}closeInlineEditor(){const t=document.getElementById("lp-active-editor");t&&t.remove(),document.removeEventListener("click",this.handleOutsideClick)}startImageEditing(t,e,i){this.closeInlineEditor();const a=this.editedData[e]||"",s=this.presetImages.map((t,e)=>`\n      <div class="lp-preset-image" data-url="${n(t.url)}" title="${n(t.label)}">\n        <img src="${n(t.url)}" alt="${n(t.label)}" loading="lazy">\n        <span class="lp-preset-label">${n(t.label)}</span>\n      </div>\n    `).join(""),o=document.createElement("div");o.className="lp-inline-editor lp-image-editor",o.id="lp-active-editor",o.innerHTML=`\n      <label class="lp-inline-editor-label">${n(i)}</label>\n\n      <div class="lp-image-tabs">\n        <button type="button" class="lp-image-tab active" data-tab="preset">プリセット</button>\n        <button type="button" class="lp-image-tab" data-tab="url">URL入力</button>\n      </div>\n\n      <div class="lp-image-tab-content" data-content="preset">\n        <div class="lp-preset-grid">\n          ${s}\n        </div>\n      </div>\n\n      <div class="lp-image-tab-content" data-content="url" style="display: none;">\n        <div class="lp-image-url-input">\n          <input type="url" class="lp-inline-editor-input" placeholder="画像URLを入力" value="${n(a)}">\n        </div>\n      </div>\n\n      <div class="lp-image-preview">\n        ${a?`<img src="${n(a)}" alt="プレビュー">`:"<p>プレビューなし</p>"}\n      </div>\n\n      <div class="lp-inline-editor-actions">\n        <button type="button" class="lp-inline-editor-clear">クリア</button>\n        <button type="button" class="lp-inline-editor-cancel">キャンセル</button>\n        <button type="button" class="lp-inline-editor-apply">適用</button>\n      </div>\n    `,o.style.position="fixed",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)",o.style.maxWidth="500px",o.style.width="90%",o.style.maxHeight="80vh",o.style.overflowY="auto",document.body.appendChild(o);const l=o.querySelector("input"),c=o.querySelector(".lp-image-preview"),r=o.querySelectorAll(".lp-image-tab"),d=o.querySelectorAll(".lp-image-tab-content");let p=a;r.forEach(t=>{t.addEventListener("click",()=>{r.forEach(t=>t.classList.remove("active")),t.classList.add("active");const e=t.dataset.tab;d.forEach(t=>{t.style.display=t.dataset.content===e?"block":"none"})})}),o.querySelectorAll(".lp-preset-image").forEach(t=>{t.addEventListener("click",()=>{o.querySelectorAll(".lp-preset-image").forEach(t=>t.classList.remove("selected")),t.classList.add("selected"),p=t.dataset.url,l.value=p,c.innerHTML=`<img src="${n(p)}" alt="プレビュー">`})}),l.addEventListener("input",()=>{p=l.value.trim(),o.querySelectorAll(".lp-preset-image").forEach(t=>t.classList.remove("selected")),c.innerHTML=p?`<img src="${n(p)}" alt="プレビュー">`:"<p>プレビューなし</p>"});const h=()=>this.closeInlineEditor();o.querySelector(".lp-inline-editor-clear").addEventListener("click",()=>{p="",l.value="",o.querySelectorAll(".lp-preset-image").forEach(t=>t.classList.remove("selected")),c.innerHTML="<p>プレビューなし</p>"}),o.querySelector(".lp-inline-editor-cancel").addEventListener("click",h),o.querySelector(".lp-inline-editor-apply").addEventListener("click",()=>{this.editedData[e]=p,t.style.backgroundImage=p?`url('${p}')`:"",h()}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},100)}async saveChanges(){console.log("保存データ:",this.editedData),alert("保存機能は管理画面から行ってください。\n編集内容:\n"+JSON.stringify(this.editedData,null,2))}cancelEdit(){confirm("編集内容を破棄してよろしいですか？")&&(window.location.href=window.location.pathname+"?c="+this.currentCompanyDomain)}previewChanges(){console.log("プレビュー:",this.editedData)}}const b=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];class v{constructor(){this.renderer=new u,this.editor=new g,this.isEditMode=a("edit"),this.companyDomain=null,this.utmParams={},this.lpSettings=null}async init(){if(this.companyDomain=this.getCompanyDomain(),this.companyDomain){this.captureUTMParams();try{await this.waitForJobsLoader();const t=await window.JobsLoader.fetchCompanies(),e=null==t?void 0:t.find(t=>{var e;return(null==(e=t.companyDomain)?void 0:e.trim())===this.companyDomain&&window.JobsLoader.isCompanyVisible(t)});if(!e)return void this.showError("指定された会社は見つかりませんでした。");const n=await this.fetchJobs(e);this.lpSettings=await this.fetchLPSettings(this.companyDomain)||{},this.setupAdTracking(this.lpSettings),this.hideLoading();const i=document.getElementById("lp-content");i&&(this.renderer.render(e,n,this.lpSettings,i),this.setupEventListeners(e)),this.isEditMode&&this.editor.enable(this.lpSettings,this.companyDomain),this.updateSEO(e,n,this.lpSettings),this.isEditMode||this.trackPageView(e)}catch(t){console.error("LP読み込みエラー:",t),this.showError("ページの読み込みに失敗しました。")}}else this.showError("会社が指定されていません。")}getCompanyDomain(){return s("c")||s("id")||null}async waitForJobsLoader(t=1e4){return void 0!==window.JobsLoader?window.JobsLoader:new Promise((e,n)=>{const i=Date.now(),a=setInterval(()=>{void 0!==window.JobsLoader?(clearInterval(a),e(window.JobsLoader)):Date.now()-i>t&&(clearInterval(a),n(new Error("JobsLoader timeout")))},100)})}async fetchJobs(t){var e;if(!(null==(e=t.jobsSheet)?void 0:e.trim()))return[];const n=await window.JobsLoader.fetchCompanyJobs(t.jobsSheet.trim());return(null==n?void 0:n.length)?n.filter(t=>"false"!==t.visible&&"FALSE"!==t.visible).filter(t=>window.JobsLoader.isJobInPublishPeriod(t)).sort((t,e)=>(parseInt(t.order)||999)-(parseInt(e.order)||999)).map(e=>({...e,company:t.company,companyDomain:t.companyDomain})):[]}async fetchLPSettings(t){try{const e=`https://docs.google.com/spreadsheets/d/${window.JobsLoader.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=LP設定`,n=await fetch(e);if(!n.ok)return null;const i=(await n.text()).split("\n"),a=window.JobsLoader.parseCSVLine(i[0]||"");for(let s=1;s<i.length;s++){if(!i[s].trim())continue;const e=window.JobsLoader.parseCSVLine(i[s]),n={};if(a.forEach((t,i)=>{n[t.replace(/"/g,"").trim()]=e[i]||""}),n.companyDomain===t||n["会社ドメイン"]===t)return{heroTitle:n.heroTitle||n["ヒーロータイトル"]||"",heroSubtitle:n.heroSubtitle||n["ヒーローサブタイトル"]||"",heroImage:n.heroImage||n["ヒーロー画像"]||"",ctaText:n.ctaText||n["CTAテキスト"]||"この求人に応募する",pointTitle1:n.pointTitle1||n["ポイント1タイトル"]||"",pointDesc1:n.pointDesc1||n["ポイント1説明"]||"",pointTitle2:n.pointTitle2||n["ポイント2タイトル"]||"",pointDesc2:n.pointDesc2||n["ポイント2説明"]||"",pointTitle3:n.pointTitle3||n["ポイント3タイトル"]||"",pointDesc3:n.pointDesc3||n["ポイント3説明"]||"",pointTitle4:n.pointTitle4||n["ポイント4タイトル"]||"",pointDesc4:n.pointDesc4||n["ポイント4説明"]||"",pointTitle5:n.pointTitle5||n["ポイント5タイトル"]||"",pointDesc5:n.pointDesc5||n["ポイント5説明"]||"",pointTitle6:n.pointTitle6||n["ポイント6タイトル"]||"",pointDesc6:n.pointDesc6||n["ポイント6説明"]||"",faq:n.faq||n.FAQ||"",designPattern:n.designPattern||n["デザインパターン"]||"standard",sectionOrder:n.sectionOrder||n["セクション順序"]||"",sectionVisibility:n.sectionVisibility||n["セクション表示"]||"",tiktokPixelId:n.tiktokPixelId||n["TikTok Pixel ID"]||"",googleAdsId:n.googleAdsId||n["Google Ads ID"]||"",googleAdsLabel:n.googleAdsLabel||n["Google Ads ラベル"]||"",ogpTitle:n.ogpTitle||n["OGPタイトル"]||"",ogpDescription:n.ogpDescription||n["OGP説明文"]||"",ogpImage:n.ogpImage||n["OGP画像"]||""}}}catch(e){console.log("LP設定シートが見つかりません（デフォルト設定を使用）")}return null}hideLoading(){const t=document.getElementById("lp-loading");t&&(t.style.display="none")}showError(t){this.hideLoading();const e=document.getElementById("lp-content");e&&(e.innerHTML=`\n        <div class="lp-error">\n          <p>${t}</p>\n          <a href="/" class="lp-btn-back">トップページへ戻る</a>\n        </div>\n      `)}setupEventListeners(t){document.querySelectorAll(".lp-faq-question").forEach(t=>{t.addEventListener("click",()=>{const e="true"===t.getAttribute("aria-expanded");t.setAttribute("aria-expanded",!e);const n=t.getAttribute("aria-controls"),i=document.getElementById(n);i&&i.classList.toggle("open",!e)})}),document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",e=>{const n=t.getAttribute("href");if("#"===n)return;const i=document.querySelector(n);i&&(e.preventDefault(),i.scrollIntoView({behavior:"smooth",block:"start"}))})}),document.querySelectorAll(".lp-btn-apply-hero, .lp-btn-apply-main, .lp-btn-apply-footer, .lp-btn-apply-header").forEach(e=>{e.addEventListener("click",()=>{const n=e.classList.contains("lp-btn-apply-hero")?"hero":e.classList.contains("lp-btn-apply-main")?"main":e.classList.contains("lp-btn-apply-header")?"header":"footer";o("lp_apply_click",{company_domain:t.companyDomain,company_name:t.company,button_location:n,...this.utmParams}),this.trackConversion("SubmitForm",{content_name:t.company,content_category:"job_application",button_location:n,...this.utmParams})})}),document.querySelectorAll(".lp-btn-tel-header, .lp-btn-tel-footer").forEach(e=>{e.addEventListener("click",()=>{const n=e.classList.contains("lp-btn-tel-header")?"header":"footer";o("lp_tel_click",{company_domain:t.companyDomain,company_name:t.company,button_location:n,...this.utmParams}),this.trackConversion("Contact",{content_name:t.company,content_category:"phone_call",button_location:n,...this.utmParams})})})}updateSEO(t,e,n={}){const i=n.ogpTitle||n.heroTitle||"",a=n.ogpDescription||"",s=n.ogpImage||n.heroImage||"",o=i?`${i} | ${t.company}`:`${t.company} 求人情報 | リクエコ求人ナビ`,l=a||(e.length>0?`${t.company}の求人情報。${e[0].title}など${e.length}件の募集中。`:`${t.company}の求人情報ページです。`);document.title=o;const c=document.querySelector('meta[name="description"]');c&&(c.content=l);const r=document.querySelector('meta[property="og:title"]');r&&(r.content=o);const d=document.querySelector('meta[property="og:description"]');if(d&&(d.content=l),s){let t=document.querySelector('meta[property="og:image"]');t||(t=document.createElement("meta"),t.setAttribute("property","og:image"),document.head.appendChild(t)),t.content=s;let e=document.querySelector('meta[name="twitter:image"]');e||(e=document.createElement("meta"),e.setAttribute("name","twitter:image"),document.head.appendChild(e)),e.content=s}let p=document.querySelector('meta[property="og:url"]');p||(p=document.createElement("meta"),p.setAttribute("property","og:url"),document.head.appendChild(p)),p.content=`${window.location.origin}${window.location.pathname}?c=${this.companyDomain}`;let h=document.querySelector('meta[name="twitter:card"]');h||(h=document.createElement("meta"),h.setAttribute("name","twitter:card"),document.head.appendChild(h)),h.content="summary_large_image"}captureUTMParams(){const t=new URLSearchParams(window.location.search);if(b.forEach(e=>{const n=t.get(e);n&&(this.utmParams[e]=n)}),Object.keys(this.utmParams).length>0)sessionStorage.setItem(`utm_params_${this.companyDomain}`,JSON.stringify(this.utmParams)),console.log("[LP] UTM params captured:",this.utmParams);else{const t=sessionStorage.getItem(`utm_params_${this.companyDomain}`);if(t)try{this.utmParams=JSON.parse(t)}catch(e){}}}setupAdTracking(t){t.tiktokPixelId&&this.initTikTokPixel(t.tiktokPixelId),t.googleAdsId&&this.initGoogleAds(t.googleAdsId)}initTikTokPixel(t){t&&!window.ttq&&(!function(e,n,i){e.TiktokAnalyticsObject=i;var a=e[i]=e[i]||[];a.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],a.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var s=0;s<a.methods.length;s++)a.setAndDefer(a,a.methods[s]);a.instance=function(t){for(var e=a._i[t]||[],n=0;n<a.methods.length;n++)a.setAndDefer(e,a.methods[n]);return e},a.load=function(t,e){var n="https://analytics.tiktok.com/i18n/pixel/events.js";a._i=a._i||{},a._i[t]=[],a._i[t]._u=n,a._t=a._t||{},a._t[t]=+new Date,a._o=a._o||{},a._o[t]=e||{};var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=n+"?sdkid="+t+"&lib="+i;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(s,o)},a.load(t),a.page()}(window,document,"ttq"),console.log("[LP] TikTok Pixel initialized:",t))}initGoogleAds(t){if(!t)return;if("function"==typeof gtag)return gtag("config",t),void console.log("[LP] Google Ads configured:",t);const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${t}`,document.head.appendChild(e),e.onload=()=>{function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],window.gtag=e,e("js",new Date),e("config",t),console.log("[LP] Google Ads initialized:",t)}}trackConversion(t,e={}){var n,i;window.ttq&&(window.ttq.track(t,e),console.log("[LP] TikTok event tracked:",t,e)),(null==(n=this.lpSettings)?void 0:n.googleAdsId)&&(null==(i=this.lpSettings)?void 0:i.googleAdsLabel)&&"function"==typeof gtag&&(gtag("event","conversion",{send_to:`${this.lpSettings.googleAdsId}/${this.lpSettings.googleAdsLabel}`,...e}),console.log("[LP] Google Ads conversion tracked:",this.lpSettings.googleAdsId))}trackPageView(t){o("lp_view",{company_domain:t.companyDomain,company_name:t.company,...this.utmParams}),window.ttq&&window.ttq.track("ViewContent",{content_name:t.company,content_category:"company_lp"})}}document.addEventListener("DOMContentLoaded",()=>{(new v).init()});
