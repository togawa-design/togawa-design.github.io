import"./modulepreload-polyfill-YP0FEG5d.js";import{getUrlParam as e,showError as n,showLoading as t,waitForJobsLoader as a,trackEvent as o,escapeHtml as l}from"./utils-BNVq905i.js";import{i,f as c,e as s,b as d}from"./jobs-loader-BCrPIti6.js";import{I as r,P as p,D as m,J as y}from"./index-DMbtoUTV.js";import{i as u}from"./layout-C2GTnn7H.js";async function b(e,n,t){try{const a=[];for(const t of e)if(d(t)&&t.companyDomain!==n){if(t.jobsSheet&&t.jobsSheet.trim()){const e=await s(t.jobsSheet.trim());e&&e.length>0&&(e.forEach(e=>{e.company=t.company,e.companyDomain=t.companyDomain}),a.push(...e.slice(0,2)))}if(a.length>=6)break}!function(e,n,t){const a=document.getElementById("related-jobs-container");if(!a)return;const o=e.filter(e=>!(e.companyDomain===n&&String(e.id)===String(t))).slice(0,6);0!==o.length?a.innerHTML=o.map(e=>y({job:e})).join(""):a.innerHTML='<p class="no-data">関連する求人がありません。</p>'}(a.slice(0,6),n,t)}catch(a){console.error("関連求人の取得エラー:",a)}}let v=null;function f(){const e=document.getElementById("apply-modal");e&&(e.style.display="none"),document.body.style.overflow="",v=null}function g(e){["form","complete"].forEach(n=>{const t=document.getElementById(`apply-step-${n}`);t&&(t.style.display=n===e?"block":"none")})}function h(e,n){const t=document.getElementById(e);t&&(t.textContent=n,t.style.display="block")}function j(){var e,n;!function(){if("undefined"==typeof firebase)return console.warn("[Firestore] Firebase not loaded"),!1;const e={apiKey:"AIzaSyB3eXZoFkXOwnHxPvaHiWO7csmZK4KGqAQ",authDomain:"generated-area-484613-e3-90bd4.firebaseapp.com",projectId:"generated-area-484613-e3-90bd4"};firebase.apps.length||firebase.initializeApp(e),window.firebaseDb=firebase.firestore()}();const t=document.getElementById("apply-modal");t&&(t.querySelectorAll(".modal-close, .modal-close-btn").forEach(e=>{e.addEventListener("click",f)}),null==(e=t.querySelector(".modal-backdrop"))||e.addEventListener("click",f),null==(n=document.getElementById("apply-form"))||n.addEventListener("submit",$))}async function $(e){var n,t,a,l,i,c,s,d,r,p,m,y,u,b;e.preventDefault();const f=null==(t=null==(n=document.getElementById("apply-name"))?void 0:n.value)?void 0:t.trim(),j=null==(l=null==(a=document.getElementById("apply-name-kana"))?void 0:a.value)?void 0:l.trim(),$=null==(i=document.getElementById("apply-birthdate"))?void 0:i.value,E=null==(c=document.getElementById("apply-gender"))?void 0:c.value,D=null==(d=null==(s=document.getElementById("apply-phone"))?void 0:s.value)?void 0:d.trim(),w=null==(p=null==(r=document.getElementById("apply-email"))?void 0:r.value)?void 0:p.trim(),I=null==(y=null==(m=document.getElementById("apply-address"))?void 0:m.value)?void 0:y.trim(),B=null==(b=null==(u=document.getElementById("apply-message"))?void 0:u.value)?void 0:b.trim();if(function(e){const n=document.getElementById(e);n&&(n.style.display="none")}("apply-form-error"),!(f&&j&&$&&D&&w&&I))return void h("apply-form-error","必須項目を入力してください");if(!v)return void h("apply-form-error","エラーが発生しました。再度お試しください");const S=function(e){if(!e)return"";const n=new Date,t=new Date(e);let a=n.getFullYear()-t.getFullYear();const o=n.getMonth()-t.getMonth();return(o<0||0===o&&n.getDate()<t.getDate())&&a--,a}($);try{if(!(await async function(e){try{if(!window.firebaseDb)return console.warn("[Application] Firestore not initialized"),null;const n={companyDomain:e.company_domain,companyName:e.company_name,jobId:e.job_id,jobTitle:e.job_title,applicantName:e.name,applicantNameKana:e.nameKana,applicantBirthdate:e.birthdate,applicantAge:e.age,applicantGender:e.gender||"",applicantPhone:e.phone,applicantEmail:e.email,applicantAddress:e.address,applicantMessage:e.message||"",userId:null,status:"new",type:"apply",source:document.referrer||"direct",userAgent:navigator.userAgent,timestamp:new Date,createdAt:firebase.firestore.FieldValue.serverTimestamp()},t=await window.firebaseDb.collection("applications").add(n);return console.log("[Application] Saved to Firestore:",t.id),t.id}catch(n){return console.error("[Application] Failed to save:",n),null}}({...v,name:f,nameKana:j,birthdate:$,age:S,gender:E,phone:D,email:w,address:I,message:B})))throw new Error("Failed to save application");o("submit_application",v),g("complete")}catch(_){console.error("[Apply] Submit error:",_),h("apply-form-error","応募の送信に失敗しました。もう一度お試しください")}}function E(){document.querySelectorAll("[data-apply-btn]").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const t={company_domain:e.dataset.companyDomain,company_name:e.dataset.companyName,job_id:e.dataset.jobId,job_title:e.dataset.jobTitle};o("click_apply",t),function(e){v=e;const n=document.getElementById("apply-modal");if(!n)return;const t=document.getElementById("apply-job-info");t&&(t.textContent=`${e.company_name} - ${e.job_title}`);const a=document.getElementById("apply-form");a&&a.reset(),g("form"),n.style.display="flex",document.body.style.overflow="hidden"}(t)})})}async function D(){await i();const d=e("company"),y=e("job");if(d&&y){t("job-detail-container","求人情報を読み込んでいます...");try{await a();const e=await c();if(!e)return void n("job-detail-container","データの取得に失敗しました。");const t=e.find(e=>e.companyDomain&&e.companyDomain.trim()===d);if(!t)return void n("job-detail-container","会社が見つかりませんでした。");let i=null;if(t.jobsSheet&&t.jobsSheet.trim()){const e=await s(t.jobsSheet.trim());e&&(i=e.find(e=>String(e.id)===String(y)),i&&(i.company=t.company,i.companyDomain=t.companyDomain))}if(!i)return void n("job-detail-container","求人が見つかりませんでした。");!function(e){const n=document.getElementById("job-detail-container");if(!n)return;const t=e.displayedFeatures||"",a=t?t.split(",").map(e=>e.trim()).filter(e=>e):[],o=e.features||"",i=o?o.split(",").map(e=>e.trim()).filter(e=>e):[],c=a.length>0?a.slice(0,3):i.slice(0,3);n.innerHTML=`\n    <div class="lp-container">\n      \x3c!-- ヒーローセクション --\x3e\n      <section class="lp-hero-section">\n        <div class="lp-hero-bg"></div>\n        <div class="lp-hero-inner">\n          <p class="lp-hero-label">${l(e.company)}</p>\n          <h1 class="lp-hero-title">${l(e.title)}</h1>\n          <div class="lp-hero-meta">\n            <span class="lp-hero-location">\n              ${r.location}\n              ${l(e.location)}\n            </span>\n          </div>\n          <a href="#apply-section" class="lp-hero-cta" data-apply-btn data-job-id="${l(String(e.id))}" data-company-domain="${l(e.companyDomain)}" data-company-name="${l(e.company)}" data-job-title="${l(e.title)}">今すぐ応募する</a>\n        </div>\n      </section>\n\n      \x3c!-- ポイントセクション --\x3e\n      <section class="lp-points-section">\n        <div class="lp-section-inner">\n          <h2 class="lp-section-heading">この求人のポイント</h2>\n          <div class="lp-points-grid">\n            ${e.totalBonus?p({icon:r.money,label:"特典総額",value:e.totalBonus,isHighlight:!0}):""}\n            ${e.monthlySalary?p({icon:r.wallet,label:"月収例",value:e.monthlySalary}):""}\n            ${e.employmentType?p({icon:r.briefcase,label:"雇用形態",value:e.employmentType}):""}\n          </div>\n          ${c.length>0?`\n          <div class="lp-tags">\n            ${c.map(e=>`<span class="lp-tag">${l(e)}</span>`).join("")}\n          </div>\n          `:""}\n        </div>\n      </section>\n\n      \x3c!-- 募集要項セクション --\x3e\n      <section class="lp-details-section">\n        <div class="lp-section-inner">\n          <h2 class="lp-section-heading">募集要項</h2>\n          <div class="lp-details-table">\n            ${m({label:"仕事内容",value:e.jobDescription})}\n            ${m({label:"給与",value:e.salary})}\n            ${m({label:"応募資格",value:e.requirements})}\n            ${m({label:"勤務時間",value:e.workingHours})}\n            ${m({label:"休日・休暇",value:e.holidays})}\n            ${m({label:"待遇・福利厚生",value:e.benefits})}\n            <div class="lp-detail-row">\n              <div class="lp-detail-label">勤務地</div>\n              <div class="lp-detail-value">${l(e.location)}</div>\n            </div>\n            ${e.access?`\n            <div class="lp-detail-row">\n              <div class="lp-detail-label">アクセス</div>\n              <div class="lp-detail-value">${l(e.access)}</div>\n            </div>\n            `:""}\n          </div>\n        </div>\n      </section>\n\n      \x3c!-- 応募セクション --\x3e\n      <section class="lp-apply-section" id="apply-section">\n        <div class="lp-section-inner">\n          <h2 class="lp-apply-heading">まずはお気軽にご応募ください</h2>\n          <p class="lp-apply-text">経験・学歴不問！あなたのご応募をお待ちしています。</p>\n          <div class="lp-apply-buttons">\n            <a href="#" class="lp-apply-btn primary" data-apply-btn data-job-id="${l(String(e.id))}" data-company-domain="${l(e.companyDomain)}" data-company-name="${l(e.company)}" data-job-title="${l(e.title)}">この求人に応募する</a>\n            <a href="company.html?id=${l(e.companyDomain)}" class="lp-apply-btn secondary">${l(e.company)}の企業情報を見る</a>\n          </div>\n        </div>\n      </section>\n    </div>\n  `}(i),function(e){const n=document.getElementById("breadcrumb-company");n&&(n.innerHTML=`<a href="company.html?id=${encodeURIComponent(e.companyDomain)}">${l(e.company)}</a>`);const t=document.getElementById("breadcrumb-current");t&&(t.textContent=e.title)}(i),function(e){document.title=`${e.title} | ${e.company} | L-SET`;const n=document.querySelector('meta[name="description"]');n&&(n.content=`${e.company}の${e.title}。${e.location}勤務。${e.totalBonus?"特典総額"+e.totalBonus+"。":""}`)}(i),b(e,d,y),o("view_job_detail",{company_domain:i.companyDomain,company_name:i.company,job_id:String(i.id),job_title:i.title,location:i.location}),j(),E(),u()}catch(v){console.error("求人詳細の取得エラー:",v),n("job-detail-container","データの取得に失敗しました。しばらくしてから再度お試しください。")}}else n("job-detail-container","求人が見つかりませんでした。")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>D(),0)}):setTimeout(()=>D(),0);
