<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">

  <title>求人管理 | リクエコ求人ナビ</title>

  <!-- スタイルシート -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
  <!-- 求人管理ダッシュボード -->
  <div id="job-manage-dashboard" class="admin-dashboard">
    <!-- サイドバー -->
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <h2>リクエコ求人ナビ</h2>
        <p>求人管理</p>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li><a href="admin.html" data-section="back"><span class="nav-icon">←</span>管理画面に戻る</a></li>
          <li class="active"><a href="#" data-section="jobs"><span class="nav-icon">📋</span>求人一覧</a></li>
          <li><a href="#" data-section="analytics"><span class="nav-icon">📈</span>アクセス解析</a></li>
          <li><a href="#" data-section="reports"><span class="nav-icon">📊</span>レポート</a></li>
        </ul>
      </nav>
      <div class="sidebar-footer">
        <a href="#" id="btn-open-sheet" target="_blank" class="btn-back-top">管理シートを開く</a>
        <a href="admin.html" class="btn-logout">管理画面へ戻る</a>
      </div>
    </aside>

    <!-- メインコンテンツ -->
    <main class="admin-main">
      <!-- ヘッダー -->
      <header class="admin-header">
        <h1 id="page-title">求人一覧</h1>
        <div class="header-actions">
          <button id="btn-add-job" class="btn-primary">+ 新規求人作成</button>
          <button id="btn-refresh" class="btn-refresh">更新</button>
        </div>
      </header>

      <!-- 求人一覧セクション -->
      <section id="section-jobs" class="admin-section active">
        <div class="info-box">
          <p id="company-info">会社: <strong id="company-name">-</strong></p>
          <p>この会社の求人データは、専用の管理シートで管理されています。</p>
        </div>

        <!-- 求人フィード出力 -->
        <div class="feed-export-section">
          <div class="feed-export-header">
            <h3>求人フィード出力</h3>
            <p class="form-hint">各求人媒体に掲載するためのフィードをダウンロードできます</p>
          </div>
          <div class="feed-export-buttons">
            <button id="btn-download-indeed" class="btn-feed" title="Indeed用XMLフィード">
              <span class="feed-icon">📄</span>
              <span class="feed-label">Indeed XML</span>
            </button>
            <button id="btn-download-google" class="btn-feed" title="Google しごと検索用JSON-LD">
              <span class="feed-icon">📄</span>
              <span class="feed-label">Google JSON-LD</span>
            </button>
            <button id="btn-download-jobbox" class="btn-feed" title="求人ボックス/スタンバイ用XML">
              <span class="feed-icon">📄</span>
              <span class="feed-label">求人ボックス XML</span>
            </button>
            <button id="btn-download-csv" class="btn-feed" title="CSV形式でエクスポート">
              <span class="feed-icon">📊</span>
              <span class="feed-label">CSV</span>
            </button>
          </div>
          <div id="feed-status" class="feed-status" style="display: none;">
            <div class="loading-spinner-small"></div>
            <span>フィードを生成中...</span>
          </div>
        </div>

        <div class="table-container">
          <table class="admin-table" id="jobs-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>募集タイトル</th>
                <th>勤務地</th>
                <th>月収</th>
                <th>表示</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="jobs-tbody">
              <tr>
                <td colspan="6" class="loading-cell">データを読み込み中...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- アクセス解析セクション -->
      <section id="section-analytics" class="admin-section">
        <div class="analytics-header">
          <h2>アクセス解析</h2>
          <p class="section-description">求人ページへのアクセス状況を確認できます</p>
        </div>

        <!-- 期間選択 -->
        <div class="analytics-controls">
          <div class="analytics-period-select">
            <label for="analytics-period">期間</label>
            <select id="analytics-period">
              <option value="7days" selected>過去7日間</option>
              <option value="30days">過去30日間</option>
              <option value="month">今月</option>
              <option value="last-month">先月</option>
            </select>
          </div>
          <button id="btn-load-analytics" class="btn-primary">データ取得</button>
        </div>

        <!-- サマリーカード -->
        <div class="analytics-summary">
          <div class="analytics-card">
            <div class="analytics-icon">👁️</div>
            <div class="analytics-content">
              <span class="analytics-value" id="analytics-pv">-</span>
              <span class="analytics-label">総PV数</span>
            </div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon">👤</div>
            <div class="analytics-content">
              <span class="analytics-value" id="analytics-users">-</span>
              <span class="analytics-label">ユニークユーザー</span>
            </div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon">📄</div>
            <div class="analytics-content">
              <span class="analytics-value" id="analytics-pages-per-session">-</span>
              <span class="analytics-label">平均閲覧ページ</span>
            </div>
          </div>
          <div class="analytics-card">
            <div class="analytics-icon">⏱️</div>
            <div class="analytics-content">
              <span class="analytics-value" id="analytics-avg-time">-</span>
              <span class="analytics-label">平均滞在時間</span>
            </div>
          </div>
        </div>

        <!-- 求人別アクセス数 -->
        <div class="analytics-section">
          <h3>求人別アクセス数</h3>
          <div class="analytics-table-container">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>求人タイトル</th>
                  <th>PV</th>
                  <th>ユーザー</th>
                  <th>直帰率</th>
                  <th>平均滞在時間</th>
                </tr>
              </thead>
              <tbody id="job-analytics-tbody">
                <tr>
                  <td colspan="5" class="loading-cell">「データ取得」ボタンをクリックしてください</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- 流入元別 -->
        <div class="analytics-section">
          <h3>流入元別アクセス</h3>
          <div class="analytics-table-container">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>流入元</th>
                  <th>セッション</th>
                  <th>割合</th>
                </tr>
              </thead>
              <tbody id="source-analytics-tbody">
                <tr>
                  <td colspan="3" class="loading-cell">-</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- デバイス別 -->
        <div class="analytics-section">
          <h3>デバイス別アクセス</h3>
          <div class="analytics-table-container">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>デバイス</th>
                  <th>セッション</th>
                  <th>割合</th>
                </tr>
              </thead>
              <tbody id="device-analytics-tbody">
                <tr>
                  <td colspan="3" class="loading-cell">-</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- 注意書き -->
        <div class="analytics-note">
          <p>※ アクセス解析データはGoogle Analyticsから取得しています。データ反映には最大24時間かかる場合があります。</p>
        </div>
      </section>

      <!-- レポートセクション -->
      <section id="section-reports" class="admin-section">
        <div class="report-header">
          <h2>応募レポート</h2>
          <p class="section-description">期間を選択してレポートを生成・ダウンロードできます</p>
        </div>

        <!-- 期間選択 -->
        <div class="report-controls">
          <div class="report-period-select">
            <label for="report-period">期間</label>
            <select id="report-period">
              <option value="week">今週</option>
              <option value="last-week">先週</option>
              <option value="month" selected>今月</option>
              <option value="last-month">先月</option>
              <option value="custom">カスタム</option>
            </select>
          </div>
          <div id="report-custom-dates" class="report-custom-dates" style="display: none;">
            <div class="date-input">
              <label for="report-from">開始日</label>
              <input type="date" id="report-from">
            </div>
            <span class="date-separator">〜</span>
            <div class="date-input">
              <label for="report-to">終了日</label>
              <input type="date" id="report-to">
            </div>
          </div>
          <button id="btn-generate-report" class="btn-primary">レポート生成</button>
        </div>

        <!-- レポートプレビュー -->
        <div id="report-preview" class="report-preview">
          <div class="report-loading" id="report-loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>レポートを生成中...</p>
          </div>

          <div id="report-content" style="display: none;">
            <!-- サマリーカード -->
            <div class="report-summary">
              <div class="summary-card">
                <div class="summary-icon">📥</div>
                <div class="summary-content">
                  <span class="summary-value" id="summary-total">0</span>
                  <span class="summary-label">総応募数</span>
                </div>
              </div>
              <div class="summary-card">
                <div class="summary-icon">📈</div>
                <div class="summary-content">
                  <span class="summary-value" id="summary-change">-</span>
                  <span class="summary-label">前期比</span>
                </div>
              </div>
              <div class="summary-card">
                <div class="summary-icon">✅</div>
                <div class="summary-content">
                  <span class="summary-value" id="summary-hired">0</span>
                  <span class="summary-label">採用数</span>
                </div>
              </div>
              <div class="summary-card">
                <div class="summary-icon">⏳</div>
                <div class="summary-content">
                  <span class="summary-value" id="summary-pending">0</span>
                  <span class="summary-label">対応中</span>
                </div>
              </div>
            </div>

            <!-- ステータス別内訳 -->
            <div class="report-section">
              <h3>ステータス別内訳</h3>
              <div class="report-table-container">
                <table class="report-table">
                  <thead>
                    <tr>
                      <th>ステータス</th>
                      <th>件数</th>
                      <th>割合</th>
                    </tr>
                  </thead>
                  <tbody id="status-breakdown">
                  </tbody>
                </table>
              </div>
            </div>

            <!-- 求人別パフォーマンス -->
            <div class="report-section">
              <h3>求人別パフォーマンス TOP5</h3>
              <div class="report-table-container">
                <table class="report-table">
                  <thead>
                    <tr>
                      <th>求人</th>
                      <th>応募数</th>
                      <th>PV</th>
                      <th>CVR</th>
                    </tr>
                  </thead>
                  <tbody id="job-performance">
                  </tbody>
                </table>
              </div>
            </div>

            <!-- 流入元分析 -->
            <div class="report-section">
              <h3>流入元分析</h3>
              <div class="report-table-container">
                <table class="report-table">
                  <thead>
                    <tr>
                      <th>流入元</th>
                      <th>応募数</th>
                      <th>割合</th>
                    </tr>
                  </thead>
                  <tbody id="source-breakdown">
                  </tbody>
                </table>
              </div>
            </div>

            <!-- 担当者別対応状況 -->
            <div class="report-section">
              <h3>担当者別対応状況</h3>
              <div class="report-table-container">
                <table class="report-table">
                  <thead>
                    <tr>
                      <th>担当者</th>
                      <th>対応済</th>
                      <th>未対応</th>
                    </tr>
                  </thead>
                  <tbody id="assignee-breakdown">
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- 未生成時メッセージ -->
          <div id="report-empty" class="report-empty">
            <div class="empty-icon">📊</div>
            <p>「レポート生成」ボタンをクリックしてレポートを作成してください</p>
          </div>
        </div>

        <!-- ダウンロードボタン -->
        <div class="report-actions" id="report-actions" style="display: none;">
          <button id="btn-report-csv" class="btn-secondary">
            <span class="btn-icon">📄</span>
            CSVダウンロード
          </button>
          <button id="btn-report-excel" class="btn-primary">
            <span class="btn-icon">📊</span>
            Excelダウンロード
          </button>
        </div>
      </section>
    </main>
  </div>

  <!-- 求人編集モーダル -->
  <div id="job-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 id="job-modal-title">求人情報の編集</h3>
        <button class="modal-close" id="job-modal-close">&times;</button>
      </div>
      <form id="job-edit-form">
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label for="edit-job-title">募集タイトル <span class="required">*</span></label>
              <input type="text" id="edit-job-title" required placeholder="例: 製造スタッフ募集！月収32万円以上">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-job-location">勤務地 <span class="required">*</span></label>
              <input type="text" id="edit-job-location" required placeholder="例: 愛知県豊田市">
            </div>
            <div class="form-group">
              <label for="edit-job-salary">月収（円）</label>
              <input type="number" id="edit-job-salary" placeholder="例: 320000">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-job-bonus">賞与合計（円）</label>
              <input type="number" id="edit-job-bonus" placeholder="例: 500000">
            </div>
            <div class="form-group">
              <label for="edit-job-order">表示順</label>
              <input type="number" id="edit-job-order" placeholder="1" min="1">
            </div>
          </div>
          <div class="form-group">
            <label for="edit-job-features">特徴（カンマ区切り）</label>
            <input type="text" id="edit-job-features" placeholder="例: 未経験歓迎, 寮完備, 交通費支給">
          </div>
          <div class="form-group">
            <label for="edit-job-badges">バッジ（カンマ区切り）</label>
            <input type="text" id="edit-job-badges" placeholder="例: 急募, 高収入">
          </div>
          <div class="form-group">
            <label for="edit-job-description">仕事内容</label>
            <textarea id="edit-job-description" rows="4" placeholder="仕事内容の詳細を入力..."></textarea>
          </div>
          <div class="form-group">
            <label for="edit-job-requirements">応募資格</label>
            <textarea id="edit-job-requirements" rows="3" placeholder="応募資格を入力..."></textarea>
          </div>
          <div class="form-group">
            <label for="edit-job-benefits">福利厚生</label>
            <textarea id="edit-job-benefits" rows="3" placeholder="福利厚生を入力..."></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-job-hours">勤務時間</label>
              <input type="text" id="edit-job-hours" placeholder="例: 8:00〜17:00">
            </div>
            <div class="form-group">
              <label for="edit-job-holidays">休日</label>
              <input type="text" id="edit-job-holidays" placeholder="例: 土日祝, GW, 年末年始">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-job-start-date">掲載開始日</label>
              <input type="date" id="edit-job-start-date">
            </div>
            <div class="form-group">
              <label for="edit-job-end-date">掲載終了日</label>
              <input type="date" id="edit-job-end-date">
            </div>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="edit-job-visible" checked>
              <span>公開する</span>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-danger" id="job-modal-delete" style="margin-right: auto; display: none;">削除</button>
          <button type="button" class="btn-secondary" id="job-modal-cancel">キャンセル</button>
          <button type="submit" class="btn-primary" id="job-modal-save">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <script type="module" src="/src/pages/job-manage.js"></script>
</body>
</html>
