rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // admin_users コレクション - 管理者ユーザー（Google認証）
    match /admin_users/{userId} {
      // 認証済みユーザーは読み取り可能
      allow read: if request.auth != null;
      // 管理者のみ書き込み可能（本番では管理者判定を追加）
      allow write: if true;
    }

    // company_users コレクション - 会社ユーザー（ID/PW認証）
    match /company_users/{userId} {
      // 認証済みユーザーまたはログイン時は読み取り可能
      allow read: if true;
      // 管理者のみ書き込み可能（本番では管理者判定を追加）
      allow write: if true;
    }

    // applications コレクション - 応募データ
    match /applications/{docId} {
      // 読み書き全て許可（開発用）
      allow read, write: if true;
    }

    // assignees コレクション - 担当者データ
    match /assignees/{docId} {
      allow read, write: if true;
    }

    // companies コレクション - 会社別設定
    match /companies/{companyDomain} {
      allow read, write: if true;

      // サブコレクション: assignees
      match /assignees/{assigneeId} {
        allow read, write: if true;
      }
    }

    // pageviews コレクション - ページビューデータ
    match /pageviews/{docId} {
      allow read, write: if true;
    }

    // page_analytics_events コレクション - ページアナリティクスイベント（LP/採用ページ）
    match /page_analytics_events/{docId} {
      // 書き込みは誰でも可能（Cloud Functions経由で送信）
      allow write: if true;
      // 読み取りは認証済みユーザーのみ
      allow read: if request.auth != null;
    }

    // page_analytics_daily コレクション - ページアナリティクス日次集計
    match /page_analytics_daily/{dateStr} {
      allow read: if request.auth != null;
      allow write: if true;

      // サブコレクション: stats
      match /stats/{statsId} {
        allow read: if request.auth != null;
        allow write: if true;
      }
    }

    // users コレクション - ユーザープロフィール
    match /users/{userId} {
      allow read, write: if true;
    }

    // その他のコレクションも許可（開発用）
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
